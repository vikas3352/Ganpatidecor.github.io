/*! For license information please see Gc2HostPpt.js.LICENSE.txt */
var Gc2HostPpt;(()=>{"use strict";var e,t,r={6840:(e,t)=>{var r,i,n,o,s,a;Object.defineProperty(t,"__esModule",{value:!0}),(a=t.Edge||(t.Edge={}))[a.Left=0]="Left",a[a.Top=1]="Top",a[a.Right=2]="Right",a[a.Bottom=3]="Bottom",a[a.Count=4]="Count",(s=t.EdgePosition||(t.EdgePosition={}))[s.Minimum=0]="Minimum",s[s.Middle=1]="Middle",s[s.Maximum=2]="Maximum",s[s.Count=3]="Count",(o=t.ChartChildPositionOptions||(t.ChartChildPositionOptions={}))[o.None=0]="None",o[o.DoNotReserveSpace=1]="DoNotReserveSpace",o[o.RelativeToPlotArea=2]="RelativeToPlotArea",o[o.DoNotShareEdge=4]="DoNotShareEdge",(n=t.TickLabelsPosition||(t.TickLabelsPosition={}))[n.High=0]="High",n[n.Low=1]="Low",n[n.NextToAxis=2]="NextToAxis",n[n.Count=3]="Count",(i=t.TickMarksLayoutType||(t.TickMarksLayoutType={}))[i.Cross=0]="Cross",i[i.Inside=1]="Inside",i[i.Outside=2]="Outside",i[i.None=3]="None",i[i.Count=4]="Count",(r=t.TrendlineType||(t.TrendlineType={}))[r.Linear=0]="Linear",r[r.Polynomial=1]="Polynomial",r[r.Exponential=2]="Exponential",r[r.Logarithmic=3]="Logarithmic",r[r.Power=4]="Power",r[r.MovingAverage=5]="MovingAverage",r[r.Count=6]="Count"},7900:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},3245:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isExperimentalText=function(e){return Array.isArray(e.lines)}},7279:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BubbleSeriesLayout={Canonical:"Bubble",Id:"Bubble|6646C07F-EE69-4C50-8884-14E2C12A8A9C"},t.BulletHorizontalLayout={Canonical:"Bullet Horizontal",Id:"Bullet Horizontal|9A25A13C-AB3E-4EF8-A1D9-39D9CCC37B8B"},t.BoxWhiskerSeriesLayout={Canonical:"Box-and-Whisker",Id:"Box-and-Whisker|14CC8215-BA99-43D8-9BE9-B8DBA7AD0F38"},t.BarClusteredSeriesLayout={Canonical:"Bar Clustered",Id:"Bar Clustered|E3705380-245A-4853-B6AA-83835693455E"},t.BarStackedSeriesLayout={Canonical:"Bar Stacked",Id:"Bar Stacked|EC5331C8-5FF9-4616-9FFA-6C75564A2351"},t.BarStacked100SeriesLayout={Canonical:"Bar Stacked (100%)",Id:"Bar Stacked (100%)|97A63078-E257-49FA-A446-87127409FDE1"},t.WordCloudSeriesLayout={Canonical:"Word Cloud",Id:"Word Cloud|C430CFE8-79A1-4D29-9CC9-E3684ADC40A9"},t.MapSeriesLayout={Canonical:"Map",Id:"Map|7C2B0DE5-DA0B-4699-9363-55B47CE0D858"},t.DoughnutSeriesLayout={Canonical:"Doughnut",Id:"Doughnut|2370A541-66E7-41A5-9C91-F652C321ECB4"},t.PieSeriesLayout={Canonical:"Pie",Id:"Pie|0ACFABC7-B08C-4B76-B4F0-CE04A553FE7B"},t.PieSubsliceSeriesLayout={Canonical:"Pie Subslice",Id:"Pie Subslice|87B522EA-8314-474F-A4A5-C496B913EB4A"},t.RoseSeriesLayout={Canonical:"Rose",Id:"Rose|7FB5902D-B5B1-4F68-9C44-019E0737EFE0"},t.TreemapSeriesLayout={Canonical:"Treemap",Id:"Treemap|46C6B32F-E068-4797-B132-46134DDE3841"},t.SunburstSeriesLayout={Canonical:"Sunburst",Id:"Sunburst|EB06F640-38E2-40E2-B7D7-B2CAA15A9888"},t.ScatterSeriesLayout={Canonical:"Scatter",Id:"Scatter|E5E0729E-3F80-40FE-BAD9-B2C1FC0C48DF"},t.StreamgraphLayout={Canonical:"Streamgraph",Id:"Streamgraph|C1BBDE14-A890-4AE1-BAE5-9E712511FB49"},t.AreaSeriesLayout={Canonical:"Area",Id:"Area|89C5F39D-8367-4002-B161-7317E84B765A"},t.AreaStackedSeriesLayout={Canonical:"Area Stacked",Id:"Area Stacked|559EE575-F359-4C18-A578-95DDF77451D4"},t.AreaStacked100SeriesLayout={Canonical:"Area Stacked (100%)",Id:"Area Stacked (100%)|310E5127-9664-483E-B00D-43661237ED58"},t.RadarSeriesLayout={Canonical:"Radar",Id:"Radar|807D8333-019F-4585-803D-D3E7B910A21F"},t.RadarFilledSeriesLayout={Canonical:"Radar Filled",Id:"Radar Filled|EA4BD985-602D-4D31-A381-5D03785A72D3"},t.LineSeriesLayout={Canonical:"Line",Id:"Line|0835421C-BB45-4049-B5A1-01A910FA5786"},t.LineStackedSeriesLayout={Canonical:"Line Stacked",Id:"Line Stacked|D6EC4F15-AA43-4EB2-AC1E-7598CB3C730B"},t.LineStacked100SeriesLayout={Canonical:"Line Stacked (100%)",Id:"Line Stacked (100%)|74199267-AFC6-47FE-8360-CBDE0AD03D92"},t.ColumnClusteredSeriesLayout={Canonical:"Column Clustered",Id:"Column Clustered|66CD2202-3E02-411B-B0C8-80F648956105"},t.ColumnStackedSeriesLayout={Canonical:"Column Stacked",Id:"Column Stacked|AFB97C4F-15E7-4492-B85F-F07F1CDCE9E9"},t.ColumnStacked100SeriesLayout={Canonical:"Column Stacked (100%)",Id:"Column Stacked (100%)|D4F12861-68F0-418A-A140-486C9B328FC0"},t.FunnelSeriesLayout={Canonical:"Funnel",Id:"Funnel|73edc3b8-0194-4fb7-b180-9745cfa4b3ed"},t.WaterfallSeriesLayout={Canonical:"Waterfall",Id:"Waterfall|EB06F640-38E2-40E2-B7D7-B2CAA15A9888"}},1428:(e,t,r)=>{function i(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),i(r(7900)),i(r(6840));var n=r(7279);t.Extensions=n;var o=r(4579);t.Utils=o;var s=r(3245);t.Experimental=s,i(r(675))},675:(e,t)=>{var r,i,n,o,s,a,l,h;Object.defineProperty(t,"__esModule",{value:!0}),t.isLinearGradientShade=function(e){return"number"==typeof e.angle},t.isRadialGradientShade=function(e){return"object"==typeof e.center},t.isSolidFillFormat=function(e){var t;return"string"==typeof(null===(t=e)||void 0===t?void 0:t.color)},t.isGradientFillFormat=function(e){var t;return Array.isArray(null===(t=e)||void 0===t?void 0:t.stops)},t.isPatternFillFormat=function(e){return"number"==typeof e.pattern},(h=t.LineDashStyle||(t.LineDashStyle={}))[h.Solid=0]="Solid",h[h.Dash=1]="Dash",h[h.Dot=2]="Dot",h[h.DashDot=3]="DashDot",h[h.DashDotDot=4]="DashDotDot",h[h.Count=5]="Count",(l=t.LineDashType||(t.LineDashType={}))[l.Solid=0]="Solid",l[l.Dash=1]="Dash",l[l.Dot=2]="Dot",l[l.DashDot=3]="DashDot",l[l.DashDotDot=4]="DashDotDot",l[l.RoundDot=5]="RoundDot",l[l.SquareDot=6]="SquareDot",l[l.LongDash=7]="LongDash",l[l.LongDashDot=8]="LongDashDot",l[l.LongDashDotDot=9]="LongDashDotDot",l[l.Count=10]="Count",(a=t.LineCapType||(t.LineCapType={}))[a.Flat=0]="Flat",a[a.Square=1]="Square",a[a.Round=2]="Round",a[a.Count=3]="Count",(s=t.LineJoinType||(t.LineJoinType={}))[s.Round=0]="Round",s[s.Bevel=1]="Bevel",s[s.Miter=2]="Miter",s[s.Count=3]="Count",(o=t.LineEndType||(t.LineEndType={}))[o.None=0]="None",o[o.Triangle=1]="Triangle",o[o.Stealth=2]="Stealth",o[o.Diamond=3]="Diamond",o[o.Oval=4]="Oval",o[o.Arrow=5]="Arrow",o[o.Count=6]="Count",(n=t.LineEndSize||(t.LineEndSize={}))[n.Small=0]="Small",n[n.Medium=1]="Medium",n[n.Large=2]="Large",n[n.Count=3]="Count",(i=t.SelectionHandleOption||(t.SelectionHandleOption={}))[i.All=0]="All",i[i.EndPoints=1]="EndPoints",i[i.Maximum=2]="Maximum",i[i.Count=3]="Count",(r=t.PatternType||(t.PatternType={}))[r.Horizontal=0]="Horizontal",r[r.Vertical=1]="Vertical",r[r.ForwardDiagonal=2]="ForwardDiagonal",r[r.BackwardDiagonal=3]="BackwardDiagonal",r[r.Cross=4]="Cross",r[r.DiagonalCross=5]="DiagonalCross",r[r.Pattern05Percent=6]="Pattern05Percent",r[r.Pattern10Percent=7]="Pattern10Percent",r[r.Pattern20Percent=8]="Pattern20Percent",r[r.Pattern25Percent=9]="Pattern25Percent",r[r.Pattern30Percent=10]="Pattern30Percent",r[r.Pattern40Percent=11]="Pattern40Percent",r[r.Pattern50Percent=12]="Pattern50Percent",r[r.Pattern60Percent=13]="Pattern60Percent",r[r.Pattern70Percent=14]="Pattern70Percent",r[r.Pattern75Percent=15]="Pattern75Percent",r[r.Pattern80Percent=16]="Pattern80Percent",r[r.Pattern90Percent=17]="Pattern90Percent",r[r.LightDownwardDiagonal=18]="LightDownwardDiagonal",r[r.LightUpwardDiagonal=19]="LightUpwardDiagonal",r[r.DarkDownwardDiagonal=20]="DarkDownwardDiagonal",r[r.DarkUpwardDiagonal=21]="DarkUpwardDiagonal",r[r.WideDownwardDiagonal=22]="WideDownwardDiagonal",r[r.WideUpwardDiagonal=23]="WideUpwardDiagonal",r[r.LightVertical=24]="LightVertical",r[r.LightHorizontal=25]="LightHorizontal",r[r.NarrowVertical=26]="NarrowVertical",r[r.NarrowHorizontal=27]="NarrowHorizontal",r[r.DarkVertical=28]="DarkVertical",r[r.DarkHorizontal=29]="DarkHorizontal",r[r.DashedDownwardDiagonal=30]="DashedDownwardDiagonal",r[r.DashedUpwardDiagonal=31]="DashedUpwardDiagonal",r[r.DashedHorizontal=32]="DashedHorizontal",r[r.DashedVertical=33]="DashedVertical",r[r.SmallConfetti=34]="SmallConfetti",r[r.LargeConfetti=35]="LargeConfetti",r[r.ZigZag=36]="ZigZag",r[r.Wave=37]="Wave",r[r.DiagonalBrick=38]="DiagonalBrick",r[r.HorizontalBrick=39]="HorizontalBrick",r[r.Weave=40]="Weave",r[r.Plaid=41]="Plaid",r[r.Divot=42]="Divot",r[r.DottedGrid=43]="DottedGrid",r[r.DottedDiamond=44]="DottedDiamond",r[r.Shingle=45]="Shingle",r[r.Trellis=46]="Trellis",r[r.Sphere=47]="Sphere",r[r.SmallGrid=48]="SmallGrid",r[r.SmallCheckerBoard=49]="SmallCheckerBoard",r[r.LargeCheckerBoard=50]="LargeCheckerBoard",r[r.OutlinedDiamond=51]="OutlinedDiamond",r[r.SolidDiamond=52]="SolidDiamond",r[r.Count=53]="Count"},4579:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var i,n=r(675),o=((i={})[0]="none",i[1]="categoryNames",i[2]="values",i[3]="xValues",i[4]="yValues",i[5]="sizeValues",i[6]="openValues",i[7]="closeValues",i[8]="highValues",i[9]="lowValues",i[10]="rValues",i[11]="thetaValues",i[12]="errorBarsPosValues",i[13]="errorBarsNegValues",i[14]="canvasXValues",i[15]="canvasYValues",i[16]="parentIndices",i[17]="stringRenderingData",i[18]="discreteRenderingData",i[19]="continuousRenderingData",i[20]="customValues",i[21]="customStrings",i[22]="dataIndex",i[23]="partialValues",i[24]="controlValues",i[25]="categoryValues",i[26]="categoryWidths",i[27]="regionIds",i[28]="count",i);function s(e){var t=e.toString(16).toUpperCase();return 1===t.length?"0"+t:t}function a(e){switch(e){case n.LineDashStyle.Dash:return[4,3];case n.LineDashStyle.Dot:return[1,3];case n.LineDashStyle.DashDot:return[4,3,1,3];case n.LineDashStyle.DashDotDot:return[4,3,1,3,1,3];default:return[0]}}t.getSeriesFieldFromDimension=function(e){return o[e]},t.getDataTypeFromDimension=function(e){switch(e){case 1:case 21:case 17:case 27:return 1;case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 18:case 20:case 22:case 23:case 24:case 25:case 26:return 0;default:return 2}},t.toHex=s,t.isInRange=function(e,t,r){return e>=t&&e<=r},t.brightenColor=function(e,t){t>0?(e.r=e.r*(1-t)+t,e.g=e.g*(1-t)+t,e.b=e.b*(1-t)+t):(e.r*=t+1,e.g*=t+1,e.b*=t+1)},t.colorToCSSString=function(e){if(e){var t=Math.floor(255*e.r),r=Math.floor(255*e.g),i=Math.floor(255*e.b);return 1===e.a?"#"+s(t)+s(r)+s(i):"rgba("+t+","+r+","+i+","+e.a.toFixed(4)+")"}},t.cssStringToColor=function(e){var t=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i.exec(e);if(t)return{r:parseInt(t[1],16)/255,g:parseInt(t[2],16)/255,b:parseInt(t[3],16)/255,a:1};var r=/^rgba\((\d+),(\d+),(\d+),(\d+\.\d+)\)$/i.exec(e);return r?{r:+r[1]/255,g:+r[2]/255,b:+r[3]/255,a:+r[4]}:void 0},t.pointToString=function(e){return e.x+","+e.y+" "},t.isMissingNumber=function(e){return isNaN(e)},t.lineDashStyleToDashArray=a,t.createStrokeDashArray=function(e,t){return a(e).map((function(e){return e*t}))}},104:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.UserAction||(t.UserAction={})).Render="render",r.Select="select",r.Deselect="deselect",r.Hover="hover",r.Unhover="unhover";var i=function(){function e(e){this.isActive=!0,this.start=performance.now(),this.data={actions:[],isSuccess:!0,entry:e}}return e.prototype.addAction=function(e){-1===this.data.actions.indexOf(e)&&this.data.actions.push(e)},e.prototype.setError=function(e){this.data.isSuccess=!1,this.data.errorMessage=e.message},e.prototype.end=function(){if(this.isActive){this.isActive=!1;var e=performance.now();this.data.duration=e-this.start,this.data.actions.sort(),(t=n.pop())&&t.sink.write(t.activity.getData())}var t},e.prototype.getEntry=function(){return this.data.entry},e.prototype.getData=function(){if(this.isActive)throw new Error("Data is invalid while activity is active.");return this.data},e}();t.Activity=i;var n=[];function o(e,t){var r=new i(t);return n.push({sink:e,activity:r}),r}function s(){var e;return null===(e=n[n.length-1])||void 0===e?void 0:e.activity}t.startActivity=o,t.getCurrentActivity=s,t.wrapWithActivity=function(e,t,r){var i,n;try{return e&&o(e,t),r()}catch(e){null===(i=s())||void 0===i||i.setError(e)}finally{null===(n=s())||void 0===n||n.end()}},t.wrapTimeout=function(e,t){var r,i;if("string"==typeof e)throw new Error("No string based timer.");var a,l=(null===(r=s())||void 0===r?void 0:r.getEntry())+"_timeout",h=null===(i=n[n.length-1])||void 0===i?void 0:i.sink;return setTimeout((a=h,function(){var t,r;try{a&&o(a,l),e()}catch(e){null===(t=s())||void 0===t||t.setError(e)}finally{null===(r=s())||void 0===r||r.end()}}),t)}},4354:function(e,t,r){var i=this&&this.__assign||function(){return i=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},i.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var n=r(104),o=function(){function e(){this.activities=[],this.timeout=-1,this.ignorableActions=[n.UserAction.Render,n.UserAction.Select,n.UserAction.Deselect]}return e.prototype.write=function(e){var t=this;e.actions.length>0&&e.actions.every((function(e){return-1!==t.ignorableActions.indexOf(e)}))?this.writeAggregated(e):(this.activities.push(e),-1!==this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout((function(){return t.flushActivities()}),1e3))},e.prototype.flushActivities=function(){for(var e;this.activities.length>0;){for(var t=this.activities[0],r=[],n=this.activities.length-1;n>=0;n--){var o=this.activities[n];this.shouldAggregate(t,o)&&(r.push(null!=(e=o.duration)?e:0),this.activities.splice(n,1))}var s=r.reduce((function(e,t){return e+t}))/r.length;this.writeAggregated(i(i({},t),{duration:{average:s,count:r.length}}))}},e.prototype.shouldAggregate=function(e,t){return e.errorMessage===t.errorMessage&&e.entry===t.entry&&e.actions.length===t.actions.length&&e.actions.every((function(e,r){return t.actions[r]===e}))},e}();t.AggregatingActivitySink=o},690:function(e,t,r){var i,n=this&&this.__extends||(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},i(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){var r=e.call(this)||this;return r.callback=t,r}return n(t,e),t.prototype.writeAggregated=function(e){this.callback(e)},t}(r(4354).AggregatingActivitySink);t.CallbackActivitySink=o},8956:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this.minX=Number.MAX_VALUE,this.maxX=-Number.MAX_VALUE,this.minY=Number.MAX_VALUE,this.maxY=-Number.MAX_VALUE}return e.prototype.addPoint=function(e){this.minX=Math.min(this.minX,e.x),this.maxX=Math.max(this.maxX,e.x),this.minY=Math.min(this.minY,e.y),this.maxY=Math.max(this.maxY,e.y)},e.prototype.getBounds=function(){return{min:{x:this.minX,y:this.minY},max:{x:this.maxX,y:this.maxY}}},e.prototype.isEmpty=function(){return this.minX===Number.MAX_VALUE&&this.maxX===-Number.MAX_VALUE&&this.minY===Number.MAX_VALUE&&this.maxY===-Number.MAX_VALUE},e.prototype.reset=function(){this.minX=Number.MAX_VALUE,this.maxX=-Number.MAX_VALUE,this.minY=Number.MAX_VALUE,this.maxY=-Number.MAX_VALUE},e}();t.Bounds2D=r},3976:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var i=r(1428),n=r(8688),o=r(7882),s=r(8202),a=function(){function e(e){this.filled=!1,this.masterInstancer=new o.MasterInstancer,this.isCreatingMaster=!1;var t=e.getContext("2d");if(!t)throw new Error("Invalid canvas");this.context=t,n.scale2DCanvasContextByDevicePixelRatio(this.context),this.context.clearRect(0,0,e.width,e.height)}return e.prototype.beginGeometry=function(e){return this.formatObject=e,!0},e.prototype.endGeometry=function(){return this.formatObject=void 0,this.masterInstancer.reset(),!0},e.prototype.beginPath=function(e){return!this.isCreatingMaster||this.masterInstancer.beginPath(e)},e.prototype.endPath=function(){return!this.isCreatingMaster||this.masterInstancer.endPath()},e.prototype.beginFigure=function(e,t,r){return this.isCreatingMaster?this.masterInstancer.beginFigure(e,t,r):(this.context.beginPath(),this.context.moveTo(e.x+.5,e.y+.5),this.filled=t,!0)},e.prototype.endFigure=function(e){if(!this.formatObject)throw new Error("Missing format object.");if(this.isCreatingMaster)return this.masterInstancer.endFigure(e);if(this.context.save(),e&&this.context.closePath(),this.filled){var t=this.formatObject.getFill();if(!i.isSolidFillFormat(t))throw new Error("Unsupported fill.");this.context.fillStyle=t.color,this.context.fill()}var r=this.formatObject.getLineThickness();if("number"==typeof r&&(this.context.lineWidth=r),0!==r){var n=this.formatObject.getLineDashType(),o=this.formatObject.getLineCapType();n!==i.LineDashType.Solid&&this.context.setLineDash(s.createStrokeDashArray(n,r,o));var a=this.formatObject.getLineFill();if(!i.isSolidFillFormat(a))throw new Error("Unsupported line fill.");this.context.strokeStyle=a.color,this.context.stroke()}return this.context.restore(),!0},e.prototype.addLines=function(e){if(this.isCreatingMaster)return this.masterInstancer.addLines(e);for(var t=0,r=e;t<r.length;t++){var i=r[t];this.context.lineTo(i.x+.5,i.y+.5)}return!0},e.prototype.addBeziers=function(e){if(this.isCreatingMaster)return this.masterInstancer.addBeziers(e);for(var t=0;t<e.length;t+=3)this.context.bezierCurveTo(e[t+0].x+.5,e[t+0].y+.5,e[t+1].x+.5,e[t+1].y+.5,e[t+2].x+.5,e[t+2].y+.5);return!0},e.prototype.addEscape=function(e,t){if(this.isCreatingMaster&&101!==e)return this.masterInstancer.addEscape(e,t);switch(e){case 100:this.masterInstancer.reset(),this.isCreatingMaster=!0;break;case 101:this.isCreatingMaster=!1;break;case 102:this.masterInstancer.createInstance(this,t)}return!0},e.prototype.render=function(e){var t=this;e.enumerateGeometry(this),this.renderText(e.getText()),e.getChildren().forEach((function(e){return t.render(e)}))},e.prototype.renderText=function(e){if(e){this.context.save(),this.context.translate(e.getLocation().x,e.getLocation().y),this.context.rotate(Math.PI*e.getAngle()/180);for(var t=0,r=0,i=e.getLines();r<i.length;r++){for(var n=i[r],o=0,s=0,a=n.getRuns();s<a.length;s++){var l=a[s],h="";2===l.getStyle()?h+="italic ":1===l.getStyle()&&(h+="oblique "),l.getWeight()>=700&&(h+="bold ");var c=""+h+l.getPixelSize()+"px "+l.getFaceName();this.context.font=c,this.context.fillStyle=l.getColor(),this.context.fillText(l.getText(),o,t+n.getBaseline()),o+=this.context.measureText(l.getText()).width}t+=n.getHeight()}this.context.restore()}},e}();t.CanvasSink=a},532:function(e,t,r){var i=this&&this.__assign||function(){return i=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},i.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var n,o=r(7828);!function(e){e[e.Idle=0]="Idle",e[e.LayoutInProgress=1]="LayoutInProgress",e[e.RenderInProgress=2]="RenderInProgress",e[e.LayoutAndRenderInProgress=3]="LayoutAndRenderInProgress"}(n=t.HostStatus||(t.HostStatus={}));var s=function(){function e(e,t,r){var i=this;this.layoutInProgress=!1,this.renderInProgress=!1,this.listeners={},this.layoutProvider=e,this.chartPlayer=new o.ChartPlayer(t,r),this.chartPlayer.on("finish",(function(e,t){i.onRenderFinish(e,t)})),this.chartPlayer.on("error",(function(e,t){i.onRenderError(e,t)}))}return e.prototype.on=function(e,t){return this.listeners[e]=t,this},e.prototype.getLayoutProvider=function(){return this.layoutProvider},e.prototype.setElement=function(e){this.chartPlayer.setElement(e),this.renderCurrent()},e.prototype.getRenderSettings=function(){return this.chartPlayer.getRenderSettings()},e.prototype.setRenderer=function(e){this.chartPlayer.setRenderer(e),this.renderCurrent()},e.prototype.setConfiguration=function(e){var t=i({},e);this.beginLayout(t)},e.prototype.beginLayout=function(e){var t=this;this.layoutInProgress?this.pendingChartDefinition=e:(this.setLayoutInProgress(!0),this.layoutProvider.getResource(e,this.chartPlayer.getRenderSettings().renderer,(function(e,r){if(t.setLayoutInProgress(!1),e?t.notifyError("LayoutFailed: "+e):(t.currentChartLayout=r,t.renderCurrent()),t.pendingChartDefinition){var i=t.pendingChartDefinition;t.pendingChartDefinition=void 0,t.beginLayout(i)}})))},e.prototype.renderCurrent=function(){this.currentChartLayout&&this.chartPlayer.getElement()&&(this.setRenderInProgress(!0),this.chartPlayer.render(this.currentChartLayout))},e.prototype.setLayoutInProgress=function(e){this.layoutInProgress!==e&&(this.layoutInProgress=e,this.layoutInProgress?this.notifyStatusChanged("layout-start"):this.notifyStatusChanged("layout-finish"))},e.prototype.setRenderInProgress=function(e){this.renderInProgress!==e&&(this.renderInProgress=e,this.renderInProgress?this.notifyStatusChanged("render-start"):this.notifyStatusChanged("render-finish"))},e.prototype.notifyStatusChanged=function(e){this.listeners[e]&&this.listeners[e](e,this.getStatus())},e.prototype.notifyError=function(e){this.listeners.error&&this.listeners.error("error",e)},e.prototype.getStatus=function(){return this.layoutInProgress?this.renderInProgress?n.LayoutAndRenderInProgress:n.LayoutInProgress:this.renderInProgress?n.RenderInProgress:n.Idle},e.prototype.onRenderFinish=function(e,t){this.setRenderInProgress(!1)},e.prototype.onRenderError=function(e,t){this.notifyError("RenderFailed: "+t)},e}();t.ChartHost=s},7828:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var i,n=r(8688),o=r(311),s=r(6363),a=r(8911),l=r(2777),h=r(3636),c=r(873),u=r(8282),d=r(4092),p=r(3976),f=r(4002),g=r(7906),m=r(7938),v=r(104),y=r(690);!function(e){e[e.Idle=0]="Idle",e[e.Rendering=1]="Rendering",e[e.Finished=2]="Finished"}(i=t.RenderStatus||(t.RenderStatus={}));var _=function(){function e(e,t,r){this.renderingStatus=i.Idle,this.listeners={},this.activitySink=new y.CallbackActivitySink(this.handleActivity.bind(this)),this.renderSettings=e,this.element=t,this.renderHost=r||new c.DefaultRenderHost}return e.prototype.getElement=function(){return this.element},e.prototype.setElement=function(e){this.element=e},e.prototype.getRenderSettings=function(){return this.renderSettings},e.prototype.setRenderer=function(e){this.renderSettings.renderer=e},e.prototype.on=function(e,t){return this.listeners[e]=t,this},e.prototype.render=function(e,t){var r=this;v.wrapWithActivity(this.activitySink,"ChartPlayer.render",(function(){var n;if(!r.element)throw new Error("Missing element.");r.renderingStatus!==i.Rendering&&(r.setAndNotifyStatus(i.Rendering),r.renderSettings.renderer===s.IvyRenderer.Image?r.renderImage(r.element,e):r.renderSettings.renderer===s.IvyRenderer.JSON?r.renderJson(r.element,e):r.renderSettings.renderer===s.IvyRenderer.Canvas?r.renderCanvas(r.element,e):r.renderSettings.renderer===s.IvyRenderer.Svg&&r.renderSvg(r.element,e,t),null===(n=v.getCurrentActivity())||void 0===n||n.addAction(v.UserAction.Render),r.setAndNotifyStatus(i.Finished))}))},e.prototype.select=function(e){var t=this;v.wrapWithActivity(this.activitySink,"ChartPlayer.select",(function(){var r;return null===(r=t.interactivityManager)||void 0===r?void 0:r.select(e)}))},e.prototype.selectParent=function(){var e=this;v.wrapWithActivity(this.activitySink,"ChartPlayer.selectParent",(function(){var t;return null===(t=e.interactivityManager)||void 0===t?void 0:t.selectParent()}))},e.prototype.selectFirstChild=function(){var e=this;v.wrapWithActivity(this.activitySink,"ChartPlayer.selectFirstChild",(function(){var t;return null===(t=e.interactivityManager)||void 0===t?void 0:t.selectFirstChild()}))},e.prototype.selectNextSibling=function(){var e=this;v.wrapWithActivity(this.activitySink,"ChartPlayer.selectNextSibling",(function(){var t;return null===(t=e.interactivityManager)||void 0===t?void 0:t.selectNextSibling()}))},e.prototype.selectPreviousSibling=function(){var e=this;v.wrapWithActivity(this.activitySink,"ChartPlayer.selectPreviousSibling",(function(){var t;return null===(t=e.interactivityManager)||void 0===t?void 0:t.selectPreviousSibling()}))},e.prototype.getDescription=function(){var e=this;return v.wrapWithActivity(this.activitySink,"ChartPlayer.getDescription",(function(){var t;return null===(t=e.interactivityManager)||void 0===t?void 0:t.getDescription()}))},Object.defineProperty(e.prototype,"isInteractivityEnabled",{set:function(e){var t=this;v.wrapWithActivity(this.activitySink,"ChartPlayer.isInteractivityEnabled",(function(){t.interactivityManager&&(t.interactivityManager.isEnabled=e)}))},enumerable:!0,configurable:!0}),e.prototype.renderCanvas=function(e,t){if("object"!=typeof t.data)throw new Error("Unsupported svg resource.");var r=new o.SceneGraph(t.data),i=r.getSize(),s=n.createCanvas(e,i.width,i.height);new p.CanvasSink(s).render(r.getRoot())},e.prototype.renderSvg=function(e,t,r){var i=this;if(!this.renderHost)throw new Error("Render host is needed for svg rendering.");if("object"!=typeof t.data)throw new Error("Unsupported svg resource.");var s=new o.SceneGraph(t.data),c=s.getSize(),p=s.getBorderWidth(),v=document.createElementNS(u.svgns,"svg");this.renderSettings.disableChartElementResize||(v.setAttribute("width",""+(c.width+2*p)),v.setAttribute("height",""+(c.height+2*p))),n.replaceChildren(e,[v]);var y=new d.SvgSink(s,v,this.renderHost,this.activitySink);if(y.render(),r){var _=new a.Interactivity(r.data),b=this.renderHost.isFeatureEnabled("EnableTooltips",!1)?new l.SvgTooltip(v):new m.NullTooltip(v),T=new g.NotifyingSelector(new f.SvgSelector(v),(function(e,t){return i.notifySelectionChanged(e,t)}),(function(e){return i.notifyDoubleClick(e)}));T.setHandles(y.getHandles()),T.setPathWidths(y.getPathWidths());var w=new h.InteractivityManager(b,T,_.getRoot());y.addObserver(w),this.interactivityManager=w}},e.prototype.renderImage=function(e,t){if("string"!=typeof t.data)throw new Error("Invalid image.");var r="data:image"===t.data.substring(0,10)?t.data:"data:image/png;base64,"+t.data,i=document.createElement("img");i.alt="Chart",i.src=r,n.replaceChildren(e,[i])},e.prototype.renderJson=function(e,t){var r=document.createElement("pre");r.innerText=JSON.stringify(t.data,null,2),n.replaceChildren(e,[r])},e.prototype.setAndNotifyStatus=function(e){if(this.renderingStatus!==e)switch(this.renderingStatus=e,this.renderingStatus){case i.Rendering:this.notifyStateChanged("start");break;case i.Finished:this.notifyStateChanged("finish")}},e.prototype.notifyStateChanged=function(e){this.listeners[e]&&this.listeners[e](e,this.renderingStatus)},e.prototype.handleActivity=function(e){e.isSuccess?this.notifyLog(JSON.stringify(e)):this.notifyError(JSON.stringify(e))},e.prototype.notifyLog=function(e){this.listeners.log&&this.listeners.log("log",e)},e.prototype.notifyError=function(e){this.listeners.error&&this.listeners.error("error",e)},e.prototype.notifySelectionChanged=function(e,t){this.listeners.select&&this.listeners.select("select",e,t)},e.prototype.notifyDoubleClick=function(e){this.listeners.dblclick&&this.listeners.dblclick("dblclick",e)},e}();t.ChartPlayer=_},8202:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var i=r(1428);t.createStrokeDashArray=function(e,t,r){var n=function(e){switch(e){case i.LineDashType.Dash:return[4,3];case i.LineDashType.Dot:return[1,3];case i.LineDashType.DashDot:return[4,3,1,3];case i.LineDashType.DashDotDot:return[4,3,1,3,1,3];case i.LineDashType.RoundDot:return[1,1];case i.LineDashType.SquareDot:return[3,1];case i.LineDashType.LongDash:return[8,3];case i.LineDashType.LongDashDot:return[8,3,1,3];case i.LineDashType.LongDashDotDot:return[8,3,1,3,1,3];case i.LineDashType.Solid:default:return[0]}}(e);return r===i.LineCapType.Flat?n.map((function(e){return e*t})):n.map((function(e,t){return t%2==0?e-1:e+1})).map((function(e){return e*t}))}},873:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.prototype.renderCustomData=function(e,t){},e.prototype.isFeatureEnabled=function(e,t){return t},e.prototype.setFeatureIsEnabled=function(e,t){throw new Error("DefaultRenderHost does not allow setting feature enablement.")},e}();t.DefaultRenderHost=r},8688:(e,t)=>{function r(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function i(e,t){r(e),t.forEach((function(t){e.appendChild(t)}))}Object.defineProperty(t,"__esModule",{value:!0}),t.removeChildren=r,t.replaceChildren=i,t.getParentElement=function(e){var t,r=e.parentNode;if((null===(t=r)||void 0===t?void 0:t.nodeType)===Node.ELEMENT_NODE)return r},t.getOffsetInRect=function(e,t,r){return{x:t-e.left,y:r-e.top}},t.createCanvas=function(e,t,r){var n=document.createElement("canvas"),o=window.devicePixelRatio||1;return n.style.width=t+"px",n.style.height=r+"px",n.width=t*o,n.height=r*o,i(e,[n]),n},t.scale2DCanvasContextByDevicePixelRatio=function(e){var t=window.devicePixelRatio||1;e.scale(t,t)},t.customDataClassName="custom-data",t.hitTestingClassName="hit-test"},8282:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.svgns="http://www.w3.org/2000/svg",t.xlinkns="http://www.w3.org/1999/xlink"},9569:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var i=r(6363),n=function(){function e(e){var t,r;this.extensionsUrl=null!=(t=e.extensionsUrl)?t:e.base+"/charts/extensions?clientId="+e.clientId,this.layoutUrl=null!=(r=e.layoutUrl)?r:e.base+"/charts?clientId="+e.clientId}return e.prototype.getExtensions=function(e){this.get(this.extensionsUrl,e)},e.prototype.getResource=function(e,t,r){t===i.IvyRenderer.Image?this.getImage(e,r):this.getJson(e,r)},e.prototype.getImage=function(e,t){this.callPost("image/png",e,t)},e.prototype.getJson=function(e,t){this.callPost("application/json",e,t)},e.prototype.callPost=function(e,t,r){this.post(this.layoutUrl,e,t,r)},e.prototype.post=function(e,t,r,i){var n=new XMLHttpRequest;n.open("POST",e),n.setRequestHeader("Accept",t),n.setRequestHeader("Content-Type","text/plain"),n.send(JSON.stringify(r)),this.completeAjax(n,i)},e.prototype.get=function(e,t){var r=new XMLHttpRequest;r.open("GET",e),r.send(null),this.completeAjax(r,t)},e.prototype.completeAjax=function(e,t){e.onreadystatechange=function(){e.readyState===XMLHttpRequest.DONE&&(200===e.status?t(null,JSON.parse(e.responseText)):t("Edera RequestFailed StatusCode: "+e.status,null))}},e}();t.EderaLayoutProvider=n},9072:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getDomIdFromElementId=function(e,t){return"number"==typeof t?"ce"+e+"-"+t:"ce"+e};var r=/^ce([\w.]+)(-\d)?$/;t.isElementDomId=function(e){return r.test(e)},t.getElementIdFromDomId=function(e){var t;return null===(t=r.exec(e))||void 0===t?void 0:t[1]},t.getElementInfoFromDomId=function(e){if("string"==typeof e){var t=r.exec(e);if(t&&3===t.length){if(void 0===t[2])return{id:t[1]};var i=parseInt(t[2].slice(1),10);return{id:t[1],datapointIndex:i}}}}},3640:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.resetTimer=0,this.initial=e,this.value=e}return e.prototype.getValue=function(){return this.value},e.prototype.setValue=function(e,t){var r=this;clearTimeout(this.resetTimer),this.value=e,this.resetTimer=setTimeout((function(){return r.reset()}),t)},e.prototype.reset=function(){clearTimeout(this.resetTimer),this.value=this.initial},e}();t.ExpiringValue=r},1432:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});var r=0;t.generateUniqueId=function(){return"MSChart-"+(++r).toString()}},9140:(e,t,r)=>{function i(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),i(r(1428)),i(r(6363)),i(r(532)),i(r(7828)),i(r(9569)),i(r(6725))},143:function(e,t){var r=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var i=Array(e),n=0;for(t=0;t<r;t++)for(var o=arguments[t],s=0,a=o.length;s<a;s++,n++)i[n]=o[s];return i};Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this.handles=[]}return e.prototype.getHandles=function(){return r(this.handles)},e.prototype.reset=function(){this.handles=[]},e.prototype.beginGeometry=function(e){return!0},e.prototype.endGeometry=function(){return!0},e.prototype.beginPath=function(e){return!0},e.prototype.endPath=function(){return!0},e.prototype.beginFigure=function(e,t,r){return this.handles.push(e),!0},e.prototype.endFigure=function(e){return!0},e.prototype.addLines=function(e){return this.handles=this.handles.concat(e),!0},e.prototype.addBeziers=function(e){var t=e.filter((function(e,t){return(t+1)%3==0}));return this.handles=this.handles.concat(t),!0},e.prototype.addEscape=function(e,t){return!0},e}();t.HandleSink=i},9639:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var i=r(1428),n=r(6341),o=function(){function e(e){this.element=e}return e.prototype.getId=function(){return this.element.id},e.prototype.getDescription=function(){return this.element.description},e.prototype.getOnlyShowText=function(){return!!this.element.onlyShowText&&this.element.onlyShowText},e.prototype.hasDescription=function(){return"string"==typeof this.element.description},e.prototype.getChildren=function(){return this.element.children?this.element.children.map((function(t){return new e(t)})):[]},e.prototype.getDatapointChildren=function(){return this.element.datapointChildren?this.element.datapointChildren.map((function(e){return new n.InteractiveElementDatapoint(e)})):[]},e.prototype.getSelectionHandleOption=function(){return this.element.selectionHandleOption?this.element.selectionHandleOption:i.SelectionHandleOption.All},e}();t.InteractiveElement=o},6341:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var i=r(6662),n=function(){function e(e){this.element=e}return e.prototype.getIndex=function(){return this.element.index},e.prototype.getTitle=function(){return this.element.title},e.prototype.getDescription=function(){return this.element.description?this.element.description.map((function(e){return new i.InteractiveElementDatapointDescription(e)})):[]},e.prototype.hasTooltip=function(){return"string"==typeof this.element.title||this.getDescription().length>0},e.prototype.getDatapointChildren=function(){return this.element.children?this.element.children.map((function(t){return new e(t)})):[]},e}();t.InteractiveElementDatapoint=n},6662:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.element=e}return e.prototype.getHeading=function(){return this.element.heading},e.prototype.getValue=function(){return this.element.value},e}();t.InteractiveElementDatapointDescription=r},8911:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var i=r(9639),n=function(){function e(e){this.root=new i.InteractiveElement(e.root)}return e.prototype.getRoot=function(){return this.root},e}();t.Interactivity=n},3636:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var i,n=r(5629),o=r(9759),s=r(3640),a=r(1428),l=r(9072),h=r(104);!function(e){e[e.None=0]="None",e[e.ChartElement=1]="ChartElement",e[e.Datapoint=2]="Datapoint",e[e.Count=3]="Count"}(i||(i={}));var c=function(){function e(e,t,r){this.tooltips={},this.datapointTooltips={},this.tooltipType=i.None,this.delayDatapointTooltip=new s.ExpiringValue(!0),this.selectables=[],this._isEnabled=!0,this.tooltip=e,this.selector=t,this.root=r,this.cacheTooltipText(r),this.cacheSelectables(r)}return e.prototype.receiveMouseOver=function(e){var t=this;if(this._isEnabled){var r=e.target?this.getSelectionCandidateId(e.target):void 0;this.hover(r);for(var n=e.target;n;){var o=l.getDomIdFromElementId(n.getId());if(-1!==Object.keys(this.datapointTooltips).indexOf(o)){this.tooltipType=i.Datapoint;var s=this.datapointTooltips[o],a=s.getTitle();a&&this.tooltip.setHeader(a),s.getDescription().forEach((function(e){t.tooltip.addPair(e.getHeading(),e.getValue())})),this.showDatapointTooltip(e);break}if(-1!==Object.keys(this.tooltips).indexOf(o)){this.tooltipType=i.ChartElement,this.tooltip.setHeader(this.tooltips[o]),this.showNonDatapointTooltip(e);break}n=n.getParent()}}},e.prototype.receiveMouseMove=function(e){if(this._isEnabled){var t=e.target?this.getSelectionCandidateId(e.target):void 0;switch(this.hover(t),this.tooltipType){case i.ChartElement:this.showNonDatapointTooltip(e);break;case i.Datapoint:this.showDatapointTooltip(e)}}},e.prototype.receiveMouseOut=function(){this._isEnabled&&(this.hover(void 0),this.removeTooltips())},e.prototype.receiveMouseDown=function(e){this._isEnabled&&this.handleSelection(e,n.PointerType.Mouse)},e.prototype.receivePointerDown=function(e,t){if(this._isEnabled){var r=n.convertPointerTypeToEnum(t);this.handleSelection(e,r)}},e.prototype.receiveDoubleClick=function(e){if(this._isEnabled){var t=e.target?this.getSelectionCandidateId(e.target):void 0;t?(this.selector.doubleClick(t),e.stopPropagation()):this.selector.doubleClick(void 0)}},e.prototype.select=function(e){if(this._isEnabled){if(e===this.selector.getSelectedId())return;if(e&&-1===this.selectables.indexOf(e))this.selector.select(void 0,!1,a.SelectionHandleOption.All);else{var t=!1,r=a.SelectionHandleOption.All;if(e){var i=this.getInteractiveElement(this.root,e);if(!i)throw new Error("Invalid selection.");t=i.getOnlyShowText(),r=i.getSelectionHandleOption()}this.selector.select(e,t,r)}}},e.prototype.selectParent=function(){this._isEnabled&&0!==this.selectables.length&&this.selector.getSelectedId()&&this.select(void 0)},e.prototype.selectFirstChild=function(){this._isEnabled&&0!==this.selectables.length&&(this.selector.getSelectedId()||this.select(this.selectables[0]))},e.prototype.selectNextSibling=function(){this.selectSibling(!0)},e.prototype.selectPreviousSibling=function(){this.selectSibling(!1)},e.prototype.getDescription=function(){var e=this.selector.getSelectedId();if(e){var t=this.getInteractiveElement(this.root,e);if(t)return t.getDescription();throw new Error("Invalid selection.")}return this.root.getDescription()},Object.defineProperty(e.prototype,"isEnabled",{set:function(e){e!==this._isEnabled&&(e||(this.hover(void 0),this.selector.select(void 0,!1,a.SelectionHandleOption.All),this.removeTooltips()),this._isEnabled=e)},enumerable:!0,configurable:!0}),e.prototype.hover=function(e){var t=this;if(this.hoverTimer&&clearTimeout(this.hoverTimer),e){var r=this.getInteractiveElement(this.root,e);if(!r)throw new Error("Invalid selection.");this.hoverTimer=h.wrapTimeout((function(){return t.selector.hover(e,r.getOnlyShowText())}),16)}else this.selector.hover(void 0,!1)},e.prototype.getInteractiveElement=function(e,t){if(e.getId()===t)return e;for(var r=0,i=e.getChildren();r<i.length;r++){var n=i[r],o=this.getInteractiveElement(n,t);if(o)return o}},e.prototype.removeTooltips=function(){this.tooltipType===i.Datapoint&&this.tooltip.isVisible()&&this.delayDatapointTooltip.setValue(!1,250),this.tooltipType=i.None,clearTimeout(this.showTooltipTimer),this.showTooltipTimer=0,this.tooltip.hide(),this.tooltip.removePairs()},e.prototype.cacheTooltipText=function(e){var t=this,r=e.getId(),i=e.getDescription();i&&(this.tooltips[l.getDomIdFromElementId(r)]=i),e.getChildren().forEach((function(e){t.cacheTooltipText(e)})),e.getDatapointChildren().filter((function(e){return e.hasTooltip()})).forEach((function(e){t.datapointTooltips[l.getDomIdFromElementId(r,e.getIndex())]=e}))},e.prototype.cacheSelectables=function(e){var t=this;e.getChildren().forEach((function(e){t.selectables.push(e.getId()),t.cacheSelectables(e)}))},e.prototype.getSelectionCandidateId=function(e){for(var t=e;t&&-1===this.selectables.indexOf(t.getId());)t=t.getParent();if(t)return t.getId()},e.prototype.showDatapointTooltip=function(e){this.tooltip.setPosition(e.x,e.y),this.tooltip.isVisible()||this.showTooltip(!this.delayDatapointTooltip.getValue(),o.TooltipOffset.Above)},e.prototype.showNonDatapointTooltip=function(e){this.tooltip.isVisible()||(this.tooltip.setPosition(e.x,e.y),this.showTooltip(!1,o.TooltipOffset.BelowRight))},e.prototype.showTooltip=function(e,t){var r=this,i=function(){r.tooltip.setOffset(t),r.tooltip.show()};e?i():(clearTimeout(this.showTooltipTimer),this.showTooltipTimer=setTimeout(i,250))},e.prototype.selectSibling=function(e){if(this._isEnabled&&0!==this.selectables.length){var t=this.selector.getSelectedId();if(t){var r=this.selectables.indexOf(t);if(r<0)throw new Error("Invalid selection.");r===(e?this.selectables.length-1:0)?this.select(this.selectables[e?0:this.selectables.length-1]):this.select(this.selectables[e?r+1:r-1])}}},e.prototype.handleSelection=function(e,t){var r=e.target?this.getSelectionCandidateId(e.target):void 0;r?((t===n.PointerType.Mouse&&this.selector.getSelectedId()!==r||t===n.PointerType.Touch)&&this.selectElement(r,t),e.stopPropagation()):this.selector.select(void 0,!1,a.SelectionHandleOption.All,t)},e.prototype.selectElement=function(e,t){var r=this.getInteractiveElement(this.root,e);if(!r)throw new Error("Invalid selection.");this.selector.select(e,r.getOnlyShowText(),r.getSelectionHandleOption(),t)},e}();t.InteractivityManager=c},7906:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var i=r(5629),n=function(){function e(e,t,r){this.wrapped=e,this.selectCallback=t,this.doubleClickCallback=r}return e.prototype.doubleClick=function(e){this.doubleClickCallback(e)},e.prototype.select=function(e,t,r,n){this.wrapped.select(e,t,r),this.selectCallback(e,n===i.PointerType.Touch)},e.prototype.getSelectedId=function(){return this.wrapped.getSelectedId()},e.prototype.hover=function(e,t){this.wrapped.hover(e,t)},e.prototype.setHandles=function(e){this.wrapped.setHandles(e)},e.prototype.setPathWidths=function(e){this.wrapped.setPathWidths(e)},e}();t.NotifyingSelector=n},7938:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.rootElement=e}return e.prototype.show=function(){},e.prototype.hide=function(){},e.prototype.isVisible=function(){return!1},e.prototype.setPosition=function(e,t){},e.prototype.setOffset=function(e){},e.prototype.setHeader=function(e){},e.prototype.addPair=function(e,t){},e.prototype.removePairs=function(){},e.prototype.getRoot=function(){return this.rootElement},e}();t.NullTooltip=r},5629:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Mouse="mouse",e.Touch="touch"}(r=t.PointerType||(t.PointerType={})),t.convertPointerTypeToEnum=function(e){switch(e){case"mouse":return r.Mouse;case"pen":case"touch":return r.Touch;default:throw new Error("PointerType not supported")}}},9759:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.TooltipOffset||(t.TooltipOffset={}))[r.Above=0]="Above",r[r.BelowRight=1]="BelowRight"},6725:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var i=r(8282),n=function(){function e(){this.features={}}return e.prototype.renderCustomData=function(e,t){this.setInnerHTML(e,t)},e.prototype.isFeatureEnabled=function(e,t){var r=this.features[e];return"boolean"==typeof r?r:t},e.prototype.setFeatureIsEnabled=function(e,t){this.features[e]=t},e.prototype.setInnerHTML=function(e,t){var r=document.createElementNS(i.svgns,"g");if(void 0!==r.innerHTML)r.innerHTML=t;else{if(!r.ownerDocument)throw new Error("Cannot render content.");var n=(new DOMParser).parseFromString(t,"text/xml").documentElement;r.appendChild(r.ownerDocument.importNode(n,!0))}for(var o=r.querySelector("svg")||r;o.firstElementChild;){var s=o.firstElementChild;o.removeChild(s),e.appendChild(s)}},e}();t.OfficeRenderHost=n},7877:function(e,t,r){var i=this&&this.__assign||function(){return i=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},i.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var n=r(1428),o=r(7022),s=r(8685),a=r(3554),l=function(){function e(e,t){var r;this.formatResolver=new o.FormatResolver,this.element=e,this.parent=t,this.id=null!=(r=e.id)?r:"MISSING_ID",this.element.renderingProperties?this.formatResolver.pushFormat(this.getFormatFromRenderingProperties(this.element.renderingProperties)):this.element.format&&this.formatResolver.pushFormat(this.element.format)}return e.prototype.getFill=function(){return this.formatResolver.getFill()},e.prototype.getLineFill=function(){return this.formatResolver.getLineFill()},e.prototype.getLineThickness=function(){return this.formatResolver.getLineThickness()},e.prototype.getLineDashType=function(){return this.formatResolver.getLineDashType()},e.prototype.getLineCapType=function(){return this.formatResolver.getLineCapType()},e.prototype.getLineJoinType=function(){return this.formatResolver.getLineJoinType()},e.prototype.getHeadEnd=function(){return this.formatResolver.getHeadEnd()},e.prototype.getTailEnd=function(){return this.formatResolver.getTailEnd()},e.prototype.getClipRectIndex=function(){return this.formatResolver.getClipRectIndex()},e.prototype.getId=function(){return this.id},e.prototype.getText=function(){return this.element.text?n.Experimental.isExperimentalText(this.element.text)?new s.ExperimentalText(this.element.text,this.formatResolver):new a.LegacyText(this.element.text):void 0},e.prototype.getCustomData=function(){return this.element.customData},e.prototype.getChildren=function(){var t=this;return this.element.children?this.element.children.map((function(r,n){return new e(i({id:t.id+"-"+n},r),t)})):[]},e.prototype.getParent=function(){return this.parent},e.prototype.enumerateGeometry=function(e){if(Array.isArray(this.element.geometry))for(var t=0,r=this.element.geometry;t<r.length;t++){var i=r[t];switch(i.op){case 0:if(i.format?this.formatResolver.pushFormat(i.format):i.formatObject?this.formatResolver.pushFormat(this.getFormatFromFormatObject(i.formatObject)):this.formatResolver.pushFormat({}),!e.beginGeometry(this.copy()))throw new Error("Invalid operation: BeginGeometry failed.");break;case 1:if(this.formatResolver.popFormat(),!e.endGeometry())throw new Error("Invalid operation: EndGeometry failed.");break;case 2:if(!e.beginPath(i.fillMode))throw new Error("Invalid operation: BeginPath failed.");break;case 3:if(!e.endPath())throw new Error("Invalid operation: EndPath failed.");break;case 4:if(!e.beginFigure(i.startPoint,i.filled,i.type))throw new Error("Invalid operation: BeginFigure failed.");break;case 6:if(!e.addLines(i.points))throw new Error("Invalid operation: AddLines failed.");break;case 7:if(!e.addBeziers(i.points))throw new Error("Invalid operation: AddBeziers failed.");break;case 8:if(!e.addEscape(i.escape,i.data))throw new Error("Invalid operation: AddEscape failed.");break;case 5:if(!e.endFigure(i.closed))throw new Error("Invalid operation: EndFigure failed.");break;default:throw new Error("Invalid operation: default case should not be reached")}}},e.prototype.copy=function(){var t=new e(this.element,this.parent);return t.formatResolver=this.formatResolver.copy(),t},e.prototype.getFormatFromRenderingProperties=function(e){if(!e)return{};var t={line:{thickness:e.lineThickness,dashStyle:e.lineDashStyle}},r=n.Utils.colorToCSSString(e.fillColor);r&&(t.fill={color:r});var i=n.Utils.colorToCSSString(e.lineColor);return i&&t.line&&(t.line.fill={color:i}),t},e.prototype.getFormatFromFormatObject=function(e){return e?{fill:{color:e.fillColor},line:{fill:{color:e.lineColor}}}:{}},e}();t.Element=l},8685:function(e,t,r){var i,n=this&&this.__extends||(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},i(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(960),s=function(e){function t(t,r){var i=e.call(this)||this;return i.text=t,i.resolver=r,i}return n(t,e),t.prototype.getLines=function(){var e=this;return this.text.lines.map((function(t){return new a(e.text,t,e.resolver)}))},t.prototype.getAngle=function(){return this.text.angle},t.prototype.getText=function(){return this.text.text},t.prototype.getSize=function(){return this.text.size},t.prototype.getLocation=function(){return this.text.location},t.prototype.getTextAlignment=function(){return 2},t}(o.ElementText);t.ExperimentalText=s;var a=function(e){function t(t,r,i){var n=e.call(this)||this;return n.text=t,n.line=r,n.resolver=i,n}return n(t,e),t.prototype.getRuns=function(){var e=this;return this.line.runs.map((function(t){return new l(e.text,t,e.resolver)}))},t.prototype.getHeight=function(){return this.line.height},t.prototype.isTrimmed=function(){return this.line.isTrimmed},t.prototype.getBaseline=function(){return Math.max.apply(Math,this.line.runs.map((function(e){return e.baseline})))},t}(o.ElementTextLine),l=function(e){function t(t,r,i){var n=e.call(this)||this;return n.text=t,n.run=r,n.resolver=i.copy(),n.resolver.pushFormat({text:n.run.format}),n}return n(t,e),t.prototype.getColor=function(){return this.resolver.getFontColor()},t.prototype.getWeight=function(){return this.resolver.getFontWeight()},t.prototype.getStyle=function(){return this.resolver.getFontStyle()},t.prototype.getFaceName=function(){return this.resolver.getFontFaceName()},t.prototype.getPixelSize=function(){return this.resolver.getFontPixelSize()},t.prototype.getText=function(){return this.text.text.substr(this.run.start,this.run.length)},t}(o.ElementTextRun)},7022:function(e,t,r){var i=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var i=Array(e),n=0;for(t=0;t<r;t++)for(var o=arguments[t],s=0,a=o.length;s<a;s++,n++)i[n]=o[s];return i};Object.defineProperty(t,"__esModule",{value:!0});var n=r(1428),o=function(){function e(){this.formats=[],this.defaults={fill:{color:"white"},lineFill:{color:"black"},lineThickness:1,lineDashType:n.LineDashType.Solid,lineCapType:n.LineCapType.Flat,lineJoinType:n.LineJoinType.Round,headEnd:{type:n.LineEndType.None,width:n.LineEndSize.Small,length:n.LineEndSize.Small},tailEnd:{type:n.LineEndType.None,width:n.LineEndSize.Small,length:n.LineEndSize.Small},fontColor:"#595959",fontWeight:400,fontStyle:0,fontFaceName:"Calibri",fontPixelSize:12,clipRectIndex:-1}}return e.prototype.pushFormat=function(e){this.formats.push(e)},e.prototype.popFormat=function(){return this.formats.pop()},e.prototype.copy=function(){var t=new e;return t.formats=i(this.formats),t},e.prototype.getFill=function(){var e;return null!=(e=this.resolve((function(e){return e.fill})))?e:this.defaults.fill},e.prototype.getLineFill=function(){var e;return null!=(e=this.resolve((function(e){var t,r;return null===(r=null===(t=e)||void 0===t?void 0:t.line)||void 0===r?void 0:r.fill})))?e:this.defaults.lineFill},e.prototype.getLineThickness=function(){var e;return null!=(e=this.resolve((function(e){var t;return null===(t=e.line)||void 0===t?void 0:t.thickness})))?e:this.defaults.lineThickness},e.prototype.getLineDashType=function(){var e,t;return null!=(t=null!=(e=this.resolve((function(e){var t;return null===(t=e.line)||void 0===t?void 0:t.dashType})))?e:function(e){switch(e){case"Dash":return n.LineDashType.Dash;case"DashDot":return n.LineDashType.DashDot;case"DashDotDot":return n.LineDashType.DashDotDot;case"Dot":return n.LineDashType.Dot;case"Solid":return n.LineDashType.Solid;case"Count":return n.LineDashType.Count;default:return e}}(this.resolve((function(e){var t;return null===(t=e.line)||void 0===t?void 0:t.dashStyle}))))?t:this.defaults.lineDashType},e.prototype.getLineCapType=function(){var e;return null!=(e=this.resolve((function(e){var t;return null===(t=e.line)||void 0===t?void 0:t.capType})))?e:this.defaults.lineCapType},e.prototype.getLineJoinType=function(){var e;return null!=(e=this.resolve((function(e){var t;return null===(t=e.line)||void 0===t?void 0:t.joinType})))?e:this.defaults.lineJoinType},e.prototype.getHeadEnd=function(){var e;return null!=(e=this.resolve((function(e){var t,r;return null===(r=null===(t=e)||void 0===t?void 0:t.line)||void 0===r?void 0:r.headEnd})))?e:this.defaults.headEnd},e.prototype.getTailEnd=function(){var e;return null!=(e=this.resolve((function(e){var t,r;return null===(r=null===(t=e)||void 0===t?void 0:t.line)||void 0===r?void 0:r.tailEnd})))?e:this.defaults.tailEnd},e.prototype.getFontColor=function(){var e;return null!=(e=this.resolve((function(e){var t,r;return null===(r=null===(t=e.text)||void 0===t?void 0:t.fill)||void 0===r?void 0:r.color})))?e:this.defaults.fontColor},e.prototype.getFontWeight=function(){var e;return null!=(e=this.resolve((function(e){var t;return null===(t=e.text)||void 0===t?void 0:t.weight})))?e:this.defaults.fontWeight},e.prototype.getFontStyle=function(){var e;return null!=(e=this.resolve((function(e){var t;return null===(t=e.text)||void 0===t?void 0:t.style})))?e:this.defaults.fontStyle},e.prototype.getFontFaceName=function(){var e;return null!=(e=this.resolve((function(e){var t;return null===(t=e.text)||void 0===t?void 0:t.faceName})))?e:this.defaults.fontFaceName},e.prototype.getFontPixelSize=function(){var e;return null!=(e=this.resolve((function(e){var t;return null===(t=e.text)||void 0===t?void 0:t.pixelSize})))?e:this.defaults.fontPixelSize},e.prototype.getClipRectIndex=function(){var e;return null!=(e=this.resolve((function(e){return e.clipRectIndex})))?e:this.defaults.clipRectIndex},e.prototype.resolve=function(e){return this.formats.reduceRight((function(t,r){return void 0===t?e(r):t}),void 0)},e}();t.FormatResolver=o},3554:function(e,t,r){var i,n=this&&this.__extends||(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},i(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(960),s=function(e){function t(t){var r=e.call(this)||this;return r.text=t,r}return n(t,e),t.prototype.getLines=function(){var e=this;return this.text.layout.map((function(t,r){return new a(e.text,r)}))},t.prototype.getAngle=function(){return this.text.angle},t.prototype.getText=function(){return this.text.text},t.prototype.getSize=function(){return this.text.size},t.prototype.getLocation=function(){return this.text.location},t.prototype.getTextAlignment=function(){return this.text.format.textAlignment},t}(o.ElementText);t.LegacyText=s;var a=function(e){function t(t,r){var i=e.call(this)||this;return i.index=0,i.text=t,i.index=r,i}return n(t,e),t.prototype.getRuns=function(){return[new l(this.text,this.index)]},t.prototype.getHeight=function(){return this.text.layout[this.index].height},t.prototype.isTrimmed=function(){return this.text.layout[this.index].isTrimmed},t.prototype.getBaseline=function(){return this.text.layout[this.index].baseline},t}(o.ElementTextLine);t.LegacyTextLine=a;var l=function(e){function t(t,r){var i=e.call(this)||this;i.index=0,i.start=0,i.text=t,i.index=r;for(var n=0;n<i.index;n++)i.start+=i.text.layout[n].length;return i}return n(t,e),t.prototype.getColor=function(){return this.text.format.textColor},t.prototype.getWeight=function(){return this.text.format.fontWeight},t.prototype.getStyle=function(){return this.text.format.fontStyle},t.prototype.getFaceName=function(){return this.text.format.faceName},t.prototype.getPixelSize=function(){return this.text.format.pixelSize},t.prototype.getText=function(){var e=this.text.layout[this.index],t=e.isTrimmed&&isFinite(this.text.trimStart)?this.text.trimStart-this.start:e.length-e.newlineLength;return this.text.text.substr(this.start,t)},t}(o.ElementTextRun);t.LegacyTextRun=l},7882:(e,t)=>{function r(e,t){return{x:e.x+t.x,y:e.y+t.y}}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this.master=[]}return e.prototype.reset=function(){this.master=[]},e.prototype.beginGeometry=function(e){return this.master.push({op:0,formatObject:e}),!0},e.prototype.endGeometry=function(){return this.master.push({op:1}),!0},e.prototype.beginPath=function(e){return this.master.push({op:2,fillMode:e}),!0},e.prototype.endPath=function(){return this.master.push({op:3}),!0},e.prototype.beginFigure=function(e,t,r){return this.master.push({op:4,startPoint:e,filled:t,figureType:r}),!0},e.prototype.endFigure=function(e){return this.master.push({op:5,closed:e}),!0},e.prototype.addLines=function(e){return this.master.push({op:6,points:e}),!0},e.prototype.addBeziers=function(e){return this.master.push({op:7,points:e}),!0},e.prototype.addEscape=function(e,t){return this.master.push({op:8,escape:e,data:t}),!0},e.prototype.createInstance=function(e,t){return this.master.every((function(i){switch(i.op){case 0:return e.beginGeometry(i.formatObject);case 1:return e.endGeometry();case 2:return e.beginPath(i.fillMode);case 3:return e.endPath();case 4:return e.beginFigure(r(t,i.startPoint),i.filled,i.figureType);case 5:return e.endFigure(i.closed);case 6:return e.addLines(i.points.map((function(e){return r(t,e)})));case 7:return e.addBeziers(i.points.map((function(e){return r(t,e)})));case 8:return e.addEscape(i.escape,i.data);default:throw new Error("Unexpected geometry.")}}))},e}();t.MasterInstancer=i},311:function(e,t,r){var i=this&&this.__assign||function(){return i=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},i.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var n=r(7877),o=function(){function e(e){this.root=new n.Element(i({id:"ROOT_ELEMENT"},e.root)),this.sceneGraph=e}return e.prototype.getRoot=function(){return this.root},e.prototype.getElementById=function(e){return this.findElementWithIdFromElement(this.root,e)},e.prototype.getSize=function(){return this.sceneGraph.size},e.prototype.getBorderWidth=function(){var e;return null!=(e=this.sceneGraph.borderWidth)?e:1},e.prototype.getClipRects=function(){var e;return null!=(e=this.sceneGraph.clipRects)?e:[]},e.prototype.findElementWithIdFromElement=function(e,t){if(e.getId()===t)return e;for(var r=0,i=e.getChildren();r<i.length;r++){var n=i[r],o=this.findElementWithIdFromElement(n,t);if(o)return o}},e}();t.SceneGraph=o},960:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});t.ElementTextRun=function(){};t.ElementTextLine=function(){};t.ElementText=function(){}},959:function(e,t,r){var i=this&&this.__assign||function(){return i=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},i.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var n=r(9072),o=r(8688),s=r(104),a=function(){function e(e,t,r){var i=this;this.observers=[],this.handleMouseOver=function(e){s.wrapWithActivity(i.activitySink,"ObservableSvgElement.handleMouseOver",(function(){var t=i.convertMouseEvent(e);i.observers.forEach((function(e){return e.receiveMouseOver(t)}))}))},this.handleMouseMove=function(e){s.wrapWithActivity(i.activitySink,"ObservableSvgElement.handleMouseMove",(function(){var t=i.convertMouseEvent(e);i.observers.forEach((function(e){return e.receiveMouseMove(t)}))}))},this.handleMouseOut=function(){s.wrapWithActivity(i.activitySink,"ObservableSvgElement.handleMouseOut",(function(){return i.observers.forEach((function(e){return e.receiveMouseOut()}))}))},this.handleMouseDown=function(e){s.wrapWithActivity(i.activitySink,"ObservableSvgElement.handleMouseDown",(function(){var t=i.convertMouseEvent(e);i.observers.forEach((function(e){return e.receiveMouseDown(t)}))}))},this.handleDoubleClick=function(e){s.wrapWithActivity(i.activitySink,"ObservableSvgElement.handleDoubleClick",(function(){var t=i.convertMouseEvent(e);i.observers.forEach((function(e){return e.receiveDoubleClick(t)}))}))},this.handlePointerDown=function(e){s.wrapWithActivity(i.activitySink,"ObservableSvgElement.handlePointerDown",(function(){var t=i.convertMouseEvent(e);i.observers.forEach((function(r){return r.receivePointerDown(t,e.pointerType)}))}))},this.sceneGraph=e,this.activitySink=r,this.renderHost=t}return e.prototype.bind=function(e){this.unbind(),this.element=e,this.renderHost&&this.renderHost.isFeatureEnabled("EnablePointerEvents",!1)?this.element.addEventListener("pointerdown",this.handlePointerDown):this.element.addEventListener("mousedown",this.handleMouseDown),this.element.addEventListener("mouseover",this.handleMouseOver),this.element.addEventListener("mousemove",this.handleMouseMove),this.element.addEventListener("mouseout",this.handleMouseOut),this.element.addEventListener("dblclick",this.handleDoubleClick)},e.prototype.unbind=function(){this.element&&(this.renderHost&&this.renderHost.isFeatureEnabled("EnablePointerEvents",!1)?this.element.removeEventListener("pointerdown",this.handlePointerDown):this.element.removeEventListener("mousedown",this.handleMouseDown),this.element.removeEventListener("mouseover",this.handleMouseOver),this.element.removeEventListener("mousemove",this.handleMouseMove),this.element.removeEventListener("mouseout",this.handleMouseOut),this.element.removeEventListener("dblclick",this.handleDoubleClick)),this.element=void 0},e.prototype.addObserver=function(e){this.observers.push(e)},e.prototype.removeObservers=function(){this.observers=[]},e.prototype.getElementFromTarget=function(e){if(!(e instanceof Element))throw new Error("Invalid event target.");for(var t=e;t&&!n.isElementDomId(t.id);)t=o.getParentElement(t);if(t){var r=n.getElementIdFromDomId(t.id);if(!r)throw new Error("Unexpected error.");var i=this.sceneGraph.getElementById(r);if(!i)throw new Error("Unexpected error.");return i}},e.prototype.convertMouseEvent=function(e){if(!e.target)throw new Error("Unexpected event.");if(!this.element)throw new Error("Unexpected error. Binding required.");var t=o.getOffsetInRect(this.element.getBoundingClientRect(),e.clientX,e.clientY);return i(i({},t),{target:this.getElementFromTarget(e.target),stopPropagation:function(){return e.stopPropagation()}})},e}();t.ObservableSvgElement=a},5626:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var i=r(1432),n=r(8282),o=function(){function e(e,t){this.svg=e,this.idPrefix=i.generateUniqueId(),this.count=t.length,this.ensureClipRects(t)}return e.prototype.getIdForIndex=function(e){if(e>=this.count)throw new Error("Invalid index.");return this.idPrefix+"-"+e},e.prototype.ensureClipRects=function(e){var t=this;e.forEach((function(e,r){t.ensureClipRect(e,r)}))},e.prototype.ensureClipRect=function(e,t){var r=document.createElementNS(n.svgns,"clipPath");r.id=this.getIdForIndex(t);var i=document.createElementNS(n.svgns,"rect");i.setAttribute("x",""+e.left),i.setAttribute("y",""+e.top),i.setAttribute("width",""+(e.right-e.left)),i.setAttribute("height",""+(e.bottom-e.top)),r.appendChild(i),this.svg.appendChild(r)},e}();t.SvgClipRectStorage=o},4030:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var i=r(8282),n=function(){function e(e){this.defs=e}return e.prototype.storeLinearGradient=function(e,t,r){var n=this.translateLinearGradientShade(e.angle),o=n.start,s=n.end,a=document.createElementNS(i.svgns,"linearGradient");a.setAttribute("x1",o.x.toString()),a.setAttribute("y1",o.y.toString()),a.setAttribute("x2",s.x.toString()),a.setAttribute("y2",s.y.toString()),this.appendGradient(a,t,r)},e.prototype.storeRadialGradient=function(e,t,r,n){var o=this.translateRadialGradientShade(e.center,r),s=document.createElementNS(i.svgns,"radialGradient");s.setAttribute("fx",o.focal.x.toString()),s.setAttribute("fy",o.focal.y.toString()),s.setAttribute("cx",o.center.x.toString()),s.setAttribute("cy",o.center.y.toString()),s.setAttribute("r",o.radius.toString()),o.translate&&o.scale&&s.setAttribute("gradientTransform","translate("+o.translate.x+", "+o.translate.y+") scale("+o.scale.x+", "+o.scale.y+")"),this.appendGradient(s,t,n)},e.prototype.appendGradient=function(e,t,r){e.id=r,t.sort((function(e,t){return e.pos-t.pos}));for(var n=0,o=t;n<o.length;n++){var s=o[n],a=document.createElementNS(i.svgns,"stop");a.setAttribute("offset",s.pos.toString()),a.setAttribute("stop-color",s.color),e.appendChild(a)}this.defs.appendChild(e)},e.prototype.translateLinearGradientShade=function(e){(e+=180)<0?(e%=360,e+=360):e%=360;var t,r,i,n=Math.floor(e/90),o=(e-90*n)*Math.PI/180,s={x:Math.cos(o),y:Math.sin(o)},a=(t={x:-1,y:-1}).x*(r=s).x+t.y*r.y,l={x:s.x*a,y:s.y*a};switch(n){case 0:default:i=l;break;case 1:i={x:-l.y,y:l.x};break;case 2:i={x:-l.x,y:-l.y};break;case 3:i={x:l.y,y:-l.x}}var h={x:-i.x,y:-i.y},c=function(e){return{x:(e.x+1)/2,y:(e.y+1)/2}};return i=c(i),{start:h=c(h),end:i}},e.prototype.translateRadialGradientShade=function(e,t){var r=t.max.x-t.min.x,i=t.max.y-t.min.y,n=r/2,o=Math.sqrt(r*r+i*i)/2,s=(n+o-(n-o))/r/2,a={x:r*e.x/r,y:i*e.y/i},l=i/r,h=(l-1)/-2;a.y=e.y*l+h;var c=(t.max.x-t.min.x)/(t.max.y-t.min.y),u={x:1,y:c},d={x:0,y:(c-1)/-2};if(e.y>1||e.y<0)if(a.y<0){var p=.5-s-a.y;a.x=.5,a.y+=p,d.y-=p,u.y+=p}else p=a.y-(.5+s),a.x=.5,a.y-=p,u.y+=p;else{var f={x:a.x-.5,y:a.y-.5},g=f.x*f.x+f.y*f.y;g>=s*s&&(s=Math.sqrt(g))}return{focal:a,center:{x:.5,y:.5},radius:s,translate:d,scale:u}},e}();t.SvgGradientStorage=n},1273:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var i=r(1428),n=r(8282),o=function(){function e(e){this.refXOffset=.1,this.defs=e}return e.prototype.storeTriangleLineEnd=function(e,t,r,i,o){var s=this.translateTriangleLineEndSize(e,t),a=s.x,l=s.y,h=this.createTrianglePath(a,l,0)+" Z",c=document.createElementNS(n.svgns,"marker");c.setAttribute("refX",this.refXOffset.toString()),c.setAttribute("refY",l.toString());var u=document.createElementNS(n.svgns,"path");u.setAttribute("d",h),u.setAttribute("fill",r),c.appendChild(u),this.appendLineEnd(c,i,o)},e.prototype.storeArrowLineEnd=function(e,t,r,i,o){var s=this.translateTriangleLineEndSize(e,t),a=s.x,l=s.y,h=this.createArrowPath(a,l,o)+" Z",c=document.createElementNS(n.svgns,"marker");c.setAttribute("refX",(o+this.refXOffset).toString()),c.setAttribute("refY",(o+l).toString());var u=document.createElementNS(n.svgns,"path");u.setAttribute("d",h),u.setAttribute("fill","none"),u.setAttribute("stroke",r),u.setAttribute("stroke-linecap","round"),c.appendChild(u),this.appendLineEnd(c,i,o)},e.prototype.storeDiamondLineEnd=function(e,t,r,i,o){var s=this.translateDiamondLineEndSize(e,t),a=s.x,l=s.y,h=this.createDiamondPath(a,l)+" Z",c=document.createElementNS(n.svgns,"marker");c.setAttribute("refX",(a/2).toString()),c.setAttribute("refY",l.toString());var u=document.createElementNS(n.svgns,"path");u.setAttribute("d",h),u.setAttribute("fill",r),c.appendChild(u),this.appendLineEnd(c,i,o)},e.prototype.storeOvalLineEnd=function(e,t,r,i,o){var s=this.translateOvalLineEndSize(e,t),a=s.x,l=s.y,h=a.toString(),c=l.toString(),u=document.createElementNS(n.svgns,"marker");u.setAttribute("refX",a.toString()),u.setAttribute("refY",l.toString());var d=document.createElementNS(n.svgns,"ellipse");d.setAttribute("cx",h),d.setAttribute("cy",c),d.setAttribute("rx",h),d.setAttribute("ry",c),d.setAttribute("fill",r),u.appendChild(d),this.appendLineEnd(u,i,o)},e.prototype.storeStealthLineEnd=function(e,t,r,i,o){var s=this.translateTriangleLineEndSize(e,t),a=s.x,l=s.y,h=this.createStealthPath(a,l,0)+" Z",c=document.createElementNS(n.svgns,"marker");c.setAttribute("refX",(a/4+this.refXOffset).toString()),c.setAttribute("refY",l.toString());var u=document.createElementNS(n.svgns,"path");u.setAttribute("d",h),u.setAttribute("fill",r),c.appendChild(u),this.appendLineEnd(c,i,o)},e.prototype.enumToNumber=function(e){return"number"==typeof e?e:+i.LineEndSize[e]},e.prototype.appendLineEnd=function(e,t,r){e.id=t,e.setAttribute("orient","auto-start-reverse"),e.setAttribute("markerWidth",(7*r).toString()),e.setAttribute("markerHeight",(7*r).toString()),this.defs.appendChild(e)},e.prototype.translateTriangleLineEndSize=function(e,t){var r=this.enumToNumber(e);return{x:this.enumToNumber(t)+2,y:r/2+1.5}},e.prototype.translateDiamondLineEndSize=function(e,t){var r=this.enumToNumber(e);return{x:this.enumToNumber(t)+.75,y:r+.75}},e.prototype.translateOvalLineEndSize=function(e,t){var r=this.enumToNumber(e);return{x:this.enumToNumber(t)/2+1.25,y:r/2+1.25}},e.prototype.createTrianglePath=function(e,t,r){var i=r.toString();return"M "+i+" "+i+" L "+(e+r).toString()+" "+(t+r).toString()+" L "+i+" "+(r+2*t).toString()},e.prototype.createArrowPath=function(e,t,r){var i=this.createTrianglePath(e,t,r),n=(e+r).toString(),o=(t+r).toString();return i+" M "+r.toString()+" "+o+" L "+n+" "+o},e.prototype.createDiamondPath=function(e,t){var r=e.toString(),i=t.toString();return"M 0 "+i+" L "+r+" 0 L "+(2*e).toString()+" "+i+" L "+r+" "+(2*t).toString()},e.prototype.createStealthPath=function(e,t,r){return this.createTrianglePath(e,t,r)+" L "+(e/4).toString()+" "+t.toString()},e}();t.SvgLineEndStorage=o},8827:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var i=r(1428),n=r(8956),o=function(){function e(){this.pathBounds=new n.Bounds2D,this.finishedPaths=[],this.currentPath=this.createEmptyPath(),this.isLines=!0,this.hasGradient=!1}return e.prototype.shift=function(){return this.finishedPaths.shift()},Object.defineProperty(e.prototype,"length",{get:function(){return this.finishedPaths.length},enumerable:!0,configurable:!0}),e.prototype.setDatapointIndex=function(e){""!==this.currentPath.data&&this.currentPath.datapointIndex!==e&&this.finishCurrentPath(),this.currentPath.datapointIndex=e},e.prototype.setFilled=function(e){""!==this.currentPath.data&&this.currentPath.filled!==e&&this.finishCurrentPath(),this.currentPath.filled=e},e.prototype.move=function(e){this.currentPath.data+="M"+i.Utils.pointToString(e),this.isLines&&this.pathBounds.addPoint(e)},e.prototype.addLines=function(e){if(e.length>0){this.currentPath.data+="L";for(var t=0,r=e;t<r.length;t++){var n=r[t];this.currentPath.data+=i.Utils.pointToString(n),this.isLines&&this.pathBounds.addPoint(n)}}},e.prototype.addBeziers=function(e){if(e.length>0){this.currentPath.data+="C",this.isLines=!1;for(var t=0,r=e;t<r.length;t++){var n=r[t];this.currentPath.data+=i.Utils.pointToString(n)}}},e.prototype.close=function(){this.currentPath.data+="Z"},e.prototype.finishCurrentPath=function(){""!==this.currentPath.data&&(this.hasGradient&&this.isLines&&!this.pathBounds.isEmpty()&&this.expandBoundsOfOrthogonalLine(),this.finishedPaths.push(this.currentPath),this.currentPath=this.createEmptyPath(),this.isLines=!0,this.hasGradient=!1,this.pathBounds.reset())},e.prototype.setHasGradient=function(e){this.hasGradient=e},e.prototype.expandBoundsOfOrthogonalLine=function(){var e=this.pathBounds.getBounds(),t=e.max.x-e.min.x,r=e.max.y-e.min.y;0===r&&0===t||(0===r?this.currentPath.data+="M"+e.max.x+","+(e.max.y+.005):0===t&&(this.currentPath.data+="M"+(e.max.x+.005)+","+e.max.y))},e.prototype.createEmptyPath=function(){return{data:"",filled:!1}},e}();t.SvgPathBuilder=o},6687:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var i=r(1428),n=r(1432),o=r(8282),s=function(){function e(e){this.patterns={},this.defs=e}return e.prototype.storePattern=function(e){var t=e.pattern+","+e.backgroundColor+","+e.foregroundColor;if(this.patterns[t])return this.patterns[t];var r=document.createElementNS(o.svgns,"pattern");r.id=n.generateUniqueId(),r.setAttribute("patternUnits","userSpaceOnUse"),r.setAttribute("width",d.toString()),r.setAttribute("height",d.toString());var i=1/u;r.setAttribute("patternTransform","scale("+i+" "+i+")");var s=document.createElementNS(o.svgns,"image");s.id=n.generateUniqueId(),s.setAttribute("width",d.toString()),s.setAttribute("height",d.toString()),s.setAttribute("preserveAspectRatio","none");var l=a(e);s.setAttributeNS(o.xlinkns,"href",l.toDataURL("image/jpeg",1)),this.defs.appendChild(s);var h=document.createElementNS(o.svgns,"use");return h.setAttribute("width","100%"),h.setAttribute("height","100%"),h.setAttributeNS(o.xlinkns,"href","#"+s.id),r.appendChild(h),this.defs.appendChild(r),this.patterns[t]=r.id,this.patterns[t]},e}();function a(e){var t=document.createElement("canvas"),r=t.getContext("2d");if(!r)throw new Error("Missing canvas support.");t.width=t.height=d,r.clearRect(0,0,d,d);for(var n=0,o=0,s=e.pattern*c,a=e.backgroundColor,p=e.foregroundColor,f=function(e,t,r){var n=i.Utils.cssStringToColor(e);if(!n)throw new Error("Invalid color.");var o=i.Utils.cssStringToColor(t);if(!o)throw new Error("Invalid color.");var s,a,l=i.Utils.colorToCSSString(function(e,t){return{r:e.r+t.r,g:e.g+t.g,b:e.b+t.b,a:e.a+t.a}}(n,function(e,t){return{r:e.r*t,g:e.g*t,b:e.b*t,a:e.a*t}}((a=n,{r:(s=o).r-a.r,g:s.g-a.g,b:s.b-a.b,a:s.a-a.a}),.5)));if(!l)throw new Error("Invalid color.");return l}(e.backgroundColor,e.foregroundColor),g=0;g<c;g++)for(var m=l[s+g],v=0;v<4;v++){var y=m>>v%4*2,_=a;2&y?_=p:1&y&&(_=f),r.fillStyle=_,r.fillRect(n*u,o*u,u,u),++n===h&&(n=0,o++)}return t}t.SvgPatternStorage=s,t.createPatternCanvas=a;var l=new Uint8Array([255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,3,0,3,0,3,0,3,0,3,0,3,0,3,0,7,64,29,0,116,0,208,1,64,7,0,29,0,116,1,208,1,208,0,116,0,29,64,7,208,1,116,0,29,0,7,64,255,255,3,0,3,0,3,0,3,0,3,0,3,0,3,0,7,208,29,116,116,29,208,7,208,7,116,29,29,116,7,208,3,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,3,0,0,0,0,3,0,0,3,0,0,0,0,3,0,0,3,3,0,0,48,48,0,0,3,3,0,0,48,48,0,0,3,3,48,48,3,3,48,48,3,3,48,48,3,3,48,48,51,51,12,12,51,51,192,192,51,51,12,12,51,51,192,192,51,51,204,204,51,51,204,192,51,51,204,204,51,51,192,204,51,51,204,204,51,51,204,204,51,51,204,204,51,51,204,204,63,63,204,204,243,243,204,204,63,63,204,204,243,243,204,204,252,252,207,207,252,252,207,207,252,252,207,207,252,252,207,207,252,252,255,255,207,207,255,255,252,252,255,255,207,207,255,255,63,255,255,255,255,63,255,255,63,255,255,255,255,63,255,255,255,255,255,255,255,255,255,252,255,255,255,255,255,255,252,255,3,3,12,12,48,48,192,192,3,3,12,12,48,48,192,192,192,192,48,48,12,12,3,3,192,192,48,48,12,12,3,3,15,15,60,60,240,240,195,195,15,15,60,60,240,240,195,195,240,240,60,60,15,15,195,195,240,240,60,60,15,15,195,195,15,192,63,0,252,0,240,3,192,15,0,63,0,252,3,240,3,240,0,252,0,63,192,15,240,3,252,0,63,0,15,192,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,255,255,0,0,0,0,0,0,255,255,0,0,0,0,0,0,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,255,255,0,0,255,255,0,0,255,255,0,0,255,255,0,0,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,255,255,255,255,0,0,0,0,255,255,255,255,0,0,0,0,0,0,0,0,3,3,12,12,48,48,192,192,0,0,0,0,0,0,0,0,192,192,48,48,12,12,3,3,0,0,0,0,255,0,0,0,0,0,0,0,0,255,0,0,0,0,0,0,3,0,3,0,3,0,3,0,0,3,0,3,0,3,0,3,3,0,0,3,12,0,0,48,192,0,0,192,48,0,0,12,243,192,240,0,0,240,192,243,207,3,15,0,0,15,3,207,3,192,12,48,48,12,192,3,3,192,12,48,48,12,192,3,0,0,192,3,48,204,15,0,0,0,192,3,48,204,15,0,0,192,0,48,0,12,0,3,192,3,48,12,12,48,3,192,255,255,3,0,3,0,3,0,255,255,0,3,0,3,0,3,3,3,204,12,48,48,12,204,3,3,192,12,48,48,204,192,51,51,204,204,51,51,204,204,255,0,255,0,255,0,255,0,0,0,192,0,0,3,192,0,0,0,3,0,0,192,3,0,51,51,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,48,48,0,0,0,3,0,0,48,48,0,0,0,240,3,12,12,3,240,0,0,15,0,48,0,192,0,192,255,255,60,60,255,255,195,195,255,255,60,60,255,255,195,195,252,252,3,195,3,255,3,255,252,252,195,3,255,3,255,3,255,255,3,3,3,3,3,3,255,255,3,3,3,3,3,3,195,195,60,60,60,60,195,195,195,195,60,60,60,60,195,195,255,0,255,0,255,0,255,0,0,255,0,255,0,255,0,255,3,48,12,12,48,3,192,0,48,3,12,12,3,48,0,192,192,0,240,3,252,15,255,63,252,15,240,3,192,0,0,0]),h=8,c=16,u=8,d=h*u},4002:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var i=r(8827),n=r(1428),o=r(8282),s=r(9072),a=r(8688),l=r(104),h=r(6256),c=function(){function e(e){this.handles={},this.pathWidths={},this.svg=e,this.selectionLayer=document.createElementNS(o.svgns,"g"),this.svg.appendChild(this.selectionLayer),this.createHighContrastStyle(),this.ensurePaths()}return e.prototype.doubleClick=function(e){throw new Error("Method not implemented.")},e.prototype.select=function(e,t,r){e!==this.selectPath.attachedId&&(this.removeAllHandles(),this.hidePath(this.hoverPath,l.UserAction.Unhover),this.hidePath(this.selectPath,l.UserAction.Deselect),e&&(this.overlayPath(e,this.selectPath,t,l.UserAction.Select),this.createHandlesForElement(e,r)))},e.prototype.getSelectedId=function(){return this.selectPath.attachedId},e.prototype.hover=function(e,t){e!==this.hoverPath.attachedId&&(this.svg.style.cursor=e?"default":"","string"==typeof this.selectPath.attachedId&&this.selectPath.attachedId===e||(this.hidePath(this.hoverPath,l.UserAction.Unhover),e&&this.overlayPath(e,this.hoverPath,t,l.UserAction.Hover)))},e.prototype.setHandles=function(e){this.handles=e},e.prototype.setPathWidths=function(e){this.pathWidths=e},e.prototype.hidePath=function(e,t){var r;e.attachedId&&(e.path.removeAttribute("d"),e.attachedId=void 0,null===(r=l.getCurrentActivity())||void 0===r||r.addAction(t))},e.prototype.getPathsForSelection=function(e){var t;if(!e.querySelector("."+a.customDataClassName)&&!e.querySelector("."+a.hitTestingClassName))return e.querySelectorAll("path");for(var r=e.querySelectorAll("path"),i=[],n=0;n<r.length;n++){for(var o=r[n],s=!0;void 0!==o&&o!==e&&s;){var l=null!=(t=o.getAttribute("class"))?t:"";s=-1===l.split(" ").indexOf(a.customDataClassName)&&-1===l.split(" ").indexOf(a.hitTestingClassName),o=a.getParentElement(o)}s&&i.push(r[n])}return i},e.prototype.overlayPath=function(e,t,r,n){var o,a,h=this;if(e!==t.attachedId){var c=this.svg.getBoundingClientRect(),u=this.getAdjustmentFromViewBox(null!=(o=this.svg.getAttribute("viewBox"))?o:"0"),d=s.getDomIdFromElementId(e),p=this.svg.getElementById(d);if(p&&(null===(a=l.getCurrentActivity())||void 0===a||a.addAction(n),t.attachedId=e,this.shouldShowBorder(d)||n!==l.UserAction.Select)){if(!r){var f=this.getPathsForSelection(p);if(f.length>0){for(var g="",m=0;m<f.length;m++){var v=f[m].getAttribute("d");"string"==typeof v&&(g+=v)}return void t.path.setAttribute("d",g)}}var y=[],_=p.querySelectorAll("text");if(_.length>0)this.groupElements(_).forEach((function(e){var t=e.map((function(e){return h.getBoundingBox(c,u,e)})).reduce((function(e,t){return h.getUnionOfBoundingBoxes(e,t)}));y.push({x:t.left-4,y:t.top-4},{x:t.right+4,y:t.top-4},{x:t.right+4,y:t.bottom+4},{x:t.left-4,y:t.bottom+4})}));else{var b=this.getBoundingBox(c,u,p);y.push({x:b.left,y:b.top},{x:b.right,y:b.top},{x:b.right,y:b.bottom},{x:b.left,y:b.bottom})}var T=new i.SvgPathBuilder;for(m=0;m<y.length;m+=4)T.move(y[m]),T.addLines(y.slice(m+1,m+4)),T.close();T.finishCurrentPath();var w=T.shift();if(!w)throw new Error("Unexpected missing path.");t.path.setAttribute("d",w.data),this.handles[e]=y}}},e.prototype.groupElements=function(e){for(var t={},r=0;r<e.length;r++){for(var i=e[r],n=i;!n.id;){var o=a.getParentElement(n);if(!o)throw new Error("Invalid element.");n=o}t[n.id]?t[n.id].push(i):t[n.id]=[i]}return Object.keys(t).map((function(e){return t[e]}))},e.prototype.getBoundingBox=function(e,t,r){var i=r.getBoundingClientRect();return{left:i.left-e.left+t,top:i.top-e.top+t,right:i.left-e.left+i.width+t,bottom:i.top-e.top+i.height+t}},e.prototype.getUnionOfBoundingBoxes=function(e,t){return{left:Math.min(e.left,t.left),top:Math.min(e.top,t.top),right:Math.max(e.right,t.right),bottom:Math.max(e.bottom,t.bottom)}},e.prototype.getAdjustmentFromViewBox=function(e){var t=parseInt(e,10);if(isNaN(t))throw new Error("Invalid view box.");return t},e.prototype.createHighContrastStyle=function(){var t=document.createElementNS(o.svgns,"style");this.selectionLayer.appendChild(t);var r=new h.SvgStyle(t);r.addRule("@media screen and (-ms-high-contrast: active) {\n                path."+e.highContrastSelectionPathClassName+" {\n                    stroke: highlight;\n                }\n            }"),r.addRule("@media screen and (-ms-high-contrast: active) {\n                circle."+e.highContrastSelectionHandleClassName+" {\n                    stroke: highlight;\n                    fill: window;\n                }\n            }")},e.prototype.ensurePaths=function(){this.hoverPath={path:document.createElementNS(o.svgns,"path")},this.hoverPath.path.setAttribute("stroke","#0078D2"),this.hoverPath.path.setAttribute("stroke-width","1px"),this.hoverPath.path.setAttribute("fill-opacity","0"),this.hoverPath.path.setAttribute("pointer-events","none"),this.hoverPath.path.setAttribute("class",e.highContrastSelectionPathClassName),this.selectionLayer.appendChild(this.hoverPath.path),this.selectPath={path:document.createElementNS(o.svgns,"path")},this.selectPath.path.setAttribute("stroke","#0078D2"),this.selectPath.path.setAttribute("stroke-width","1px"),this.selectPath.path.setAttribute("fill-opacity","0"),this.selectPath.path.setAttribute("pointer-events","none"),this.selectPath.path.setAttribute("class",e.highContrastSelectionPathClassName),this.selectionLayer.appendChild(this.selectPath.path)},e.prototype.createHandlesForElement=function(e,t){var r,i=this,o=this.handles[e];if(o&&o.length>0)if(t===n.SelectionHandleOption.EndPoints&&o.length>1)this.createHandle(o[0]),this.createHandle(o[o.length-1]);else if(t===n.SelectionHandleOption.Maximum&&o.length>16){this.createHandle(o[o.length-1]);for(var s=(o.length-1)/15,a=0;Math.round(a)<o.length-1;a+=s)this.createHandle(o[Math.round(a)])}else o.forEach((function(e){return i.createHandle(e)}));else{var l=this.svg.getBoundingClientRect(),h=this.getAdjustmentFromViewBox(null!=(r=this.svg.getAttribute("viewBox"))?r:"0"),c=this.getBoundingBox(l,h,this.selectPath.path);this.createHandle({x:c.left,y:c.top}),this.createHandle({x:c.right,y:c.top}),this.createHandle({x:c.right,y:c.bottom}),this.createHandle({x:c.left,y:c.bottom})}},e.prototype.createHandle=function(t){var r=document.createElementNS(o.svgns,"circle");r.setAttribute("class","handle "+e.highContrastSelectionHandleClassName),r.setAttribute("stroke","#0078D2"),r.setAttribute("stroke-width","1px"),r.setAttribute("fill","#B2D6F9"),r.setAttribute("pointer-events","none"),r.setAttribute("cx",t.x.toString()),r.setAttribute("cy",t.y.toString()),r.setAttribute("r","3"),this.selectionLayer.appendChild(r)},e.prototype.removeAllHandles=function(){for(var e=this.selectionLayer.querySelectorAll(".handle"),t=0;t<e.length;t++)this.selectionLayer.removeChild(e[t])},e.prototype.shouldShowBorder=function(e){var t=this.pathWidths[e];return"number"!=typeof t||t>1},e.highContrastSelectionPathClassName="MSChart-HighContrastSelectionPath",e.highContrastSelectionHandleClassName="MSChart-HighContrastSelectionHandle",e}();t.SvgSelector=c},4092:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var i=r(1428),n=r(8202),o=r(6256),s=r(7882),a=r(4030),l=r(6687),h=r(8282),c=r(8956),u=r(8827),d=r(1432),p=r(9072),f=r(143),g=r(8688),m=r(8688),v=r(959),y=r(5626),_=r(1273),b=function(){function e(t,r,i,n){this.pathBuilder=new u.SvgPathBuilder,this.groupStack=[],this.masterInstancer=new s.MasterInstancer,this.isCreatingMaster=!1,this.handleSink=new f.HandleSink,this.handles={},this.pathWidths={},this.sceneGraph=t,this.renderHost=i,this.observable=new v.ObservableSvgElement(this.sceneGraph,i,n);var c=this.sceneGraph.getSize(),d=this.sceneGraph.getBorderWidth();r.setAttribute("viewBox",-d+" "+-d+" "+(c.width+2*d)+" "+(c.height+2*d)),r.setAttribute("class",""+e.chartRootClassName);var p=document.createElementNS(h.svgns,"style");r.appendChild(p),this.svgStyle=new o.SvgStyle(p),this.svgStyle.addRule("@media screen and (-ms-high-contrast: active) {\n                path."+e.highContrastClassName+" {\n                    fill: window;\n                    stroke: windowText;\n                }\n            }"),this.svgStyle.addRule("@media screen and (-ms-high-contrast: active) {\n                path."+e.highContrastNoFillClassName+" {\n                    stroke: windowText;\n                }\n            }"),this.svgStyle.addRule("@media screen and (-ms-high-contrast: active) {\n                path."+e.highContrastNoStrokeClassName+" {\n                    fill: window;\n                }\n            }"),this.svgStyle.addRule("@media screen and (-ms-high-contrast: active) {\n                tspan."+e.highContrastClassName+" {\n                    fill: windowText;\n                    stroke: none;\n                }\n            }"),this.svgStyle.addRule("svg."+e.chartRootClassName+" {\n                font-size: 12px;\n                pointer-events: painted;\n            }");var g=document.createElementNS(h.svgns,"defs");this.gradientStorage=new a.SvgGradientStorage(g),this.patternStorage=new l.SvgPatternStorage(g),this.lineEndStorage=new _.SvgLineEndStorage(g),r.appendChild(g),this.clipRectStorage=new y.SvgClipRectStorage(r,t.getClipRects());var m=document.createElementNS(h.svgns,"g");r.appendChild(m),this.observable.bind(m),this.groupStack.push(m)}return e.prototype.addObserver=function(e){this.observable.addObserver(e)},e.prototype.removeObservers=function(){this.observable.removeObservers()},e.prototype.beginGeometry=function(e){if(this.isCreatingMaster)return this.masterInstancer.beginGeometry(e);if(!this.handleSink.beginGeometry(e))return!1;if(this.pathBounds=this.shouldStartCollectingPathBounds(e)?new c.Bounds2D:void 0,this.formatObject=e,this.formatObject){var t=this.formatObject.getFill(),r=this.formatObject.getLineFill(),n=i.isGradientFillFormat(r)||i.isGradientFillFormat(t);this.pathBuilder.setHasGradient(n)}return!0},e.prototype.endGeometry=function(){if(this.isCreatingMaster)return this.masterInstancer.endGeometry();if(!this.handleSink.endGeometry())return!1;for(this.pathBuilder.finishCurrentPath();this.pathBuilder.length>0;)this.addPathToSvg(this.pathBuilder.shift());return this.formatObject=void 0,!0},e.prototype.beginPath=function(e){return this.isCreatingMaster?this.masterInstancer.beginPath(e):!!this.handleSink.beginPath(e)},e.prototype.endPath=function(){return this.isCreatingMaster?this.masterInstancer.endPath():!!this.handleSink.endPath()},e.prototype.beginFigure=function(e,t,r){if(this.isCreatingMaster)return this.masterInstancer.beginFigure(e,t,r);if(!this.handleSink.beginFigure(e,t,r))return!1;for(this.pathBuilder.setFilled(t),this.pathBuilder.move(e);this.pathBuilder.length>0;)this.addPathToSvg(this.pathBuilder.shift());return this.pathBounds&&this.pathBounds.addPoint(e),!0},e.prototype.endFigure=function(e){return this.isCreatingMaster?this.masterInstancer.endFigure(e):!!this.handleSink.endFigure(e)&&(e&&this.pathBuilder.close(),!0)},e.prototype.addLines=function(e){if(this.isCreatingMaster)return this.masterInstancer.addLines(e);if(!this.handleSink.addLines(e))return!1;if(this.pathBuilder.addLines(e),this.pathBounds){var t=this.pathBounds;e.forEach((function(e){return t.addPoint(e)}))}return!0},e.prototype.addBeziers=function(e){if(this.isCreatingMaster)return this.masterInstancer.addBeziers(e);if(!this.handleSink.addBeziers(e))return!1;if(this.pathBuilder.addBeziers(e),this.pathBounds){var t=this.pathBounds;e.forEach((function(e){return t.addPoint(e)}))}return!0},e.prototype.addEscape=function(e,t){if(this.isCreatingMaster&&101!==e)return this.masterInstancer.addEscape(e,t);if(!this.handleSink.addEscape(e,t))return!1;switch(e){case 100:this.masterInstancer.reset(),this.isCreatingMaster=!0;break;case 101:this.isCreatingMaster=!1;break;case 200:if("number"!=typeof t)return!1;this.pathBuilder.setDatapointIndex(t);break;case 201:this.pathBuilder.setDatapointIndex(void 0);break;case 102:this.masterInstancer.createInstance(this,t)}return!0},e.prototype.render=function(){this.renderElement(this.sceneGraph.getRoot())},e.prototype.getHandles=function(){return this.handles},e.prototype.getPathWidths=function(){return this.pathWidths},e.prototype.renderElement=function(e){var t=this;this.createAndPushGroup(e),this.renderGeometry(e),this.renderText(e),this.renderCustomData(e.getId(),e.getCustomData(),this.renderHost);var r=this.handleSink.getHandles();this.handleSink.reset(),r.length>0&&(this.handles[e.getId()]=r),e.getChildren().forEach((function(e){return t.renderElement(e)})),this.popGroup()},e.prototype.addPathToSvg=function(e){if(!this.formatObject)throw new Error("Missing format object.");var t=document.createElementNS(h.svgns,"path");t.setAttribute("d",e.data);var r=this.getTop();if(!r)throw new Error("Element stack should not be empty.");if(r.appendChild(t),null!==e.datapointIndex){var i=r.id;if(i){var n=p.getElementIdFromDomId(i);n&&"number"==typeof e.datapointIndex&&t.setAttribute("id",p.getDomIdFromElementId(n,e.datapointIndex))}}var o=this.formatObject.getClipRectIndex();o>=0&&t.setAttribute("clip-path","url(#"+this.clipRectStorage.getIdForIndex(o)+")"),this.stylePath(e,r,t)},e.prototype.stylePath=function(t,r,o){if(!this.formatObject)throw new Error("Missing format object.");var s=this.formatObject.getFill(),a=this.formatObject.getLineFill();if(t.filled||a){var l=[];if(t.filled?l.push({name:"fill",value:this.resolveFill(s)}):l.push({name:"fill",value:"none"}),a){var c=a,u=this.resolveFill(c);l.push({name:"stroke",value:""+u});var d=this.formatObject.getLineThickness(),p="number"==typeof d,f=p?d:1;p&&l.push({name:"stroke-width",value:f.toString()});var g=this.formatObject.getLineDashType(),v=this.formatObject.getLineCapType(),y=this.formatObject.getLineJoinType();if(g!==i.LineDashType.Solid){var _=n.createStrokeDashArray(g,f,v).toString();l.push({name:"stroke-dasharray",value:_})}l.push({name:"stroke-linecap",value:this.getStrokeLineCap(v)}),l.push({name:"stroke-linejoin",value:this.getStrokeJoinType(y)});var b=this.formatObject.getHeadEnd(),T=this.formatObject.getTailEnd();if(b.type!==i.LineEndType.None&&l.push({name:"marker-start",value:this.resolveLineEnd(b,u,f)}),T.type!==i.LineEndType.None&&l.push({name:"marker-end",value:this.resolveLineEnd(T,u,f)}),f<6&&!t.filled){var w=document.createElementNS(h.svgns,"path");w.setAttribute("class",m.hitTestingClassName),w.setAttribute("d",t.data),w.setAttribute("stroke","transparent"),w.setAttribute("fill","none"),w.setAttribute("stroke-width",6..toString());var x=this.formatObject.getClipRectIndex();x>=0&&w.setAttribute("clip-path","url(#"+this.clipRectStorage.getIdForIndex(x)+")"),r.appendChild(w)}if(!t.filled){var C="number"==typeof this.pathWidths[r.id]?this.pathWidths[r.id]:1;this.pathWidths[r.id]=Math.min(C,f)}}else l.push({name:"stroke",value:"none"});var S=this.svgStyle.ensureRule(l),P=t.filled?a?e.highContrastClassName:e.highContrastNoStrokeClassName:e.highContrastNoFillClassName;o.setAttribute("class",P+" "+S)}},e.prototype.getStrokeLineCap=function(e){switch(e){case i.LineCapType.Flat:return"butt";case i.LineCapType.Round:return"round";case i.LineCapType.Square:return"square";default:return"butt"}},e.prototype.getStrokeJoinType=function(e){switch(e){case i.LineJoinType.Round:return"round";case i.LineJoinType.Bevel:return"bevel";case i.LineJoinType.Miter:return"miter";default:return"round"}},e.prototype.resolveFill=function(e){if(i.isSolidFillFormat(e))return e.color;if(i.isGradientFillFormat(e)){var t=d.generateUniqueId();if(i.isLinearGradientShade(e.shade))this.gradientStorage.storeLinearGradient(e.shade,e.stops,t);else{if(!i.isRadialGradientShade(e.shade))throw new Error("Invalid IGradientFillFormat.");if(!this.pathBounds)throw new Error("Bounds required for radial gradient.");this.gradientStorage.storeRadialGradient(e.shade,e.stops,this.pathBounds.getBounds(),t)}return"url(#"+t+")"}if(i.isPatternFillFormat(e))return"url(#"+this.patternStorage.storePattern(e)+")";throw new Error("Invalid format.")},e.prototype.resolveLineEnd=function(e,t,r){var n=d.generateUniqueId();switch(e.type){case i.LineEndType.Triangle:this.lineEndStorage.storeTriangleLineEnd(e.width,e.length,t,n,r);break;case i.LineEndType.Stealth:this.lineEndStorage.storeStealthLineEnd(e.width,e.length,t,n,r);break;case i.LineEndType.Diamond:this.lineEndStorage.storeDiamondLineEnd(e.width,e.length,t,n,r);break;case i.LineEndType.Oval:this.lineEndStorage.storeOvalLineEnd(e.width,e.length,t,n,r);break;case i.LineEndType.Arrow:this.lineEndStorage.storeArrowLineEnd(e.width,e.length,t,n,r);break;default:throw new Error("'None' format line end.")}return"url(#"+n+")"},e.prototype.getTop=function(){return this.groupStack.length>0?this.groupStack[this.groupStack.length-1]:void 0},e.prototype.createAndPushGroup=function(e){var t=document.createElementNS(h.svgns,"g");t.setAttribute("id",p.getDomIdFromElementId(e.getId()));var r=this.getTop();r&&r.appendChild(t),this.groupStack.push(t)},e.prototype.popGroup=function(){this.groupStack.pop()},e.prototype.renderText=function(t){var r=this,i=t.getText();if(i){var n=this.getTop();if(!n)throw new Error("Element stack should not be empty.");var o=document.createElementNS(h.svgns,"g"),s=i.getLocation(),a="translate("+s.x+", "+s.y+")",l="rotate("+i.getAngle()+")";o.setAttribute("transform",a+" "+l);var c=0;i.getLines().forEach((function(t){if(0!==t.getHeight()){var n=document.createElementNS(h.svgns,"text");n.setAttribute("y",(c+t.getBaseline()).toString(10));var s=0;2===i.getTextAlignment()&&(s=i.getSize().width/2,n.setAttribute("text-anchor","middle")),n.setAttribute("x",s.toString(10)),t.getRuns().forEach((function(i,o){var s=document.createElementNS(h.svgns,"tspan");s.textContent=i.getText();var a=o===t.getRuns().length-1;t.isTrimmed()&&a&&(s.textContent+="");var l=[{name:"font-family",value:i.getFaceName()},{name:"font-size",value:i.getPixelSize()+"px"},{name:"stroke",value:"none"},{name:"fill",value:i.getColor()},{name:"white-space",value:"pre"},{name:"font-weight",value:i.getWeight().toString()}];switch(i.getStyle()){case 0:l.push({name:"font-style",value:"normal"});break;case 2:l.push({name:"font-style",value:"italic"});break;case 1:l.push({name:"font-style",value:"oblique"})}var c=r.svgStyle.ensureRule(l);s.setAttribute("class",e.highContrastClassName+" "+c),n.appendChild(s)})),c+=t.getHeight(),o.appendChild(n)}})),n.appendChild(o)}},e.prototype.renderCustomData=function(e,t,r){if(t&&r){var i=this.getTop();if(!i)throw new Error("Element stack should not be empty.");var n=document.createElementNS(h.svgns,"g");n.setAttribute("class",g.customDataClassName),i.appendChild(n),r.renderCustomData(n,t)}},e.prototype.renderGeometry=function(e){e.enumerateGeometry(this)},e.prototype.shouldStartCollectingPathBounds=function(e){var t=e.getFill(),r=e.getLineFill();return!!(r&&i.isGradientFillFormat(r)&&i.isRadialGradientShade(r.shade))||!!(t&&i.isGradientFillFormat(t)&&i.isRadialGradientShade(t.shade))},e.chartRootClassName="MSChart-ChartRoot",e.highContrastClassName="MSChart-HighContrast",e.highContrastNoFillClassName="MSChart-HighContrastNoFill",e.highContrastNoStrokeClassName="MSChart-HighContrastNoStroke",e}();t.SvgSink=b},6256:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var i=r(1432),n=function(){function e(e){this.content="",this.rules=[],this.element=e}return e.prototype.addRule=function(e){var t=e.replace(/(\n|\s+)/g," ");t&&(this.content+=t),this.updateElement()},e.prototype.ensureRule=function(e){var t=this;e.sort((function(e,t){return e.name<t.name?-1:e.name>t.name?1:0}));var r="";if(!this.rules.some((function(i){return!!t.areRulesEqual(i.properties,e)&&(r=i.className,!0)}))){var n="."+(r=i.generateUniqueId())+" {";e.forEach((function(e){n+=e.name+": "+e.value+";"})),n+="}",this.rules.push({className:r,properties:e}),this.addRule(n)}return r},e.prototype.areRulesEqual=function(e,t){return e.length===t.length&&e.every((function(e,r){return e.name===t[r].name&&e.value===t[r].value}))},e.prototype.updateElement=function(){this.element.textContent=this.content},e}();t.SvgStyle=n},2777:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var i=r(8282),n=r(9759),o=function(){function e(e){this.padding=10,this.x=0,this.y=0,this.offset=n.TooltipOffset.Above,this.rootElement=e,this.ensureTooltip()}return e.prototype.show=function(){this.updateRectangle(),this.tooltipGroup.setAttribute("visibility","visible")},e.prototype.hide=function(){this.tooltipGroup.setAttribute("visibility","hidden")},e.prototype.isVisible=function(){return"visible"===this.tooltipGroup.getAttribute("visibility")},e.prototype.setPosition=function(e,t){this.x=e,this.y=t;for(var r=this.tooltipText.getBoundingClientRect(),i=this.getOffsetDimensions(e,t,r.width,r.height),n=this.tooltipText.childNodes,o=0;o<n.length;++o)n[o].nodeType===Node.ELEMENT_NODE&&n[o].setAttribute("x",""+i[0]);this.tooltipText.setAttribute("y",""+i[1]),this.tooltipBorderRectangle.setAttribute("x",""+(i[0]-this.padding/2)),this.tooltipBorderRectangle.setAttribute("y",""+(i[1]-2*this.padding))},e.prototype.setOffset=function(e){this.offset!==e&&(this.offset=e,this.setPosition(this.x,this.y))},e.prototype.setHeader=function(e){this.tooltipTspan.textContent=e,this.tooltipTspan.setAttribute("x","0")},e.prototype.addPair=function(e,t){var r=e,n=document.createElementNS(i.svgns,"tspan");n.textContent=r,n.setAttribute("dy","17px"),n.setAttribute("x","0"),this.setStyle(n,a);var o=document.createElementNS(i.svgns,"tspan");o.textContent=t,o.setAttribute("dy","12px"),o.setAttribute("x","0"),this.setStyle(o,l),this.tooltipText.appendChild(n),this.tooltipText.appendChild(o)},e.prototype.removePairs=function(){for(var e=this.tooltipText.childElementCount;e>1;)this.tooltipText.removeChild(this.tooltipText.lastChild),e-=1},e.prototype.getRoot=function(){return this.rootElement},e.prototype.ensureTooltip=function(){this.tooltipGroup=document.createElementNS(i.svgns,"g"),this.tooltipGroup.setAttribute("visibility","hidden"),this.tooltipGroup.setAttribute("transform","translate(0,0) rotate(0)"),this.tooltipGroup.style.pointerEvents="none",this.tooltipBorderRectangle=document.createElementNS(i.svgns,"rect"),this.setStyle(this.tooltipBorderRectangle,h),this.tooltipGroup.appendChild(this.tooltipBorderRectangle),this.tooltipText=document.createElementNS(i.svgns,"text"),this.tooltipGroup.appendChild(this.tooltipText),this.tooltipTspan=document.createElementNS(i.svgns,"tspan"),this.setStyle(this.tooltipTspan,s),this.tooltipText.appendChild(this.tooltipTspan),this.rootElement.appendChild(this.tooltipGroup)},e.prototype.setStyle=function(e,t){var r="";t.forEach((function(e){r+=e.name+": "+e.value+";"})),e.setAttribute("style",""+r)},e.prototype.getOffsetDimensions=function(e,t,r,i){switch(this.offset){case n.TooltipOffset.Above:return[e-r/2,t-i+this.padding/2];case n.TooltipOffset.BelowRight:return[e+this.padding,t+i+1.5*this.padding];default:throw new Error("Invalid offset.")}},e.prototype.updateRectangle=function(){var e=this.tooltipText.getBoundingClientRect();this.tooltipBorderRectangle.setAttribute("width",""+(e.width+this.padding)),this.tooltipBorderRectangle.setAttribute("height",""+(e.height+this.padding/2))},e}();t.SvgTooltip=o;var s=[{name:"font-family",value:"Calibri"},{name:"font-size",value:"17px"},{name:"stroke",value:"none"},{name:"fill",value:"#000000"},{name:"white-space",value:"pre"},{name:"font-weight",value:"400"},{name:"font-style",value:"normal"}],a=[{name:"font-family",value:"Calibri"},{name:"font-size",value:"13px"},{name:"stroke",value:"none"},{name:"fill",value:"#000000"},{name:"white-space",value:"pre"},{name:"font-weight",value:"400"},{name:"font-style",value:"normal"}],l=[{name:"font-family",value:"Calibri"},{name:"font-size",value:"15px"},{name:"stroke",value:"none"},{name:"fill",value:"#000000"},{name:"white-space",value:"pre"},{name:"font-weight",value:"700"},{name:"font-style",value:"normal"}],h=[{name:"stroke",value:"black"},{name:"fill",value:"white"},{name:"fill-opacity",value:".93"},{name:"stroke-width",value:".5px"}]},6363:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.IvyRenderer||(t.IvyRenderer={}))[r.Image=0]="Image",r[r.Svg=1]="Svg",r[r.Canvas=2]="Canvas",r[r.JSON=3]="JSON"},1380:function(e,t,r){var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};t.__esModule=!0,n(r(4122),t),n(r(3353),t),n(r(3584),t)},5751:function(e,t,r){var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return n(t,e),t};t.__esModule=!0,t.Model=t.VisualModel=t.PropertyModel=t.TokenizedPropId=void 0;var s=o(r(4122)),a=function(){function e(){this.str={},this.double={},this.int={},this.bool={},this.color={},this.enum={}}return e.prototype.applyDiff=function(e,t){var r=this;if(e.r){var i=e.r;Object.keys(i).forEach((function(e){var t=s.getAttributeType(e,r.valueType);t&&r.removeAttribute(e,t)}))}if(t)switch(t){case s.UniformPropertyType.Str:this.valueType=s.PropAttributeType.Str;break;case s.UniformPropertyType.Double:this.valueType=s.PropAttributeType.Double;break;case s.UniformPropertyType.Int:case s.UniformPropertyType.Enum:this.valueType=s.PropAttributeType.Int;break;case s.UniformPropertyType.Bool:this.valueType=s.PropAttributeType.Bool;break;case s.UniformPropertyType.Color:this.valueType=s.PropAttributeType.Color;break;default:this.valueType=void 0}if(e.c){var n=e.c;Object.keys(n).forEach((function(e){var t=n[e],i=s.getAttributeType(e,r.valueType);i&&r.changeAttribute(e,i,t)}))}},e.prototype.changeAttribute=function(e,t,r){switch(t){case s.PropAttributeType.Str:this.str[e]=r;break;case s.PropAttributeType.Double:this.double[e]=r;break;case s.PropAttributeType.Int:this.int[e]=r;break;case s.PropAttributeType.Bool:this.bool[e]=r;break;case s.PropAttributeType.Color:this.color[e]=r;break;case s.PropAttributeType.EnumNamesToken:this.enum[e]=r;break;default:throw new Error("Unexpected PropAttributeType in changeAttribute")}},e.prototype.removeAttribute=function(e,t){switch(t){case s.PropAttributeType.Str:delete this.str[e];break;case s.PropAttributeType.Double:delete this.double[e];break;case s.PropAttributeType.Int:delete this.int[e];break;case s.PropAttributeType.Bool:delete this.bool[e];break;case s.PropAttributeType.Color:delete this.color[e];break;case s.PropAttributeType.EnumNamesToken:delete this.enum[e];break;default:throw new Error("Unexpected PropAttributeType in removeAttribute")}},e}(),l=function(){function e(e,t){void 0===t&&(t=void 0),this.nameToken=e,this.index=t}return e.prototype.equals=function(e){return this.nameToken===e.nameToken&&this.index===e.index},e}();t.TokenizedPropId=l;var h=function(){function e(e,t){this.attributes=new a,this.childNames=[],this.children=[],this.parent=0,this.type=s.UniformPropertyType.Object,this.owningVisual=e,this.token=t}return e.prototype.applyDiff=function(e){if(void 0!==e.t&&(this.type=e.t),void 0!==e.a&&this.attributes.applyDiff(e.a,e.t),void 0!==e.c){if(void 0!==e.cn)this.childNames=e.cn.map((function(e){return new l(e)}));else{if(void 0===e.cin)throw new Error("Error: PropertyModel.applyDiff: missing child names");this.childNames=[];for(var t=0;t<e.c.length;t++)this.childNames.push(new l(e.cin,t))}this.children=e.c}void 0!==e.p&&(this.parent=e.p)},e.prototype.getParent=function(){var e=this.owningVisual.getProp(this.parent);if(e!==this)return e},e.prototype.getIdOfChild=function(e){var t=this.children.indexOf(e);if(-1===t)throw new Error("getIdOfChild called with non-child");return this.childNames[t]},e.prototype.getChildById=function(e){for(var t=0;t<this.childNames.length;t++)if(e.equals(this.childNames[t]))return this.children[t];throw new Error("getChildById called with non-child")},e}();t.PropertyModel=h;var c=function(){function e(e){this.props={},this.owningModel=e}return e.prototype.applyDiff=function(e){var t=this;Object.keys(e.p).forEach((function(r){var i=e.p[r];if(i.r)delete t.props[r];else{var n=t.props[r];void 0===n&&(n=new h(t,parseInt(r)),t.props[r]=n),n.applyDiff(i)}}))},e.prototype.getProp=function(e){return this.props[e]},e.prototype.getTokenizedPropPath=function(e){for(var t=[],r=e;0!==r;){var i=this.getProp(r),n=i.parent;if(void 0===n)break;var o=this.getProp(n).getIdOfChild(r);t.push(o),r=i.parent}return t.slice().reverse()},e.prototype.getPropPath=function(e){var t=this.getTokenizedPropPath(e);return this.owningModel.detokenizePropPath(t)},e.prototype.tokenizedLookupProp=function(e,t){var r=this,i=e;return t.forEach((function(e){var t=r.getProp(i);i=t.getChildById(new l(e.nameToken,e.index))})),this.getProp(i)},e.prototype.lookupProp=function(e,t){var r=this.owningModel.tokenizePropPath(t);return this.tokenizedLookupProp(e,r)},e}();t.VisualModel=c;var u=function(){function e(){this.stringTable=[],this.reverseStringTable={},this.enumTable=[],this.visuals={}}return e.prototype.resetModelState=function(){this.version=void 0,this.stringTable=[],this.reverseStringTable={},this.enumTable=[],this.visuals={}},e.prototype.getVisual=function(e){var t=this.visuals[e];if(!t)throw new Error("Visual not found");return t},e.prototype.tokenizeString=function(e){return this.reverseStringTable[e]},e.prototype.detokenizeString=function(e){return this.stringTable[e]},e.prototype.detokenizeEnumTable=function(e){return this.enumTable[e]},e.prototype.tokenizeId=function(e){var t=function(e){for(var t,r,i=e.length-1;i>=0;i--)if(!((r=e.charAt(i))>="0"&&r<="9")){t=i;break}if(void 0===t)throw new Error("invalid property ID");if(t===e.length-1)return{name:e,index:void 0};var n=e.slice(void 0,t+1),o=e.slice(t+1);return{name:n,index:parseInt(o,10)}}(e),r=this.reverseStringTable[t.name];return new l(r,t.index)},e.prototype.detokenizeId=function(e){var t=this.stringTable[e.nameToken];return void 0!==e.index&&(t=t.concat(e.index.toString())),t},e.prototype.detokenizePropPath=function(e){var t,r=this,i="";return e.forEach((function(e){if(void 0===t)i=r.detokenizeId(e);else if(void 0!==e.index){if(t.nameToken!==e.nameToken)throw new Error("Malformed property path, collection content not under matching collection");i=i.concat(e.index.toString())}else i=i.concat("_",r.detokenizeId(e));t=e})),i},e.prototype.tokenizePropPath=function(e){var t=this,r=e.split("_");if(0==r.length)return[];""===r[0]&&(r=r.slice(1));var i=[];return r.forEach((function(e){var r=t.tokenizeId(e);void 0!==r.index&&i.push(new l(r.nameToken,void 0)),i.push(r)})),i},e.prototype.applyChange=function(e){var t=this;if(e.full&&this.resetModelState(),void 0!==this.version&&void 0!==e.ver&&this.version+1!==e.ver)throw new s.DesyncError("Version has de-synchronized.");this.version=e.ver;var r=e.s.s;if(r!==this.stringTable.length)throw new s.DesyncError("String table has de-synchronized.");e.s.v.forEach((function(e){t.stringTable[r]=e,t.reverseStringTable[e]=r,r++}));var i=e.e.s;if(i!==this.enumTable.length)throw new s.DesyncError("Enum table has de-synchronized.");e.e.v.forEach((function(e){t.enumTable[i]=e,i++})),this.applyVisualDiff(e.v)},e.prototype.applyVisualDiff=function(e){var t=this;Object.keys(e).forEach((function(r){var i=e[r];if(i.r)delete t.visuals[r];else{var n=t.visuals[r];void 0===n&&(n=new c(t),t.visuals[r]=n),n.applyDiff(i)}}))},e}();t.Model=u},4122:function(e,t){var r,i,n,o,s,a,l,h,c=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});t.__esModule=!0,t.DesyncError=t.UniformPropertyType=t.getAttributeType=t.EnumNamesTokenPropAttributeName=t.StringPropAttributeName=t.ValuePropAttributeName=t.IntPropAttributeName=t.BoolPropAttributeName=t.PropAttributeType=void 0,function(e){e.Str="Str",e.Double="Double",e.Int="Int",e.Bool="Bool",e.Color="Color",e.EnumNamesToken="EnumNamesToken"}(i=t.PropAttributeType||(t.PropAttributeType={})),function(e){e.WriteOnly="WO",e.ReadOnly="RO",e.HideEntireSubtreeUI="HESUI",e.HideMeButShowChildrenUI="HMBSCUI",e.ExpandableUI="EUI",e.NextPropOnSameLine="NPOSL",e.HideLabel="HL",e.ShowResetUI="SRUI",e.HasOwnExpandableSection="HOES",e.NextPropOnSameLineFOTP="NPOSLFOTP",e.ShowResetUIFOTP="SRUIFOTP",e.Untransferable="U",e.NotTriviallyUndoable="NTU",e.HasDefault="HDe",e.IsDefault="IDe"}(n=t.BoolPropAttributeName||(t.BoolPropAttributeName={})),function(e){e.Size="S",e.MinSize="MiS",e.MaxSize="MaS"}(o=t.IntPropAttributeName||(t.IntPropAttributeName={})),function(e){e.Value="V",e.Min="Mi",e.Max="Ma",e.StepSize="SS"}(s=t.ValuePropAttributeName||(t.ValuePropAttributeName={})),function(e){e.LocalizedName="LN"}(a=t.StringPropAttributeName||(t.StringPropAttributeName={})),function(e){e.EnumOptions="EO",e.EnumLocalizedOptions="ELO"}(l=t.EnumNamesTokenPropAttributeName||(t.EnumNamesTokenPropAttributeName={})),t.getAttributeType=function(e,t){switch(e){case n.WriteOnly:case n.ReadOnly:case n.HideEntireSubtreeUI:case n.HideMeButShowChildrenUI:case n.ExpandableUI:case n.NextPropOnSameLine:case n.HideLabel:case n.ShowResetUI:case n.HasOwnExpandableSection:case n.NextPropOnSameLineFOTP:case n.ShowResetUIFOTP:case n.Untransferable:case n.NotTriviallyUndoable:case n.HasDefault:case n.IsDefault:return i.Bool;case o.Size:case o.MinSize:case o.MaxSize:return i.Int;case s.Value:case s.Min:case s.Max:case s.StepSize:return t;case a.LocalizedName:return i.Str;case l.EnumOptions:case l.EnumLocalizedOptions:return i.EnumNamesToken}},(h=t.UniformPropertyType||(t.UniformPropertyType={}))[h.Object=0]="Object",h[h.Collection=1]="Collection",h[h.Str=2]="Str",h[h.Double=3]="Double",h[h.Int=4]="Int",h[h.Bool=5]="Bool",h[h.Enum=6]="Enum",h[h.Color=7]="Color",h[h.Count=8]="Count";var u=function(e){function t(r){var i=e.call(this,r)||this;return Object.setPrototypeOf(i,t.prototype),i}return c(t,e),t}(Error);t.DesyncError=u},3584:function(e,t,r){var i,n=this&&this.__extends||(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},i(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&o(t,e,r);return s(t,e),t};t.__esModule=!0,t.getProperty=t.isEnumProperty=t.isColorProperty=t.isBoolProperty=t.isIntProperty=t.isDoubleProperty=t.isStringProperty=t.isCollectionProperty=t.isObjectProperty=t.EnumProperty=t.ColorProperty=t.BoolProperty=t.IntProperty=t.DoubleProperty=t.StringProperty=t.CollectionProperty=t.ObjectProperty=t.Property=void 0;var l=a(r(4122)),h=function(){function e(e){this.prop=e}return e.prototype.getType=function(){throw new Error("Undetermined property type")},e.prototype.getBoolAttribute=function(e){return this.prop.attributes.bool[e]},e.prototype.getStringAttribute=function(e){return this.prop.attributes.str[e]},e.prototype.getEnumNamesTokenAttribute=function(e){return this.prop.attributes.enum[e]},e}();t.Property=h;var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.getType=function(){return l.UniformPropertyType.Object},t.prototype.getProperty=function(e){var t=this.prop.owningVisual.lookupProp(this.prop.token,e);if(t)return _(t)},t.prototype.forEachChild=function(e){if(this.prop.childNames.length!==this.prop.children.length)throw new Error("name and children length mismatch");for(var t=0;t<this.prop.children.length;t++){var r=this.prop.childNames[t],i=this.prop.owningVisual.owningModel.detokenizeId(r),n=this.prop.children[t];e(i,_(this.prop.owningVisual.getProp(n)))}},t}(h);t.ObjectProperty=c;var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.getType=function(){return l.UniformPropertyType.Collection},t.prototype.length=function(){return this.prop.children.length},t.prototype.getAt=function(e){var t=this.prop.children[e],r=_(this.prop.owningVisual.getProp(t));if(!y(r))throw new Error("collection contains a non-object");return r},t.prototype.forEachChild=function(e){for(var t=0;t<this.prop.children.length;t++){var r=this.prop.children[t],i=_(this.prop.owningVisual.getProp(r));if(!y(i))throw new Error("collection contains a non-object");e(t,i)}},t}(h);t.CollectionProperty=u;var d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.getType=function(){return l.UniformPropertyType.Str},t.prototype.getValueAttribute=function(e){return this.prop.attributes.str[e]},t}(h);t.StringProperty=d;var p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.getType=function(){return l.UniformPropertyType.Double},t.prototype.getValueAttribute=function(e){return this.prop.attributes.double[e]},t}(h);t.DoubleProperty=p;var f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.getType=function(){return l.UniformPropertyType.Int},t.prototype.getValueAttribute=function(e){return this.prop.attributes.int[e]},t}(h);t.IntProperty=f;var g=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.getType=function(){return l.UniformPropertyType.Bool},t.prototype.getValueAttribute=function(e){return this.prop.attributes.bool[e]},t}(h);t.BoolProperty=g;var m=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.getType=function(){return l.UniformPropertyType.Color},t.prototype.getValueAttribute=function(e){return this.prop.attributes.color[e]},t}(h);t.ColorProperty=m;var v=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.getType=function(){return l.UniformPropertyType.Enum},t.prototype.getValueAttribute=function(e){return this.prop.attributes.int[e]},t.prototype.getValueAsString=function(){var e=this.getValueAttribute(l.ValuePropAttributeName.Value);if(void 0!==e){var t=this.getEnumNamesTokenAttribute(l.EnumNamesTokenPropAttributeName.EnumOptions);if(void 0!==t){var r=this.prop.owningVisual.owningModel.detokenizeEnumTable(t)[e];return this.prop.owningVisual.owningModel.detokenizeString(r)}}},t.prototype.getLocalizedValue=function(){var e=this.getValueAttribute(l.ValuePropAttributeName.Value);if(void 0!==e){var t=this.getEnumNamesTokenAttribute(l.EnumNamesTokenPropAttributeName.EnumLocalizedOptions);if(void 0!==t){var r=this.prop.owningVisual.owningModel.detokenizeEnumTable(t)[e];return this.prop.owningVisual.owningModel.detokenizeString(r)}}},t}(h);function y(e){return e.getType()===l.UniformPropertyType.Object}function _(e){switch(e.type){case l.UniformPropertyType.Object:return new c(e);case l.UniformPropertyType.Collection:return new u(e);case l.UniformPropertyType.Str:return new d(e);case l.UniformPropertyType.Double:return new p(e);case l.UniformPropertyType.Int:return new f(e);case l.UniformPropertyType.Bool:return new g(e);case l.UniformPropertyType.Enum:return new v(e);case l.UniformPropertyType.Color:return new m(e)}throw new Error("Unexpected UniformPropertyType")}t.EnumProperty=v,t.isObjectProperty=y,t.isCollectionProperty=function(e){return e.getType()===l.UniformPropertyType.Collection},t.isStringProperty=function(e){return e.getType()===l.UniformPropertyType.Str},t.isDoubleProperty=function(e){return e.getType()===l.UniformPropertyType.Double},t.isIntProperty=function(e){return e.getType()===l.UniformPropertyType.Int},t.isBoolProperty=function(e){return e.getType()===l.UniformPropertyType.Bool},t.isColorProperty=function(e){return e.getType()===l.UniformPropertyType.Color},t.isEnumProperty=function(e){return e.getType()===l.UniformPropertyType.Enum},t.getProperty=_},3353:function(e,t,r){var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return n(t,e),t};t.__esModule=!0,t.VisualsMirror=t.AlterTrackingResponseScope=t.Endpoint=t.VisualMirror=void 0;var s=o(r(5751)),a=o(r(3584)),l=function(){function e(e){this.model=e}return e.prototype.getRootProperty=function(){var t=a.getProperty(this.model.getProp(e.rootPropToken));if(a.isObjectProperty(t))return t;throw new Error("A visual's root property is always expected to be an object.")},e.rootPropToken=0,e}();t.VisualMirror=l;var h;t.Endpoint=function(){this.trackedVisualIDs=[],this.relevantAttributes=[]},function(e){e.Incremental="inc",e.Full="full"}(h=t.AlterTrackingResponseScope||(t.AlterTrackingResponseScope={}));var c=function(){this.v=[],this.a=[]},u=function(){this.g=[]},d=function(){function e(){this.model=new s.Model,this.endpoints={}}return e.prototype.createTrackingAlterationRequestJson=function(e){for(var t={},r=0,i=Object.keys(this.endpoints);r<i.length;r++)for(var n=i[r],o=0,s=this.endpoints[n].trackedVisualIDs;o<s.length;o++){var a=s[o],l=t[a];l?l.push(n):t[a]=[n]}for(var d={},p=0,f=Object.keys(t);p<f.length;p++){var g=f[p],m=t[g],v=m.join(),y=d[v];if(y)y.v.push(g);else{for(var _=new Set,b=0,T=m;b<T.length;b++)for(var w=T[b],x=0,C=this.endpoints[w].relevantAttributes;x<C.length;x++){var S=C[x];_.add(S)}var P=new c;P.v=[g],P.a=Array.from(_),d[v]=P}}var E=new u;return e===h.Full&&(E.s=e),E.g=Object.values(d),JSON.stringify(E)},e.prototype.updateModel=function(e){var t=JSON.parse(e);this.model.applyChange(t)},e.prototype.getVisualMirror=function(e){return new l(this.model.getVisual(e))},e}();t.VisualsMirror=d},943:(e,t,r)=>{function i(e){if(null===e)return"";let t=e.toString().toUpperCase();return t.startsWith("{")||(t=`{${t}`),t.endsWith("}")||(t=`${t}}`),t}r.d(t,{n:()=>i})},1093:(e,t,r)=>{r.d(t,{Z:()=>Ye,L:()=>Ke});var i=r(2661),n=r(4591);class o extends i.B{getGeometry(e){switch(e.type){case 0:const t=this.get(e.preset);if(void 0===t)throw new Error(`Unregistered geometry for type:${e.preset}`);return t;case 1:return e.custom;default:(0,n.t)(e)}}}var s=r(5965),a=r(3955),l=r(5069);class h{constructor(e,t,r){this.rect=e,this.rotInDegrees=t,this.rotationPoint=r}get leftTop(){return void 0===this.rotatedLeftTop&&(this.rotatedLeftTop=new l.S(this.rect.left,this.rect.top),this.rotatedLeftTop.rotate(this.rotInDegrees,this.rotationPoint)),this.rotatedLeftTop}get rightBottom(){return void 0===this.rotatedRightBottom&&(this.rotatedRightBottom=new l.S(this.rect.right,this.rect.bottom),this.rotatedRightBottom.rotate(this.rotInDegrees,this.rotationPoint)),this.rotatedRightBottom}get leftBottom(){return void 0===this.rotatedLeftBottom&&(this.rotatedLeftBottom=new l.S(this.rect.left,this.rect.bottom),this.rotatedLeftBottom.rotate(this.rotInDegrees,this.rotationPoint)),this.rotatedLeftBottom}get rightTop(){return void 0===this.rotatedRightTop&&(this.rotatedRightTop=new l.S(this.rect.right,this.rect.top),this.rotatedRightTop.rotate(this.rotInDegrees,this.rotationPoint)),this.rotatedRightTop}get widthAlongRotatedAxis(){return this.rect.width()}get heightAlongRotatedAxis(){return this.rect.height()}get widthAlongXYAxis(){return Math.abs(this.rightBottom.x-this.leftTop.x)}get heightAlongXYAxis(){return Math.abs(this.rightBottom.y-this.leftTop.y)}get center(){return new l.S((this.leftTop.x+this.rightBottom.x)/2,(this.leftTop.y+this.rightBottom.y)/2)}getUnRotatedAtCenterRect(){const e=new l.S(this.leftTop.x,this.leftTop.y);e.rotate(-this.rotInDegrees,this.center);const t=new l.S(this.rightBottom.x,this.rightBottom.y);return t.rotate(-this.rotInDegrees,this.center),new a.U(e.x,e.y,t.x,t.y)}getRotatedRectAtCenter(e){return new h(this.getUnRotatedAtCenterRect(),e,this.center)}getRotatedRectAtPoint(e,t){return new h(this.getUnRotatedAtCenterRect(),e,t)}}function c(e,t,r){return new h(e,t,r)}class u{constructor(e,t,r,i){this.left=e,this.top=t,this.right=r,this.bottom=i}equals(e){return d(this.left,e.left)&&d(this.top,e.top)&&d(this.right,e.right)&&d(this.bottom,e.bottom)}getSrcRectTransformFromParent(e){const t=e.clone(),r=(0,s.m)(e),i=r.center(),n=c(this.getFlipAdjustedNormalizedSrcRect(e.flip,r),t.rot,i).getUnRotatedAtCenterRect();return t.pos.x=n.left,t.pos.y=n.top,t.size.width=n.width(),t.size.height=n.height(),t}getParentTransform(e){const t=e.clone(),r=(0,s.m)(e),i=c(this.getFlipAdjustedNormalizedParentRect(e.flip,r),t.rot,r.center()).getUnRotatedAtCenterRect();return t.pos.x=i.left,t.pos.y=i.top,t.size.width=i.width(),t.size.height=i.height(),t}isDefault(){return 0===this.left&&0===this.top&&0===this.right&&0===this.bottom}getFlipAdjustedNormalizedSrcRect(e,t){const r=t.left+t.width()*(e.x?this.right:this.left)/100,i=t.top+t.height()*(e.y?this.bottom:this.top)/100,n=t.right-t.width()*(e.x?this.left:this.right)/100,o=t.bottom-t.height()*(e.y?this.top:this.bottom)/100;return new a.U(r,i,n,o)}getFlipAdjustedNormalizedParentRect(e,t){const r=100*t.width()/(100-this.left-this.right),i=100*t.height()/(100-this.top-this.bottom),n=t.left-r*(e.x?this.right:this.left)/100,o=t.top-i*(e.y?this.bottom:this.top)/100,s=t.right+r*(e.x?this.left:this.right)/100,l=t.bottom+i*(e.y?this.top:this.bottom)/100;return new a.U(n,o,s,l)}}function d(e,t){return Math.abs(e-t)<.01}var p=r(9946),f=r(9495),g=r(4814),m=r(4193),v=r(7721),y=r(9807),_=r(5942);class b{constructor(e,t){this.paths=[],this.size=new m.N(e,t)}}const T={b:e=>e.bottom,h:e=>e.height(),hc:e=>e.left+e.width()/2,hd2:e=>e.height()/2,hd3:e=>e.height()/3,hd4:e=>e.height()/4,hd5:e=>e.height()/5,hd6:e=>e.height()/6,hd8:e=>e.height()/8,hd10:e=>e.height()/10,l:e=>e.left,ls:e=>Math.max(e.width(),e.height()),r:e=>e.right,ss:e=>Math.min(e.width(),e.height()),ssd2:e=>T.ss(e)/2,ssd4:e=>T.ss(e)/4,ssd6:e=>T.ss(e)/6,ssd8:e=>T.ss(e)/8,ssd16:e=>T.ss(e)/16,ssd32:e=>T.ss(e)/32,t:e=>e.top,vc:e=>e.top+e.height()/2,w:e=>e.width(),wd2:e=>e.width()/2,wd3:e=>e.width()/3,wd4:e=>e.width()/4,wd5:e=>e.width()/5,wd6:e=>e.width()/6,wd8:e=>e.width()/8,wd10:e=>e.width()/10,wd12:e=>e.width()/12,wd32:e=>e.width()/32};function w(e,t,r){return"number"==typeof e?e:e in t?t[e]:function(e,t){if(e in T)return T[e](t);throw new Error(`Invalid formula: ${e}`)}(e,r)}var x=r(6487),C=r(9764);const S=100;function P(e,t,r){const i=new b(S,S);let o,a;if(void 0!==e.u&&e.u)o=new y.A(new _.i(0,0),new m.N(1,1)),a=new y.A(new _.i(0,0),new m.N(S,S));else{const e=t.size.width/t.size.height;o=new y.A(new _.i(0,0),new m.N(e*S,S)),i.size.width=e*S}const h=function(e,t,r){const i={},o=e=>w(e,i,r);return void 0!==e&&e.forEach((e=>{const[t,r]=e;i[t]=r})),void 0!==t&&t.forEach((e=>{const[t,...r]=e;i[t]=function(e,t){switch(e[0]){case 0:return Math.abs(t(e[1]));case 1:return Math.sqrt(Math.abs(t(e[1])));case 2:return t(e[1]);case 3:return-t(e[1]);case 4:return Math.atan2(t(e[2]),t(e[1]));case 5:return t(e[1])*Math.cos(t(e[2]));case 6:return Math.max(t(e[1]),t(e[2]));case 7:return Math.min(t(e[1]),t(e[2]));case 8:return t(e[1])*Math.sin(t(e[2]));case 9:return t(e[1])*Math.tan(t(e[2]));case 10:return t(e[1])+t(e[2]);case 11:return t(e[1])-t(e[2]);case 12:return r=t(e[1]),i=t(e[2]),Math.sqrt(r*r+i*i);case 13:return t(e[1])*t(e[2]);case 14:return function(e,t){return 0===t?e:e/t}(t(e[1]),t(e[2]));case 15:return function(e,t,r){return 0===r?e*t:e*t/r}(t(e[1]),t(e[2]),t(e[3]));case 16:return t(e[1])+(t(e[2])-t(e[3]));case 17:return function(e,t,r){return 0===r?e+t:(e+t)/r}(t(e[1]),t(e[2]),t(e[3]));case 18:return t(e[1])>0?t(e[2]):t(e[3]);case 19:return t(e[1])*Math.cos(Math.atan2(t(e[3]),t(e[2])));case 20:return Math.min(Math.max(t(e[1]),t(e[2])),t(e[3]));case 21:return t(e[1])*Math.sin(Math.atan2(t(e[3]),t(e[2])));default:(0,n.t)(e)}var r,i}(r,o)})),i}(void 0!==r&&r.length>0?r:e.a,e.g,(0,s.m)(o));return e.p.forEach((e=>{i.paths.push(function(e,t,r,i){const o=(0,s.m)(r),a=new l.S(o.left+o.width()/2,o.top+o.height()/2),h=(0,x.Yr)(r.rot),c=(0,C.Iu)(-a.x,-a.y).scale(r.flip.x?-1:1,r.flip.y?-1:1).rotate(h).translate(a.x,a.y),u=(e,r)=>{const n=new l.S(w(e,t,o),w(r,t,o));if(n.multiply(c),void 0!==i){const e=(0,C.bA)(i.size.width,i.size.height).translate(i.pos.x,i.pos.y);n.multiply(e)}return n},d=void 0!==i?i.size.width:1,p=void 0!==i?i.size.height:1;return{fillMode:void 0===e.f?1:e.f,lineEnabled:void 0===e.l||e.l,segments:e.s.map((e=>{switch(e[0]){case 0:return{segmentType:0,beginPoint:u(e[1],e[2])};case 1:return{segmentType:1,endPoint:u(e[1],e[2])};case 2:return{segmentType:2,xRadius:w(e[1],t,o)*d,yRadius:w(e[2],t,o)*p,startAngle:w(e[3],t,o),sweepAngle:w(e[4],t,o)};case 3:return{segmentType:3,controlPoint:u(e[1],e[2]),endPoint:u(e[3],e[4])};case 4:return{segmentType:4,controlPoint1:u(e[1],e[2]),controlPoint2:u(e[3],e[4]),endPoint:u(e[5],e[6])};case 5:return{segmentType:5};default:(0,n.t)(e)}}))}}(e,h,o,a))})),i}var E=r(7660),M=r(6730),R=r(2718),A=r(4136);class I{constructor(e){this.type=1,this.color=e}clone(){return new I(this.color)}equals(e){return F(e)&&this.color.equals(e.color)}}function F(e){return 1===e.type}var B=r(2518);function L(e){return 2===e.type}class D{constructor(e,t,r,i,n,o,s,a){this.fill=e,this.weight=t,this.dash=r,this.headEnd=i,this.tailEnd=n,this.join=o,this.compound=s,this.cap=a}clone(){var e,t,r,i,n;return new D(null===(e=this.fill)||void 0===e?void 0:e.clone(),this.weight,null===(t=this.dash)||void 0===t?void 0:t.clone(),null===(r=this.headEnd)||void 0===r?void 0:r.clone(),null===(i=this.tailEnd)||void 0===i?void 0:i.clone(),null===(n=this.join)||void 0===n?void 0:n.clone(),this.compound,this.cap)}equals(e){return(0,B.C)(this.fill,e.fill)&&this.weight===e.weight&&(0,B.C)(this.dash,e.dash)&&(0,B.C)(this.headEnd,e.headEnd)&&(0,B.C)(this.tailEnd,e.tailEnd)&&(0,B.C)(this.join,e.join)&&this.compound===e.compound&&this.cap===e.cap}resolveFrom(e){void 0!==this.fill&&!L(this.fill)||void 0===e.fill||(this.fill=e.fill.clone()),void 0===this.weight&&void 0!==e.weight&&(this.weight=e.weight),void 0===this.dash&&void 0!==e.dash&&(this.dash=e.dash.clone()),void 0===this.headEnd&&void 0!==e.headEnd&&(this.headEnd=e.headEnd.clone()),void 0===this.tailEnd&&void 0!==e.tailEnd&&(this.tailEnd=e.tailEnd.clone()),void 0===this.join&&void 0!==e.join&&(this.join=e.join.clone()),void 0===this.compound&&void 0!==e.compound&&(this.compound=e.compound),void 0===this.cap&&void 0!==e.cap&&(this.cap=e.cap)}}const k=new A.kl(255,255,255,1),O=new A.kl(0,0,0,0);function U(e){return e<0?0:e<=.798354?12.92*e:e<255?269.025*Math.pow(e/255,1/2.4)-14.025:255}function N(e,t,r){const i=function(e){return e<0?e+360:e>=360?e-360:e}(r);return i<60?e+(t-e)*i/60:i<180?t:i<240?e+(t-e)*(240-i)/60:e}function V(e){if(e.transforms.length>0){const t=function(e){return function(e){return 4===e.type}(e)?function(e){const t=e.h,r=e.s,i=e.l,n=i<=.5?i*(r+1):i+r-i*r,o=2*i-n;return new A.kl(255*N(o,n,t+120),255*N(o,n,t),255*N(o,n,t-120),e.a)}(e):(0,A.DT)(e)?function(e){return new A.kl(U(e.r),U(e.g),U(e.b),e.a)}(e):e}(e.transforms.reduce(((e,t)=>t.transform(e)),e));return(0,A.Pc)(t)}return e}class G{constructor(){this.type=0}clone(){return new G}equals(e){return 0===e.type}}var z=r(3738);function W(e){return 2===e.type}class H{constructor(e,t){this.position=e,this.color=t}clone(){return new H(this.position,this.color)}equals(e){return this.position===e.position&&this.color.equals(e.color)}}class j{constructor(e,t,r,i,n,o=!0){this.type=3,this.gradientType=e,this.stops=t,this.fromRect=r,this.toRect=i,this.angle=n,this.rotateWithShape=o}clone(){var e,t;return new j(this.gradientType,this.stops.map((e=>e.clone())),null===(e=this.fromRect)||void 0===e?void 0:e.clone(),null===(t=this.toRect)||void 0===t?void 0:t.clone(),this.angle,this.rotateWithShape)}equals(e){return!!q(e)&&this.gradientType===e.gradientType&&function(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r+=1)if(!(0,B.w)(e[r],t[r]))return!1;return!0}(this.stops,e.stops)&&(0,B.C)(this.fromRect,e.fromRect)&&(0,B.C)(this.toRect,e.toRect)&&this.angle===e.angle&&this.rotateWithShape===e.rotateWithShape}}function q(e){return 3===e.type}function X(e,t){if(F(e)){if(W(e.color)){const r=t.clone();return r.transforms.push(...(0,z.x)(e.color.transforms)),new I(r)}}else if(q(e)){if(function(e){for(const t of e.stops)if(W(t.color))return!0;return!1}(e))return function(e,t){const r=e.stops.map((e=>{if(W(e.color)){const r=t.clone();return r.transforms.push(...(0,z.x)(e.color.transforms)),new H(e.position,r)}return e}));return new j(e.gradientType,r,e.fromRect,e.toRect,e.angle,e.rotateWithShape)}(e,t)}else if(L(e))throw new Error("Resolve style fillprops before making a call to replace placeholder color.");return e}function K(e,t,r){if(0===t.index)return r;const i=Math.min(t.index,e.length)-1;if(i<0)throw new Error(`StyleMatrixReference index ${t.index} is negative.`);return e[i]}const Y=new G;function $(e,t,r){if(F(e))return function(e,t){if((0,A.KL)(e))return V(e);if(function(e){return 1===e.type}(e)){if(void 0===t)throw new Error("ThemeInfo should be provided to resolve SchemeColors.");return V(function(e,t){const r=e.theme.colorScheme.presets[e.schemeMapping[t.presetColorType]];return new A.kl(r.r,r.g,r.b,r.a,[...t.transforms])}(t,e))}throw new Error(`Unsupported color type to resolve: ${e.type}.`)}(e.color,r);if(L(e)){if(void 0===t||void 0===r)throw new Error("`Style reference and theme info needed to resolve StyleFillProps.");return $((i=t,X(K(r.theme.styles.fills,i,Y),i.color)),t,r)}var i}const Z=new D(new G);function J(e){return void 0===e?"none":(0,A.T3)(e)}var Q=r(1459);function ee(e){switch(e.segmentType){case 1:case 3:case 4:return e.endPoint;case 0:return e.beginPoint;default:throw Error("Unexpected segment type")}}class te{constructor(e){this.path="",this.transform=e}moveTo(e){const t=e.transform(this.transform);this.path+=`M${t.x},${t.y}`,this.last=e}lineTo(e){const t=e.transform(this.transform);this.path+=`L${t.x},${t.y}`,this.last=e}arcTo(e,t,r,i){const n=0===e||0===t,o=n?r:Math.atan2(e*Math.sin(r),t*Math.cos(r)),s=i<0?-1:1;let a=Math.abs(i);if(a>=Q.uo)a=Q.uo;else{let i=r+a*s;i=n?i:Math.atan2(e*Math.sin(i),t*Math.cos(i)),a=(i-o)*s,a<0&&(a+=Q.uo)}const h=this.last.x-Math.cos(o)*e,c=this.last.y-Math.sin(o)*t,u=Math.ceil(8*Math.abs(a)/Q.uo);for(let r=0;r<u;r+=1){const i=s*Q.uo/8,n=o+r*i,d=r===u-1?s*a-r*i:i,p=n+d,f=n+d/2,g=1/Math.cos(d/2),m=new l.S(h+Math.cos(f)*g*e,c+Math.sin(f)*g*t),v=new l.S(h+Math.cos(p)*e,c+Math.sin(p)*t);Math.abs(d)>0?this.quadraticBezierTo(m,v):this.lineTo(v)}}quadraticBezierTo(e,t){const r=e.transform(this.transform),i=t.transform(this.transform);this.path+=`Q${r.x},${r.y},${i.x},${i.y}`,this.last=t}cubicBezierTo(e,t,r){const i=e.transform(this.transform),n=t.transform(this.transform),o=r.transform(this.transform);this.path+=`C${i.x},${i.y},${n.x},${n.y},${o.x},${o.y}`,this.last=r}close(){this.path+="Z"}}function re(e,t){e.segments.forEach((e=>{switch(e.segmentType){case 0:t.moveTo(e.beginPoint);break;case 1:t.lineTo(e.endPoint);break;case 2:t.arcTo(e.xRadius,e.yRadius,e.startAngle,e.sweepAngle);break;case 4:t.cubicBezierTo(e.controlPoint1,e.controlPoint2,e.endPoint);break;case 3:t.quadraticBezierTo(e.controlPoint,e.endPoint);break;case 5:t.close();break;default:(0,n.t)(e)}}))}function ie(e,t,r){const i=(0,R.u)("path");return i.setAttribute("d",e),[i,t,!r]}function ne(e,t,r,i,o,s,a){var h;const c=function(e,t){const r=new l.S(t*function(e,t){switch(t){case 0:return 5===e?2.5:2;case 1:return 5===e?3.5:3;case 2:return 5;default:(0,n.t)(t)}}(e.type,e.width),t*function(e,t){switch(t){case 0:return 2;case 1:return 3;case 2:return 5===e?4.5:5;default:(0,n.t)(t)}}(e.type,e.length));switch(e.type){case 1:case 5:const t=5===e.type,i=[{segmentType:0,beginPoint:new l.S(-r.x/2,-r.y)},{segmentType:1,endPoint:new l.S(0,0)},{segmentType:1,endPoint:new l.S(r.x/2,-r.y)}];return{fillMode:t?0:1,lineEnabled:t,segments:t?i:i.concat([{segmentType:5}])};case 2:return{fillMode:1,lineEnabled:!1,segments:[{segmentType:0,beginPoint:new l.S(-r.x/2,-r.y)},{segmentType:1,endPoint:new l.S(0,0)},{segmentType:1,endPoint:new l.S(r.x/2,-r.y)},{segmentType:1,endPoint:new l.S(0,-r.y/2)},{segmentType:5}]};case 3:return{fillMode:1,lineEnabled:!1,segments:[{segmentType:0,beginPoint:new l.S(0,r.y/2)},{segmentType:1,endPoint:new l.S(r.x/2,0)},{segmentType:1,endPoint:new l.S(0,-r.y/2)},{segmentType:1,endPoint:new l.S(-r.x/2,0)},{segmentType:5}]};case 4:return{fillMode:1,lineEnabled:!1,segments:[{segmentType:0,beginPoint:new l.S(r.x/2,0)},{segmentType:2,xRadius:r.x/2,yRadius:r.y/2,startAngle:0,sweepAngle:Q.uo},{segmentType:5}]};default:throw Error("Unexpected line end type")}}(e,(h=t,Math.max(2,h))),u=function(e,t,r){const[i,n]=function(e,t,r){const i=e.segments;let n,o;if(t)o=ee(i[i.length-2]),n=ee(i[i.length-1]);else{const e=i[0];if(0!==e.segmentType)throw Error("Unexpected segment type");n=e.beginPoint,o=ee(i[1])}n=n.transform(r),o=o.transform(r);const s=new l.S(n.x-o.x,n.y-o.y);return s.normalize(),[n,s]}(e,t,r);return new C.V2(-n.y,n.x,n.x,n.y,i.x,i.y)}(o,i,s),d=new te(u);re(c,d);const p=ie(d.path,c.fillMode,c.lineEnabled);return void 0!==r&&0!==r.dashType&&p[0].setAttribute("stroke-dasharray","none"),5===e.type&&p[0].setAttribute("stroke-linecap","round"),function(e){switch(e){case 3:case 4:case 2:case 1:return!0;case 0:case 5:return!1;default:(0,n.t)(e)}}(e.type)&&p[0].setAttribute("fill",a),p}class oe{}class se{constructor(){this.type=oe,this.pointerEventNotifiers=(0,E.n)(),this.update=new p.p,this.hitTestSlop=M.Hr,this.group=(0,R.u)("g"),this.paths=[]}setGeometry(e,t){this.geometry=e,this.geometryTransform=(0,C.Iu)(-e.size.width/2,-e.size.height/2).scale(t.size.width/e.size.width*(t.flip.x?-1:1),t.size.height/e.size.height*(t.flip.y?-1:1)).rotate((0,x.Yr)(t.rot)),this.paths=function(e,t){const r=[],i=new te(t);let n=0,o=!0;return e.paths.forEach((e=>{(""!==i.path&&n!==e.fillMode||!o)&&(r.push(ie(i.path,n,o)),i.path=""),re(e,i),n=e.fillMode,o=e.lineEnabled})),r.push(ie(i.path,n,o)),r}(e,this.geometryTransform),this.setCenter(t.getCenter())}setProps(e,t,r,i,o,s,a,l){var h,c;(null==l?void 0:l.isInHighContrastMode)?this.fillColor=function(e){return void 0!==e.highContrastColors?(0,A.yY)(e.highContrastColors.backgroundColor):O}(l):this.fillColor=void 0!==e?$(e,null==r?void 0:r.fillRef,i):void 0,this.pictureEffects=s,this.group.setAttribute("fill",J(this.fillColor));const u=function(e,t){if(!(null==t?void 0:t.isInHighContrastMode))return e;const r=new I(function(e){return void 0!==e.highContrastColors?(0,A.yY)(e.highContrastColors.foregroundTextColor):k}(t));if(void 0!==e){const t=e.clone();return t.fill=r,t}return new D(r)}(t,l);if(void 0!==u){const e=function(e,t,r){if(void 0!==r&&void 0!==t&&void 0!==t.lineRef){const i=e.clone();return i.resolveFrom(function(e,t){var r;const i=K(e.lines,t,Z),n=i.clone();return n.fill=X(null!==(r=i.fill)&&void 0!==r?r:new G,t.color),n}(r.theme.styles,t.lineRef)),i}return e}(u,r,i),t=null!==(h=e.weight)&&void 0!==h?h:1,o=J($(null!==(c=e.fill)&&void 0!==c?c:new G,void 0,i));this.group.setAttribute("stroke",o),this.group.setAttribute("stroke-width",`${t}pt`),void 0!==e.dash&&0!==e.dash.dashType?this.group.setAttribute("stroke-dasharray",(d=e.dash.dashType,p=96*t/72,function(e){switch(e){case 1:return[1,3];case 2:return[4,3];case 4:return[4,3,1,3];case 3:return[8,3];case 5:return[8,3,1,3];case 6:return[8,3,1,3,1,3];case 7:return[3,1];case 8:return[1,1];case 9:return[3,1,1,1];case 10:return[3,1,1,1,1,1];case 0:return[];default:(0,n.t)(e)}}(d).map((e=>e*p)).join(" "))):this.group.removeAttribute("stroke-dasharray"),void 0!==e.join&&0!==e.join.joinType?this.group.setAttribute("stroke-linejoin",function(e){switch(e){case 1:return"bevel";case 0:return"miter";case 2:return"round";default:(0,n.t)(e)}}(e.join.joinType)):(this.group.removeAttribute("stroke-linejoin"),this.group.setAttribute("stroke-miterlimit","8"));const s=e.headEnd;void 0!==s&&0!==s.type&&this.geometry.paths.forEach((r=>{0===r.fillMode&&r.lineEnabled&&this.paths.push(ne(s,t,e.dash,!1,r,this.geometryTransform,o))}));const a=e.tailEnd;void 0!==a&&0!==a.type&&this.geometry.paths.forEach((r=>{0===r.fillMode&&r.lineEnabled&&this.paths.push(ne(a,t,e.dash,!0,r,this.geometryTransform,o))}))}else this.group.setAttribute("stroke","none");var d,p}setCenter(e){this.group.setAttribute("transform",`translate(${e.x} ${e.y})`)}teardown(){}}function ae(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}class le{constructor(e,t){this.element=e,this.name=t}set transform(e){this.element.set(this.name,e)}setRotate(e,t=0,r=0,i=2){this.transform=he(e,t,r,i)}setScale(e,t,r=2){this.transform=ce(e,t,r)}setTranslate(e,t,r=2){this.transform=ue(e,t,r)}set(e,t,r,i,n=2){var o,s;0!==r||t.x||t.y?this.transform=`${ue(i.x,i.y,n)}${he(r,0,0,n)}${o=t.x,s=t.y,ce(o?-1:1,s?-1:1,0)}${ue(e.x,e.y,n)}`:this.transform=`${ue(i.x+e.x,i.y+e.y,n)}`}}function he(e,t,r,i){return 0===e?"":0!==t||0!==r?`rotate(${e.toFixed(i)},${t.toFixed(i)},${r.toFixed(i)})`:`rotate(${e.toFixed(i)})`}function ce(e,t,r){return 1===e&&1===t?"":`scale(${e.toFixed(r)},${t.toFixed(r)})`}function ue(e,t,r){return 0===e&&0===t?"":`translate(${e.toFixed(r)},${t.toFixed(r)})`}class de extends class{constructor(e){this.element=e}get id(){return this.element.id}set id(e){this.element.id=e}get style(){return this.element.style}set(e,t){this.element.setAttribute(e,`${t}`)}appendChild(e){this.element.appendChild(e.element)}}{constructor(e){super(e),this.transform=new le(this,"transform")}set opacity(e){this.set("opacity",e)}}var pe=r(2489),fe=r(5163);const ge=[2,1.75,1.5,1.25,1,.5],me='<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">',ve='<path d="M12.4014 13.2403C13.222 12.83 14.2039 12.9967 14.8536 13.6464C15.0488 13.8417 15.0488 14.1583 14.8535 14.3536C14.6583 14.5488 14.3417 14.5488 14.1464 14.3535C13.7961 14.0032 13.278 13.92 12.8486 14.1347C12.4366 14.3407 12 14.8852 12 16C12 17.1148 12.4366 17.6593 12.8486 17.8653C13.278 18.08 13.7961 17.9967 14.1464 17.6464C14.3417 17.4512 14.6583 17.4512 14.8536 17.6464C15.0488 17.8417 15.0488 18.1583 14.8536 18.3535C14.2039 19.0032 13.222 19.17 12.4014 18.7597C11.5634 18.3407 11 17.3852 11 16C11 14.6149 11.5634 13.6593 12.4014 13.2403ZM20.3536 13.6465C19.7039 12.9968 18.722 12.83 17.9014 13.2403C17.0634 13.6593 16.5 14.6149 16.5 16C16.5 17.3852 17.0634 18.3407 17.9014 18.7597C18.722 19.17 19.7039 19.0033 20.3536 18.3536C20.5488 18.1583 20.5488 17.8417 20.3536 17.6465C20.1583 17.4512 19.8417 17.4512 19.6464 17.6465C19.2961 17.9968 18.778 18.08 18.3486 17.8653C17.9366 17.6593 17.5 17.1148 17.5 16C17.5 14.8852 17.9366 14.3408 18.3486 14.1347C18.778 13.9201 19.2961 14.0033 19.6464 14.3536C19.8417 14.5488 20.1583 14.5488 20.3535 14.3536C20.5488 14.1583 20.5488 13.8417 20.3536 13.6465ZM8 13C8 11.3431 9.34315 10 11 10H21C22.6569 10 24 11.3431 24 13V19C24 20.6569 22.6569 22 21 22H11C9.34315 22 8 20.6569 8 19V13ZM11 11C9.89543 11 9 11.8954 9 13V19C9 20.1046 9.89543 21 11 21H21C22.1046 21 23 20.1046 23 19V13C23 11.8954 22.1046 11 21 11H11Z" fill="white"/>',ye=`${me}<path id="volume-low-icon" class="invisible" fill="#FFFFFF" fill-opacity="1.000" d="M17.9971 9.00613C17.9971 8.13311 16.9568 7.67928 16.3168 8.27313L12.4447 11.8665C12.3522 11.9523 12.2307 12 12.1046 12H9.49707C8.66864 12 7.99707 12.6716 7.99707 13.5V18.5C7.99707 19.3284 8.66864 20 9.49707 20H12.1046C12.2307 20 12.3522 20.0477 12.4447 20.1335L16.3168 23.7269C16.9568 24.3207 17.9971 23.8669 17.9971 22.9939V9.00613ZM13.1249 12.5995L16.9971 9.00613V22.9939L13.1249 19.4005C12.8475 19.1431 12.483 19 12.1046 19H9.49707C9.22093 19 8.99707 18.7761 8.99707 18.5V13.5C8.99707 13.2239 9.22093 13 9.49707 13H12.1046C12.483 13 12.8475 12.8569 13.1249 12.5995Z"/><path id="volume-medium-icon" class="invisible" fill="#FFFFFF" fill-opacity="1.000" d="M17.9971 9.00613C17.9971 8.13311 16.9568 7.67928 16.3168 8.27313L12.4447 11.8665C12.3522 11.9523 12.2307 12 12.1046 12H9.49707C8.66864 12 7.99707 12.6716 7.99707 13.5V18.5C7.99707 19.3284 8.66864 20 9.49707 20H12.1046C12.2307 20 12.3522 20.0477 12.4447 20.1335L16.3168 23.7269C16.9568 24.3207 17.9971 23.8669 17.9971 22.9939V9.00613ZM13.1249 12.5995L16.9971 9.00613V22.9939L13.1249 19.4005C12.8475 19.1431 12.483 19 12.1046 19H9.49707C9.22093 19 8.99707 18.7761 8.99707 18.5V13.5C8.99707 13.2239 9.22093 13 9.49707 13H12.1046C12.483 13 12.8475 12.8569 13.1249 12.5995ZM20.0814 18.9332C19.8421 18.7954 19.7599 18.4897 19.8977 18.2504C20.6739 16.9028 20.7294 15.1916 19.897 13.7499C19.759 13.5108 19.8409 13.205 20.08 13.0669C20.3192 12.9288 20.625 13.0108 20.7631 13.2499C21.7811 15.0132 21.7112 17.1054 20.7642 18.7495C20.6264 18.9888 20.3207 19.0711 20.0814 18.9332Z"/><path id="volume-high-icon" class="invisible" fill="#FFFFFF" fill-opacity="1.000" d="M17.9971 9.00613C17.9971 8.13311 16.9568 7.67928 16.3168 8.27313L12.4447 11.8665C12.3522 11.9523 12.2307 12 12.1046 12H9.49707C8.66864 12 7.99707 12.6716 7.99707 13.5V18.5C7.99707 19.3284 8.66864 20 9.49707 20H12.1046C12.2307 20 12.3522 20.0477 12.4447 20.1335L16.3168 23.7269C16.9568 24.3207 17.9971 23.8669 17.9971 22.9939V9.00613ZM13.1249 12.5995L16.9971 9.00613V22.9939L13.1249 19.4005C12.8475 19.1431 12.483 19 12.1046 19H9.49707C9.22093 19 8.99707 18.7761 8.99707 18.5V13.5C8.99707 13.2239 9.22093 13 9.49707 13H12.1046C12.483 13 12.8475 12.8569 13.1249 12.5995ZM22.1422 10.7746C22.3478 10.5903 22.6639 10.6076 22.8482 10.8133C25.5644 13.8449 25.5645 18.449 22.8483 21.4806C22.664 21.6863 22.3479 21.7036 22.1422 21.5194C21.9365 21.3351 21.9192 21.019 22.1035 20.8133C24.4794 18.1615 24.4794 14.1324 22.1034 11.4806C21.9192 11.2749 21.9365 10.9588 22.1422 10.7746ZM20.0814 18.9332C19.8421 18.7954 19.7599 18.4897 19.8977 18.2504C20.6739 16.9028 20.7294 15.1916 19.897 13.7499C19.759 13.5108 19.8409 13.205 20.08 13.0669C20.3192 12.9288 20.625 13.0108 20.7631 13.2499C21.7811 15.0132 21.7112 17.1054 20.7642 18.7495C20.6264 18.9888 20.3207 19.0711 20.0814 18.9332Z"/><path id="volume-muted-icon" class="invisible" fill="#FFFFFF" fill-opacity="1.000" d="M17.9971 9.00613C17.9971 8.13311 16.9568 7.67928 16.3168 8.27313L12.4447 11.8665C12.3522 11.9523 12.2307 12 12.1046 12H9.49707C8.66864 12 7.99707 12.6716 7.99707 13.5V18.5C7.99707 19.3284 8.66864 20 9.49707 20H12.1046C12.2307 20 12.3522 20.0477 12.4447 20.1335L16.3168 23.7269C16.9568 24.3207 17.9971 23.8669 17.9971 22.9939V9.00613ZM13.1249 12.5995L16.9971 9.00613V22.9939L13.1249 19.4005C12.8475 19.1431 12.483 19 12.1046 19H9.49707C9.22093 19 8.99707 18.7761 8.99707 18.5V13.5C8.99707 13.2239 9.22093 13 9.49707 13H12.1046C12.483 13 12.8475 12.8569 13.1249 12.5995ZM20.029 14.1665C20.2243 13.9712 20.5409 13.9712 20.7361 14.1665L22.3826 15.8129L24.029 14.1665C24.2243 13.9712 24.5409 13.9712 24.7361 14.1665C24.9314 14.3617 24.9314 14.6783 24.7361 14.8736L23.0897 16.52L24.7361 18.1665C24.9314 18.3617 24.9314 18.6783 24.7361 18.8736C24.5409 19.0688 24.2243 19.0688 24.029 18.8736L22.3826 17.2271L20.7361 18.8736C20.5409 19.0688 20.2243 19.0688 20.029 18.8736C19.8338 18.6783 19.8338 18.3617 20.029 18.1665L21.6755 16.52L20.029 14.8736C19.8338 14.6783 19.8338 14.3617 20.029 14.1665Z"/></svg>`,_e=`${me}<path id="play-icon" class="invisible" fill="#FFFFFF" fill-opacity="1.000" d="M24.1059 15.0879C25.1413 15.6575 25.1413 17.1443 24.1059 17.7139L14.1089 23.2129C13.1092 23.7628 11.8855 23.0402 11.8855 21.9L11.8855 10.9018C11.8855 9.76156 13.1092 9.03893 14.1089 9.58883L24.1059 15.0879ZM23.6236 16.8385C23.9688 16.6487 23.9688 16.1531 23.6236 15.9632L13.6266 10.4641C13.2934 10.2808 12.8855 10.5217 12.8855 10.9018L12.8855 21.9C12.8855 22.28 13.2934 22.5209 13.6266 22.3376L23.6236 16.8385Z"/><path  id="pause-icon" fill="#FFFFFF" fill-opacity="1.000" d="M11.8855 8.77393C10.7809 8.77393 9.8855 9.66936 9.8855 10.7739V22.7739C9.8855 23.8785 10.7809 24.7739 11.8855 24.7739H13.8855C14.9901 24.7739 15.8855 23.8785 15.8855 22.7739V10.7739C15.8855 9.66936 14.9901 8.77393 13.8855 8.77393H11.8855ZM10.8855 10.7739C10.8855 10.2216 11.3332 9.77393 11.8855 9.77393H13.8855C14.4378 9.77393 14.8855 10.2216 14.8855 10.7739V22.7739C14.8855 23.3262 14.4378 23.7739 13.8855 23.7739H11.8855C11.3332 23.7739 10.8855 23.3262 10.8855 22.7739V10.7739ZM19.8855 8.77393C18.7809 8.77393 17.8855 9.66936 17.8855 10.7739V22.7739C17.8855 23.8785 18.7809 24.7739 19.8855 24.7739H21.8855C22.9901 24.7739 23.8855 23.8785 23.8855 22.7739V10.7739C23.8855 9.66936 22.9901 8.77393 21.8855 8.77393H19.8855ZM18.8855 10.7739C18.8855 10.2216 19.3332 9.77393 19.8855 9.77393H21.8855C22.4378 9.77393 22.8855 10.2216 22.8855 10.7739V22.7739C22.8855 23.3262 22.4378 23.7739 21.8855 23.7739H19.8855C19.3332 23.7739 18.8855 23.3262 18.8855 22.7739V10.7739Z"/></svg>`,be=`${me}${ve}</svg>`,Te=`${me}${ve}<rect y="31.885" width="2" height="32" transform="rotate(-90 0 31.885)" fill="white"/></svg>`;function we(e){let t="";switch(e){case"play-pause-icon":t=_e;break;case"volume-icon":t=ye;break;case"captions-icon":t=be;break;case"captions-active-icon":t=Te;break;case"checkmark-icon":t='<svg width="14" height="10" viewBox="0 0 14 10" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M13.3516 1.35156L5 9.71094L0.648438 5.35156L1.35156 4.64844L5 8.28906L12.6484 0.648438L13.3516 1.35156Z" fill="white"/></svg>'}const r=(new DOMParser).parseFromString(t,"image/svg+xml"),i=document.importNode(r.documentElement,!0);return i.classList.add(e),i.setAttribute("aria-hidden","true"),i}let xe={info(e,t){},warn(e,t){},error(e,t){}};const Ce=new Map([["ar","Arabic"],["ar-sa","Arabic"],["bn","Bangla"],["bn-bd","Bangla"],["bn-in","Bangla"],["cs","Czech"],["cs-cz","Czech"],["da","Danish"],["da-dk","Danish"],["de","German"],["de-at","German"],["de-ch","German"],["de-de","German"],["el","Greek"],["el-gr","Greek"],["en","English"],["en-au","English"],["en-ca","English"],["en-gb","English"],["en-ie","English"],["en-in","English"],["en-nz","English"],["en-us","English"],["en-za","English"],["es","Spanish"],["es-ar","Spanish"],["es-cl","Spanish"],["es-co","Spanish"],["es-es","Spanish"],["es-mx","Spanish"],["es-us","Spanish"],["fi","Finnish"],["fi-fi","Finnish"],["fr","French"],["fr-be","French"],["fr-ca","French"],["fr-ch","French"],["fr-fr","French"],["he","Hebrew"],["he-il","Hebrew"],["hi","Hindi"],["hi-in","Hindi"],["hu","Hungarian"],["hu-hu","Hungarian"],["id","Indonesian"],["id-id","Indonesian"],["it","Italian"],["it-ch","Italian"],["it-it","Italian"],["ja","Japanese"],["jp","Japanese"],["jp-jp","Japanese"],["ko","Korean"],["ko-kr","Korean"],["nl","Dutch"],["nl-be","Dutch"],["nl-nl","Dutch"],["no","Norwegian"],["no-no","Norwegian"],["pl","Polish"],["pl-pl","Polish"],["pt","Portugese"],["pt-br","Portugese"],["pt-pt","Portugese"],["ro","Romanian"],["ro-ro","Romanian"],["ru","Russian"],["ru-ru","Russian"],["sk","Slovak"],["sk-sk","Slovak"],["sv","Swedish"],["sv-se","Swedish"],["ta","Tamil"],["ta-in","Tamil"],["ta-lk","Tamil"],["th","Thai"],["th-yh","Thai"],["tr","Turkish"],["tr-tr","Turkish"],["zh","Chinese"],["zh-cn","Chinese (Simplified)"],["zh-hant","Chinese (Traditional)"],["zh-hk","Chinese (Traditional)"],["zh-tw","Chinese (Traditional)"],["unknown","Unknown"]]);function Se(e){const t=Ce.get(e.toLowerCase());return void 0===t?e:t}class Pe{constructor(){this.cues=[],this.label="",this.language=""}}function Ee(e,t){Object.assign(e.style,t)}function Me(e){return e/1e3}function Re(e,t){const[r,i,n]=Ae(e);return t.localizedTimeStr.replace("{0}",`${r>0?r.toFixed(0):""}`).replace("{1}",`${r>0?(a=r,1===a?t.localizedLabelsStr[0]:t.localizedLabelsStr[1]):""}`).replace("{2}",`${i>0?i.toFixed(0):""}`).replace("{3}",`${i>0?(s=i,1===s?t.localizedLabelsStr[2]:t.localizedLabelsStr[3]):""}`).replace("{4}",(o=n,0===e?"0":o>0?o.toFixed(0):"")).replace("{5}",(r=>e>0&&0===r?"":1===r?t.localizedLabelsStr[4]:t.localizedLabelsStr[5])(n));var o,s,a}function Ae(e){const t=Math.floor(e/3600),r=Math.floor((e-3600*t)/60);return[t,r,Math.floor(e-3600*t-60*r)]}class Ie{constructor(e,t,r){this.captionsButtonVisible=!1,this.captionsButtonEnabled=!1,this.volumeSliderEnabled=!0,this.captionsMinUIDelay=250,this.speedButtonEnabled=!1,this.textTracks=[],this.captionSelection=0,this.captionFocus=0,this.speedSelection=0,this.lastToggleTime=0,this.defaultCaptionsTrackSet=!1,this.defaultSpeedSet=!1,this.videoElement=e,this.mediaControlInfo=t,this.mediaCallbacks=r,this.captionsButtonVisible=void 0!==t.captionsEnabled&&t.captionsEnabled,this.captionsButtonVisible&&this.videoElement.textTracks.length>0&&(this.captionsButtonEnabled=!0),this.captionsRenderer=t.captionsRenderer,this.volumeSliderEnabled=void 0===this.mediaControlInfo.volumeSliderEnabled||this.mediaControlInfo.volumeSliderEnabled,this.speedButtonEnabled=void 0!==t.speedEnabled&&t.speedEnabled;const i=isNaN(t.trimInfo.trimEndMs)?0:t.trimInfo.trimEndMs,n=isNaN(this.videoElement.duration)?0:1e3*this.videoElement.duration-i;this.mediaInfo={trimStartMs:isNaN(t.trimInfo.trimStartMs)?0:t.trimInfo.trimStartMs,trimEndMs:i,max:Me(n),autoplay:this.videoElement.autoplay,playbackSpeed:this.videoElement.playbackRate,screenReaderInfo:t.screenReaderInfo},this.createControls(),this.setVolumeIcon(this.videoElement.volume,this.videoElement.muted),isNaN(this.videoElement.duration)&&(xe.warn(541882010,"PlaybackControls: Video duration not set."),void 0!==this.mediaCallbacks&&this.mediaCallbacks.logVetoCallback("IncorrectProgressAndTiming"))}show(){this.container.style.display="flex"}hide(){this.updatePopOuts(),this.container.style.display="none"}get getCaptionSelection(){return this.captionSelection}setParent(e){try{null===e.shadowRoot?this.root=e.attachShadow({mode:"open"}):this.root=e.shadowRoot,this.root.appendChild(this.container),this.addCssRef(this.root),this.setPlayPauseIcon(!this.videoElement.paused),void 0!==this.captionsRenderer&&this.captionsRenderer.updateContainer(parseInt(this.container.style.zIndex,10)-1)}catch(e){xe.error(526485603,`Exception in setParent: ${e}`)}}get getBounds(){return this.container.getBoundingClientRect()}enableCaptionTrack(e){e<0||void 0===this.captionsMenu||void 0===this.captionsMenu.options||(this.captionSelection=e,this.captionsMenu.options[e].ariaChecked="true",0===e?this.hideCaptionsUnderlineIcon():(this.showCaptionsUnderlineIcon(),void 0!==this.captionsRenderer?this.captionsRenderer.renderCaptionTrack(this.getTextTracks[e-1],this.videoElement,this):this.videoElement.textTracks[e-1].mode="showing"),this.captionsCheckmark.style.top=`${this.captionsMenu.options[e].offsetTop+14}px`)}onProgressSliderInput(){if(this.videoElement.currentTime!==this.progressBar.valueAsNumber){void 0!==this.mediaCallbacks?this.mediaCallbacks.seekMediaCallback(this.progressBar.valueAsNumber):this.videoElement.currentTime=this.progressBar.valueAsNumber,this.progressBar.value=`${this.videoElement.currentTime}`,this.setProgressForScreenReader();const e=Me(this.mediaInfo.trimStartMs);Fe(this.progressBar,(this.progressBar.valueAsNumber-e)/(this.mediaInfo.max-e)*100,(this.videoElement.buffered.end(0)-e)/(this.mediaInfo.max-e)*100)}}onVolumeSliderInput(){this.videoElement.volume=this.volumeSlider.valueAsNumber/100,this.videoElement.volume>0&&this.videoElement.muted&&(this.videoElement.muted=!1),Be(this.volumeSlider,this.volumeSlider.valueAsNumber)}onVolumeClick(){this.videoElement.muted=!this.videoElement.muted;const e=this.videoElement.muted,t=e?0:this.videoElement.volume;this.setVolumeIcon(t,e),this.volumeSliderEnabled&&(this.volumeSlider.value=""+100*t,Be(this.volumeSlider,this.volumeSlider.valueAsNumber))}onPlayPauseClick(){return(0,fe.mG)(this,void 0,void 0,(function*(){this.updatePopOuts(),this.videoElement.paused?void 0!==this.mediaCallbacks?this.mediaCallbacks.playMediaCallback():yield this.videoElement.play():void 0!==this.mediaCallbacks?this.mediaCallbacks.pauseMediaCallback():this.videoElement.pause()}))}onPlaybackSpeedClick(){this.setDefaultPlaybackSpeed(),this.speedMenu.classList.contains("invisible")&&(this.hideCaptionsMenu(3),this.ensureMenuPosition(1)),this.speedMenu.classList.toggle("invisible"),this.speedCheckmark.classList.toggle("invisible")}hidePlaybackSpeedMenu(){this.speedButtonEnabled&&(this.speedMenu.classList.contains("invisible")||(this.speedMenu.classList.add("invisible"),this.speedCheckmark.classList.add("invisible")))}setDefaultPlaybackSpeed(){this.defaultSpeedSet||(this.defaultSpeedSet=!0,this.speedSelection=ge.indexOf(this.mediaInfo.playbackSpeed),-1===this.speedSelection?xe.warn(509670626,"PlaybackControls.createPlaybackSpeedControl: default video speed not in list of playback speed options"):this.setPlaybackSpeed(this.speedSelection))}setPlaybackSpeed(e){this.speedMenu.options[this.speedSelection].ariaChecked="false",this.speedSelection=e,this.mediaInfo.playbackSpeed=ge[e],this.videoElement.playbackRate=this.mediaInfo.playbackSpeed,this.speedButton.innerText=this.mediaInfo.playbackSpeed.toString()+"x",this.speedMenu.options[this.speedSelection].ariaChecked="true",this.speedCheckmark.style.top=`${this.speedMenu.options[e].offsetTop+14}px`,this.speedMenu.classList.add("invisible"),this.speedCheckmark.classList.add("invisible")}addCssRef(e){const t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("type","text/css"),t.setAttribute("href",this.mediaControlInfo.cssUrl),e.appendChild(t)}createControls(){this.createContainer(),this.createTopControls(this.container),this.createBottomControls(this.container),this.speedButtonEnabled&&this.createPlaybackSpeedMenu(this.container),this.videoElement.addEventListener("timeupdate",(()=>this.onTimeUpdate())),this.videoElement.addEventListener("play",(()=>this.onPlay())),this.setTabOrder()}createContainer(){const e=Le("div","control-container");e.id="video-controls-container",this.container=e;const t=this.mediaControlInfo;Ee(e,{left:`${t.position.x}px`,top:`${t.position.y}px`,width:`${t.size.x}px`,minHeight:`${t.size.y}px`,zIndex:`${t.zIndex}`,direction:"ltr",display:"none"}),void 0!==this.mediaControlInfo.cssPositionOverride&&(e.style.position=this.mediaControlInfo.cssPositionOverride),e.addEventListener("mousedown",(()=>{e.classList.add("no-outline")})),e.addEventListener("click",(e=>{e.stopPropagation(),1===e.button&&this.updatePopOuts()})),e.addEventListener("keydown",(t=>{this.updatePopOuts(t),e.classList.remove("no-outline")}))}createTopControls(e){const t=Le("div","controls-top");this.createProgressBar(t),e.appendChild(t)}createBottomControls(e){const t=Le("div","controls-bottom");this.createLeftControls(t),this.createRightControls(t),e.appendChild(t)}createLeftControls(e){const t=Le("div","controls-left");this.createPlayButton(t),this.createVolumeControls(t),this.createTimeControl(t),e.appendChild(t)}createRightControls(e){const t=Le("div","controls-right");this.createCaptionsControls(t),this.speedButtonEnabled&&this.createPlaybackSpeedControl(t),e.appendChild(t)}setTabOrder(){this.progressBar.tabIndex=1,this.playButton.tabIndex=2,this.volumeButton.tabIndex=3;let e=this.volumeButton.tabIndex+1;if(this.volumeSliderEnabled&&(this.volumeSlider.tabIndex=e,e+=1),this.captionsButtonVisible&&(this.captionsButton.tabIndex=e,e+=1),this.captionsButtonEnabled)for(const t of this.captionsMenu.options)t.tabIndex=e,e+=1;if(this.speedButtonEnabled){this.speedButton.tabIndex=e,e+=1;for(const t of this.speedMenu.options)t.tabIndex=e,e+=1}}updatePopOuts(e){(void 0===e||"Tab"!==e.key&&"Shift"!==e.key)&&(this.handleCaptionsKeyboardEvent(e)||(this.hideCaptionsMenu(3),this.handleSpeedKeyboardEvent(e)||this.hidePlaybackSpeedMenu()))}handleCaptionsKeyboardEvent(e){if(!this.captionsButtonEnabled||void 0===e)return!1;if(this.isCaptionsMenuVisible())switch(e.key){case"ArrowUp":case"PageUp":this.captionFocus>0&&(this.captionFocus-=1,this.captionsMenu.options[this.captionFocus].focus());break;case"ArrowDown":case"PageDown":this.captionFocus>=0&&this.captionFocus<this.captionsMenu.options.length-1&&(this.captionFocus+=1,this.captionsMenu.options[this.captionFocus].focus());break;case"ArrowLeft":case"ArrowRight":break;default:return!1}else{if("c"!==e.key)return!1;"none"===this.container.style.display&&this.show(),this.toggleCaptionsMenu(2),this.showOptionFocus(this.captionsMenu.options[this.captionSelection],0)}return e.stopPropagation(),!0}handleSpeedKeyboardEvent(e){if(!this.speedButtonEnabled||void 0===e)return!1;if(!this.speedMenu.classList.contains("invisible"))switch(e.key){case"ArrowUp":case"PageUp":this.speedSelection>0&&(this.speedSelection-=1,this.speedMenu.options[this.speedSelection].focus());break;case"ArrowDown":case"PageDown":this.speedSelection>=0&&this.speedSelection<this.speedMenu.options.length-1&&(this.speedSelection+=1,this.speedMenu.options[this.speedSelection].focus());break;case"ArrowLeft":case"ArrowRight":break;default:return!1}return e.stopPropagation(),!0}getProgressStep(){const e=this.mediaInfo.max-Me(this.mediaInfo.trimStartMs);return Math.max(e/100,.1)}createProgressBar(e){const t=document.createElement("input");this.progressBar=t,t.type="range",t.classList.add("progress-slider"),t.min=`${Me(this.mediaInfo.trimStartMs)}`,t.max=`${this.mediaInfo.max}`,t.value=t.min,t.step=`${this.getProgressStep()}`,t.addEventListener("input",(()=>this.onProgressSliderInput())),void 0!==this.mediaInfo.screenReaderInfo&&t.setAttribute("aria-label",this.mediaInfo.screenReaderInfo.progressBarStr),t.addEventListener("focus",(()=>this.setProgressForScreenReader())),t.addEventListener("click",(()=>this.updatePopOuts())),!0===this.mediaControlInfo.stopPropagateMouseDownOnSlider&&t.addEventListener("mousedown",(e=>{e.stopPropagation()})),t.addEventListener("keydown",(e=>{this.updatePopOuts(e),"ArrowDown"!==e.key&&"ArrowLeft"!==e.key&&"ArrowUp"!==e.key&&"ArrowRight"!==e.key&&"PageDown"!==e.key&&"PageUp"!==e.key||e.stopPropagation()})),e.appendChild(t)}createPlayButton(e){const t=Le("button","playpause");this.playButton=t,t.type="button";const r=we("play-pause-icon");t.appendChild(r),void 0!==this.mediaInfo.screenReaderInfo&&t.setAttribute("aria-label",this.videoElement.paused?this.mediaInfo.screenReaderInfo.playButtonStr:this.mediaInfo.screenReaderInfo.pauseButtonStr);const i=()=>{this.setPlayPauseIcon(!this.videoElement.paused)};this.videoElement.addEventListener("play",i),this.videoElement.addEventListener("pause",i),this.videoElement.addEventListener("keydown",(e=>{this.handleCaptionsKeyboardEvent(e)})),t.addEventListener("click",(()=>this.onPlayPauseClick())),t.addEventListener("keydown",(e=>{if(this.updatePopOuts(e),void 0!==e.key)switch(e.key){case"Enter":case" ":e.preventDefault(),e.stopPropagation(),this.onPlayPauseClick().catch((e=>xe.warn(526952129,`PlayerControls.onPlayPauseClick: unable to play/pause video - ${e}`)))}})),e.appendChild(t)}setPlayPauseIcon(e){const t=this.playButton.querySelector("#play-icon"),r=this.playButton.querySelector("#pause-icon");null!==t&&null!==r?e?(r.classList.remove("invisible"),t.classList.add("invisible"),void 0!==this.mediaInfo.screenReaderInfo&&this.playButton.setAttribute("aria-label",this.mediaInfo.screenReaderInfo.pauseButtonStr)):(t.classList.remove("invisible"),r.classList.add("invisible"),void 0!==this.mediaInfo.screenReaderInfo&&this.playButton.setAttribute("aria-label",this.mediaInfo.screenReaderInfo.playButtonStr)):(xe.warn(541882011,"PlayerControls.setPlayPauseIcon: querySelector returned null."),void 0!==this.mediaCallbacks&&this.mediaCallbacks.logVetoCallback("IncorrectPlayPauseIcon"))}createVolumeControls(e){const t=Le("div","volume-container");this.createVolumeButton(t),this.volumeSliderEnabled&&(this.createVolumeSlider(t),t.addEventListener("focusin",(()=>{this.volumeSlider.classList.add("visible")})),t.addEventListener("mouseleave",(()=>{this.volumeSlider.classList.remove("visible")}))),t.addEventListener("click",(()=>this.updatePopOuts())),t.addEventListener("keydown",(e=>this.updatePopOuts(e))),e.appendChild(t)}createVolumeButton(e){const t=Le("button","volume");this.volumeButton=t,t.type="button";const r=we("volume-icon");t.appendChild(r),this.videoElement.addEventListener("volumechange",(()=>{const e=this.videoElement.muted?0:this.videoElement.volume;this.setVolumeIcon(e,this.videoElement.muted||0===this.videoElement.volume),this.volumeSliderEnabled&&(this.volumeSlider.value=""+100*e,Be(this.volumeSlider,this.volumeSlider.valueAsNumber))})),void 0!==this.mediaInfo.screenReaderInfo&&(t.setAttribute("aria-label",this.videoElement.muted?this.mediaInfo.screenReaderInfo.unmuteButtonStr:this.mediaInfo.screenReaderInfo.muteButtonStr),t.addEventListener("keydown",(e=>{if(this.updatePopOuts(e),void 0!==e.key)switch(e.key){case"Enter":case" ":e.preventDefault(),e.stopPropagation(),this.onVolumeClick()}}))),t.addEventListener("click",(()=>{this.updatePopOuts(),this.onVolumeClick()})),t.addEventListener("keydown",(e=>this.updatePopOuts(e))),this.volumeSliderEnabled&&t.addEventListener("mouseenter",(()=>{this.volumeSlider.classList.add("visible")})),e.appendChild(t)}createVolumeSlider(e){const t=Le("input","volume-slider");this.volumeSlider=t,t.type="range",t.min="0",t.max="100",t.value=this.videoElement.muted?"0":""+100*this.videoElement.volume,void 0!==this.mediaInfo.screenReaderInfo&&t.setAttribute("aria-label",this.mediaInfo.screenReaderInfo.volumeSliderStr),Be(t,t.valueAsNumber),t.addEventListener("input",(()=>this.onVolumeSliderInput())),!0===this.mediaControlInfo.stopPropagateMouseDownOnSlider&&t.addEventListener("mousedown",(e=>{e.stopPropagation()})),t.addEventListener("click",(()=>this.updatePopOuts())),t.addEventListener("keydown",(e=>{this.updatePopOuts(e),"ArrowDown"!==e.key&&"ArrowLeft"!==e.key&&"ArrowUp"!==e.key&&"ArrowRight"!==e.key&&"PageDown"!==e.key&&"PageUp"!==e.key||e.stopPropagation()})),t.addEventListener("focusout",(()=>{this.volumeSlider.classList.remove("visible")})),e.appendChild(t)}setVolumeIcon(e,t){const r=this.volumeButton.querySelector("#volume-low-icon"),i=this.volumeButton.querySelector("#volume-medium-icon"),n=this.volumeButton.querySelector("#volume-high-icon"),o=this.volumeButton.querySelector("#volume-muted-icon");if(null===r||null===i||null===n||null===o)return xe.warn(541882012,"PlayerControls.setVolumeIcon: querySelector returned null, unable to set volume button icon"),void(void 0!==this.mediaCallbacks&&this.mediaCallbacks.logVetoCallback("IncorrectVolumeIndicator"));o.classList.add("invisible"),r.classList.add("invisible"),i.classList.add("invisible"),n.classList.add("invisible"),t?o.classList.remove("invisible"):e<.33?r.classList.remove("invisible"):e<.67?i.classList.remove("invisible"):n.classList.remove("invisible"),void 0!==this.mediaInfo.screenReaderInfo&&this.volumeButton.setAttribute("aria-label",t?this.mediaInfo.screenReaderInfo.unmuteButtonStr:this.mediaInfo.screenReaderInfo.muteButtonStr)}get getTextTracks(){return this.textTracks.length<1&&this.videoElement.textTracks.length>0&&(this.textTracks.length=0,this.textTracks=function(e){const t=[];for(let r=0;r<e.length;r+=1){const i=new Pe;i.language=e[r].language,i.label=e[r].label;const n=e[r].cues;if(null!==n){for(let e=0;e<n.length;e+=1){const t=new VTTCue(n[e].startTime,n[e].endTime,n[e].text);i.cues[e]=t}t[r]=i}}return t}(this.videoElement.textTracks)),this.textTracks}setDefaultCaptionTrack(){if(!this.defaultCaptionsTrackSet&&this.captionsButtonEnabled){if(this.defaultCaptionsTrackSet=!0,void 0!==this.captionsRenderer&&""!==this.captionsRenderer.getDefaultLang)for(let e=0;e<this.getTextTracks.length;e+=1)if(this.getTextTracks[e].language.toLowerCase()===this.captionsRenderer.getDefaultLang)return void this.enableCaptionTrack(e);this.enableCaptionTrack(0)}}disableCaptionTrack(e){e<0||(this.captionsMenu.options[e].ariaChecked="false",0!==e&&(void 0!==this.captionsRenderer?this.captionsRenderer.stopCaptionTrack():this.videoElement.textTracks[e-1].mode="disabled"))}updateCaptionTrack(e){xe.info(512550666,`PlaybackControls - Captions: Updating selected caption track new selection: ${e}, previous selection: ${this.captionSelection}`),e!==this.captionSelection&&(this.disableCaptionTrack(this.captionSelection),this.enableCaptionTrack(e))}showCaptionsUnderlineIcon(){this.ensureCaptionsButtonIconPosition(),this.captionsButton.children[1].classList.remove("invisible"),this.captionsButton.children[0].classList.add("invisible")}hideCaptionsUnderlineIcon(){this.captionsButton.children[0].classList.remove("invisible"),this.captionsButton.children[1].classList.add("invisible")}isCaptionsMenuVisible(){return"block"===this.captionsMenu.style.display}showCaptionsMenu(e){this.captionsButtonEnabled&&(this.setDefaultCaptionTrack(),xe.info(512521174,`PlaybackControls - Captions: Showing captions menu, source: ${e.toString()}`),this.hidePlaybackSpeedMenu(),this.ensureMenuPosition(0),this.captionsMenu.style.display="block",this.captionsCheckmark.style.display="block",1===e&&this.showOptionFocus(this.captionsMenu.options[this.captionSelection],0))}hideCaptionsMenu(e){this.captionsButtonEnabled&&(xe.info(512521173,`PlaybackControls - Captions: Hiding captions menu, source: ${e.toString()}`),this.captionsCheckmark.style.display="none",this.captionsMenu.style.display="none")}toggleCaptionsMenu(e){this.captionsButtonEnabled&&(Date.now()-this.lastToggleTime<=this.captionsMinUIDelay||(xe.info(512521172,`PlaybackControls - Captions: Toggling captions menu, source: ${e.toString()}`),this.lastToggleTime=Date.now(),this.isCaptionsMenuVisible()?this.hideCaptionsMenu(e):this.showCaptionsMenu(e)))}showOptionFocus(e,t){switch(e.style.backgroundColor="#000000",e.style.background="solid",e.focus(),t){case 0:this.captionFocus=parseInt(e.id,10);break;case 1:this.speedSelection=parseInt(e.id,10)}}hideOptionFocus(e){e.style.background="none"}createCaptionsControls(e){this.captionsButtonVisible&&void 0===this.captionsButton&&(this.captionsButtonEnabled&&(xe.info(512550661,"PlaybackControls - Captions: Creating captions menu"),this.createCaptionsMenu()),this.createCaptionsButton(),e.appendChild(this.captionsButton),this.captionsButtonEnabled&&this.hideCaptionsMenu(3))}createCaptionsMenu(){const e=Le("datalist","closed-captions-menu");if(this.captionsMenu=e,e.ariaLabel="Closed captions menu",Ee(e,{backgroundColor:"#292827",opacity:".8",position:"absolute",right:"8px",borderRadius:"2px"}),this.container.appendChild(e),this.createMenuCheckmark(0),e.appendChild(this.captionsCheckmark),e.appendChild(this.createOptionElement(0,"Off")),this.captionsButtonEnabled)for(let t=0;t<this.videoElement.textTracks.length;t+=1){const r=this.videoElement.textTracks[t];xe.info(512550665,`PlaybackControls - Captions: Adding track index: ${t}, label: ${r.label}, language: ${r.language}`),void 0!==this.captionsRenderer&&"hidden"!==this.videoElement.textTracks[t].mode&&(this.videoElement.textTracks[t].mode="hidden");const i=Se(r.language);i===r.language&&xe.info(512550664,`PlaybackControls - Captions: Unknown language code: ${r.language}`);const n=`${r.label}${""!==r.label?" ":""}${i}`;e.appendChild(this.createOptionElement(t+1,n))}}createOptionElement(e,t){xe.info(512550663,`PlaybackControls - Captions: Creating option index: ${e}, label: ${t}`);const r=Le("option",t);return r.label=t,r.id=`${e}`,r.ariaLabel=t,r.ariaRoleDescription="menuitemradio",r.ariaChecked="false",this.setOptionStyle(r),r.addEventListener("click",(t=>{0===t.button&&(this.updateCaptionTrack(e),this.hideCaptionsMenu(0),t.stopImmediatePropagation())})),r.addEventListener("keydown",(t=>{"Spacebar"!==t.key&&" "!==t.key&&"Enter"!==t.key||(this.updateCaptionTrack(e),this.hideCaptionsMenu(1),t.stopImmediatePropagation())})),r.addEventListener("mouseenter",(()=>{this.showOptionFocus(r,0)})),r.addEventListener("focusin",(()=>{this.showOptionFocus(r,0)})),r.addEventListener("mouseleave",(()=>{this.hideOptionFocus(r)})),r.addEventListener("focusout",(()=>{this.hideOptionFocus(r)})),r}setOptionStyle(e){Ee(e,{paddingTop:"9px",paddingBottom:"9px",paddingLeft:"32px",paddingRight:"40px",color:"#F3F2F1",fontFamily:"Segoe UI, sans-serif",fontSize:"14px",textAlign:"left",fillOpacity:".8",background:"none"})}createCaptionsButton(){xe.info(512550662,"PlaybackControls - Captions: Creating captions button");const e="Closed captions button",t=Le("button","closed-captions-button");this.captionsButton=t,t.type="button",t.name=e,t.ariaLabel=e,t.ariaHasPopup="menu",t.disabled=!1,t.style.marginLeft="4px",this.addCaptionbuttonIcons(),this.captionsButtonEnabled&&(t.addEventListener("click",(e=>{this.toggleCaptionsMenu(0),e.stopImmediatePropagation()})),t.addEventListener("keydown",(e=>{"Spacebar"!==e.key&&" "!==e.key&&"Enter"!==e.key||(this.toggleCaptionsMenu(1),e.stopImmediatePropagation())})))}addCaptionbuttonIcons(){const e=we("captions-icon");this.captionsButtonEnabled||(e.style.opacity=".40"),this.captionsButton.appendChild(e);const t=we("captions-active-icon");t.classList.add("invisible"),t.style.position="absolute",this.captionsButton.appendChild(t)}ensureCaptionsButtonIconPosition(){if(""!==this.captionsButton.children[1].style.left)return;const e=this.captionsButton.offsetLeft;this.captionsButton.children[1].style.left=e.toString().concat("px")}ensureMenuPosition(e){if(null!==this.progressBar.offsetParent){const t=this.progressBar.offsetParent;if(null!==t)switch(e){case 0:this.captionsMenu.style.bottom=t.offsetHeight-2+"px";break;case 1:this.speedMenu.style.bottom=t.offsetHeight-2+"px"}}}createMenuCheckmark(e){const t=we("checkmark-icon");switch(e){case 0:this.captionsCheckmark=t;break;case 1:this.speedCheckmark=t,this.speedCheckmark.style.display="block"}Ee(t,{position:"absolute",left:"10px",zIndex:"5"})}createTimeControl(e){this.currentTime=document.createElement("span"),this.currentTime.classList.add("text-formatting"),this.currentTime.style.marginLeft="4px",this.currentTime.innerText="0:00";const t=document.createElement("span");t.classList.add("text-formatting"),t.textContent=" / ";const r=document.createElement("span");r.classList.add("text-formatting"),r.id="video-end-time";const i=new Date(1e3*this.mediaInfo.max).toISOString(),n="00"===i.substring(11,13)?i.substring(14,19):i.substring(11,19);r.innerText=n,this.currentTime.style.alignSelf="center",t.style.alignSelf="center",r.style.alignSelf="center",e.appendChild(this.currentTime),e.appendChild(t),e.appendChild(r)}onTimeUpdate(){this.videoElement.currentTime<=this.mediaInfo.max?this.currentTime.innerText=function(e){const[t,r,i]=Ae(e);return t>0?`${t}:${r<10?"0":""}${r}:${r<10?"0":""}${i}`:`${r}:${i<10?"0":""}${i}`}(this.videoElement.currentTime):this.setPlayPauseIcon(!1);const e=Me(this.mediaInfo.trimStartMs);this.progressBar.value=`${this.videoElement.currentTime}`;const t=this.videoElement.buffered.length>0?(this.videoElement.buffered.end(0)-e)/(this.mediaInfo.max-e)*100:0;Fe(this.progressBar,(this.progressBar.valueAsNumber-e)/(this.mediaInfo.max-e)*100,t)}onPlay(){this.setDefaultCaptionTrack()}createPlaybackSpeedControl(e){this.speedButton=Le("button","speed"),this.speedButton.type="button",this.speedButton.classList.add("speed","text-formatting"),this.speedButton.innerText=this.mediaInfo.playbackSpeed.toString()+"x",this.speedButton.ariaLabel="Playback speed button",this.speedButton.addEventListener("click",(()=>this.onPlaybackSpeedClick())),this.speedButton.addEventListener("keydown",(e=>{"Spacebar"!==e.key&&" "!==e.key&&"Enter"!==e.key||(this.onPlaybackSpeedClick(),this.speedMenu.classList.contains("invisible")||this.showOptionFocus(this.speedMenu.options[this.speedSelection],1))})),e.appendChild(this.speedButton)}createPlaybackSpeedMenu(e){this.speedMenu=Le("datalist","speed-menu"),this.speedMenu.classList.add("text-formatting","invisible"),this.speedMenu.style.display="block";for(let e=0;e<ge.length;e+=1){const t=Le("option","speed-menu-option");t.classList.add("text-formatting"),t.label=ge[e].toString()+"x",t.innerText=t.label,t.id=`${e}`,t.ariaLabel=t.label,t.ariaRoleDescription="menuitemradio",t.ariaChecked="false",t.addEventListener("click",(()=>this.setPlaybackSpeed(e))),t.addEventListener("keydown",(t=>{"Spacebar"!==t.key&&" "!==t.key&&"Enter"!==t.key||(this.setPlaybackSpeed(e),t.stopImmediatePropagation())})),t.addEventListener("mouseenter",(()=>{this.showOptionFocus(t,1)})),t.addEventListener("focusin",(()=>{this.showOptionFocus(t,1)})),t.addEventListener("mouseleave",(()=>{this.hideOptionFocus(t)})),t.addEventListener("focusout",(()=>{this.hideOptionFocus(t)})),this.speedMenu.appendChild(t)}e.appendChild(this.speedMenu),this.createMenuCheckmark(1),this.speedCheckmark.classList.add("invisible"),this.speedMenu.appendChild(this.speedCheckmark)}setProgressForScreenReader(){if(void 0!==this.mediaInfo.screenReaderInfo){const e=Re(this.videoElement.currentTime,this.mediaInfo.screenReaderInfo),t=Re(this.videoElement.duration,this.mediaInfo.screenReaderInfo),r=this.mediaInfo.screenReaderInfo.progressStr.replace("{0}",e).replace("{1}",t);this.progressBar.setAttribute("aria-valuetext",r)}}}function Fe(e,t,r){e.style.background=`linear-gradient(to right, #FFFFFF ${t}%, #FFFFFFB2 ${t}% ${r}%, #FFFFFF59 ${r}% 100%`}function Be(e,t){e.style.background=`linear-gradient(to right, #FFFFFF ${t}%, #FFFFFF59 ${t}% 100%`}function Le(e,t){const r=document.createElement(e);return r.classList.add(t),r}function De(e){Ee(e,{zIndex:"6",pointerEvents:"all",position:"absolute",objectFit:"fill",height:"100%",width:"100%"})}class ke{constructor(){this.rateChanges=0,this.volumeChanges=0,this.plays=0,this.seeks=0,this.stalls=0,this.totalBufferingTimeMs=0,this.totalPlayingTimeMs=0}}class Oe{constructor(e,t,r,i,n){this.perfSummary=new ke,this.shouldUseLocalTelemetry=n,this.pageLoadingTime=Date.now(),this.isDesignerElement=r,this.mediaProperties=i,this.player=this.createLocalPlayer(e,t,r),void 0!==this.shouldUseLocalTelemetry&&this.shouldUseLocalTelemetry&&this.createPerfTelemetry()}logSummary(){return(0,fe.mG)(this,void 0,void 0,(function*(){}))}play(){return(0,fe.mG)(this,void 0,void 0,(function*(){try{yield this.player.play()}catch(e){xe.info(541882e3,"Error local video play")}xe.info(520378572,`Local.play: this.player.paused: ${this.player.paused}`)}))}pause(){this.player.pause()}setVisible(){!0===this.isDesignerElement&&(this.player.loop=!0),this.player.style.visibility="visible",this.setFocus()}setHidden(){!0===this.isDesignerElement&&(this.player.loop=!1,this.player.autoplay=!1),this.player.style.pointerEvents="none",this.player.style.visibility="hidden"}stop(){this.player.pause(),this.player.currentTime=0,void 0!==this.shouldUseLocalTelemetry&&this.shouldUseLocalTelemetry&&this.logPerfSummary()}togglePause(){return(0,fe.mG)(this,void 0,void 0,(function*(){if(xe.info(520378573,`Local.togglePause: Before toggle, this.player.paused: ${this.player.paused}`),this.player.paused)try{yield this.play()}catch(e){xe.info(541882001,"Error local video play while toggle pause")}else this.pause();xe.info(520378574,`Local.togglePause: After toggle, this.player.paused: ${this.player.paused}`)}))}getPlayer(){return this.player}getCurrentTime(){}getDuration(){}seekTo(e){}ensureMediaClient(){}setMute(){}setUnMute(){}setVolume(e){}logPerfSummary(){this.updateTotalBufferingTime(),this.updateTotalPlayingTime(),0===this.perfSummary.totalBufferingTimeMs&&0===this.perfSummary.totalPlayingTimeMs&&void 0===this.perfSummary.errorCode||(this.perfSummary.durationMs=Math.round(1e3*this.player.duration),this.perfSummary.width=this.player.videoWidth,this.perfSummary.height=this.player.videoHeight,this.perfSummary.hasControls=this.player.controls,this.perfSummary.isAutoplay=this.player.autoplay,this.perfSummary.isLoop=this.player.loop,this.perfSummary.lastRate=this.player.playbackRate,this.perfSummary.lastVolume=Math.round(100*this.player.volume),this.perfSummary.lastIsMuted=this.player.muted,xe.info(541882002,`EmbeddedPlayback ${JSON.stringify(this.perfSummary)}`),this.perfSummary.totalBufferingTimeMs=0,this.perfSummary.totalPlayingTimeMs=0,this.perfSummary.errorCode=void 0)}createPerfTelemetry(){this.player.addEventListener("loadstart",(()=>{void 0===this.perfSummary.timeToLoadStartMs&&(this.perfSummary.timeToLoadStartMs=Date.now()-this.pageLoadingTime)})),this.player.addEventListener("canplay",(()=>{void 0===this.perfSummary.timeToInteractivityMs&&(this.perfSummary.timeToInteractivityMs=Date.now()-this.pageLoadingTime)})),this.player.addEventListener("play",(()=>{this.lastPlayTime=Date.now(),this.perfSummary.plays+=1})),this.player.addEventListener("playing",(()=>{this.lastPlayingTime=Date.now(),void 0===this.perfSummary.timeToPlayingMs&&void 0!==this.lastPlayTime&&(this.perfSummary.timeToPlayingMs=this.lastPlayingTime-this.lastPlayTime),this.updateTotalBufferingTime()})),this.player.addEventListener("waiting",(()=>{this.lastWaitingTime=Date.now(),this.updateTotalPlayingTime()})),this.player.addEventListener("pause",(()=>{this.updateTotalBufferingTime(),this.updateTotalPlayingTime()})),this.player.addEventListener("seeking",(()=>{this.perfSummary.seeks+=1})),this.player.addEventListener("stalled",(()=>{this.perfSummary.stalls+=1})),this.player.addEventListener("ended",(()=>{this.perfSummary.isPlayedUntilEnd=!0})),this.player.addEventListener("ratechange",(()=>{this.perfSummary.rateChanges+=1})),this.player.addEventListener("volumechange",(()=>{this.perfSummary.volumeChanges+=1})),this.player.addEventListener("error",(()=>{this.updateTotalBufferingTime(),this.updateTotalPlayingTime(),void 0===this.perfSummary.errorCode&&null!==this.player.error&&(this.perfSummary.errorCode=this.player.error.code)})),this.player.addEventListener("abort",(()=>{this.updateTotalBufferingTime(),this.updateTotalPlayingTime(),this.perfSummary.wasAborted=!0}))}updateTotalBufferingTime(){void 0!==this.lastWaitingTime&&(this.perfSummary.totalBufferingTimeMs+=Date.now()-this.lastWaitingTime,this.lastWaitingTime=void 0)}updateTotalPlayingTime(){void 0!==this.lastPlayingTime&&(this.perfSummary.totalPlayingTimeMs+=Date.now()-this.lastPlayingTime,this.lastPlayingTime=void 0)}setFocus(){void 0!==this.player&&this.player.focus()}seekToTrimStartIfNeeded(){void 0!==this.player&&void 0!==this.mediaProperties.trimmedEndTimeSec&&(this.player.currentTime<this.mediaProperties.trimStartSec||this.player.currentTime>=this.mediaProperties.trimmedEndTimeSec)&&(this.player.currentTime=this.mediaProperties.trimStartSec)}onTimeUpdate(){void 0!==this.player&&void 0!==this.mediaProperties.trimmedEndTimeSec&&this.player.currentTime>=this.mediaProperties.trimmedEndTimeSec&&(this.player.pause(),this.player.currentTime=this.mediaProperties.trimmedEndTimeSec)}isTrimValid(){return void 0!==this.mediaProperties.durationSec&&this.mediaProperties.trimStartSec<=this.mediaProperties.durationSec&&this.mediaProperties.trimEndSec<=this.mediaProperties.durationSec&&this.mediaProperties.trimStartSec+this.mediaProperties.trimEndSec<this.mediaProperties.durationSec}setTrim(e){void 0===e||isNaN(e.duration)||(this.mediaProperties.durationSec=e.duration,this.mediaProperties.trimmedEndTimeSec=this.mediaProperties.durationSec-this.mediaProperties.trimEndSec,this.isTrimValid()?(e.addEventListener("timeupdate",(()=>{this.onTimeUpdate()})),e.addEventListener("play",(()=>{this.seekToTrimStartIfNeeded()}))):(this.mediaProperties.trimStartSec=0,this.mediaProperties.trimEndSec=0,this.mediaProperties.trimmedEndTimeSec=this.mediaProperties.durationSec))}createLocalPlayer(e,t,r){const i=document.createElement("video");return i.controls=!0,i.setAttribute("disablePictureInPicture","true"),i.setAttribute("controlsList","nodownload nofullscreen noremoteplayback"),i.src=t,e.appendChild(i),i.autoplay=!0,i.style.visibility=r?"hidden":"visible",De(i),r?(i.loop=!0,i.muted=!0,i.addEventListener("canplay",(()=>{i.style.visibility="visible"}),{once:!0})):this.setFocus(),(this.mediaProperties.trimStartSec>0||this.mediaProperties.trimEndSec>0)&&i.addEventListener("loadedmetadata",(()=>{this.setTrim(i)}),{once:!0}),i}}class Ue{constructor(e,t){this.playButton=t,this.parent=e}setPlayButtonVisible(){this.isPlayButtonBiggerThanParent()||(this.playButton.style.display="block",this.playButton.style.pointerEvents="visible")}setPlayButtonHidden(){this.playButton.style.display="none"}updatePlayButtonVisibility(){this.isPlayButtonBiggerThanParent()?this.setPlayButtonHidden():(this.playButton.style.display="block",this.playButton.style.pointerEvents="visible")}onSelectPlayButton(){if(void 0===this.shapeOverlayElement&&this.findShapeSelectionOverlay(),void 0!==this.shapeOverlayElement){const e=parseFloat(this.parent.style.left)+parseFloat(this.parent.style.width)/2-28.3,t=parseFloat(this.parent.style.top)+parseFloat(this.parent.style.height)/2-28.3;this.playButton.style.top=`${t}px`,this.playButton.style.left=`${e}px`,this.shapeOverlayElement.appendChild(this.playButton)}}onDeSelectPlayButton(){this.playButton.style.top="calc(50% - 28.3px)",this.playButton.style.left="calc(50% - 28.3px)",this.parent.appendChild(this.playButton)}findShapeSelectionOverlay(){null!==this.parent.parentElement&&void 0!==this.parent.parentElement.getElementsByClassName("ShapeSelectionOverlay")[0]?this.shapeOverlayElement=this.parent.parentElement.getElementsByClassName("ShapeSelectionOverlay")[0]:this.shapeOverlayElement=void 0}isPlayButtonBiggerThanParent(){return 56.6>parseFloat(this.parent.style.width)||56.6>parseFloat(this.parent.style.height)}}function Ne(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}class Ve{constructor(e,t,r,i,n,o,s,a){this.createNonNative=a,this.appSettings=s,this.isPlaying=!1,this.isNativeVideo=i,this.isDesignerElement=n,this.parent=e,this.url=t,this.hostName=this.isNativeVideo?"":this.getHostname(t),this.videoToolTip=r,this.videoLibraryCallback=o,this.playButton=this.createPlayButton(),this.isSlideShow=!1,this.playButtonHandler=new Ue(this.parent,this.playButton),function(e,t,r){let i;return i=r?e.UseNewYoutubePlayer:e.UseNewEditorYoutubePlayer,!(void 0===i||!i||"www.youtube.com"!==t||void 0===window.URLSearchParams)}(this.appSettings,this.hostName,this.isSlideShow)&&!document.querySelector('script[src="https://www.youtube.com/iframe_api"]')&&function(){const e=document.createElement("script");e.setAttribute("type","text/javascript"),e.src="https://www.youtube.com/iframe_api",document.head.appendChild(e)}(),xe.info(541882006,"Video Element Count"),this.isDesignerElement&&this.startPlaying()}setPlayButtonHidden(){void 0!==this.playButtonHandler&&this.playButtonHandler.setPlayButtonHidden()}updatePlayButtonVisibility(){this.isPlaying||void 0===this.playButtonHandler||this.playButtonHandler.updatePlayButtonVisibility()}setPlayButtonVisible(){this.isPlaying||void 0===this.playButtonHandler||this.playButtonHandler.setPlayButtonVisible()}startPlaying(){if(this.isNativeVideo&&""===this.url)return this.setPlayButtonHidden(),this.isPlaying=!0,void this.videoLibraryCallback.fetchLocalVideoSrc();void 0===this.client?this.createClient(this.url):this.isPlaying||(this.client.setVisible(),this.client.play(),this.setDefaultStyles()),void 0!==this.client&&(this.isPlaying=!0),xe.info(541882007,"Video Play Count"),this.setPlayButtonHidden()}stopPlaying(){void 0!==this.client&&(this.client.setHidden(),this.isPlaying&&this.client.stop(),this.isPlaying=!1)}hasClient(){return void 0!==this.client}setLocalVideoSrc(e){this.url=e,(this.videoLibraryCallback.isSelected()||this.isDesignerElement)&&this.startPlaying()}onSelectPlayButton(){void 0!==this.playButtonHandler&&this.playButtonHandler.onSelectPlayButton()}onDeSelectPlayButton(){void 0!==this.playButtonHandler&&this.playButtonHandler.onDeSelectPlayButton()}dispose(){null!==this.playButton&&void 0!==this.playButton&&null!==this.playButton.parentNode&&void 0!==this.playButton.parentNode&&this.playButton.parentNode.removeChild(this.playButton)}setDefaultStyles(){if(void 0!==this.client){const e=this.client.getPlayer();void 0!==e&&De(e)}}createClient(e){try{if(this.isNativeVideo)this.client=new Oe(this.parent,e,this.isDesignerElement,void 0!==this.videoLibraryCallback&&void 0!==(t=this.videoLibraryCallback.getMediaProperties())?{trimStartSec:void 0!==t.trimStartSec?t.trimStartSec:0,trimEndSec:void 0!==t.trimEndSec?t.trimEndSec:0,volume:void 0!==t.volume?t.volume:.8,mute:void 0!==t.mute&&t.mute,repeat:void 0!==t.repeat&&t.repeat,rewind:void 0!==t.rewind&&t.rewind,playAcrossSlides:void 0!==t.playAcrossSlides&&t.playAcrossSlides,hideDuringShow:void 0!==t.hideDuringShow&&t.hideDuringShow,startOption:void 0!==t.startOption?t.startOption:"NYI",trimmedEndTimeSec:void 0,durationSec:void 0}:{trimStartSec:0,trimEndSec:0,volume:.8,mute:!1,repeat:!1,rewind:!1,playAcrossSlides:!1,hideDuringShow:!1,startOption:"NYI",trimmedEndTimeSec:void 0,durationSec:void 0},this.appSettings.useNewLocalTelemetry);else{if(void 0===this.createNonNative)throw new Error("Non native video not supported.");this.client=this.createNonNative(this.appSettings,e,this.hostName,this.parent,this.isSlideShow,(()=>this.onClientReady()))}const r=this.client.getPlayer();void 0!==r&&r.setAttribute("title",this.videoToolTip),xe.info(541882009,"Success VideoManager")}catch(e){xe.info(541882008,`Error VideoManager: ${this.hostName}`)}var t}onClientReady(){void 0!==this.client&&this.client.play()}playButtonOnClick(e){void 0!==e&&(e.stopImmediatePropagation(),e.preventDefault()),this.videoLibraryCallback.selectShape(),this.startPlaying()}createPlayButton(){const e=function(){const e=Ne("svg");e.setAttribute("viewBox","-1 -1 2 2"),Ee(e,{height:"56.6px",width:"56.6px",position:"absolute",zIndex:"6",top:"calc(50% - 28.3px)",left:"calc(50% - 28.3px)",cursor:"pointer",pointerEvents:"all"});const t=Ne("circle");t.setAttribute("cx","0"),t.setAttribute("cy","0"),t.setAttribute("r","1"),t.setAttribute("fill","#404040");const r=Ne("path");return r.setAttribute("d","M.5 0 L-.25 -.5 L-.25 .5 Z"),r.setAttribute("fill","none"),r.setAttribute("stroke","white"),r.setAttribute("stroke-width",".05"),r.setAttribute("opacity",".5"),e.appendChild(t),e.appendChild(r),e}();return e.addEventListener("click",(e=>this.playButtonOnClick(e)),!1),this.isDesignerElement&&e.setAttribute("visibility","hidden"),this.parent.appendChild(e),e}getHostname(e){return!0===this.appSettings.IsGFXVideoUrlUtilsEnabled?function(e){if(""===e)return"";const t=new RegExp("^[a-z+.-]+://([^/:?&]*)","i").exec(e);return null!=t&&t.length>1?t[1]:""}(e):void 0!==window.URLSearchParams&&""!==e?new URL(e).hostname:""}}var Ge=r(9354);class ze extends de{constructor(e=ae("image")){super(e)}set width(e){this.set("width",`${e}`)}set height(e){this.set("height",`${e}`)}set x(e){this.set("x",`${e}`)}set y(e){this.set("y",`${e}`)}set preserveAspectRatio(e){this.set("preserveAspectRatio",e)}set href(e){this.set("href",e)}}class We extends de{constructor(e=ae("g")){super(e)}set width(e){this.set("width",`${e}`)}set height(e){this.set("height",`${e}`)}set x(e){this.set("x",`${e}`)}set y(e){this.set("y",`${e}`)}}class He extends de{constructor(e=ae("foreignObject")){super(e)}set width(e){this.set("width",`${e}`)}set height(e){this.set("height",`${e}`)}set x(e){this.set("x",`${e}`)}set y(e){this.set("y",`${e}`)}appendChildElement(e){this.element.appendChild(e)}}function je(e,t){if(void 0===t||!(0,Ge.bd)(t))return;const{sourceAnchorBounds:r,targetBounds:i}=t,n=e.size.width/r.width(),o=e.size.height/r.height(),s=i.width()*n,a=i.height()*o,l=i.left*n,h=i.top*o,c=new ze;return c.width=s,c.height=a,c.transform.setTranslate(l,h),c.href=t.data,c.preserveAspectRatio="none",c.style.pointerEvents="none",c.element}var qe=r(2485);class Xe{constructor(e,t,r,i,n){this.viewModel=new qe.AX,this.viewModelUpdated=new p.p,this.shapeViewModel=new se,this.isVideoSelected=!1,this.properties={},this.select=()=>{void 0!==this.editContext&&this.editContext.actionInvoker.invoke(new f.rZ([this.graphic]))},this.fetchSource=()=>{void 0===this.provider&&(0,g._)(0,"Failed to obtain video provider"),this.provider.getSource(this.graphic).then((e=>{this.videoElement.setLocalVideoSrc(e),this.extractHtmlVideo()})).catch((e=>{(0,g._)(0,"Failed to fetch video source")}))},this.onTransformUpdated=()=>{this.stopPlaying(),this.renderVideoToViewModel()},this.onModelUpdated=()=>{this.updateViewModel()},this.stopPlaying=()=>{var e;this.videoElement.stopPlaying(),this.videoElement.updatePlayButtonVisibility(),null===(e=this.controls)||void 0===e||e.hide()},this.onVideoPlaying=()=>{var e;this.fixHtmlVideo(),this.ensureControl(),null===(e=this.controls)||void 0===e||e.show()},this.graphic=e,this.context=t,this.registry=r,this.editContext=i,this.provider=n,this.model=e.model,this.updateViewModel(),this.model.modelUpdated.on(this.onModelUpdated),this.context.anchorPresenter.transformUpdated.on(this.onTransformUpdated),this.context.viewScale.viewTransformChanged.on(this.onTransformUpdated),this.context.viewScale.combinedScaleChanged.on(this.onTransformUpdated)}set isSelected(e){this.isVideoSelected=e,e||(this.stopPlaying(),this.viewModelUpdated.emit())}play(){this.videoElement.startPlaying()}teardown(){this.model.modelUpdated.off(this.onModelUpdated),this.context.anchorPresenter.transformUpdated.off(this.onTransformUpdated),this.context.viewScale.viewTransformChanged.off(this.onTransformUpdated),this.context.viewScale.combinedScaleChanged.off(this.onTransformUpdated),this.teardownControls(),void 0!==this.video&&this.videoElement.dispose()}get videoElement(){return this.video[1]}updateViewModel(){var e,t;void 0!==this.video&&this.videoElement.dispose(),this.properties=null!==(t=null===(e=this.provider)||void 0===e?void 0:e.getProperties(this.graphic))&&void 0!==t?t:{};const r=document.createElement("div"),{source:i,looping:n,altText:o}=this.graphic.model,s=new Ve(r,i.url,o,i.isNative,n,{isSelected:()=>this.isVideoSelected,selectShape:this.select,fetchLocalVideoSrc:this.fetchSource,getMediaProperties:()=>this.properties},{},void 0);this.teardownControls(),this.video=[r,s],this.renderVideoToViewModel()}renderVideoToViewModel(){var e;let t=this.context.anchorPresenter.transform;const r=this.context.viewScale;r.viewTransform.size.equals(new m.N(0,0))||(t=r.viewTransform.clone(),t.size.width*=r.zoomFactor,t.size.height*=r.zoomFactor),this.transform=t;const{left:i,right:n,top:o,bottom:s}=null!==(e=this.properties.crop)&&void 0!==e?e:{left:0,right:0,top:0,bottom:0},a=new u(100*i,100*n,100*o,100*s),{scale:h,offset:c}=function(e,t){if(void 0===t)return{scale:new l.S(1,1),offset:new l.S(0,0)};const{width:r,height:i}=function(e,t){return void 0===t?e:t.getParentTransform(e)}(e,t).size;return{scale:new l.S(r/e.size.width,i/e.size.height),offset:new l.S(t.left*r/100,t.top*i/100)}}(t,a),[d,p]=function(e,t,r,i,n){const o=new We,{x:s,y:a}=e.getCenter();o.transform.setTranslate(s,a);const{size:l,flip:h,rot:c}=e,{width:u,height:d}=l,p=new He;return p.width=u*r.x,p.height=d*r.y,p.transform.set({x:-u/2-i.x,y:-d/2-i.y},h,c,{x:0,y:0}),p.element.appendChild(t),o.element.appendChild(p.element),[o.element,je(e,n)]}(t,this.video[0],h,c,this.model.fallbackRenderData),f=this.graphic.model.geometry;if(void 0!==f)try{this.shapeViewModel.setGeometry(P(this.registry.getGeometry(f),t),t);const e=function(e,t,r,i,n){const o=(0,R.u)("mask");return o.id=`gc2-crop-${performance.now()}${Math.random()}`,e.forEach((([e,t])=>{if(0===t)return;const r=e.cloneNode();r.setAttribute("fill","white"),o.append(r)})),o}(this.shapeViewModel.paths,0,new l.S(0,0),new l.S(1,1));d.setAttribute("mask",`url(#${e.id})`),d.appendChild(e)}catch(e){(0,pe.H)(0,0,`Failed to create video crop mask, ${e.message}`)}(0,v.o)(this.viewModel.video),void 0!==p?this.viewModel.video.append(p,d):this.viewModel.video.append(d),this.viewModelUpdated.emit()}extractHtmlVideo(){const e=this.videoElement.client;this.htmlVideo=e.getPlayer(),this.htmlVideo.addEventListener("play",this.onVideoPlaying),this.fixHtmlVideo()}ensureControl(){var e;if(void 0!==this.controls||void 0===this.htmlVideo)return;const{trimStartSec:t,trimEndSec:r}=this.properties,{size:i,rot:n}=this.transform,{width:o,height:s}=i;this.viewModel.control.style.width="0px",this.viewModel.control.style.height="0px",this.viewModel.control.style.transform=`translate(${o/2}px,${s/2}px)rotate(${n}deg)`;const a={position:{x:-o/2,y:s/2-50},size:{x:o,y:50},trimInfo:{trimStartMs:1e3*t,trimEndMs:1e3*r},zIndex:1e3,cssUrl:null!==(e=this.properties.controlCssUrl)&&void 0!==e?e:"",cssPositionOverride:"relative",stopPropagateMouseDownOnSlider:!0};this.controls=new Ie(this.htmlVideo,a),this.controls.setParent(this.viewModel.control)}teardownControls(){var e,t;null===(e=this.htmlVideo)||void 0===e||e.removeEventListener("play",this.onVideoPlaying),(0,v.o)(this.viewModel.control),null===(t=this.controls)||void 0===t||t.hide(),this.controls=void 0}fixHtmlVideo(){void 0!==this.htmlVideo&&(this.htmlVideo.style.pointerEvents="none",this.htmlVideo.controls=!1)}}const Ke=new o([]);function Ye(e){return t=Ke,r=function(e){var t;if(2===e.getGraphicType())return null===(t=e.getVideoData())||void 0===t?void 0:t.getVideoProvider()}(e),(e,i,n)=>new Xe(e,i,t,n,r);var t,r}},5163:(e,t,r)=>{r.d(t,{Jh:()=>a,XA:()=>l,ZT:()=>n,ev:()=>h,mG:()=>s,pi:()=>o});var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},i(e,t)};function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var o=function(){return o=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},o.apply(this,arguments)};function s(e,t,r,i){return new(r||(r=Promise))((function(n,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}l((i=i.apply(e,t||[])).next())}))}function a(e,t){var r,i,n,o,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(n=2&o[0]?i.return:o[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,o[1])).done)return n;switch(i=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((n=(n=s.trys).length>0&&n[n.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){s.label=o[1];break}if(6===o[0]&&s.label<n[1]){s.label=n[1],n=o;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(o);break}n[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],i=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function l(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],i=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function h(e,t,r){if(r||2===arguments.length)for(var i,n=0,o=t.length;n<o;n++)!i&&n in t||(i||(i=Array.prototype.slice.call(t,0,n)),i[n]=t[n]);return e.concat(i||Array.prototype.slice.call(t))}Object.create,Object.create},2489:(e,t,r)=>{r.d(t,{H:()=>s,KE:()=>a,MP:()=>o,PN:()=>l,WD:()=>n,_v:()=>h});let i={logOperation(e){},logTrace(e){}};function n(e){i=e}function o(e,t,r){i.logOperation({name:e,durationMs:t,props:r})}function s(e,t,r){i.logTrace({level:0,id:e,category:t,message:r})}function a(e,t,r){i.logTrace({level:1,id:e,category:t,message:r})}function l(e,t,r){i.logTrace({level:2,id:e,category:t,message:r})}function h(e,t,r){i.logTrace({level:3,id:e,category:t,message:r})}},9495:(e,t,r)=>{r.d(t,{Wn:()=>i,rZ:()=>n});const i="selGrphAct";class n{constructor(e,t=!1){this.actionType=i,this.graphics=[],this.isFirstTimeSelect=!1,this.graphics=e,this.clearExisting=t}}},9946:(e,t,r)=>{r.d(t,{p:()=>i});class i{constructor(){this.listeners=[]}on(e){this.listeners.push(e)}off(e){const t=this.listeners.indexOf(e);-1!==t&&this.listeners.splice(t,1)}use(e){return this.on(e),()=>{this.off(e)}}emit(...e){this.listeners.forEach((t=>{t(...e)}))}}},7660:(e,t,r)=>{r.d(t,{n:()=>o});var i=r(1703),n=r(9946);function o(){const e=()=>new n.p;return{pointerdown:new i.o(e),pointermove:new i.o(e),pointerup:new i.o(e),pointercancel:new i.o(e),pointerover:new i.o(e),pointerout:new i.o(e)}}},9764:(e,t,r)=>{r.d(t,{Iu:()=>n,V2:()=>i,bA:()=>o});class i{constructor(e=1,t=0,r=0,i=1,n=0,o=0){this.m11=e,this.m12=t,this.m21=r,this.m22=i,this.m31=n,this.m32=o}apply(e){const t=this.m11*e.m11+this.m12*e.m21,r=this.m11*e.m12+this.m12*e.m22,i=this.m21*e.m11+this.m22*e.m21,n=this.m21*e.m12+this.m22*e.m22,o=this.m31*e.m11+this.m32*e.m21+e.m31,s=this.m31*e.m12+this.m32*e.m22+e.m32;return this.m11=t,this.m12=r,this.m21=i,this.m22=n,this.m31=o,this.m32=s,this}translate(e,t){return this.apply(n(e,t))}scale(e,t){return this.apply(o(e,t))}rotate(e){return this.apply(function(e){const t=Math.cos(e),r=Math.sin(e);return new i(t,r,-r,t,0,0)}(e))}}function n(e,t){return new i(1,0,0,1,e,t)}function o(e,t){return new i(e,0,0,t,0,0)}},6487:(e,t,r)=>{r.d(t,{LW:()=>o,Yr:()=>n});var i=r(1459);function n(e){return e*i.PI/180}function o(e){const t=e%360;return t<0?t+360:t}},1459:(e,t,r)=>{r.d(t,{AF:()=>p,KK:()=>u,PI:()=>i,W0:()=>d,_E:()=>s,_b:()=>l,av:()=>o,eh:()=>a,oP:()=>h,ql:()=>c,uo:()=>n});const i=Math.PI,n=2*Math.PI,o=n/3,s=3*Math.PI,a=1.5*Math.PI,l=Math.PI/2,h=Math.PI/3,c=Math.PI/4,u=Math.PI/6,d=Math.PI/12,p=12700},5069:(e,t,r)=>{r.d(t,{S:()=>n});var i=r(6487);class n{constructor(e,t){this.x=e,this.y=t}normalize(){const e=Math.sqrt(this.x*this.x+this.y*this.y);this.x=this.x/e,this.y=this.y/e}multiply(e){const t=this.x*e.m11+this.y*e.m21+e.m31,r=this.x*e.m12+this.y*e.m22+e.m32;this.x=t,this.y=r}add(e){return this.x+=e.x,this.y+=e.y,this}rotate(e,t=new n(0,0)){const r=(0,i.Yr)(e),o=Math.cos(r),s=Math.sin(r),a=this.x-t.x,l=this.y-t.y;this.x=a*o-l*s+t.x,this.y=a*s+l*o+t.y}transform(e){const t=new n(this.x,this.y);return t.multiply(e),t}}},3955:(e,t,r)=>{r.d(t,{U:()=>n});var i=r(5069);class n{constructor(e,t,r,i){this.left=e,this.top=t,this.right=r,this.bottom=i}width(){return this.right-this.left}height(){return this.bottom-this.top}isEmpty(){return 0===this.width()||0===this.height()}center(){return new i.S((this.left+this.right)/2,(this.top+this.bottom)/2)}clone(){return new n(this.left,this.top,this.right,this.bottom)}equals(e){return this.left===e.left&&this.top===e.top&&this.right===e.right&&this.bottom===e.bottom}scale(e,t){this.left*=e,this.top*=t,this.right*=e,this.bottom*=t}}},9354:(e,t,r)=>{r.d(t,{l9:()=>n,qp:()=>i,Ev:()=>s,bd:()=>o});class i{}class n extends class{constructor(e,t,r){this.data=e,this.sourceAnchorBounds=t,this.targetBounds=r}}{constructor(e,t,r){super(e,t,r),this.type=i}}function o(e){return e.type===i}function s(e){if(!o(e))throw new Error(`Invalid renderData type: ${e.type}`)}},4136:(e,t,r)=>{function i(e){return Math.round(e)}r.d(t,{kl:()=>s,KL:()=>a,DT:()=>u,yY:()=>c,T3:()=>h,Pc:()=>l});var n=r(2518),o=r(3738);class s{constructor(e,t,r,i,n=[]){this.type=0,this.r=e,this.g=t,this.b=r,this.a=i,this.transforms=n}clone(){return new s(this.r,this.g,this.b,this.a,(0,o.x)(this.transforms))}equals(e){return a(e)&&this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a&&function(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r+=1)if(!(0,n.w)(e[r],t[r]))return!1;return!0}(this.transforms,e.transforms)}}function a(e){return 0===e.type}function l(e){return new s(i(e.r),i(e.g),i(e.b),e.a)}function h(e){return`rgba(${e.r}, ${e.g}, ${e.b}, ${e.a})`}function c(e){if(e.startsWith("rgb(")){const[t,r,i]=e.slice(4).split(",").map(parseFloat);return new s(t,r,i,1)}if(e.startsWith("rgba(")){const[t,r,i,n]=e.slice(5).split(",").map(parseFloat);return new s(t,r,i,n)}if(e.startsWith("#")){const t=parseInt(e.slice(1),16);if(7===e.length)return new s(t>>16&255,t>>8&255,255&t,1);if(9===e.length)return new s(t>>24&255,t>>16&255,t>>8&255,(255&t)/255)}throw new Error(`Unsupported CSS color: ${e}`)}function u(e){return 3===e.type}new s(0,0,0,1)},3738:(e,t,r)=>{function i(e){return e.map((e=>e))}r.d(t,{x:()=>i})},5848:(e,t,r)=>{r.d(t,{d:()=>i});class i{constructor(e=!1,t=!1){this.x=e,this.y=t}clone(){return new i(this.x,this.y)}equals(e){return this.x===e.x&&this.y===e.y}}},5942:(e,t,r)=>{r.d(t,{i:()=>i});class i{constructor(e=0,t=0){this.x=e,this.y=t}clone(){return new i(this.x,this.y)}equals(e){return this.x===e.x&&this.y===e.y}multiply(e){const t=this.x*e.m11+this.y*e.m21+e.m31,r=this.x*e.m12+this.y*e.m22+e.m32;return this.x=t,this.y=r,this}add(e){return this.x+=e.x,this.y+=e.y,this}subtract(e){return this.x-=e.x,this.y-=e.y,this}scale(e,t){return this.x*=e,this.y*=t,this}set(e){return this.x=e.x,this.y=e.y,this}}},4193:(e,t,r)=>{r.d(t,{N:()=>i});class i{constructor(e=0,t=0){this.width=e,this.height=t}clone(){return new i(this.width,this.height)}equals(e){return this.width===e.width&&this.height===e.height}subtract(e){return this.width-=e.width,this.height-=e.height,this}scale(e,t){return this.width*=e,this.height*=t,this}}},9807:(e,t,r)=>{r.d(t,{A:()=>a});var i=r(5069),n=r(5848),o=r(5942),s=r(4193);class a{constructor(e=new o.i,t=new s.N,r=new n.d,i=0){this.pos=e,this.size=t,this.flip=r,this.rot=i}clone(){return new a(this.pos.clone(),this.size.clone(),this.flip.clone(),this.rot)}equals(e){return this.pos.equals(e.pos)&&this.size.equals(e.size)&&this.flip.equals(e.flip)&&this.rot===e.rot}getCenter(){return new i.S(this.pos.x+this.size.width/2,this.pos.y+this.size.height/2)}}},1703:(e,t,r)=>{r.d(t,{o:()=>i});class i{constructor(e){this.initializer=e}get value(){return void 0===this.instance&&(this.instance=this.initializer()),this.instance}get valid(){return void 0!==this.instance}}},2661:(e,t,r)=>{r.d(t,{B:()=>i,o:()=>n});class i{constructor(e){this.registry=new Map(e)}register(e,t){return this.registry.set(e,t),this}get(e){return this.registry.get(e)}}class n extends i{constructor(e){super(e),this.values=new Set(e.map((e=>e[1])))}register(e,t){return super.register(e,t),this.values.add(t),this}[Symbol.iterator](){return this.values[Symbol.iterator]()}}},2518:(e,t,r)=>{function i(e,t){return e.equals(t)}function n(e,t){return void 0===e&&void 0===t||void 0!==e&&void 0!==t&&e.equals(t)}r.d(t,{C:()=>n,w:()=>i})},7721:(e,t,r)=>{function i(e){for(;null!==e.firstChild;)e.removeChild(e.firstChild)}r.d(t,{o:()=>i})},5965:(e,t,r)=>{r.d(t,{m:()=>n});var i=r(3955);function n(e){return new i.U(e.pos.x,e.pos.y,e.pos.x+e.size.width,e.pos.y+e.size.height)}},2718:(e,t,r)=>{function i(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}r.d(t,{u:()=>i})},4814:(e,t,r)=>{r.d(t,{_:()=>n});var i=r(2489);function n(e,t){throw(0,i.H)(0,e,t),new Error(`Error: ${t}, Category: ${e}`)}},4591:(e,t,r)=>{r.d(t,{t:()=>n});var i=r(4814);function n(e){(0,i._)(0,`Unreachable ${e}`)}},6730:(e,t,r)=>{r.d(t,{GJ:()=>n,Hr:()=>i});const i=0,n=6},2485:(e,t,r)=>{r.d(t,{AU:()=>l,AX:()=>a,P:()=>s});var i=r(7660),n=r(6730),o=r(2718);class s{}class a{constructor(){this.type=s,this.pointerEventNotifiers=(0,i.n)(),this.hitTestSlop=n.Hr,this.video=(0,o.u)("svg"),this.control=document.createElement("div"),this.video.style.overflow="visible",this.video.style.pointerEvents="none",this.control.style.position="absolute",this.control.style.top="0",this.control.style.left="0",this.control.style.pointerEvents="auto"}teardown(){}}function l(e,t){t.root.append(e.video),t.root.append(e.control)}}},i={};function n(e){var t=i[e];if(void 0!==t)return t.exports;var o=i[e]={exports:{}};return r[e].call(o.exports,o,o.exports,n),o.exports}n.m=r,n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce(((t,r)=>(n.f[r](e,t),t)),[])),n.u=e=>"Gc2Video.js",n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},t="@gc2/host-ppt:",n.l=(r,i,o,s)=>{if(e[r])e[r].push(i);else{var a,l;if(void 0!==o)for(var h=document.getElementsByTagName("script"),c=0;c<h.length;c++){var u=h[c];if(u.getAttribute("src")==r||u.getAttribute("data-webpack")==t+o){a=u;break}}a||(l=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,n.nc&&a.setAttribute("nonce",n.nc),a.setAttribute("data-webpack",t+o),a.src=r),e[r]=[i];var d=(t,i)=>{a.onerror=a.onload=null,clearTimeout(p);var n=e[r];if(delete e[r],a.parentNode&&a.parentNode.removeChild(a),n&&n.forEach((e=>e(i))),t)return t(i)},p=setTimeout(d.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=d.bind(null,a.onerror),a.onload=d.bind(null,a.onload),l&&document.head.appendChild(a)}},n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");r.length&&(e=r[r.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e})(),(()=>{var e={649:0};n.f.j=(t,r)=>{var i=n.o(e,t)?e[t]:void 0;if(0!==i)if(i)r.push(i[2]);else{var o=new Promise(((r,n)=>i=e[t]=[r,n]));r.push(i[2]=o);var s=n.p+n.u(t),a=new Error;n.l(s,(r=>{if(n.o(e,t)&&(0!==(i=e[t])&&(e[t]=void 0),i)){var o=r&&("load"===r.type?"missing":r.type),s=r&&r.target&&r.target.src;a.message="Loading chunk "+t+" failed.\n("+o+": "+s+")",a.name="ChunkLoadError",a.type=o,a.request=s,i[1](a)}}),"chunk-"+t,t)}};var t=(t,r)=>{var i,o,[s,a,l]=r,h=0;if(s.some((t=>0!==e[t]))){for(i in a)n.o(a,i)&&(n.m[i]=a[i]);l&&l(n)}for(t&&t(r);h<s.length;h++)o=s[h],n.o(e,o)&&e[o]&&e[o][0](),e[o]=0},r=self.webpackChunk_gc2_host_ppt=self.webpackChunk_gc2_host_ppt||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var o={};(()=>{n.r(o),n.d(o,{pptGraphicFactoryGlobal:()=>Yl});class e{constructor(e){this.health=e}logKpiUsage(e,t,r,i){this.health.recordKpiUsage(e,t,i,r)}logKpiFailure(e,t,r,i,n){this.health.recordKpiFailure(e,t,r,i,n)}logKpiSuccess(e,t){this.health.recordKpiSuccess(e,t)}}class t{constructor(e){this.health=e}logVeto(e,t,r){r.extendedProperties.set("internalVetoName",t),this.health.recordQosError(e,["GraphicsExperienceDegraded"],!1,!1,!1,!1,r)}}var r=n(7660),i=n(6730),s=n(3955),a=n(9807),l=n(4814);const h=function(e){if(void 0!==window.FinalizationRegistry)return new window.FinalizationRegistry((e=>{const t=`Failed to teardown TeardownTracker ${e}`;(0,l._)(0,t)}))}();class c{constructor(e){this._tornDown=!1,this.inFinalizationRegistry=!1,this.handlers=[],this.name=e}get tornDown(){return this._tornDown}onTeardown(e){this.handlers.push(e)}teardown(){this._tornDown;for(let e=this.handlers.length-1;e>=0;e-=1)this.handlers[e]();this.inFinalizationRegistry&&void 0!==h&&(h.unregister(this),this.inFinalizationRegistry=!1),this._tornDown=!0}}var u=n(2489);class d{constructor(e){this.props=new Map,this.name=e,this.id=d.opCount,d.opCount+=1,performance.mark(this.getStartMarker())}setProp(e,t){this.props.set(e,t.toString())}complete(){performance.mark(this.getEndMarker()),performance.measure(this.name,this.getStartMarker(),this.getEndMarker());const e=performance.getEntriesByName(this.name,"measure");e.length>0&&(0,u.MP)(this.name,e[e.length-1].duration,this.props.size>0?this.props:void 0),performance.clearMarks(this.getStartMarker()),performance.clearMarks(this.getEndMarker()),performance.clearMeasures(this.name)}getStartMarker(){return`${this.name}.${this.id}.Start`}getEndMarker(){return`${this.name}.${this.id}.End`}}d.opCount=0;var p=n(5163),f=.001,g=function(){function e(e,t){this.x=e,this.y=t}return e.Flip=function(t,r){return new e(t?-1:1,r?-1:1)},e.prototype.negate=function(){return new e(-this.x,-this.y)},e.prototype.inverse=function(){return new e(1/this.x,1/this.y)},e.prototype.normalized=function(){var e=this.length();return e?this.scale(1/e):void 0},e.prototype.abs=function(){return new e(Math.abs(this.x),Math.abs(this.y))},e.prototype.floor=function(){return new e(Math.floor(this.x),Math.floor(this.y))},e.prototype.ceil=function(){return new e(Math.ceil(this.x),Math.ceil(this.y))},e.prototype.sign=function(){return new e(this.x<0?-1:1,this.y<0?-1:1)},e.prototype.isZero=function(){return 0==this.x&&0==this.y},e.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},e.Distance=function(e,t){return e.subtract(t).length()},e.prototype.equals=function(e){return this.x==e.x&&this.y==e.y},e.prototype.equalsWithEpsilon=function(e,t){return void 0===t&&(t=f),Math.abs(this.x-e.x)<t&&Math.abs(this.y-e.y)<t},e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y)},e.prototype.subtract=function(t){return new e(this.x-t.x,this.y-t.y)},e.prototype.multiply=function(t){return new e(this.x*t.x,this.y*t.y)},e.prototype.divide=function(t){return new e(this.x/t.x,this.y/t.y)},e.prototype.dot=function(e){return this.x*e.x+this.y*e.y},e.prototype.scale=function(t){return new e(this.x*t,this.y*t)},e.prototype.rotate=function(t){return t?new e(this.x*Math.cos(t)-this.y*Math.sin(t),this.x*Math.sin(t)+this.y*Math.cos(t)):this},e.prototype.transformVector=function(e){return e.transformVector(this)},e.prototype.transformPoint=function(e){return e.transformPoint(this)},e.InterpolateLinear=function(e,t,r){return e.add(t.subtract(e).scale(r))},e.InterpolateQuadratic=function(t,r,i,n){return e.InterpolateLinear(e.InterpolateLinear(t,r,n),e.InterpolateLinear(r,i,n),n)},e.QuadraticTangent=function(t,r,i,n){return e.InterpolateLinear(r,i,n).subtract(e.InterpolateLinear(t,r,n)).normalized()},e.CalculateLineIntersection=function(t,r,i,n,o){void 0===o&&(o=f);var s=(n.x-i.x)*(t.y-i.y)-(n.y-i.y)*(t.x-i.x),a=(n.y-i.y)*(r.x-t.x)-(n.x-i.x)*(r.y-t.y);if(Math.abs(a)>o)return e.InterpolateLinear(t,r,s/a)},e.MeasureQuadraticLength=function(e,t,r){return S(e.x,e.y,t.x,t.y,r.x,r.y)},e.Zero=new e(0,0),e.One=new e(1,1),e}(),m=function(e,t,r){this.x=e,this.y=t,this.z=r},v=function(){function e(e,t,r,i,n,o,s,a,l){this.m=new Float32Array([e,t,r,i,n,o,s,a,l])}return e.prototype.toMatrix3=function(){return this},e.prototype.isIdentity=function(){return this==e.Identity||this.equals(e.Identity)},e.prototype.multiply=function(t){var r=this.m,i=t.m;return new e(r[0]*i[0]+r[1]*i[3]+r[2]*i[6],r[0]*i[1]+r[1]*i[4]+r[2]*i[7],r[0]*i[2]+r[1]*i[5]+r[2]*i[8],r[3]*i[0]+r[4]*i[3]+r[5]*i[6],r[3]*i[1]+r[4]*i[4]+r[5]*i[7],r[3]*i[2]+r[4]*i[5]+r[5]*i[8],r[6]*i[0]+r[7]*i[3]+r[8]*i[6],r[6]*i[1]+r[7]*i[4]+r[8]*i[7],r[6]*i[2]+r[7]*i[5]+r[8]*i[8])},e.prototype.inverse=function(){var t=this.m,r=t[0]*t[4]-t[1]*t[3];return 0==r?void 0:new e(t[4]/r,-t[1]/r,0,-t[3]/r,t[0]/r,0,(t[3]*t[7]-t[4]*t[6])/r,(-t[0]*t[7]+t[1]*t[6])/r,1)},e.prototype.transformVector=function(e){return new g(e.x*this.m[0]+e.y*this.m[3],e.x*this.m[1]+e.y*this.m[4])},e.prototype.transformPoint=function(e){return new g(e.x*this.m[0]+e.y*this.m[3]+this.m[6],e.x*this.m[1]+e.y*this.m[4]+this.m[7])},e.prototype.isSimpleScaleTranslationOnly=function(){return 0==this.m[1]&&0==this.m[2]&&0==this.m[3]&&0==this.m[5]&&1==this.m[8]},e.prototype.getSimpleScale=function(){return new g(this.m[0],this.m[4])},e.prototype.getSimpleTranslation=function(){return new g(this.m[6],this.m[7])},e.prototype.equals=function(e){for(var t=0;t<9;t++)if(this.m[t]!=e.m[t])return!1;return!0},e.prototype.tryGetTransform=function(e){var t=this.transformVector(new g(1,0)),r=this.transformVector(new g(0,1));if(!(Math.abs(t.x*r.x+t.y*r.y)>f)){var i=t.x*r.y-t.y*r.x>0?new g(t.length(),r.length()):new g(t.length(),-r.length()),n=t.y>0?Math.acos(t.x/i.x):-Math.acos(t.x/i.x),o=this.transformPoint(e.negate());return new y(e,i,n,o)}},e.Translation2D=function(t){return new e(1,0,0,0,1,0,t.x,t.y,1)},e.Scale2D=function(t){return new e(t.x,0,0,0,t.y,0,0,0,1)},e.ScaleTranslation2D=function(t,r){return new e(t.x,0,0,0,t.y,0,r.x,r.y,1)},e.RotationZ=function(t){var r=Math.cos(t),i=Math.sin(t);return new e(r,i,0,-i,r,0,0,0,1)},e.RotationAroundPoint=function(e,t){return new y(t.negate(),g.One,e,t).toMatrix3()},e.FromTransforms=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];if(0==t.length)return e.Identity;for(var i=t[0].toMatrix3(),n=1;n<t.length;n++)i=i.multiply(t[n].toMatrix3());return i},e.Identity=new e(1,0,0,0,1,0,0,0,1),e}(),y=function(){function e(e,t,r,i){this.preTranslation=e||g.Zero,this.scale=t||g.One,this.rotation=null!=r?r:0,this.translation=i||g.Zero}return e.prototype.toMatrix3=function(){var e=Math.cos(this.rotation),t=Math.sin(this.rotation),r=this.scale.x*e,i=this.scale.x*t,n=this.scale.y*-t,o=this.scale.y*e;return new v(r,i,0,n,o,0,this.preTranslation.x*r+this.preTranslation.y*n+this.translation.x,this.preTranslation.y*o+this.preTranslation.x*i+this.translation.y,1)},e.prototype.isIdentity=function(){return this==e.Identity||this.equals(e.Identity)},e.prototype.toInverseMatrix3=function(){var e=Math.cos(-this.rotation),t=Math.sin(-this.rotation),r=e/this.scale.x,i=t/this.scale.y,n=-t/this.scale.x,o=e/this.scale.y;return new v(r,i,0,n,o,0,-this.translation.x*r-this.translation.y*n-this.preTranslation.x,-this.translation.y*o-this.translation.x*i-this.preTranslation.y,1)},e.prototype.transformVector=function(e){return e.multiply(this.scale).rotate(this.rotation)},e.prototype.transformPoint=function(e){return e.add(this.preTranslation).multiply(this.scale).rotate(this.rotation).add(this.translation)},e.prototype.applyScaleAndTranslationBefore=function(t,r){return new e(this.preTranslation.add(r).divide(t),this.scale.multiply(t),this.rotation,this.translation)},e.prototype.applyTranslationAfter=function(t){return new e(this.preTranslation,this.scale,this.rotation,this.translation.add(t))},e.prototype.equals=function(e){return this.preTranslation.equals(e.preTranslation)&&this.scale.equals(e.scale)&&this.rotation==e.rotation&&this.translation.equals(e.translation)},e.fromScaleAndTranslation=function(t,r){return new e(void 0,t,void 0,r)},e.fromTransformAndPretranslation=function(t,r){return new e(r,t.scale,t.rotation,t.translation)},e.fromTransformAndScale=function(t,r){return new e(t.preTranslation,r,t.rotation,t.translation)},e.fromTransformAndRotation=function(t,r){return new e(t.preTranslation,t.scale,r,t.translation)},e.fromTransformAndTranslation=function(t,r){return new e(t.preTranslation,t.scale,t.rotation,r)},e.Identity=new e,e}(),_=function(){function e(e,t,r,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=0),void 0===i&&(i=0),this.left=e,this.top=t,this.right=r,this.bottom=i}return e.FromSize=function(t){return new e(0,0,t.x,t.y)},e.FromSizeAndCenter=function(t,r){return new e(r.x-.5*t.x,r.y-.5*t.y,r.x+.5*t.x,r.y+.5*t.y)},e.FromPoints=function(t,r){return new e(Math.min(t.x,r.x),Math.min(t.y,r.y),Math.max(t.x,r.x),Math.max(t.y,r.y))},e.prototype.isEmpty=function(){return this.left==this.right&&this.top==this.bottom},e.prototype.isValid=function(){return this.left<=this.right&&this.top<=this.bottom},Object.defineProperty(e.prototype,"width",{get:function(){return this.right-this.left},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.bottom-this.top},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return new g(this.right-this.left,this.bottom-this.top)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"center",{get:function(){return new g((this.left+this.right)/2,(this.top+this.bottom)/2)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leftTop",{get:function(){return new g(this.left,this.top)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rightBottom",{get:function(){return new g(this.right,this.bottom)},enumerable:!1,configurable:!0}),e.prototype.isPointInRect=function(e){return this.left<=e.x&&e.x<=this.right&&this.top<=e.y&&e.y<=this.bottom},e.prototype.equals=function(e){return this.left==e.left&&this.top==e.top&&this.right==e.right&&this.bottom==e.bottom},e.prototype.inflate=function(t){return new e(this.left-t,this.top-t,this.right+t,this.bottom+t)},e.prototype.inflateToInteger=function(){return new e(Math.floor(this.left),Math.floor(this.top),Math.ceil(this.right),Math.ceil(this.bottom))},e.prototype.multiply=function(t){return e.FromPoints(this.leftTop.multiply(t),this.rightBottom.multiply(t))},e.prototype.divide=function(t){return e.FromPoints(this.leftTop.divide(t),this.rightBottom.divide(t))},e.prototype.translate=function(t){return new e(this.left+t.x,this.top+t.y,this.right+t.x,this.bottom+t.y)},e.prototype.transformedBounds=function(t){for(var r=void 0,i=[new g(this.left,this.top),new g(this.right,this.top),new g(this.right,this.bottom),new g(this.left,this.bottom)],n=0;n<4;n++)r=e.UnionPoint(r,i[n].transformPoint(t));return r},e.UnionPoint=function(t,r){return t&&t.isValid()?new e(Math.min(t.left,r.x),Math.min(t.top,r.y),Math.max(t.right,r.x),Math.max(t.bottom,r.y)):new e(r.x,r.y,r.x,r.y)},e.UnionRect=function(t,r){return t&&r&&t.isValid()&&r.isValid()?new e(Math.min(t.left,r.left),Math.min(t.top,r.top),Math.max(t.right,r.right),Math.max(t.bottom,r.bottom)):t&&t.isValid()?t:r&&r.isValid()?r:void 0},e.IntersectRect=function(t,r){if(t&&r&&t.isValid()&&r.isValid()){var i=new e(Math.max(t.left,r.left),Math.max(t.top,r.top),Math.min(t.right,r.right),Math.min(t.bottom,r.bottom));return i.isValid()?i:void 0}},e.SegmentBounds=function(t,r){return new e(Math.min(t.x,r.x),Math.min(t.y,r.y),Math.max(t.x,r.x),Math.max(t.y,r.y))},e.QuadraticBezierBounds=function(t,r,i){var n;n=e.SegmentBounds(t,i);var o=(t.x-r.x)/(t.x+i.x-2*r.x);0<o&&o<1&&(n=e.UnionPoint(n,g.InterpolateQuadratic(t,r,i,o)));var s=(t.y-r.y)/(t.y+i.y-2*r.y);return 0<s&&s<1&&(n=e.UnionPoint(n,g.InterpolateQuadratic(t,r,i,s))),n},e.InterpolateLinear=function(t,r,i){return new e(C(t.left,r.left,i),C(t.top,r.top,i),C(t.right,r.right,i),C(t.bottom,r.bottom,i))},e.Zero=new e(0,0,0,0),e}(),b=function(){function e(e,t,r,i){this.xMin=e,this.yMin=t,this.xMax=r,this.yMax=i}return e.prototype.equals=function(e){return this.xMin===e.xMin&&this.yMin===e.yMin&&this.xMax===e.xMax&&this.yMax===e.yMax},e.prototype.clip=function(e){var t=new _(void 0===this.xMin?e.left:this.xMin,void 0===this.yMin?e.top:this.yMin,void 0===this.xMax?e.right:this.xMax,void 0===this.yMax?e.bottom:this.yMax);return _.IntersectRect(e,t)},e.CreateFromRect=function(t){return new e(t.left,t.top,t.right,t.bottom)},e}();function T(e){return Math.pow(2,Math.round(Math.log(e)/Math.log(2)))}function w(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.log(2)))}function x(e,t,r){return Math.min(r,Math.max(t,e))}function C(e,t,r){return e+(t-e)*r}function S(e,t,r,i,n,o){var s=n-e,a=o-t;if(Math.abs(s*(i-t)-a*(r-e))<f)return Math.sqrt(s*s+a*a);var l=n-2*r+e,h=o-2*i+t,c=2*r-2*n,u=2*i-2*o,d=4*(l*l+h*h),p=4*(l*c+h*u),g=c*c+u*u,m=2*Math.sqrt(d+p+g),v=Math.sqrt(d),y=2*Math.sqrt(g),_=p/v;return(v*(2*d*m+p*(m-y))+(4*g*d-p*p)*Math.log((2*v+_+m)/(_+y)))/(8*d*v)}function P(e,t,r,i){var n=(t-e)/(2*Math.PI);return n-=Math.floor(n),(i&&n>0||null==i&&n>.5)&&n--,C(e,e+n*(2*Math.PI),r)}function E(e,t){return e==t||null!=e&&null!=t&&e.equals(t)}var M=function(){function e(){}return e.Error=function(t,r){return e.s_logger.sendTraceTag(t,306,10,r),new Error(r+" "+t)},e.Message=function(t,r){e.s_logger.sendTraceTag(t,306,50,r)},e.setLogger=function(t){t&&(e.s_logger=t)},e.s_logger={sendTraceTag:function(e,t,r,i){console.log(e,i)},shipAssertTag:function(){},debugAssertTag:function(){}},e}(),R=1,A=8,I=16,F=0;function B(e,t){R=e,A=t}var L=0,D=!1;var k=function(){function e(e,t){void 0===t&&(t=!1),this.m_changeTracker=new O,this.deferTracking=t,this.m_changeTracker=new O(t?this.getHash:void 0),this.m_elements=[],e&&(this.elements=e)}return e.prototype.getHash=function(){return this.m_elements.map((function(e){return e.changeTracker.currentUniqueId})).join(",")},Object.defineProperty(e.prototype,"changeTracker",{get:function(){return this.m_changeTracker},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this.m_elements.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"elements",{get:function(){return this.m_elements},set:function(e){this.removeAll();for(var t=0,r=e;t<r.length;t++){var i=r[t];this.push(i)}},enumerable:!1,configurable:!0}),e.prototype.getAt=function(e){if(e<0||e>=this.elements.length)throw M.Error(592520775,"Out of range");return this.m_elements[e]},e.prototype.setAt=function(e,t){this.deferTracking||(O.RemoveListener(this.getAt(e).changeTracker,this.m_changeTracker),O.AddListener(t.changeTracker,this.m_changeTracker)),this.m_elements[e]=t},e.prototype.push=function(e){this.deferTracking||O.AddListener(e.changeTracker,this.m_changeTracker),this.m_elements.push(e)},e.prototype.insertAt=function(e,t){this.deferTracking||O.AddListener(t.changeTracker,this.m_changeTracker),this.m_elements.splice(e,0,t)},e.prototype.removeAll=function(){if(!this.deferTracking)for(var e=0,t=this.m_elements;e<t.length;e++){var r=t[e];O.RemoveListener(r.changeTracker,this.m_changeTracker)}this.m_elements=[]},e.prototype.removeAt=function(e){this.deferTracking||O.RemoveListener(this.getAt(e).changeTracker,this.m_changeTracker),this.m_elements.splice(e,1)},e}(),O=function(){function e(t){this.trackerId=e.s_nextUniqueId++,this.m_version=0,this.m_getDeferedHashFunction=t,this.m_currentUniqueId=this.trackerId+"v0",this.m_listeners=[]}return Object.defineProperty(e.prototype,"version",{get:function(){return this.m_getDeferedHashFunction&&this.verifyDeferedHash(),this.m_version},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentUniqueId",{get:function(){return this.m_getDeferedHashFunction&&this.verifyDeferedHash(),this.m_currentUniqueId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"listenerCount",{get:function(){var e,t;return(null===(e=this.m_weakListeners)||void 0===e?void 0:e.length)||(null===(t=this.m_listeners)||void 0===t?void 0:t.length)||0},enumerable:!1,configurable:!0}),e.prototype.verifyDeferedHash=function(){if(this.m_getDeferedHashFunction){var e=this.m_getDeferedHashFunction();e!=this.m_deferedHash&&(this.notifyChange(),this.m_deferedHash=e)}},e.prototype.notifyChange=function(){var e;if(this.m_version++,this.m_currentUniqueId=this.trackerId+"v"+this.m_version,this.m_weakListeners){this.m_weakListeners.length;this.m_weakListeners=this.m_weakListeners.filter((function(e){return null!=e.deref()}));for(var t=0,r=this.m_weakListeners;t<r.length;t++)null===(e=r[t].deref())||void 0===e||e.notifyChange()}else if(this.m_listeners)for(var i=0,n=this.m_listeners;i<n.length;i++)n[i].notifyChange()},e.prototype.replaceListener=function(t,r){t!=r&&(t&&e.RemoveListener(t.changeTracker,this),r&&e.AddListener(r.changeTracker,this))},e.AddListener=function(e,t){if(e)if(e.m_weakListeners){if(void 0===e.m_weakListeners.find((function(e){return e.deref()===t}))){if("undefined"==typeof WeakRef)throw M.Error(525337749,"WeakRef not supported");e.m_weakListeners.push(new WeakRef(t)),t.notifyChange()}}else{if(!e.m_listeners)throw M.Error(525337750,"No dependency array");-1==e.m_listeners.indexOf(t)&&(e.m_listeners.push(t),t.notifyChange())}},e.RemoveListener=function(e,t){if(e)if(e.m_weakListeners)e.m_weakListeners=e.m_weakListeners.filter((function(e){return e.deref()!=t})),t.notifyChange();else if(e.m_listeners){var r=e.m_listeners.indexOf(t);-1!=r&&(e.m_listeners.splice(r,1),t.notifyChange())}},e.s_nextUniqueId=1,e}(),U="undefined"!=typeof FinalizationRegistry?new FinalizationRegistry((function(e){var t=e;for(var r in t)t[r].onFinalization()})):void 0,N=function(){function e(t,r){if(t instanceof e)this.m_sharedPathStorage=t.m_sharedPathStorage,this.m_transform=r||t.transform;else{for(var i=[],n=0,o=t.figures;n<o.length;n++){var s=o[n];i.push(s instanceof W?s.createFigure():s)}this.m_sharedPathStorage={figures:i,fillMode:null==t.fillMode?1:t.fillMode,lineEnabled:null==t.lineEnabled||t.lineEnabled,extrusionEnabled:null==t.extrusionEnabled||t.extrusionEnabled,glyphCacheId:t.glyphCacheId?{fontId:t.glyphCacheId.fontId,glyphId:t.glyphCacheId.glyphId}:void 0,isUntransformedRect:q(i),untransformedBounds:j(i),renderDataMap:{}},this.m_transform=r||(t.transform?t.transform:y.Identity)}null==U||U.register(this,this.renderDataMap)}return e.CreateFromFigure=function(t){return new e({figures:[t]})},e.CreateFromRect=function(t){return new e({figures:[z.CreateFromRect(t)]})},Object.defineProperty(e.prototype,"figures",{get:function(){return this.m_sharedPathStorage.figures},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transform",{get:function(){return this.m_transform},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fillMode",{get:function(){return this.m_sharedPathStorage.fillMode},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lineEnabled",{get:function(){return this.m_sharedPathStorage.lineEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"extrusionEnabled",{get:function(){return this.m_sharedPathStorage.extrusionEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"glyphCacheId",{get:function(){return this.m_sharedPathStorage.glyphCacheId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxPressure",{get:function(){return 4096},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"renderDataMap",{get:function(){return this.m_sharedPathStorage.renderDataMap},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasPressureInfo",{get:function(){return this.figures.some((function(e){return!!(8&e.format)}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isUntransformedRect",{get:function(){return this.m_sharedPathStorage.isUntransformedRect},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"untransformedBounds",{get:function(){return this.m_sharedPathStorage.untransformedBounds},enumerable:!1,configurable:!0}),e.prototype.measureLength=function(e){void 0===e&&(e=y.Identity);for(var t=0,r=0,i=this.figures;r<i.length;r++)t+=i[r].measureLength(e);return t},e.prototype.equals=function(e){return this.m_sharedPathStorage==e.m_sharedPathStorage&&this.m_transform.equals(e.m_transform)},e}(),V=.1;function G(e){var t=(1&e?2:0)+(2&e?1:0)+(4&e?1:0)+(8&e?1:0)+(16&e?2:0);return 32&e&&(t=4*Math.ceil(t/4)),t}var z=function(){function e(e,t,r){if(void 0===t&&(t=!1),void 0===r&&(r=3),this.m_points=e,this.m_isClosed=t,this.m_format=r,this.m_pointDataSize=G(r),this.m_points.length%this.m_pointDataSize!=0)throw M.Error(592520776,"list of points invalid")}return e.CreateFromRect=function(t){return new e([t.left,t.top,1,t.right,t.top,1,t.right,t.bottom,1,t.left,t.bottom,1],!0)},e.CreateFromRoundedRect=function(e,t){var r=Math.min(t,Math.min(e.width,e.height)/2),i=new W;return i.moveTo(e.center.x-e.width/2,e.center.y-(e.height/2-r)),i.arcTo(r,r,-Math.PI,Math.PI/2),i.lineTo(e.right-r,e.top),i.arcTo(r,r,-Math.PI/2,Math.PI/2),i.lineTo(e.right,e.bottom-r),i.arcTo(r,r,0,Math.PI/2),i.lineTo(e.left+r,e.bottom),i.arcTo(r,r,Math.PI/2,Math.PI/2),i.lineTo(e.left,e.top+r),i.close(),i.createFigure()},Object.defineProperty(e.prototype,"points",{get:function(){return this.m_points},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"format",{get:function(){return this.m_format},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pointDataSize",{get:function(){return this.m_pointDataSize},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isClosed",{get:function(){return this.m_isClosed},enumerable:!1,configurable:!0}),e.prototype.isLastPointDuplicated=function(){return this.getPoint(0).equalsWithEpsilon(this.getPoint(-1),V)},e.prototype.getPointCount=function(){return this.m_points.length/this.m_pointDataSize},e.prototype.getPoint=function(e){var t=this.getPointCount(),r=e<0?e%t+t:e%t;return new g(this.m_points[r*this.m_pointDataSize],this.m_points[r*this.m_pointDataSize+1])},e.prototype.getPointType=function(e){if(!(2&this.m_format))return 1;var t=this.getPointCount(),r=e<0?e%t+t:e%t;return this.m_points[r*this.m_pointDataSize+2]},e.prototype.toPolygon=function(){for(var e=this.getPointCount(),t=new W([],this.m_isClosed,1),r=0;r<e;r++){var i=this.getPoint(r);if(2!=this.getPointType(r))t.pushPoint(i.x,i.y);else for(var n=this.getPoint(r-1),o=this.getPoint(r+1),s=1;s<8;s++){var a=g.InterpolateQuadratic(n,i,o,s/8);t.pushPoint(a.x,a.y)}}return t.createFigure()},e.prototype.measureLength=function(e){void 0===e&&(e=y.Identity);var t=0;return this.forEachSegment((function(e,r,i){return t+=r?g.MeasureQuadraticLength(e,r,i):g.Distance(e,i),!0}),e),t},e.prototype.getPointFromDist=function(e,t,r){void 0===t&&(t=y.Identity),void 0===r&&(r=!1);var i=0,n=void 0;return this.forEachSegment((function(t,r,o){var s=r?g.MeasureQuadraticLength(t,r,o):g.Distance(t,o);if(i+s>e){var a=(e-i)/s;n=r?g.InterpolateQuadratic(t,r,o,a):g.InterpolateLinear(t,o,a)}return(i+=s)<=e}),t,r),n||this.getPoint(r?0:this.getPointCount()-1).transformPoint(t)},e.prototype.getTangentFromDist=function(e,t,r){void 0===t&&(t=y.Identity),void 0===r&&(r=!1);var i=0,n=g.Zero;return this.forEachSegment((function(t,r,o){var s=r?g.MeasureQuadraticLength(t,r,o):g.Distance(t,o);return n=r?g.QuadraticTangent(t,r,o,(e-i)/s):o.subtract(t).scale(1/s),(i+=s)<e}),t,r),n},e.prototype.forEachSegment=function(e,t,r){void 0===t&&(t=y.Identity),void 0===r&&(r=!1);for(var i=this.getPointCount(),n=r?0:i-1,o=r?-1:1,s=r?i-1:0;s!=n;s+=o){var a=s+o,l=a+o,h=2==this.getPointType(a);if(2!=this.getPointType(s)&&(this.m_isClosed||a==a%i)&&(!h||this.m_isClosed||l==l%i)&&!e(this.getPoint(s).transformPoint(t),h?this.getPoint(a).transformPoint(t):void 0,this.getPoint(h?l:a).transformPoint(t)))return}},e}(),W=function(){function e(e,t,r){if(void 0===e&&(e=[]),void 0===t&&(t=!1),void 0===r&&(r=3),this._points=e,this.isClosed=t,this.format=r,this.pointDataSize=G(r),this.lastPointX=0,this.lastPointY=0,this._points.length%this.pointDataSize!=0)throw M.Error(592520777,"list of points invalid")}return e.prototype.createFigure=function(){return new z(this._points,this.isClosed,this.format)},e.prototype.pushPoint=function(e,t,r,i){switch(void 0===r&&(r=1),this.lastPointX=e,this.lastPointY=t,this.pointDataSize){case 2:return void this._points.push(e,t);case 3:return void this._points.push(e,t,r);case 4:return void this._points.push(e,t,r,i?i[0]:0);case 5:return void this._points.push(e,t,r,i?i[0]:0,i?i[1]:0);case 6:return void this._points.push(e,t,r,i?i[0]:0,i?i[1]:0,i?i[2]:0);case 7:return void this._points.push(e,t,r,i?i[0]:0,i?i[1]:0,i?i[2]:0,i?i[3]:0)}throw M.Error(592520778,"Unsupported data size")},e.prototype.moveTo=function(e,t,r){if(0!=this._points.length)throw M.Error(592520779,"Figures should have only one MoveTo");this.pushPoint(e,t,1,r)},e.prototype.moveToPoint=function(e,t){this.moveTo(e.x,e.y,t)},e.prototype.lineTo=function(e,t,r){if(this._points.length<this.pointDataSize)throw M.Error(592520780,"All figures should start with a MoveTo");(Math.abs(e-this.lastPointX)>V||Math.abs(t-this.lastPointY)>V)&&this.pushPoint(e,t,1,r)},e.prototype.lineToPoint=function(e,t){this.lineTo(e.x,e.y,t)},e.prototype.quadBezierTo=function(e,t,r,i,n){if(this._points.length<this.pointDataSize)throw M.Error(592520781,"All figures should start with a MoveTo");var o=this.lastPointX,s=this.lastPointY;if(Math.abs(r-o)>V||Math.abs(i-s)>V){var a=Math.sqrt((e-o)*(e-o)+(t-s)*(t-s)),l=Math.sqrt((r-e)*(r-e)+(i-t)*(i-t)),h=Math.abs(e-o)<V&&Math.abs(t-s)<V,c=Math.abs(r-e)<V&&Math.abs(i-t)<V;!h&&!c&&Math.abs(a/l)>V&&Math.abs(l/a)>V?(this.pushPoint(e,t,2),this.pushPoint(r,i,1,n)):this.pushPoint(r,i,1,n)}},e.prototype.quadBezierToPoint=function(e,t,r){this.quadBezierTo(e.x,e.y,t.x,t.y,r)},e.prototype.cubicBezierTo=function(e,t,r,i,n,o){this.cubicBezierToPoint(new g(e,t),new g(r,i),new g(n,o))},e.prototype.cubicBezierToPoint=function(e,t,r){if(this._points.length<this.pointDataSize)throw M.Error(592520782,"All figures should start with a MoveTo");var i=new g(this.lastPointX,this.lastPointY),n=Math.abs(e.x-i.x)<V&&Math.abs(e.y-i.y)<V,o=Math.abs(t.x-e.x)<V&&Math.abs(t.y-e.y)<V,s=Math.abs(r.x-t.x)<V&&Math.abs(r.y-t.y)<V;if(o&&(n||s))n!=s&&this.lineToPoint(r);else for(var a=i,l=i,h=e,c=0;c<4;c++){var u=(c+1)/4,d=g.InterpolateQuadratic(i,e,t,u),p=g.InterpolateQuadratic(e,t,r,u),m=g.InterpolateLinear(d,p,u),v=h.subtract(l).normalized(),y=p.subtract(d).normalized(),_=void 0;if(v&&y&&Math.abs(v.dot(y))<Math.sqrt(2)/2)_=g.CalculateLineIntersection(l,h,d,p,f);else{var b=(c+.5)/4,T=g.InterpolateLinear(g.InterpolateQuadratic(i,e,t,b),g.InterpolateQuadratic(e,t,r,b),b),w=a.add(m).scale(.5);_=w.add(T.subtract(w).scale(2))}_?this.quadBezierTo(_.x,_.y,m.x,m.y):this.lineTo(m.x,m.y),a=m,l=d,h=p}},e.prototype.arcTo=function(e,t,r,i){if(this._points.length<this.pointDataSize)throw M.Error(592520783,"All figures should start with a MoveTo");var n=2*Math.PI,o=e<f||t<f,s=o?r:Math.atan2(e*Math.sin(r),t*Math.cos(r)),a=i<0?-1:1,l=Math.abs(i);if(l>=n)l=n;else{var h=r+l*a;(l=((h=o?h:Math.atan2(e*Math.sin(h),t*Math.cos(h)))-s)*a)<0&&(l+=n)}for(var c=this.lastPointX,u=this.lastPointY,d=c-Math.cos(s)*e,p=u-Math.sin(s)*t,m=Math.ceil(8*Math.abs(l)/n),v=0;v<m;v++){var y=a*n/8,_=s+v*y,b=v==m-1?a*l-v*y:y,T=_+b,w=_+b/2,x=1/Math.cos(b/2),C=new g(d+Math.cos(w)*x*e,p+Math.sin(w)*x*t),S=new g(d+Math.cos(T)*e,p+Math.sin(T)*t);Math.abs(b)>f?this.quadBezierTo(C.x,C.y,S.x,S.y):this.lineTo(S.x,S.y)}},e.prototype.close=function(){if(this._points.length<this.pointDataSize)throw M.Error(592520784,"All figures should start with a MoveTo");this.isClosed=!0},e.prototype.isLastPointDuplicated=function(){return this.getPoint(0).equalsWithEpsilon(this.getPoint(-1),V)},e.prototype.getPointCount=function(){return this._points.length/this.pointDataSize},e.prototype.getPoint=function(e){var t=this.getPointCount(),r=e<0?e%t+t:e%t;return new g(this._points[r*this.pointDataSize],this._points[r*this.pointDataSize+1])},Object.defineProperty(e.prototype,"data",{get:function(){return this._points},enumerable:!1,configurable:!0}),e}();function H(e){for(var t="["+e.replace(/(M|L|Q|C|A|E|;)/g,(function(e){return"M"==e?"0":"L"==e?"1":"Q"==e?"2":"C"==e?"3":"A"==e?"4":"E"==e?"5":","}))+"]",r=new Float32Array(JSON.parse(t)),i=[],n=void 0,o=0,s=2*Math.PI/216e5;o<r.length;)switch(r[o++]){case 0:if(o+1>=r.length)throw M.Error(592520785,"Invalid LineTo");n&&i.push(n),(n=new W).moveTo(r[o++],r[o++]);break;case 1:if(!n||o+1>=r.length)throw M.Error(592520786,"Invalid LineTo");n.lineTo(r[o++],r[o++]);break;case 2:if(!n||o+3>=r.length)throw M.Error(592520787,"Invalid MoveTo");n.quadBezierTo(r[o++],r[o++],r[o++],r[o++]);break;case 3:if(!n||o+5>=r.length)throw M.Error(592520788,"Invalid CubicBezierTo");n.cubicBezierTo(r[o++],r[o++],r[o++],r[o++],r[o++],r[o++]);break;case 4:if(!n||o+3>=r.length)throw M.Error(592520789,"Invalid Arc of ellipse");n.arcTo(r[o++],r[o++],r[o++]*s,r[o++]*s);break;case 5:if(!n)throw M.Error(592520790,"All paths should start with a MoveTo");n.close(),i.push(n),n=void 0}return n&&i.push(n),i}function j(e){for(var t=void 0,r=0,i=e;r<i.length;r++){var n=i[r];if(!n.cachedBounds){var o=n.points.length/n.pointDataSize;if(o<1)return;for(var s=n.points[0],a=s,l=n.points[1],h=l,c=0;c<o;c++){var u=c*n.pointDataSize,d=(c-1+o)%o*n.pointDataSize,p=(c+1)%o*n.pointDataSize,f=void 0,g=void 0,m=void 0;2&n.format?(f=n.points[u+2],g=n.points[d+2],m=n.points[p+2]):f=g=m=1;var v=n.points[u],y=n.points[u+1];if(1==f&&1==m)s=v<s?v:s,a=v>a?v:a,l=y<l?y:l,h=y>h?y:h;else if(1==g&&2==f&&1==m){var b=n.points[d],T=n.points[d+1],w=n.points[p],x=n.points[p+1];s=w<(s=b<s?b:s)?w:s,a=w>(a=b>a?b:a)?w:a,l=x<(l=T<l?T:l)?x:l,h=x>(h=T>h?T:h)?x:h;var C=(b-v)/(b+w-2*v);0<C&&C<1&&(s=(E=b*((P=(S=C)*S)-2*S+1)+w*P+2*v*(S-P))<s?E:s,a=E>a?E:a,l=(M=T*(P-2*S+1)+x*P+2*y*(S-P))<l?M:l,h=M>h?M:h);var S,P,E,M,R=(T-y)/(T+x-2*y);0<R&&R<1&&(s=(E=b*((P=(S=R)*S)-2*S+1)+w*P+2*v*(S-P))<s?E:s,a=E>a?E:a,l=(M=T*(P-2*S+1)+x*P+2*y*(S-P))<l?M:l,h=M>h?M:h)}}n.cachedBounds=new _(s,l,a,h)}t=_.UnionRect(t,n.cachedBounds)}return t}function q(e){if(1!=e.length)return!1;var t=e[0];if((4!=t.getPointCount()||!t.isClosed||t.isLastPointDuplicated())&&(5!=t.getPointCount()||!t.isClosed||!t.isLastPointDuplicated()))return!1;for(var r=[t.getPoint(0),t.getPoint(1),t.getPoint(2),t.getPoint(3)],i=new _(Math.min(r[0].x,r[1].x,r[2].x,r[3].x),Math.min(r[0].y,r[1].y,r[2].y,r[3].y),Math.max(r[0].x,r[1].x,r[2].x,r[3].x),Math.max(r[0].y,r[1].y,r[2].y,r[3].y)),n=0;n<4;n++){var o=r[n],s=r[(n+1)%4];if(o.x!=i.left&&o.x!=i.right||o.y!=i.top&&o.y!=i.bottom||o.x!=s.x&&o.y!=s.y)return!1}return!0}function X(e,t){var r,i=new g(t*K(e.width,e.end),t*Y(e.length,e.end));if(1==e.end||5==e.end)r=new z([-.5*i.x,-1*i.y,1,0,0,1,.5*i.x,-1*i.y,1],1==e.end);else if(2==e.end)r=new z([-.5*i.x,-1*i.y,1,0,0,1,.5*i.x,-1*i.y,1,0,-.5*i.y,1],!0);else if(3==e.end)r=new z([0,.5*i.y,1,.5*i.x,0,1,0,-.5*i.y,1,-.5*i.x,0,1],!0);else if(4==e.end){var n=new W;n.moveTo(.5*i.x,0),n.arcTo(.5*i.x,.5*i.y,0,2*Math.PI),n.close(),r=n.createFigure()}return r||M.Error(572867280,"bad arrow head"),r}function K(e,t){return 0==e?5==t?2.5:2:1==e?5==t?3.5:3:2==e?5:(M.Error(572867281,"bad arrow head"),0)}function Y(e,t){return 0==e?2:1==e?3:2==e?5==t?4.5:5:(M.Error(572867282,"bad arrow head"),0)}function $(e,t,r,i,n){var o=(3==r.end||4==r.end?.5:1)*Y(r.length,r.end)*i,s=(t?e.getPoint(e.getPointCount()-1):e.getPoint(0)).transformPoint(n),a=e.getPointFromDist(o,n,t),l=s.subtract(a).normalized();if(l){var h=new g(-l.y,l.x);return new v(h.x,h.y,0,l.x,l.y,0,0,0,1).multiply(v.Translation2D(s))}}function Z(e,t){return e?0==e.end||4==e.end||3==e.end?0:5==e.end||2==e.end?t*Y(e.length,e.end)/K(e.width,e.end):2*t:0}function J(e,t,r,i,n){if(0==r&&e.cachedBoundsContributor)return{points:e.cachedBoundsContributor.points,curves:e.cachedBoundsContributor.curves,transform:t};for(var o=0!=r,s={points:new Array,curves:new Array,transform:o?void 0:t},a=e.getPointCount(),l=0;l<a;l++){var h=e.getPoint(l-1),c=e.getPoint(l),u=e.getPoint(l+1);if(o&&(h=t.transformPoint(h),c=t.transformPoint(c),u=t.transformPoint(u)),2==e.getPointType(l))r?(s.curves.push([h.add(new g(-r,0)),c.add(new g(-r,0)),u.add(new g(-r,0))]),s.curves.push([h.add(new g(r,0)),c.add(new g(r,0)),u.add(new g(r,0))]),s.curves.push([h.add(new g(0,-r)),c.add(new g(0,-r)),u.add(new g(0,-r))]),s.curves.push([h.add(new g(0,r)),c.add(new g(0,r)),u.add(new g(0,r))])):s.curves.push([h,c,u]);else if(s.points.push(c),r)if(2==i)r?(s.points.push(c.add(new g(-r,0))),s.points.push(c.add(new g(r,0))),s.points.push(c.add(new g(0,-r))),s.points.push(c.add(new g(0,r)))):s.points.push(c);else{var d=c.subtract(h).normalized(),p=u.subtract(c).normalized();if(d&&p){d=d.scale(r),p=p.scale(r);var f=new g(-d.y,d.x),m=new g(-p.y,p.x);d.dot(m)<0&&(f=f.negate(),m=m.negate());var v=c.add(f),y=c.add(m);if(s.points.push(v),s.points.push(y),1==i||3==i){var _=g.CalculateLineIntersection(v,v.add(d),y,y.subtract(p));_&&(g.Distance(_,c)<n*r?s.points.push(_):1==i&&(s.points.push(v.add(d.scale(n))),s.points.push(y.subtract(p.scale(n)))))}}}}return 0!=r||e.cachedBoundsContributor||(e.cachedBoundsContributor={points:s.points,curves:s.curves,transform:void 0}),s}function Q(e,t){var r=!0,i=0,n=0,o=0,s=0,a=e.transform&&t?e.transform.multiply(t):t||e.transform,l=!a||a.isSimpleScaleTranslationOnly(),h=l?void 0:a,c=e.points,u=e.curves,d=c&&c.length>0?c[0]:u&&u.length>0?u[0][0]:void 0;if(d){var p=0,f=0,g=0,m=0,v=0,y=0;if(h&&(p=h.m[0],f=h.m[1],g=h.m[3],m=h.m[4],v=h.m[6],y=h.m[7]),r&&(n=i=h?d.x*p+d.y*g+v:d.x,s=o=h?d.x*f+d.y*m+y:d.y,r=!1),c&&c.length>0)for(var b=1;b<c.length;b++){var T=c[b];i=(k=h?T.x*p+T.y*g+v:T.x)<i?k:i,n=k>n?k:n,o=(O=h?T.x*f+T.y*m+y:T.y)<o?O:o,s=O>s?O:s}for(var w=0,x=u||[];w<x.length;w++){var C=x[w],S=C[0],P=C[1],E=C[2],M=h?S.x*p+S.y*g+v:S.x,R=h?S.x*f+S.y*m+y:S.y,A=h?P.x*p+P.y*g+v:P.x,I=h?P.x*f+P.y*m+y:P.y,F=h?E.x*p+E.y*g+v:E.x,B=h?E.x*f+E.y*m+y:E.y;i=F<(i=M<i?M:i)?F:i,n=F>(n=M>n?M:n)?F:n,o=B<(o=R<o?R:o)?B:o,s=B>(s=R>s?R:s)?B:s;var L=(M-A)/(M+F-2*A);0<L&&L<1&&(i=(k=M*((D=L*L)-2*L+1)+F*D+2*A*(L-D))<i?k:i,n=k>n?k:n,o=(O=R*(D-2*L+1)+B*D+2*I*(L-D))<o?O:o,s=O>s?O:s);var D,k,O,U=(R-I)/(R+B-2*I);if(0<U&&U<1)i=(k=M*((D=U*U)-2*U+1)+F*D+2*A*(U-D))<i?k:i,n=k>n?k:n,o=(O=R*(D-2*U+1)+B*D+2*I*(U-D))<o?O:o,s=O>s?O:s}var N=new _(i,o,n,s);return l&&(N=a?N.multiply(a.getSimpleScale()).translate(a.getSimpleTranslation()):N),N}}function ee(e){for(var t=void 0,r=0,i=e;r<i.length;r++){var n=i[r];if(0!=n.transform.rotation)return;var o=n.untransformedBounds;o&&(t=_.UnionRect(t,o.transformedBounds(n.transform)))}return t}function te(e,t,r){t!=r&&e.notifyChange()}function re(e,t,r){t==r||t&&r&&t.equals(r)||e.notifyChange()}function ie(e,t,r){if(t!=r)if(t&&r&&t.length==r.length){for(var i=0;i<t.length;i++)if(!t[i].equals(r[i]))return void e.notifyChange()}else e.notifyChange()}!function(){function e(e,t){this.m_changeTracker=new O,this.bounds=e,this.format=t,this.pointDataSize=G(t),this.m_figures=[new W([],!1,t)]}Object.defineProperty(e.prototype,"currentFigure",{get:function(){return this.m_figures[this.m_figures.length-1]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"figures",{get:function(){return this.m_figures},enumerable:!1,configurable:!0}),e.prototype.newFigure=function(){this.currentFigure.getPointCount()>0&&this.m_figures.push(new W([],!1,this.format))},Object.defineProperty(e.prototype,"changeTracker",{get:function(){return this.m_changeTracker},enumerable:!1,configurable:!0})}();var ne=function(){function e(e,t,r,i){void 0===i&&(i=1),this.r=e,this.g=t,this.b=r,this.a=i}return e.prototype.equals=function(e){return this.r==e.r&&this.g==e.g&&this.b==e.b&&this.a==e.a},e.prototype.modulateOpacity=function(t){return new e(this.r,this.g,this.b,this.a*t)},e.Gray=function(t){return new e(t,t,t,1)},e.FromRGBA=function(t){return new e(t.r,t.g,t.b,t.a)},e.InterpolateLinear=function(t,r,i){return new e(x(C(t.r,r.r,i),0,1),x(C(t.g,r.g,i),0,1),x(C(t.b,r.b,i),0,1),x(C(t.a,r.a,i),0,1))},e.Transparent=new e(0,0,0,0),e.Black=new e(0,0,0,1),e.White=new e(1,1,1,1),e.Red=new e(1,0,0,1),e.Orange=new e(1,.5,0,1),e.Yellow=new e(1,1,0,1),e.Green=new e(0,1,0,1),e.Cyan=new e(0,1,1,1),e.Blue=new e(0,0,1,1),e.Magenta=new e(1,0,1,1),e}(),oe=function(){function e(){this.renderDataMap={},this.m_changeTracker=new O}return Object.defineProperty(e.prototype,"changeTracker",{get:function(){return this.m_changeTracker},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.m_id},set:function(e){this.m_id!=e&&(this.m_changeTracker.notifyChange(),this.m_id=e)},enumerable:!1,configurable:!0}),e.prototype.releaseGeneratedResources=function(){for(var e in this.renderDataMap)this.renderDataMap[e].releaseGeneratedResources()},e}(),se=function(){function e(){this.m_changeTrackers={colorChangeTracker:new O,alphaChangeTracker:new O}}return Object.defineProperty(e.prototype,"changeTracker",{get:function(){return this.m_changeTrackers.colorChangeTracker},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"version",{get:function(){return this.m_changeTrackers.colorChangeTracker.version},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alphaChangeTracker",{get:function(){return this.m_changeTrackers.alphaChangeTracker},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rotateWithShape",{get:function(){return!0},enumerable:!1,configurable:!0}),e.IsGradient=function(e){return 2<=e&&e<=5},e}(),ae=function(e){function t(t){var r=e.call(this)||this;return r.m_color=t,r}return(0,p.ZT)(t,e),t.prototype.clone=function(){return new t(this.m_color)},Object.defineProperty(t.prototype,"color",{get:function(){return this.m_color},set:function(e){re(this.changeTracker,this.m_color,e),te(this.alphaChangeTracker,this.m_color.a,e.a),this.m_color=e},enumerable:!1,configurable:!0}),t.prototype.getType=function(){return 1},t}(se),le=function(){function e(e,t){this.position=e,this.color=t}return e.prototype.equals=function(e){return this.position==e.position&&this.color.equals(e.color)},e}(),he=function(e){function t(t,r){var i=e.call(this)||this;return i.m_type=t,i.m_angle=0,i.m_fillFromRect=new _(0,0,1,1),i.m_fillToRect=new _(.5,.5,.5,.5),i.m_rotateWithShape=!0,i.m_isStretched=!1,i.m_shadeFromTitle=!1,i.m_gradientStops=r?r.slice(0):[],i.m_isGammaCorrected=!0,O.AddListener(i.changeTracker,i.alphaChangeTracker),i}return(0,p.ZT)(t,e),t.prototype.clone=function(){var e=new t(this.m_type,this.m_gradientStops);return e.m_angle=this.m_angle,e.m_fillFromRect=this.m_fillFromRect,e.m_fillToRect=this.m_fillToRect,e.m_rotateWithShape=this.m_rotateWithShape,e.m_isStretched=this.m_isStretched,e.m_shadeFromTitle=this.m_shadeFromTitle,e.m_isGammaCorrected=this.m_isGammaCorrected,e},Object.defineProperty(t.prototype,"gradientStops",{get:function(){return this.m_gradientStops},set:function(e){ie(this.changeTracker,this.m_gradientStops,e),this.m_gradientStops=e.slice(0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"angle",{get:function(){return this.m_angle},set:function(e){te(this.changeTracker,this.m_angle,e),this.m_angle=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fillFromRect",{get:function(){return this.m_fillFromRect},set:function(e){re(this.changeTracker,this.m_fillFromRect,e),this.m_fillFromRect=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fillToRect",{get:function(){return this.m_fillToRect},set:function(e){re(this.changeTracker,this.m_fillToRect,e),this.m_fillToRect=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isStretched",{get:function(){return this.m_isStretched},set:function(e){te(this.changeTracker,this.m_isStretched,e),this.m_isStretched=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shadeFromTitle",{get:function(){return this.m_shadeFromTitle},set:function(e){te(this.changeTracker,this.m_shadeFromTitle,e),this.m_shadeFromTitle=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotateWithShape",{get:function(){return 5==this.m_type||this.m_rotateWithShape},set:function(e){te(this.changeTracker,this.m_rotateWithShape,e),this.m_rotateWithShape=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isGammaCorrected",{get:function(){return this.m_isGammaCorrected},set:function(e){te(this.changeTracker,this.m_isGammaCorrected,e),this.m_isGammaCorrected=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"blendBellShape",{get:function(){return this.m_blendBellShape},set:function(e){re(this.changeTracker,this.m_blendBellShape,e),this.m_blendBellShape=e},enumerable:!1,configurable:!0}),t.prototype.getType=function(){return this.m_type},t}(se),ce=function(e){function t(t,r){var i=e.call(this)||this;return i.m_fillToPreserveAspectRatio=!1,i.m_isAlphaInvariant=!!r,i.changeTracker.replaceListener(void 0,t),i.m_isAlphaInvariant||i.alphaChangeTracker.replaceListener(void 0,t),i.m_image=t,i.m_isStretched=!0,i.m_scale=g.One,i.m_offset=g.Zero,i.m_alignment=4,i.m_opacity=1,i.m_rotateWithShape=!0,i}return(0,p.ZT)(t,e),t.prototype.clone=function(){var e=new t(this.m_image);return e.m_isStretched=this.m_isStretched,e.m_scale=this.m_scale,e.m_offset=this.m_offset,e.m_alignment=this.m_alignment,e.m_opacity=this.m_opacity,e.m_rotateWithShape=this.m_rotateWithShape,e},Object.defineProperty(t.prototype,"image",{get:function(){return this.m_image},set:function(e){this.changeTracker.replaceListener(this.m_image,e),this.m_isAlphaInvariant||this.alphaChangeTracker.replaceListener(this.m_image,e),this.m_image=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wrapMode",{get:function(){return this.m_wrapMode},set:function(e){te(this.changeTracker,this.m_wrapMode,e),te(this.alphaChangeTracker,this.m_wrapMode,e),this.m_wrapMode=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isStretched",{get:function(){return this.m_isStretched},set:function(e){te(this.changeTracker,this.m_isStretched,e),te(this.alphaChangeTracker,this.m_isStretched,e),this.m_isStretched=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scale",{get:function(){return this.m_scale},set:function(e){re(this.changeTracker,this.m_scale,e),re(this.alphaChangeTracker,this.m_scale,e),this.m_scale=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"offset",{get:function(){return this.m_offset},set:function(e){re(this.changeTracker,this.m_offset,e),re(this.alphaChangeTracker,this.m_offset,e),this.m_offset=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"alignment",{get:function(){return this.m_alignment},set:function(e){te(this.changeTracker,this.m_alignment,e),te(this.alphaChangeTracker,this.m_alignment,e),this.m_alignment=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"opacity",{get:function(){return this.m_opacity},set:function(e){te(this.changeTracker,this.m_opacity,e),te(this.alphaChangeTracker,this.m_opacity,e),this.m_opacity=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotateWithShape",{get:function(){return this.m_rotateWithShape},set:function(e){te(this.changeTracker,this.m_rotateWithShape,e),te(this.alphaChangeTracker,this.m_rotateWithShape,e),this.m_rotateWithShape=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pictureEffects",{get:function(){return this.m_pictureEffects},set:function(e){this.m_pictureEffects!=e&&(this.changeTracker.replaceListener(this.m_pictureEffects,e),this.alphaChangeTracker.replaceListener(this.m_pictureEffects,e),this.m_pictureEffects=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isAlphaInvariant",{get:function(){return this.m_isAlphaInvariant},set:function(e){this.m_isAlphaInvariant!=e&&(e?this.alphaChangeTracker.replaceListener(this.m_image,void 0):this.alphaChangeTracker.replaceListener(void 0,this.m_image),this.m_isAlphaInvariant=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fillToPreserveAspectRatio",{get:function(){return this.m_fillToPreserveAspectRatio},set:function(e){te(this.changeTracker,this.m_fillToPreserveAspectRatio,e),te(this.alphaChangeTracker,this.m_fillToPreserveAspectRatio,e),this.m_fillToPreserveAspectRatio=e},enumerable:!1,configurable:!0}),t.prototype.getType=function(){return 6},t}(se),ue=function(e){function t(t,r,i){var n=e.call(this)||this;return n.m_pattern=t,n.m_foregroundColor=r,n.m_backgroundColor=i,n}return(0,p.ZT)(t,e),t.prototype.clone=function(){return new t(this.m_pattern,this.m_foregroundColor,this.m_backgroundColor)},Object.defineProperty(t.prototype,"pattern",{get:function(){return this.m_pattern},set:function(e){te(this.changeTracker,this.m_pattern,e),te(this.alphaChangeTracker,this.m_pattern,e),this.m_pattern=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"foregroundColor",{get:function(){return this.m_foregroundColor},set:function(e){re(this.changeTracker,this.m_foregroundColor,e),te(this.changeTracker,this.m_foregroundColor.a,e.a),this.m_foregroundColor=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"backgroundColor",{get:function(){return this.m_backgroundColor},set:function(e){re(this.changeTracker,this.m_backgroundColor,e),te(this.changeTracker,this.m_backgroundColor.a,e.a),this.m_backgroundColor=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotateWithShape",{get:function(){return!1},enumerable:!1,configurable:!0}),t.prototype.getType=function(){return 7},t}(se),de=(function(e){function t(t){var r=e.call(this)||this;return r.m_type=t,8!=t&&9!=t&&M.Error(592520774,"SpecialBrush must be background or group"),r}(0,p.ZT)(t,e),t.prototype.clone=function(){return new t(this.m_type)},t.prototype.getType=function(){return this.m_type}}(se),function(e,t,r,i,n){this.widthMin=e,this.end=t,this.cap=r,this.width=i,this.length=n}),pe=function(){function e(e,t,r){void 0===e&&(e=0),void 0===t&&(t=2),void 0===r&&(r=8),this.headEnd=new de(0,0,0,1,1),this.tailEnd=new de(0,0,0,1,1),this.m_changeTracker=new O,this.m_lineWidth=e,this.m_lineJoin=t,this.m_miterLimit=r,this.m_dashType=0,this.m_compoundType=0,this.m_alignment=0,this.m_useRoundDash=!1}return e.prototype.clone=function(){var t=new e(this.m_lineWidth);return t.m_lineJoin=this.m_lineJoin,t.m_miterLimit=this.m_miterLimit,t.m_dashType=this.m_dashType,t.m_compoundType=this.m_compoundType,t.m_alignment=this.m_alignment,t.m_useRoundDash=this.m_useRoundDash,t},Object.defineProperty(e.prototype,"changeTracker",{get:function(){return this.m_changeTracker},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"version",{get:function(){return this.m_changeTracker.version},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lineWidth",{get:function(){return this.m_lineWidth?this.m_lineWidth:this.m_lineHeight?this.m_lineHeight:0},set:function(e){te(this.changeTracker,this.m_lineWidth,e),this.m_lineWidth=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"adjustedLineWidth",{get:function(){return Math.max(R,this.lineWidth)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"adjustedLineWidthForArrowHead",{get:function(){return Math.max(A,this.lineWidth)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lineHeight",{get:function(){return this.m_lineHeight?this.m_lineHeight:this.m_lineWidth?this.m_lineWidth:0},set:function(e){te(this.changeTracker,this.m_lineHeight,e),this.m_lineHeight=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tipScale",{get:function(){return this.m_lineWidth&&this.m_lineHeight?new g(1,this.m_lineHeight/this.m_lineWidth):g.One},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lineJoin",{get:function(){return this.m_lineJoin},set:function(e){te(this.changeTracker,this.m_lineJoin,e),this.m_lineJoin=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"miterLimit",{get:function(){return this.m_miterLimit},set:function(e){te(this.changeTracker,this.m_miterLimit,e),this.m_miterLimit=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dashType",{get:function(){return this.m_dashType},set:function(e){te(this.changeTracker,this.m_dashType,e),this.m_dashType=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"useRoundDash",{get:function(){return this.m_useRoundDash},set:function(e){te(this.changeTracker,this.m_useRoundDash,e),this.m_useRoundDash=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dashOffset",{get:function(){return null==this.m_dashOffset?0:this.m_dashOffset},set:function(e){te(this.changeTracker,this.m_dashOffset,e),this.m_dashOffset=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"compoundType",{get:function(){return this.m_compoundType},set:function(e){te(this.changeTracker,this.m_compoundType,e),this.m_compoundType=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alignment",{get:function(){return this.m_alignment},set:function(e){te(this.changeTracker,this.m_alignment,e),this.m_alignment=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tipType",{get:function(){return null==this.m_tipType?0:this.m_tipType},set:function(e){te(this.changeTracker,this.m_tipType,e),this.m_tipType=e},enumerable:!1,configurable:!0}),e}(),fe=function(){function e(e,t,r,i){void 0===r&&(r=new pe),void 0===i&&(i=0),this.m_changeTracker=new O,this.m_alphaChangeTracker=new O,this.m_penChangeTracker=new O,this.m_fillChangeTrackers={colorChangeTracker:new O,alphaChangeTracker:new O},this.m_lineChangeTrackers={colorChangeTracker:new O,alphaChangeTracker:new O},this.m_pictureChangeTrackers={colorChangeTracker:new O,alphaChangeTracker:new O},O.AddListener(this.m_fillChangeTrackers.colorChangeTracker,this.m_changeTracker),O.AddListener(this.m_lineChangeTrackers.colorChangeTracker,this.m_changeTracker),O.AddListener(this.m_pictureChangeTrackers.colorChangeTracker,this.m_changeTracker),O.AddListener(this.m_fillChangeTrackers.alphaChangeTracker,this.m_alphaChangeTracker),O.AddListener(this.m_lineChangeTrackers.alphaChangeTracker,this.m_alphaChangeTracker),O.AddListener(this.m_pictureChangeTrackers.alphaChangeTracker,this.m_alphaChangeTracker),O.AddListener(this.m_penChangeTracker,this.m_changeTracker),this.m_pen=r,this.fillBrush=e,this.lineBrush=t,this.m_blendingMode=i,this.m_penChangeTracker.replaceListener(void 0,r)}return e.prototype.clone=function(){var t=new e;return t.fillBrush=this.m_fillBrush?this.m_fillBrush.clone():void 0,t.lineBrush=this.m_lineBrush?this.m_lineBrush.clone():void 0,t.pictureBrush=this.m_pictureBrush?this.m_pictureBrush.clone():void 0,t.pictureEffects=this.m_pictureEffects?this.m_pictureEffects.clone():void 0,t.m_pictureOverflow=this.m_pictureOverflow,t.pen=this.m_pen.clone(),t.blendingMode=this.m_blendingMode,t.m_hitTransparentFill=this.m_hitTransparentFill,t},Object.defineProperty(e.prototype,"changeTracker",{get:function(){return this.m_changeTracker},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alphaChangeTracker",{get:function(){return this.m_alphaChangeTracker},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"penChangeTracker",{get:function(){return this.m_penChangeTracker},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"version",{get:function(){return this.m_changeTracker.version},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fillBrush",{get:function(){return this.m_fillBrush},set:function(e){ge(this.m_fillChangeTrackers.colorChangeTracker,this.m_fillChangeTrackers.alphaChangeTracker,this.m_fillBrush,e),this.m_fillBrush=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lineBrush",{get:function(){return this.m_lineBrush},set:function(e){ge(this.m_lineChangeTrackers.colorChangeTracker,this.m_lineChangeTrackers.alphaChangeTracker,this.m_lineBrush,e),this.m_lineBrush=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pictureBrush",{get:function(){return this.m_pictureBrush},set:function(e){ge(this.m_pictureChangeTrackers.colorChangeTracker,this.m_pictureChangeTrackers.alphaChangeTracker,this.m_pictureBrush,e),this.m_pictureBrush=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pictureEffects",{get:function(){return this.m_pictureEffects},set:function(e){this.m_pictureEffects!=e&&(this.changeTracker.replaceListener(this.m_pictureEffects,e),this.m_pictureEffects=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pictureOverflow",{get:function(){return this.m_pictureOverflow||0},set:function(e){te(this.changeTracker,this.m_pictureOverflow,e),this.m_pictureOverflow=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pen",{get:function(){return this.m_pen},set:function(e){this.m_penChangeTracker.replaceListener(this.m_pen,e),this.m_pen=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasLine",{get:function(){return null!=this.m_lineBrush},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blendingMode",{get:function(){return this.m_blendingMode},set:function(e){te(this.changeTracker,this.m_blendingMode,e),this.m_blendingMode=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hitTransparentFill",{get:function(){return!!this.m_hitTransparentFill},set:function(e){te(this.changeTracker,this.m_hitTransparentFill,e),this.m_hitTransparentFill=e},enumerable:!1,configurable:!0}),e.prototype.getBrushImages=function(){var e=me(this.fillBrush);return e.push.apply(e,me(this.lineBrush)),e.push.apply(e,me(this.pictureBrush)),e},e}();function ge(e,t,r,i){r!=i&&(r&&(O.RemoveListener(r.changeTracker,e),O.RemoveListener(r.alphaChangeTracker,t)),i&&(O.AddListener(i.changeTracker,e),O.AddListener(i.alphaChangeTracker,t)))}function me(e){var t=[];if(e&&6==e.getType()){var r=e;r.image&&t.push(r.image)}return t}var ve=function(){function e(e,t,r){void 0===e&&(e=ne.Transparent),void 0===t&&(t=0),void 0===r&&(r=!1),this.m_changeTracker=new O,this.m_color=e,this.m_radius=t,this.m_isSharp=r}return Object.defineProperty(e.prototype,"changeTracker",{get:function(){return this.m_changeTracker},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this.m_color},set:function(e){re(this.m_changeTracker,this.m_color,e),this.m_color=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"radius",{get:function(){return this.m_radius},set:function(e){te(this.m_changeTracker,this.m_radius,e),this.m_radius=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isSharp",{get:function(){return this.m_isSharp},set:function(e){te(this.m_changeTracker,this.m_isSharp,e),this.m_isSharp=e},enumerable:!1,configurable:!0}),e.prototype.clone=function(){return new e(this.m_color,this.m_radius,this.m_isSharp)},e}(),ye=function(){function e(e,t,r,i,n,o,s,a,l){void 0===e&&(e=ne.Transparent),void 0===t&&(t=0),void 0===r&&(r=0),void 0===i&&(i=0),void 0===n&&(n=g.One),void 0===o&&(o=g.Zero),void 0===s&&(s=4),void 0===a&&(a=!1),void 0===l&&(l=0),this.m_changeTracker=new O,this.m_color=e,this.m_radius=t,this.m_angle=r,this.m_distance=i,this.m_scale=n,this.m_skew=o,this.m_alignment=s,this.m_rotateWithShape=a,this.m_shadowType=l}return Object.defineProperty(e.prototype,"changeTracker",{get:function(){return this.m_changeTracker},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this.m_color},set:function(e){re(this.m_changeTracker,this.m_color,e),this.m_color=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"radius",{get:function(){return this.m_radius},set:function(e){te(this.m_changeTracker,this.m_radius,e),this.m_radius=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"angle",{get:function(){return this.m_angle},set:function(e){te(this.m_changeTracker,this.m_angle,e),this.m_angle=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"distance",{get:function(){return this.m_distance},set:function(e){te(this.m_changeTracker,this.m_distance,e),this.m_distance=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scale",{get:function(){return this.m_scale},set:function(e){re(this.m_changeTracker,this.m_scale,e),this.m_scale=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"skew",{get:function(){return this.m_skew},set:function(e){re(this.m_changeTracker,this.m_skew,e),this.m_skew=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alignment",{get:function(){return this.m_alignment},set:function(e){te(this.m_changeTracker,this.m_alignment,e),this.m_alignment=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rotateWithShape",{get:function(){return this.m_rotateWithShape},set:function(e){te(this.m_changeTracker,this.m_rotateWithShape,e),this.m_rotateWithShape=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shadowType",{get:function(){return this.m_shadowType},set:function(e){te(this.m_changeTracker,this.m_shadowType,e),this.m_shadowType=e},enumerable:!1,configurable:!0}),e.prototype.clone=function(){return new e(this.m_color,this.m_radius,this.m_angle,this.m_distance,this.m_scale,this.m_skew,this.m_alignment,this.m_rotateWithShape,this.m_shadowType)},e}(),_e=function(){function e(e,t,r,i){void 0===e&&(e=ne.Transparent),void 0===t&&(t=0),void 0===r&&(r=0),void 0===i&&(i=0),this.m_changeTracker=new O,this.m_color=e,this.m_radius=t,this.m_angle=r,this.m_distance=i}return Object.defineProperty(e.prototype,"changeTracker",{get:function(){return this.m_changeTracker},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this.m_color},set:function(e){re(this.m_changeTracker,this.m_color,e),this.m_color=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"radius",{get:function(){return this.m_radius},set:function(e){te(this.m_changeTracker,this.m_radius,e),this.m_radius=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"angle",{get:function(){return this.m_angle},set:function(e){te(this.m_changeTracker,this.m_angle,e),this.m_angle=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"distance",{get:function(){return this.m_distance},set:function(e){te(this.m_changeTracker,this.m_distance,e),this.m_distance=e},enumerable:!1,configurable:!0}),e.prototype.clone=function(){return new e(this.m_color,this.m_radius,this.m_angle,this.m_distance)},e}(),be=function(){function e(e,t,r,i,n,o){void 0===e&&(e=0),void 0===t&&(t=1),void 0===r&&(r=0),void 0===i&&(i=0),void 0===n&&(n=1),void 0===o&&(o=0),this.m_changeTracker=new O,this.m_radius=e,this.m_startAlpha=t,this.m_startPosition=r,this.m_endAlpha=i,this.m_endPosition=n,this.m_distance=o}return Object.defineProperty(e.prototype,"changeTracker",{get:function(){return this.m_changeTracker},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"radius",{get:function(){return this.m_radius},set:function(e){te(this.m_changeTracker,this.m_radius,e),this.m_radius=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"startAlpha",{get:function(){return this.m_startAlpha},set:function(e){te(this.m_changeTracker,this.m_startAlpha,e),this.m_startAlpha=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"startPosition",{get:function(){return this.m_startPosition},set:function(e){te(this.m_changeTracker,this.m_startPosition,e),this.m_startPosition=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"endAlpha",{get:function(){return this.m_endAlpha},set:function(e){te(this.m_changeTracker,this.m_endAlpha,e),this.m_endAlpha=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"endPosition",{get:function(){return this.m_endPosition},set:function(e){te(this.m_changeTracker,this.m_endPosition,e),this.m_endPosition=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"distance",{get:function(){return this.m_distance},set:function(e){te(this.m_changeTracker,this.m_distance,e),this.m_distance=e},enumerable:!1,configurable:!0}),e.prototype.clone=function(){return new e(this.m_radius,this.m_startAlpha,this.m_startPosition,this.m_endAlpha,this.m_endPosition,this.m_distance)},e}(),Te=function(){function e(e){void 0===e&&(e=0),this.m_changeTracker=new O,this.m_radius=e}return Object.defineProperty(e.prototype,"changeTracker",{get:function(){return this.m_changeTracker},enumerable:!1,configurable:!0}),e.prototype.notifyChange=function(){this.m_changeTracker.notifyChange()},Object.defineProperty(e.prototype,"radius",{get:function(){return this.m_radius},set:function(e){this.m_radius!=e&&(this.notifyChange(),this.m_radius=e)},enumerable:!1,configurable:!0}),e.prototype.clone=function(){return new e(this.m_radius)},e}(),we=function(){function e(e,t,r,i,n){this.m_changeTracker=new O,this.glow=e,this.shadow=t,this.innerShadow=r,this.reflection=i,this.softEdges=n}return Object.defineProperty(e.prototype,"changeTracker",{get:function(){return this.m_changeTracker},enumerable:!1,configurable:!0}),e.prototype.notifyChange=function(){this.m_changeTracker.notifyChange()},Object.defineProperty(e.prototype,"glow",{get:function(){return this.m_glow},set:function(e){this.m_changeTracker.replaceListener(this.m_glow,e),this.m_glow=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shadow",{get:function(){return this.m_shadow},set:function(e){this.m_changeTracker.replaceListener(this.m_shadow,e),this.m_shadow=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"innerShadow",{get:function(){return this.m_innerShadow},set:function(e){this.m_changeTracker.replaceListener(this.m_innerShadow,e),this.m_innerShadow=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"reflection",{get:function(){return this.m_reflection},set:function(e){this.m_changeTracker.replaceListener(this.m_reflection,e),this.m_reflection=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"softEdges",{get:function(){return this.m_softEdges},set:function(e){this.m_changeTracker.replaceListener(this.m_softEdges,e),this.m_softEdges=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"direction",{get:function(){return this.m_direction||0},set:function(e){te(this.m_changeTracker,this.m_direction,e),this.m_direction=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasEffects",{get:function(){return!!(this.m_glow||this.m_shadow||this.m_innerShadow||this.m_reflection||this.m_softEdges)},enumerable:!1,configurable:!0}),e.prototype.clone=function(){return new e(this.m_glow?this.m_glow.clone():void 0,this.m_shadow?this.m_shadow.clone():void 0,this.m_innerShadow?this.m_innerShadow.clone():void 0,this.m_reflection?this.m_reflection.clone():void 0,this.m_softEdges?this.m_softEdges.clone():void 0)},e}(),xe=function(){function e(e,t,r){void 0===e&&(e=new we),void 0===t&&(t=y.Identity),this.m_animationChangeTracker=new O,this.renderDataMap={},this.m_changeTracker=new O(r),this.m_alphaTracker=new O(r),this.m_changeTracker.replaceListener(void 0,e),this.m_alphaTracker.replaceListener(void 0,e),this.m_effects=e,this.m_isHidden=!1,this.m_transform=t,null==U||U.register(this,this.renderDataMap)}return e.prototype.cloneItemData=function(e){e.effects=this.m_effects.clone(),e.m_transform=this.m_transform,e.fade=this.m_fade?this.m_fade.clone():void 0,e.m_animationTransform=this.m_animationTransform,e.m_fillBoundsOverride=this.m_fillBoundsOverride,e.m_effectsBoundsOverride=this.m_effectsBoundsOverride,e.m_scene3D=this.m_scene3D,e.m_isHidden=this.m_isHidden,e.m_instanceOffsets=this.m_instanceOffsets,e.m_clipBounds=this.m_clipBounds,e.clientData=this.clientData},Object.defineProperty(e.prototype,"changeTracker",{get:function(){return this.m_changeTracker},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"animationChangeTracker",{get:function(){return this.m_animationChangeTracker},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alphaTracker",{get:function(){return this.m_alphaTracker},enumerable:!1,configurable:!0}),e.prototype.notifyChange=function(){this.m_changeTracker.notifyChange()},Object.defineProperty(e.prototype,"version",{get:function(){return this.m_changeTracker.version},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"effects",{get:function(){return this.m_effects},set:function(e){this.m_changeTracker.replaceListener(this.m_effects,e),this.m_effects=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transform",{get:function(){return this.m_transform},set:function(e){this.m_transform.equals(e)||(this.onTransformChanged(this.m_transform,e),this.notifyChange(),this.m_transform=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isHidden",{get:function(){return this.m_isHidden},set:function(e){te(this.m_changeTracker,this.m_isHidden,e),this.m_isHidden=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"instanceOffsets",{get:function(){return this.m_instanceOffsets},set:function(e){this.m_instanceOffsets=e?e.slice(0):void 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fade",{get:function(){return this.m_fade},set:function(e){this.m_animationChangeTracker.replaceListener(this.m_fade,e),this.m_fade=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"animationTransform",{get:function(){return this.m_animationTransform},set:function(e){re(this.m_animationChangeTracker,this.m_animationTransform,e),this.m_animationTransform=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fillBoundsOverride",{get:function(){return this.m_fillBoundsOverride},set:function(e){re(this.m_changeTracker,this.m_fillBoundsOverride,e),this.m_fillBoundsOverride=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"effectsBoundsOverride",{get:function(){return this.m_effectsBoundsOverride},set:function(e){re(this.m_changeTracker,this.m_effectsBoundsOverride,e),this.m_effectsBoundsOverride=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scene3D",{get:function(){return this.m_scene3D},set:function(e){this.m_scene3D!=e&&(this.notifyChange(),this.m_scene3D=e,this.clearCache())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"clipBounds",{get:function(){return this.m_clipBounds},set:function(e){re(this.changeTracker,this.m_clipBounds,e),re(this.alphaTracker,this.m_clipBounds,e),this.m_clipBounds=e},enumerable:!1,configurable:!0}),e.prototype.getBounds=function(e,t,r,i){return void 0===e&&(e=!0),void 0===t&&(t=!0),void 0===r&&(r=!0),void 0===i&&(i=void 0),Re(this,t,r?31:0,r?31:0,null==i?void 0:i.toMatrix3(),!0,void 0,e)},e.prototype.onTransformChanged=function(e,t){},e.prototype.clearCache=function(){for(var e in this.renderDataMap)this.renderDataMap[e].releaseGeneratedResources()},e.prototype.releaseGeneratedResources=function(){this.clearCache();for(var e=0,t=this.getBrushImages();e<t.length;e++)t[e].releaseGeneratedResources()},e}(),Ce=function(e){function t(t,r,i,n){void 0===t&&(t=void 0),void 0===r&&(r=new fe),void 0===i&&(i=new we),void 0===n&&(n=y.Identity);var o=e.call(this,i,n)||this;return o.m_role=0,o.m_geometryTracker=new O,o.m_paths=t,o.m_overlapMode=0,o.m_mergeMode=0,o.changeTracker.replaceListener(void 0,r),O.AddListener(r.penChangeTracker,o.m_geometryTracker),O.AddListener(r.alphaChangeTracker,o.alphaTracker),O.AddListener(o.m_geometryTracker,o.alphaTracker),o.m_style=r,o}return(0,p.ZT)(t,e),t.prototype.clone=function(){var e=new t;return e.paths=this.m_paths?this.m_paths.slice(0):void 0,e.m_overlapMode=this.m_overlapMode,e.m_mergeMode=this.m_mergeMode,e.style=this.m_style.clone(),e.m_shape3D=this.m_shape3D,e.text=this.m_text?this.m_text.clone():void 0,e.m_textEffectMetrics=this.m_textEffectMetrics,e.m_role=this.m_role,this.cloneItemData(e),e},t.CreateRectangle=function(e,r,i,n){return void 0===r&&(r=new fe),void 0===i&&(i=new we),void 0===n&&(n=y.Identity),new t([N.CreateFromRect(e)],r,i,n)},Object.defineProperty(t.prototype,"paths",{get:function(){return this.m_paths},set:function(e){this.m_paths!=e&&(this.clearPathCache(),this.notifyGeometryChange(),this.m_paths=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"incrementalPath",{get:function(){return this.m_incrementalPath},set:function(e){this.changeTracker.replaceListener(this.m_incrementalPath,e),this.alphaTracker.replaceListener(this.m_incrementalPath,e),this.m_incrementalPath=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"overlapMode",{get:function(){return this.m_overlapMode},set:function(e){this.m_overlapMode!=e&&(this.notifyGeometryChange(),this.m_overlapMode=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mergeMode",{get:function(){return this.m_mergeMode},set:function(e){this.m_mergeMode!=e&&(this.notifyGeometryChange(),this.m_mergeMode=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"style",{get:function(){return this.m_style},set:function(e){this.m_style!=e&&(O.RemoveListener(this.m_style.penChangeTracker,this.m_geometryTracker),O.AddListener(e.penChangeTracker,this.m_geometryTracker),O.RemoveListener(this.m_style.alphaChangeTracker,this.alphaTracker),O.AddListener(e.alphaChangeTracker,this.alphaTracker),this.changeTracker.replaceListener(this.m_style,e),this.m_style=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shape3D",{get:function(){return this.m_shape3D},set:function(e){this.m_shape3D!=e&&(this.notifyGeometryChange(),this.m_shape3D=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"text",{get:function(){return this.m_text},set:function(e){this.m_text!=e&&(this.m_text&&(this.m_text.cache&&this.m_text.cache.clearCache(),O.RemoveListener(this.m_text.changeTracker,this.changeTracker),O.RemoveListener(this.m_text.changeTracker,this.alphaTracker),O.RemoveListener(this.m_text.animationChangeTracker,this.animationChangeTracker)),this.m_text=e,this.m_text&&(O.AddListener(this.m_text.changeTracker,this.changeTracker),O.AddListener(this.m_text.changeTracker,this.alphaTracker),O.AddListener(this.m_text.animationChangeTracker,this.animationChangeTracker)))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textEffectMetrics",{get:function(){return this.m_textEffectMetrics},set:function(e){re(this.changeTracker,this.m_textEffectMetrics,e),re(this.alphaTracker,this.m_textEffectMetrics,e),this.m_textEffectMetrics=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"role",{get:function(){return this.m_role},set:function(e){this.m_role!=e&&(this.notifyChange(),this.m_geometryTracker.notifyChange(),this.m_role=e)},enumerable:!1,configurable:!0}),t.prototype.onTransformChanged=function(e,t){e.scale.equals(t.scale)||this.m_geometryTracker.notifyChange()},t.prototype.clearCache=function(){e.prototype.clearCache.call(this),this.text&&this.text.cache&&(this.text.cache.clearCache(),this.text.cache=void 0),this.clearPathCache(),this.clearBoundsCache()},t.prototype.clearPathCache=function(){for(var e=0,t=this.paths||[];e<t.length;e++){var r=t[e];for(var i in r.renderDataMap)r.renderDataMap[i].releaseGeneratedResources()}},t.prototype.clearBoundsCache=function(){this.shapeBoundsCache=void 0},Object.defineProperty(t.prototype,"geometryTracker",{get:function(){return this.m_geometryTracker},enumerable:!1,configurable:!0}),t.prototype.notifyGeometryChange=function(){this.notifyChange(),this.m_geometryTracker.notifyChange(),this.clearBoundsCache()},t.prototype.getBrushImages=function(){var e=this.style.getBrushImages();return this.text&&e.push.apply(e,this.text.getBrushImages()),e},t.prototype.isSolidRectGeometry=function(){return!(!this.m_paths||1!=this.m_paths.length||!this.m_paths[0].isUntransformedRect||1!=this.m_paths[0].fillMode||this.m_paths[0].transform instanceof v||this.m_paths[0].transform instanceof y&&0!=this.m_paths[0].transform.rotation)},t.prototype.isSolidRect=function(){return!(!this.isSolidRectGeometry()||this.style.hasLine||this.style.pictureOverflow>0||this.text&&0!=this.text.renderMode)},t.prototype.hasSmallDetails=function(){return 3==this.role||this.style.hasLine&&this.style.pen.lineWidth<3||this.m_paths&&this.m_paths.some((function(e){return e.hasPressureInfo}))},t.prototype.getType=function(){return 1},t}(xe),Se=function(e){function t(t,r,i){void 0===t&&(t=void 0),void 0===r&&(r=new we),void 0===i&&(i=y.Identity);var n=this,o=t instanceof k?t:new k(t,false);return(n=e.call(this,r,i,o.deferTracking?function(){return o.getHash()}:void 0)||this).changeTracker.replaceListener(void 0,o),n.alphaTracker.replaceListener(void 0,o),n.m_items=o,n}return(0,p.ZT)(t,e),t.prototype.clone=function(){for(var e=new t,r=0,i=this.m_items.elements;r<i.length;r++){var n=i[r];e.items.push(n.clone())}return e.groupFillBrush=this.m_groupFillBrush?this.m_groupFillBrush.clone():void 0,e.m_isDocumentShape=this.m_isDocumentShape,this.cloneItemData(e),e},Object.defineProperty(t.prototype,"items",{get:function(){return this.m_items},set:function(e){this.setItems(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"groupFillBrush",{get:function(){return this.m_groupFillBrush},set:function(e){this.m_groupFillBrush=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isDocumentShape",{get:function(){return this.m_isDocumentShape},set:function(e){this.m_isDocumentShape=e},enumerable:!1,configurable:!0}),t.prototype.setItems=function(e){void 0===e&&(e=void 0);var t=e instanceof k?e:new k(e);this.changeTracker.replaceListener(this.m_items,t),this.alphaTracker.replaceListener(this.m_items,t),this.m_items=t},t.prototype.clearCache=function(){e.prototype.clearCache.call(this);for(var t=0;t<this.m_items.length;t++)this.m_items.getAt(t).clearCache()},t.prototype.getBrushImages=function(){for(var e=me(this.groupFillBrush),t=0,r=this.m_items.elements;t<r.length;t++){var i=r[t];e.push.apply(e,i.getBrushImages())}return e},t.prototype.getType=function(){return 2},t}(xe);function Pe(e,t){if(!e)return!0;if(1==e.getType()){var r=e;if(t(r),r.text&&r.text.cache){for(var i=0,n=r.text.cache.getTextShapes();i<n.length;i++)if(!Pe(n[i],t))return!1;for(var o=0,s=r.text.cache.getSelectionShapes()||[];o<s.length;o++)if(!Pe(s[o],t))return!1}}else{if(2!=e.getType())throw M.Error(591525086,"Unknown Item type");for(var a=0,l=e.items.elements;a<l.length;a++)if(!Pe(l[a],t))return!1}return!0}function Ee(e){return 1==e.alignment?-1:2==e.alignment?1:0}function Me(e,t,r){if(void 0===r&&(r=void 0),e.incrementalPath)return r?e.incrementalPath.bounds.transformedBounds(r):e.incrementalPath.bounds;e.shapeBoundsCache&&e.shapeBoundsCache.geometryVersion==e.geometryTracker.version||(e.shapeBoundsCache={geometryVersion:e.geometryTracker.version});var i=0;t&&e.style.hasLine&&(i=e.style.pen.adjustedLineWidth*(.5+Math.abs(Math.max(Ee(e.style.pen))))),t&&e.shape3D&&e.shape3D.adjustedContourWidth>0&&(i+=.5*e.shape3D.adjustedContourWidth);var n=!r||r.isSimpleScaleTranslationOnly(),o=i?e.shapeBoundsCache.pathsBoundsWithLine:e.shapeBoundsCache.pathsBounds;if(!o&&!i&&n&&e.paths&&(o=e.shapeBoundsCache.pathsBounds=ee(e.paths)),o){if(!r)return o;if(n)return o.multiply(r.getSimpleScale()).translate(r.getSimpleTranslation())}var s=i?e.shapeBoundsCache.pathsBoundsContributorsWithLine:e.shapeBoundsCache.pathsBoundsContributors;if(!s){var a=v.Scale2D(e.transform.scale);s=[],e.paths&&function(e,t,r,i,n,o){for(var s=0,a=e;s<a.length;s++)for(var l=a[s],h=l.transform.toMatrix3().multiply(i),c=0,u=l.figures;c<u.length;c++){var d=u[c];if(o.push(J(d,h,t,n?1:r.pen.lineJoin,r.pen.miterLimit)),t&&!d.isClosed&&r.pen){if(r.pen.headEnd&&0!=r.pen.headEnd.end){var p=X(r.pen.headEnd,r.pen.adjustedLineWidthForArrowHead);if(p){var f=$(d,!1,r.pen.headEnd,2*t,h);f&&o.push(J(p,f,t,1,r.pen.miterLimit))}}if(r.pen.tailEnd&&0!=r.pen.tailEnd.end){var g=X(r.pen.tailEnd,r.pen.adjustedLineWidthForArrowHead);if(g){var m=$(d,!0,r.pen.tailEnd,2*t,h);m&&o.push(J(g,m,t,1,r.pen.miterLimit))}}}}}(e.paths,i,e.style,a,null!=e.shape3D,s),i?e.shapeBoundsCache.pathsBoundsContributorsWithLine=s:e.shapeBoundsCache.pathsBoundsContributors=s}for(var l=v.Scale2D(e.transform.scale.inverse()),h=r?l.multiply(r):l,c=void 0,u=0,d=s||[];u<d.length;u++){var p=Q(d[u],h);c=_.UnionRect(c,p)}if(c&&n){var f=r?c.translate(r.getSimpleTranslation().negate()).multiply(r.getSimpleScale().inverse()):c;t?e.shapeBoundsCache.pathsBoundsWithLine=f:e.shapeBoundsCache.pathsBounds=f}return c}function Re(e,t,r,i,n,o,s,a){void 0===n&&(n=void 0),void 0===o&&(o=!0),void 0===a&&(a=!1);var l=a?e.animationTransform:void 0,h=n&&l?n.multiply(l):n||l,c=h?e.transform.toMatrix3().multiply(h):e.transform.toMatrix3(),u=void 0;if(1==e.getType()){var d=e;if(s||(u=Me(d,!0,c)),d.text&&t&&(o||s)){var p=new y(g.Zero,g.One,e.transform.rotation,e.transform.translation),f=d.text.hasAnimationProps()?n:h,m=f?p.toMatrix3().multiply(f):p.toMatrix3();u=_.UnionRect(u,d.text.getBoundsOfRange(s,m,a))}}else if(2==e.getType()&&!s&&o)for(var b=e,T=0;T<b.items.length;T++){var w=b.items.getAt(T),x=w instanceof Ce&&3==w.role;!t&&x||(u=_.UnionRect(u,Re(w,t,i,i,c)))}if(!s){var C=void 0,S=void 0,P=1&r&&e.effects&&e.effects.glow&&e.effects.glow.radius,E=2&r&&e.effects&&e.effects.shadow,M=4&r&&e.effects&&e.effects.reflection;if((P||E||M)&&(S=h?Re(e,t,r,i):u),(E||M)&&(C=e.effectsBoundsOverride?e.effectsBoundsOverride:Re(e,!1,0,1)),u&&S&&1&r&&e.effects&&e.effects.glow&&e.effects.glow.radius&&(S=S.inflate(2*e.effects.glow.radius),u=u.inflate(2*e.effects.glow.radius)),(E||M)&&!t&&e instanceof Ce&&e.text){var R=Re(e,!0,r,i);R&&(S=_.UnionRect(S,R))}if(u&&S&&C&&2&r&&e.effects&&e.effects.shadow){var A=Ie(e.effects.shadow.alignment,C),I=Fe(e.effects.shadow.angle,e.effects.shadow.distance,e.effects.shadow.scale,e.effects.shadow.skew,A),F=(e.effects.shadow.radius?S.inflate(e.effects.shadow.radius):S).transformedBounds(h?I.multiply(h):I),B=(e.effects.shadow.radius?S.inflate(e.effects.shadow.radius):S).transformedBounds(h?I.multiply(h):I);S=_.UnionRect(S,F),u=_.UnionRect(u,B)}if(u&&S&&C&&4&r&&e.effects&&e.effects.reflection){var L=e.effects.reflection,D=C.bottom+e.effects.reflection.distance/2;e instanceof Ce&&e.textEffectMetrics&&(D-=e.textEffectMetrics.descent);var k=v.Translation2D(new g(0,-D)).multiply(v.Scale2D(new g(1,-1))).multiply(v.Translation2D(new g(0,D))),O=(L.radius?S.inflate(L.radius):S).transformedBounds(k),U=h?(L.radius?S.inflate(L.radius):S).transformedBounds(k.multiply(h)):O;u=_.UnionRect(u,U)}}return u}var Ae=[new g(0,0),new g(.5,0),new g(1,0),new g(0,.5),new g(.5,.5),new g(1,.5),new g(0,1),new g(.5,1),new g(1,1)];function Ie(e,t){return void 0===t&&(t=void 0),t?Ae[e].multiply(t.size).add(t.leftTop):Ae[e]}function Fe(e,t,r,i,n){var o=v.Translation2D(n.negate()),s=new g(t,0).rotate(e).add(n),a=new v(r.x,i.y,0,i.x,r.y,0,s.x,s.y,1);return o.multiply(a)}function Be(e){e.items.removeAll(),e.clearCache()}class Le{}class De{constructor(){this.type=Le,this.pointerEventNotifiers=(0,r.n)(),this.hitTestSlop=i.Hr,this.scene=new Se,this.sourceAnchorBounds=new s.U(0,0,0,0),this.scaleFactor=De.defaultScaleFactor,this.transform=new a.A,this.emuToSourceScale=1,this.isHitTestOnly=!1,this.teardownTracker=new c("ShapeBuilderViewModel"),this.itemTeardowns=[]}static setDefaultScaleFactor(e){De.defaultScaleFactor=e}addItem(e){this.scene.items.push(e)}addTeardown(e){this.itemTeardowns.push(e)}setItems(e){e.length>0&&function(e){const t=new d("ShapeBuilderViewModel.clearTextures");try{t.setProp("renderDataMapSize",Object.keys(e.renderDataMap).length),t.setProp("sceneSize",e.items.length),e.releaseGeneratedResources()}finally{t.complete()}}(this.scene),this.scene.setItems(e)}removeItem(e){const t=this.scene.items.elements.indexOf(e);-1!==t&&this.scene.items.removeAt(t)}clear(){this.itemTeardowns.forEach((e=>{e()})),this.itemTeardowns=[],this.scene.items.removeAll()}teardown(){Be(this.scene),this.itemTeardowns.forEach((e=>{e()})),this.teardownTracker.teardown()}}function ke(e){return e.type===Le}De.defaultScaleFactor=1,function(){function e(e,t,r,i,n){this.renderDataMap={},this.contents=e,this.location=t,this.zPosition=r,this.parentTransform=n,this.morphingGrid=i}e.prototype.clearCache=function(){for(var e in this.renderDataMap)this.renderDataMap[e].releaseGeneratedResources()},e.CreateFromItem=function(t,r,i,n,o,s){var a=v.FromTransforms(t.transform,s||v.Identity,t.animationTransform||v.Identity),l=a.transformVector(new g(1,0)),h=a.transformVector(new g(0,1)),c=i.transformedBounds(a);return new e([{item:t,includeSubtree:n,textRange:o}],{center:c?c.center:g.Zero,size:c?i.size.multiply(new g(l.length(),h.length())):g.Zero,rotation:t.transform.rotation,flipX:t.transform.scale.x<0,flipY:t.transform.scale.y<0},r,void 0,s)},e.TryCreateFromShape=function(t,r,i,n){var o=Me(t,!1);return o?e.CreateFromItem(t,r,o,i,void 0,n):void 0},e.TryCreateFromText=function(t,r,i,n){if(t.text){var o=t.text.getFullRange(),s=i||o;if(o&&s&&o.contains(s)){var a=t.text.getBoundsOfRange(s);if(a){var l=a.transformedBounds(y.fromScaleAndTranslation(t.transform.scale.inverse(),t.transform.preTranslation.negate()));return l?e.CreateFromItem(t,r,l,!0,s,n):void 0}}else M.Error(592525387,"TryCreateFromText out of range: "+(i?(i.start,i.last,"]"):void 0)+" fullRange: "+(o?(o.start,o.last,"]"):"undefined"))}else M.Error(592525386,"TryCreateFromText on Shape with no Text")},e.TryCreateFromGroup=function(t,r,i,n){var o=Re(t,!1,0,0,t.transform.toInverseMatrix3());return o?e.CreateFromItem(t,r,o,i,void 0,n):void 0}}();var Oe=function(){function e(){this.elements=[]}return e.prototype.clearCache=function(){this.elements.forEach((function(e){return e.clearCache()}))},e}(),Ue=256,Ne=function(){function e(e,t){this.start=e,this.length=t}return Object.defineProperty(e.prototype,"last",{get:function(){return this.start+this.length-1},enumerable:!1,configurable:!0}),e.prototype.equals=function(e){return this.start==e.start&&this.length==e.length},e.prototype.includes=function(e){return e>=this.start&&e<=this.last},e.prototype.intersects=function(e){return this.start<=e.last&&this.last>=e.start},e.prototype.contains=function(e){return this.start<=e.start&&e.last<=this.last},e.prototype.getIntersection=function(t){var r=e.FromFirstLast(Math.max(this.start,t.start),Math.min(this.last,t.last));return r.length>=0?r:void 0},e.prototype.move=function(t){return new e(this.start+t,this.length)},e.FromFirstLast=function(t,r){return new e(t,r+1-t)},e}(),Ve=function(){function e(e){this.m_defaultData=e}return e.prototype.onDataChange=function(){},e.prototype.onRangeChange=function(){},e.prototype.onDataRemoved=function(e){},e.prototype.onDataAdded=function(e){},Object.defineProperty(e.prototype,"defaultData",{get:function(){return this.m_defaultData},set:function(e){this.m_defaultData=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ranges",{get:function(){for(var e=[],t=0,r=this.m_dataPerRange||[];t<r.length;t++){var i=r[t];e.push(i.range)}return e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"allData",{get:function(){for(var e=[this.m_defaultData],t=0,r=this.m_dataPerRange||[];t<r.length;t++){var i=r[t];e.push(i.data)}return e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dataPerRange",{get:function(){return this.m_dataPerRange||[]},enumerable:!1,configurable:!0}),e.prototype.set=function(e,t){if(this.onDataChange(),t){for(var r=0,i=this.m_dataPerRange||[];r<i.length;r++)if((s=i[r]).range.start==t.start&&s.range.last==t.last)return this.onDataRemoved(s.data),s.data=e,void this.onDataAdded(s.data);for(var n=0,o=this.m_dataPerRange||[];n<o.length;n++){var s=o[n];this.onDataRemoved(s.data)}this.onRangeChange();for(var a=[],l=!1,h=0,c=this.m_dataPerRange||[];h<c.length;h++)(s=c[h]).range.start<t.start&&a.push({range:Ne.FromFirstLast(s.range.start,Math.min(s.range.last,t.start-1)),data:s.data}),t.last<s.range.last&&(l||(a.push({range:t,data:e}),l=!0),a.push({range:Ne.FromFirstLast(Math.max(s.range.start,t.last+1),s.range.last),data:s.data}));l||a.push({range:t,data:e}),this.m_dataPerRange=a;for(var u=0,d=this.m_dataPerRange||[];u<d.length;u++)s=d[u],this.onDataAdded(s.data)}else{for(var p=0,f=this.m_dataPerRange||[];p<f.length;p++){var g=f[p];this.onDataRemoved(g.data)}this.m_defaultData=e,this.m_dataPerRange=void 0}},e.prototype.getAt=function(e){for(var t=0,r=this.m_dataPerRange||[];t<r.length;t++){var i=r[t];if(i.range.start<=e&&e<=i.range.last)return i.data}return this.m_defaultData},e.prototype.shiftIndices=function(e,t){if(this.m_dataPerRange){for(var r=[],i=t-e.length,n=0,o=this.m_dataPerRange;n<o.length;n++){var s=o[n];if(e.contains(s.range)&&e.start!=s.range.start)this.onDataRemoved(s.data);else if(s.range.includes(e.start)){var a=Math.min(e.length,s.range.last+1-e.start);r.push({range:new Ne(s.range.start,s.range.length+t-a),data:s.data})}else s.range.start<=e.last&&e.last<=s.range.last?r.push({range:Ne.FromFirstLast(e.start+t,s.range.last+i),data:s.data}):e.last<s.range.start?r.push({range:s.range.move(i),data:s.data}):r.push(s)}this.m_dataPerRange=r}},e}(),Ge=function(e){function t(t){var r=e.call(this,t)||this;return r.m_changeTracker=new O,r.m_rangeChangeTracker=new O,r.m_changeTracker.replaceListener(void 0,t),r}return(0,p.ZT)(t,e),Object.defineProperty(t.prototype,"changeTracker",{get:function(){return this.m_changeTracker},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rangeChangeTracker",{get:function(){return this.m_rangeChangeTracker},enumerable:!1,configurable:!0}),t.prototype.onDataChange=function(){this.m_changeTracker.notifyChange()},t.prototype.onRangeChange=function(){this.rangeChangeTracker.notifyChange()},t.prototype.onDataRemoved=function(e){O.RemoveListener(e.changeTracker,this.m_changeTracker)},t.prototype.onDataAdded=function(e){O.AddListener(e.changeTracker,this.m_changeTracker)},t}(Ve),ze=function(){function e(e,t,r,i){this.m_changeTracker=new O,this.m_type=e,this.m_verticalCenter=t,this.m_thickness=r,this.style=i}return e.prototype.clone=function(){return new e(this.m_type,this.m_verticalCenter,this.m_thickness,this.m_style?this.m_style.clone():void 0)},Object.defineProperty(e.prototype,"type",{get:function(){return this.m_type},set:function(e){te(this.changeTracker,this.m_type,e),this.m_type=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"verticalCenter",{get:function(){return this.m_verticalCenter},set:function(e){te(this.changeTracker,this.m_verticalCenter,e),this.m_verticalCenter=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"thickness",{get:function(){return this.m_thickness},set:function(e){te(this.changeTracker,this.m_thickness,e),this.m_thickness=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"style",{get:function(){return this.m_style},set:function(e){this.changeTracker.replaceListener(this.m_style,e),this.m_style=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"changeTracker",{get:function(){return this.m_changeTracker},enumerable:!1,configurable:!0}),e}(),We=function(){function e(e,t,r){void 0===r&&(r=!1),this.m_changeTracker=new O,this.m_animationTransform=t,this.m_isHidden=r,this.fade=e}return e.prototype.clone=function(){return new e(this.m_fade?this.m_fade.clone():void 0,this.m_animationTransform)},e.prototype.equals=function(e){return(this.m_fade==e.m_fade||null!=this.m_fade&&null!=e.m_fade&&this.m_fade.equals(e.m_fade))&&(this.m_animationTransform==e.m_animationTransform||null!=this.m_animationTransform&&null!=e.m_animationTransform&&this.m_animationTransform.equals(e.m_animationTransform))&&this.m_isHidden==e.m_isHidden},Object.defineProperty(e.prototype,"fade",{get:function(){return this.m_fade},set:function(e){this.m_changeTracker.replaceListener(this.m_fade,e),this.m_fade=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"animationTransform",{get:function(){return this.m_animationTransform},set:function(e){re(this.m_changeTracker,this.m_animationTransform,e),this.m_animationTransform=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isHidden",{get:function(){return!!this.m_isHidden},set:function(e){e!=this.isHidden&&(this.m_changeTracker.notifyChange(),this.m_isHidden=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"changeTracker",{get:function(){return this.m_changeTracker},enumerable:!1,configurable:!0}),e}(),He=new v(0,-1,0,1,0,0,0,0,1),je=function(){function e(e,t,r,i,n,o){this.lineRect=e,this.path=t,this.alignment=r,this.scale=i,this.pivot=n,this.isVerticalLayout=o,this.pathLength=t.measureLength(),this.equivalentWarpingEnvelope=this.calculateEquivalentWarpingEnvelope()}return e.prototype.equals=function(e){return this.lineRect.equals(e.lineRect)&&this.path==e.path&&this.alignment==e.alignment&&this.scale==e.scale&&this.pivot==e.pivot&&this.isVerticalLayout==e.isVerticalLayout},e.prototype.getPathPosition=function(e){var t=this.isVerticalLayout?e.transformedBounds(He):e,r=this.isVerticalLayout?this.lineRect.transformedBounds(He):this.lineRect;if(t&&r){var i=r.width,n=0;if(i*this.scale<this.pathLength){var o=this.pathLength-i*this.scale;n=this.alignment*(o/this.pathLength)}var s=(t.left-r.left)*this.scale/this.pathLength+n;return(s+(s+t.width/this.pathLength*this.scale))/2}},e.prototype.getTransform=function(e){var t=this.getPathPosition(e),r=this.isVerticalLayout?e.transformedBounds(He):e;if(t&&r){var i=x(t,0,1)*this.pathLength,n=this.path.getPointFromDist(i),o=this.path.getTangentFromDist(i);if(o){var s=(r.left+r.right)/2,a=r.top+r.height*this.pivot,l=v.Translation2D(new g(-s,-a));l=l.multiply(v.Scale2D(new g(this.scale,this.scale)));var h=o.x,c=o.y;return l=(l=l.multiply(new v(h,c,0,-c,h,0,0,0,1))).multiply(v.Translation2D(n)),this.isVerticalLayout&&(l=He.multiply(l)),l}}},e.prototype.calculateEquivalentWarpingEnvelope=function(){for(var e=new W,t=new W,r=this.isVerticalLayout?0:this.lineRect.height/2,i=this.isVerticalLayout?this.lineRect.top:this.lineRect.left,n=this.isVerticalLayout?this.lineRect.bottom:this.lineRect.right,o=this.lineRect,s=0;s<=1;s+=.00390625){var a=i+(n-i)*s,l=this.isVerticalLayout?new _(this.lineRect.right,a-r,this.lineRect.left,a+r):new _(a-r,this.lineRect.top,a+r,this.lineRect.bottom),h=this.getPathPosition(l);if(null!=h&&h>=0&&h<=1){var c=a+(2*s-1)*r,u=this.getTransform(l);if(u){var d=u.transformPoint(this.isVerticalLayout?new g(l.left,c):new g(c,l.top)),p=u.transformPoint(this.isVerticalLayout?new g(l.right,c):new g(c,l.bottom));0==e.getPointCount()?(e.moveToPoint(d),t.moveToPoint(p),o=new _(this.isVerticalLayout?o.left:c,this.isVerticalLayout?c:o.top,o.right,o.bottom)):(e.lineToPoint(d),t.lineToPoint(p),o=new _(o.left,o.top,this.isVerticalLayout?o.right:c,this.isVerticalLayout?c:o.bottom))}}}return new Xe(o,e.createFigure(),t.createFigure(),this.isVerticalLayout)},e}(),qe=function(){function e(e){this.currentX=0,this.currentY=0,this.m_samplesX=new Float32Array(257),this.m_samplesY=new Float32Array(257);for(var t=e.measureLength(),r=0;r<=Ue;r++){var i=e.getPointFromDist(t*r/Ue);this.m_samplesX[r]=i.x,this.m_samplesY[r]=i.y}}return e.prototype.moveTo=function(e){var t=Math.floor(e*Ue),r=Math.min(t+1,Ue),i=e*Ue-t;this.currentX=this.m_samplesX[t]*(1-i)+this.m_samplesX[r]*i,this.currentY=this.m_samplesY[t]*(1-i)+this.m_samplesY[r]*i},e.prototype.equals=function(e){for(var t=0;t<=Ue;t++)if(this.m_samplesX[t]!=e.m_samplesX[t]||this.m_samplesY[t]!=e.m_samplesY[t])return!1;return!0},e}(),Xe=function(){function e(e,t,r,i){void 0===i&&(i=!1),this.sourceRect=e,this.topPath=t,this.bottomPath=r,this.isVerticalLayout=i,this.topCurve=new qe(t),this.bottomCurve=new qe(r)}return e.prototype.equals=function(e){return this.sourceRect.equals(e.sourceRect)&&this.topCurve.equals(e.topCurve)&&this.bottomCurve.equals(e.bottomCurve)&&this.isVerticalLayout==e.isVerticalLayout},e.prototype.warpPoint=function(e){var t=x(this.isVerticalLayout?(e.y-this.sourceRect.top)/this.sourceRect.height:(e.x-this.sourceRect.left)/this.sourceRect.width,0,1),r=x(this.isVerticalLayout?1-(e.x-this.sourceRect.left)/this.sourceRect.width:(e.y-this.sourceRect.top)/this.sourceRect.height,0,1);return this.topCurve.moveTo(t),this.bottomCurve.moveTo(t),new g(C(this.topCurve.currentX,this.bottomCurve.currentX,r),C(this.topCurve.currentY,this.bottomCurve.currentY,r))},e.prototype.warpPath=function(e){for(var t=this,r=[],i=Math.max(this.sourceRect.width)/4,n=v.FromTransforms(e.transform),o=function(e){if(e.getPointCount()>0){var o=new W;o.moveToPoint(s.warpPoint(e.getPoint(0).transformPoint(n))),e.forEachSegment((function(e,r,s){for(var a=r||g.InterpolateLinear(e,s,.5),l=i>0?Math.max(1,Math.ceil(Math.abs(s.x-e.x)/i)):1,h=0;h<l;h++){var c=t.warpPoint(g.InterpolateQuadratic(e,a,s,h/l).transformPoint(n)),u=t.warpPoint(g.InterpolateQuadratic(e,a,s,(h+.5)/l).transformPoint(n)),d=t.warpPoint(g.InterpolateQuadratic(e,a,s,(h+1)/l).transformPoint(n)),p=u.add(u.subtract(g.InterpolateLinear(c,d,.5)));o.quadBezierToPoint(p,d)}return!0})),e.isClosed&&o.close(),r.push(o.createFigure())}},s=this,a=0,l=e.figures;a<l.length;a++)o(l[a]);return new N({figures:r,fillMode:e.fillMode,lineEnabled:e.lineEnabled,extrusionEnabled:e.extrusionEnabled,transform:void 0})},e}(),Ke=function(){function e(e,t,r){this.image=e,this.rect=t,this.transform=r}return e.prototype.equals=function(e){return this.image==e.image&&this.rect==e.rect},e}(),Ye=function(){function e(e,t,r,i,n,o){this.layoutBounds=e,this.paths=t instanceof Array?t.slice(0):t,this.outlinePath=o instanceof Array?o.slice(0):o,this.forceWarping=r,this.isWhiteSpace=i,this.textImage=n}return e.prototype.equals=function(e){if(!this.layoutBounds.equals(e.layoutBounds))return!1;if(!this.paths&&!e.paths)return!0;if(this.paths instanceof N&&e.paths instanceof N)return this.paths.equals(e.paths);if(this.paths instanceof Array&&e.paths instanceof Array){if(this.paths.length!=e.paths.length)return!1;for(var t=0;t<this.paths.length;t++)if(!this.paths[t].equals(e.paths[t]))return!1;return!0}return!this.paths&&!e.paths},e.prototype.getTranslatedCopy=function(t){var r=void 0;if(this.paths instanceof N)r=new N(this.paths,this.paths.transform.applyTranslationAfter(t));else if(this.paths){r=new Array(this.paths.length);for(var i=0;i<this.paths.length;i++)r[i]=new N(this.paths[i],this.paths[i].transform.applyTranslationAfter(t))}return new e(this.layoutBounds.translate(t),r,this.forceWarping)},e}(),$e=function(){function e(e,t,r,i){this.m_changeTracker=new O,this.m_character=e,this.style=t,this.effects=r,this.strokes=i}return e.prototype.clone=function(){var t=new e(this.m_character,this.m_style?this.m_style.clone():void 0,this.m_effects?this.m_effects.clone():void 0);if(this.m_strokes){t.m_strokes=new k;for(var r=0,i=this.m_strokes.elements;r<i.length;r++){var n=i[r];t.m_strokes.push(n.clone())}}return t},Object.defineProperty(e.prototype,"character",{get:function(){return this.m_character},set:function(e){this.m_character.equals(e)||(this.m_changeTracker.notifyChange(),this.m_character=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"style",{get:function(){return this.m_style},set:function(e){this.m_changeTracker.replaceListener(this.m_style,e),this.m_style=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"effects",{get:function(){return this.m_effects},set:function(e){this.m_changeTracker.replaceListener(this.m_effects,e),this.m_effects=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"strokes",{get:function(){return this.m_strokes},set:function(e){this.m_changeTracker.replaceListener(this.m_strokes,e),this.m_strokes=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"changeTracker",{get:function(){return this.m_changeTracker},enumerable:!1,configurable:!0}),e.prototype.equals=function(e){return!!this.m_character.equals(e.m_character)&&this.m_style==e.m_style&&this.m_effects==e.effects&&this.m_strokes==e.m_strokes},e}(),Ze=function(){function e(e,t,r){this.ascent=e,this.descent=t,this.fontHeightInPoints=r}return e.prototype.equals=function(e){return this.ascent==e.ascent&&this.descent==e.descent&&this.fontHeightInPoints==e.fontHeightInPoints},e}(),Je=function(){function e(e,t){this.m_changeTracker=new O,this.m_characters=[],this.m_localRange=e,this.m_layoutBounds=t,this.m_fillBounds=t,this.m_offset=g.Zero}return e.prototype.clone=function(){for(var t=new e(this.m_localRange,this.m_layoutBounds),r=0,i=this.m_characters;r<i.length;r++){var n=i[r];t.addCharacter(n)}return t.m_offset=this.m_offset,t.m_fillBounds=this.m_fillBounds,t.m_textEffectMetrics=this.m_textEffectMetrics,t.bender=this.m_bender,t},Object.defineProperty(e.prototype,"characters",{get:function(){return this.m_characters},set:function(e){ie(this.m_changeTracker,this.m_characters,e),this.m_characters=e.slice(0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"localRange",{get:function(){return this.m_localRange},set:function(e){re(this.m_changeTracker,this.m_localRange,e),this.m_localRange=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"offset",{get:function(){return this.m_offset},set:function(e){re(this.m_changeTracker,this.m_offset,e),this.m_offset=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"layoutBounds",{get:function(){return this.m_layoutBounds},set:function(e){re(this.m_changeTracker,this.m_layoutBounds,e),this.m_layoutBounds=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fillBounds",{get:function(){return this.m_fillBounds},set:function(e){re(this.m_changeTracker,this.m_fillBounds,e),this.m_fillBounds=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textEffectMetrics",{get:function(){return this.m_textEffectMetrics},set:function(e){re(this.m_changeTracker,this.m_textEffectMetrics,e),this.m_textEffectMetrics=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bender",{get:function(){return this.m_bender},set:function(e){this.bender==e||this.bender instanceof je&&e instanceof je&&this.bender.equals(e)||this.bender instanceof Xe&&e instanceof Xe&&this.bender.equals(e)||(this.m_changeTracker.notifyChange(),this.m_bender=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"changeTracker",{get:function(){return this.m_changeTracker},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"flowDirection",{get:function(){return 0==this.m_characters.length?0:Math.sign(this.m_characters[this.m_characters.length-1].layoutBounds.left-this.m_characters[0].layoutBounds.left)},enumerable:!1,configurable:!0}),e.prototype.removeAllCharacters=function(){this.characters=[]},e.prototype.addCharacter=function(e){this.m_changeTracker.notifyChange(),this.m_characters.push(e)},e}(),Qe=function(){function e(e,t){this.m_lines=[],this.m_localWordRanges=[],this.m_changeTracker=new O,this.m_globalRange=e,this.m_stylePerLocalRange=new Ge(t),this.m_effectsPerLocalRange=new Ge(new we),this.m_strokesPerLocalRange=new Ge(new k),this.m_changeTracker.replaceListener(void 0,this.m_stylePerLocalRange),this.m_offset=g.Zero}return e.prototype.clone=function(){for(var t=new e(this.m_globalRange,this.m_stylePerLocalRange.defaultData),r=0,i=this.m_lines;r<i.length;r++){var n=i[r];t.addLine(n.clone())}t.m_offset=this.m_offset,t.bullet=this.m_bullet?this.m_bullet.clone():void 0;for(var o=0,s=this.m_stylePerLocalRange.ranges;o<s.length;o++){var a=s[o];t.m_stylePerLocalRange.set(this.m_stylePerLocalRange.getAt(a.start).clone(),a)}t.m_effectsPerLocalRange.defaultData=this.m_effectsPerLocalRange.defaultData;for(var l=0,h=this.m_effectsPerLocalRange.ranges;l<h.length;l++){var c=h[l];t.m_effectsPerLocalRange.set(this.m_effectsPerLocalRange.getAt(c.start).clone(),c)}t.m_strokesPerLocalRange.defaultData=this.m_strokesPerLocalRange.defaultData;for(var u=0,d=this.m_strokesPerLocalRange.ranges;u<d.length;u++){for(var p=d[u],f=this.m_strokesPerLocalRange.getAt(p.start),g=new k,m=0,v=f.elements;m<v.length;m++){var y=v[m];g.push(y.clone())}t.m_strokesPerLocalRange.set(g,p)}return t.m_localWordRanges=this.m_localWordRanges.slice(0),t},Object.defineProperty(e.prototype,"lines",{get:function(){return this.m_lines},set:function(e){this.removeAllLines();for(var t=0,r=e;t<r.length;t++){var i=r[t];this.addLine(i)}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stylePerLocalRange",{get:function(){return this.m_stylePerLocalRange},set:function(e){this.m_changeTracker.replaceListener(this.m_stylePerLocalRange,e),this.m_stylePerLocalRange=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"effectsPerLocalRange",{get:function(){return this.m_effectsPerLocalRange},set:function(e){this.m_changeTracker.replaceListener(this.m_effectsPerLocalRange,e),this.m_effectsPerLocalRange=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"strokesPerLocalRange",{get:function(){return this.m_strokesPerLocalRange},set:function(e){this.m_changeTracker.replaceListener(this.m_strokesPerLocalRange,e),this.m_strokesPerLocalRange=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"globalRange",{get:function(){return this.m_globalRange},set:function(e){this.m_globalRange.equals(e)||(this.m_changeTracker.notifyChange(),this.m_globalRange=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"offset",{get:function(){return this.m_offset},set:function(e){re(this.m_changeTracker,this.m_offset,e),this.m_offset=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bullet",{get:function(){return this.m_bullet},set:function(e){this.m_changeTracker.replaceListener(this.m_bullet,e),this.m_bullet=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"localWordRanges",{get:function(){return this.m_localWordRanges},set:function(e){ie(this.m_changeTracker,this.m_localWordRanges,e),this.m_localWordRanges=e.slice(0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"changeTracker",{get:function(){return this.m_changeTracker},enumerable:!1,configurable:!0}),e.prototype.removeAllLocalWordRanges=function(){this.localWordRanges=[]},e.prototype.addLocalWordRange=function(e){this.m_changeTracker.notifyChange(),this.m_localWordRanges.push(e)},e.prototype.removeAllLines=function(){for(var e=0,t=this.m_lines;e<t.length;e++){var r=t[e];O.RemoveListener(r.changeTracker,this.m_changeTracker)}this.m_lines=[]},e.prototype.addLine=function(e){O.AddListener(e.changeTracker,this.m_changeTracker),this.m_lines.push(e)},e}(),et=(function(){function e(e,t,r,i){this.m_isAnchoredToPrevious=!1,this.m_changeTracker=new O,this.m_changeTracker.replaceListener(void 0,t),this.m_range=e,this.m_style=t,this.m_caretWidth=r,this.m_isAnchoredToPrevious=i}e.CreateCaret=function(t,r,i,n){return new e(new Ne(t,0),n||new fe(new ae(ne.White),void 0,new pe,2),r,i)},e.CreateRangeSelection=function(t,r){return new e(t,r,0,!1)},e.prototype.clone=function(){return new e(this.m_range,this.m_style.clone(),this.m_caretWidth,this.m_isAnchoredToPrevious)},Object.defineProperty(e.prototype,"range",{get:function(){return this.m_range},set:function(e){this.m_range.equals(e)||(this.m_changeTracker.notifyChange(),this.m_range=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"style",{get:function(){return this.m_style},set:function(e){this.m_changeTracker.replaceListener(this.m_style,e),this.m_style=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"caretWidth",{get:function(){return this.m_caretWidth},set:function(e){te(this.m_changeTracker,this.m_caretWidth,e),this.m_caretWidth=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isAnchoredToPrevious",{get:function(){return this.m_isAnchoredToPrevious},set:function(e){te(this.m_changeTracker,this.m_isAnchoredToPrevious,e),this.m_isAnchoredToPrevious=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"changeTracker",{get:function(){return this.m_changeTracker},enumerable:!1,configurable:!0})}(),function(){function e(){this.m_paragraphs=[],this.m_changeTracker=new O,this.m_animationChangeTracker=new O,this.m_selectionChangeTracker=new O,this.m_layoutToFrame=y.Identity,this.m_frameToShape=y.Identity,this.m_renderMode=0}return e.prototype.clone=function(){for(var t=new e,r=0,i=this.m_paragraphs;r<i.length;r++){var n=i[r];t.addParagraph(n.clone())}if(t.m_layoutToFrame=this.m_layoutToFrame,t.m_frameToShape=this.m_frameToShape,this.m_animationProps){t.m_animationProps=new Ge(new We),t.m_animationProps.defaultData=this.m_animationProps.defaultData;for(var o=0,s=this.m_animationProps.ranges;o<s.length;o++){var a=s[o];t.m_animationProps.set(this.m_animationProps.getAt(a.start).clone(),a)}}if(this.m_selectionHighlights){t.m_selectionHighlights=[];for(var l=0,h=this.m_selectionHighlights;l<h.length;l++){var c=h[l];t.m_selectionHighlights.push(c.clone())}}return t},e.prototype.createAnimationProps=function(){this.animationProps=new Ge(new We)},e.prototype.hasAnimationProps=function(){return!!this.animationProps},Object.defineProperty(e.prototype,"paragraphs",{get:function(){return this.m_paragraphs},set:function(e){if(this.m_paragraphs!=e){this.removeAllParagraphs();for(var t=0,r=e;t<r.length;t++){var i=r[t];this.addParagraph(i)}}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"layoutToFrame",{get:function(){return this.m_layoutToFrame},set:function(e){re(this.m_changeTracker,this.m_layoutToFrame,e),this.m_layoutToFrame=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"frameToShape",{get:function(){return this.m_frameToShape},set:function(e){re(this.m_changeTracker,this.m_frameToShape,e),this.m_frameToShape=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"animationProps",{get:function(){return this.m_animationProps},set:function(e){this.m_animationProps!=e&&(this.m_animationProps&&(O.RemoveListener(this.m_animationProps.changeTracker,this.m_animationChangeTracker),O.RemoveListener(this.m_animationProps.rangeChangeTracker,this.m_changeTracker)),e&&(O.AddListener(e.changeTracker,this.m_animationChangeTracker),O.AddListener(e.rangeChangeTracker,this.m_changeTracker)),this.m_animationProps=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selectionHighlights",{get:function(){return this.m_selectionHighlights},set:function(e){!function(e,t,r){if(t!=r)if(t&&r&&t.length==r.length){for(var i=0;i<t.length;i++)if(t[i]!=r[i])return void e.notifyChange()}else e.notifyChange()}(this.m_selectionChangeTracker,this.m_selectionHighlights,e),this.m_selectionHighlights=e?e.slice(0):void 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"clipBounds",{get:function(){return this.m_clipBounds},set:function(e){re(this.m_changeTracker,this.m_clipBounds,e),this.m_clipBounds=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"applyEffectsPerCharacter",{get:function(){return!!this.m_applyEffectsPerCharacter},set:function(e){te(this.m_changeTracker,!!this.m_applyEffectsPerCharacter,e),this.m_applyEffectsPerCharacter=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"changeTracker",{get:function(){return this.m_changeTracker},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"animationChangeTracker",{get:function(){return this.m_animationChangeTracker},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textVersion",{get:function(){return this.m_changeTracker.version},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selectionVersion",{get:function(){return this.m_selectionChangeTracker.version},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"renderMode",{get:function(){return this.m_renderMode},set:function(e){te(this.m_changeTracker,this.m_renderMode,e),this.m_renderMode=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"linesCutoutMargin",{get:function(){return this.m_linesCutoutMargin||g.Zero},set:function(e){re(this.m_changeTracker,this.m_linesCutoutMargin,e),this.m_linesCutoutMargin=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"spreadFill",{get:function(){return!!this.m_spreadFill},set:function(e){te(this.m_changeTracker,!!this.m_spreadFill,e),this.m_spreadFill=e},enumerable:!1,configurable:!0}),e.prototype.forceSplit=function(e){(!this.m_explicitTextSplit||e>this.m_explicitTextSplit)&&(this.m_changeTracker.notifyChange(),this.m_explicitTextSplit=e)},e.prototype.removeAllParagraphs=function(){for(var e=0,t=this.m_paragraphs;e<t.length;e++){var r=t[e];O.RemoveListener(r.changeTracker,this.m_changeTracker)}this.m_paragraphs=[]},e.prototype.addParagraph=function(e){O.AddListener(e.changeTracker,this.m_changeTracker),this.m_paragraphs.push(e)},e.prototype.removeParagraph=function(e){O.RemoveListener(this.m_paragraphs[e].changeTracker,this.m_changeTracker),this.m_paragraphs.splice(e)},e.prototype.getFullRange=function(){return this.paragraphs.length<1?void 0:Ne.FromFirstLast(this.paragraphs[0].globalRange.start,this.paragraphs[this.paragraphs.length-1].globalRange.last)},e.prototype.getRunRanges=function(){var e=this.getFullRange();if(e){for(var t=[],r=0,i=this.paragraphs;r<i.length;r++){var n=i[r];if(2==this.m_explicitTextSplit||this.applyEffectsPerCharacter)for(var o=n.globalRange.start;o<=n.globalRange.last;o++)tt(t,o);else{for(var s=n.globalRange.start,a=0,l=n.lines;a<l.length;a++){var h=l[a];tt(t,s+h.localRange.start),tt(t,s+h.localRange.last+1)}for(var c=0,u=n.stylePerLocalRange.ranges;c<u.length;c++){var d=u[c];tt(t,s+d.start),tt(t,s+d.last+1)}for(var p=0,f=n.effectsPerLocalRange.ranges;p<f.length;p++)d=f[p],tt(t,s+d.start),tt(t,s+d.last+1);for(var g=0,m=n.strokesPerLocalRange.ranges;g<m.length;g++)d=m[g],tt(t,s+d.start),tt(t,s+d.last+1);if(1==this.m_explicitTextSplit)for(var v=0,y=n.localWordRanges;v<y.length;v++)d=y[v],tt(t,s+d.start),tt(t,s+d.last+1)}}if(this.animationProps)for(var _=function(e){t.some((function(t){return t==e.start}))||t.push(e.start),t.some((function(t){return t==e.last+1}))||t.push(e.last+1)},b=0,T=this.animationProps.ranges;b<T.length;b++)_(T[b]);return rt(t,e)}return[]},e.prototype.getAnimatablePartRanges=function(e,t,r){var i=t||this.getFullRange();if(i&&0!=i.length){if(t&&r){if(t.start<0||t.start>=this.paragraphs.length||t.last<0||t.last>=this.paragraphs.length)return void M.Error(592525336,"bad paragraph range");i=Ne.FromFirstLast(this.paragraphs[t.start].globalRange.start,this.paragraphs[t.last].globalRange.last)}if(0==e)return i?[i]:void 0;for(var n=[],o=0,s=this.paragraphs;o<s.length;o++){for(var a=s[o],l=a.globalRange.start,h=0,c=a.lines;h<c.length;h++){var u=c[h];if(tt(n,l+u.localRange.start),tt(n,l+u.localRange.last+1),2==e)for(var d=l+u.localRange.start,p=!1,f=0;f<u.characters.length;f++)p||tt(n,d+f),p=1==u.characters[f].isWhiteSpace}if(1==e)for(var g=0,m=a.localWordRanges;g<m.length;g++)tt(n,l+m[g].start)}return rt(n,i)}},e.prototype.getTextPathsForCharacter=function(e,t,r,i){for(var n=[],o=i&&e.outlinePath?e.outlinePath:e.paths,s=0,a=o instanceof N?[o]:null!=o?o:[];s<a.length;s++){var l=a[s];if(l.figures.length>0){var h=v.Translation2D(t).multiply(this.layoutToFrame.toMatrix3()),c=l.transform.toMatrix3().multiply(h).tryGetTransform(l.transform.preTranslation);if(!c)throw M.Error(592525337,"unexpected transform");var u=new N(l,c),d=r instanceof Xe?r:void 0;if(r instanceof je){var p=e.layoutBounds.isEmpty()?void 0:e.layoutBounds.transformedBounds(h);if(e.forceWarping||!p)d=r.equivalentWarpingEnvelope;else{var f=r.getTransform(p);f&&(u=(c=c.toMatrix3().multiply(f.toMatrix3()).tryGetTransform(l.transform.preTranslation))?new N(l,c):void 0)}}d&&u&&(u=d.warpPath(u)),u&&n.push(u)}}return n},e.prototype.getTextPathsForRange=function(e,t){for(var r=[],i=0,n=this.paragraphs;i<n.length;i++){var o=n[i];if(o.globalRange.intersects(e))for(var s=0,a=o.lines;s<a.length;s++){var l=a[s],h=new Ne(0,l.characters.length).getIntersection(e.move(-o.globalRange.start-l.localRange.start));if(h)for(var c=h.start;c<=h.last;c++){var u=this.getTextPathsForCharacter(l.characters[c],l.offset.add(o.offset),l.bender,t);r.push.apply(r,u)}}}return r},e.prototype.getLineAndParagraphAt=function(e){for(var t=0,r=this.paragraphs;t<r.length;t++){var i=r[t];if(i.globalRange.includes(e))for(var n=e-i.globalRange.start,o=0,s=i.lines;o<s.length;o++){var a=s[o];if(a.localRange.includes(n))return{line:a,paragraph:i}}}},e.prototype.getStyleAt=function(e){for(var t=0,r=this.paragraphs;t<r.length;t++){var i=r[t];if(i.globalRange.includes(e))return i.stylePerLocalRange.getAt(e-i.globalRange.start)}},e.prototype.getEffetcsAt=function(e){for(var t=0,r=this.paragraphs;t<r.length;t++){var i=r[t];if(i.globalRange.includes(e))return i.effectsPerLocalRange.getAt(e-i.globalRange.start)}},e.prototype.getStrokesAt=function(e){for(var t=0,r=this.paragraphs;t<r.length;t++){var i=r[t];if(i.globalRange.includes(e))return i.strokesPerLocalRange.getAt(e-i.globalRange.start)}},e.prototype.getPathFromLayoutRect=function(e,t,r){var i=v.Translation2D(r).multiply(this.layoutToFrame.toMatrix3()).tryGetTransform(g.Zero);if(i){var n=new N({figures:[z.CreateFromRect(e)],transform:i}),o=t.bender instanceof je?t.bender.equivalentWarpingEnvelope:t.bender;return o&&(n=o.warpPath(n)),n}},e.prototype.getSelectionRectPaths=function(e){for(var t=void 0,r=0,i=this.paragraphs;r<i.length;r++)for(var n=i[r],o=e?e.move(-n.globalRange.start):void 0,s=0,a=n.lines;s<a.length;s++){var l=a[s],h=void 0;if(!o||l.characters&&o.intersects(l.localRange))for(var c=0;c<l.characters.length;c++){var u=l.localRange.start+c;(!o||o.start<=u&&u<=o.last)&&(h=_.UnionRect(h,l.characters[c].layoutBounds))}if(h){var d=this.getPathFromLayoutRect(h,l,l.offset.add(n.offset));d&&(t||(t=[]),t.push(d))}}return t},e.prototype.getCutoutLinePath=function(e,t){for(var r=void 0,i=[],n=0,o=this.paragraphs;n<o.length;n++)for(var s=o[n],a=e?e.move(-s.globalRange.start):void 0,l=0,h=s.lines;l<h.length;l++){var c=h[l],u=void 0;if(!a||c.characters&&a.intersects(c.localRange))for(var d=0;d<c.characters.length;d++){var p=c.localRange.start+d;(!a||a.start<=p&&p<=a.last)&&(u=_.UnionRect(u,c.characters[d].layoutBounds))}if(u){var f=c.offset.add(s.offset),g=v.Translation2D(f).multiply(this.layoutToFrame.toMatrix3());u=u.transformedBounds(g)}c.bender&&M.Error(528320162,"LinesCutout currently not supported with Benders."),u&&i.push(new _(u.left-t.x,u.top-t.y,u.right+t.x,u.bottom+t.y))}if(i.length>0){var m=new W;for(m.moveTo(i[0].left,i[0].top),m.lineTo(i[0].right,i[0].top),d=0;d<i.length-1;d++){var y=i[d].right,b=i[d+1].right,T=y>b?i[d].bottom:i[d+1].top;m.lineTo(y,T),m.lineTo(b,T)}for(m.lineTo(i[i.length-1].right,i[i.length-1].bottom),m.lineTo(i[i.length-1].left,i[i.length-1].bottom),d=i.length-1;d>0;d--){var w=i[d].left,x=i[d-1].left;T=w<x?i[d].top:i[d-1].bottom,m.lineTo(w,T),m.lineTo(x,T)}m.close(),r=[N.CreateFromFigure(m.createFigure())]}return r},e.prototype.getBoundsOfRange=function(e,t,r){if(void 0===r&&(r=!1),!r||!this.animationProps)return this.getBoundsOfRangeStatic(e,t);var i=this.getFullRange();if(i){for(var n=[],o=0,s=this.animationProps.ranges;o<s.length;o++)tt(n,(c=s[o]).start),tt(n,c.last+1);for(var a,l=0,h=rt(n,i);l<h.length;l++){var c=h[l],u=this.animationProps.getAt(c.start).animationTransform,d=t&&u?t.toMatrix3().multiply(u):t||u;a=_.UnionRect(a,this.getBoundsOfRangeStatic(c,d))}return a}},e.prototype.getBoundsOfRangeStatic=function(e,t){for(var r,i=t?this.frameToShape.toMatrix3().multiply(t.toMatrix3()):this.frameToShape,n=this.getSelectionRectPaths(e),o=0,s=this.paragraphs;o<s.length;o++){var a=s[o];a.bullet&&a.lines.length>0&&(!e||e.includes(a.globalRange.start))&&(c=this.getPathFromLayoutRect(a.bullet.character.layoutBounds,a.lines[0],a.offset))&&(n=n?n.concat(c):[c])}for(var l=0,h=n||[];l<h.length;l++){var c;(c=h[l]).untransformedBounds&&(r=_.UnionRect(r,c.untransformedBounds.transformedBounds(c.transform.toMatrix3().multiply(i.toMatrix3()))))}return r},e.prototype.getSelectionLayoutCaretPath=function(e,t,r){for(var i=0,n=this.paragraphs;i<n.length;i++)for(var o=n[i],s=e-o.globalRange.start,a=0,l=o.lines;a<l.length;a++){var h=l[a];h.localRange.length!=h.characters.length&&M.Error(592525338,"character count mismatch");var c=s-h.localRange.start,u=void 0;if(0<=c&&c<h.characters.length){var d=h.characters[c].layoutBounds,p=h.flowDirection>0?d.left:d.right;u=new _(p-.5*t,d.top,p+.5*t,d.bottom)}else 0==c&&0==h.characters.length?(p=h.flowDirection>0?h.layoutBounds.left:h.layoutBounds.right,u=new _(p-.5*t,h.layoutBounds.top,p+.5*t,h.layoutBounds.bottom)):r&&s==h.localRange.last+1&&(d=h.characters[h.characters.length-1].layoutBounds,p=h.flowDirection>0?d.right:d.left,u=new _(p-.5*t,d.top,p+.5*t,d.bottom));if(u)return this.getPathFromLayoutRect(u,h,h.offset.add(o.offset))}},e.prototype.getLineAndParagraphFromLayoutPosition=function(e){for(var t=void 0,r=void 0,i=0,n=this.paragraphs;i<n.length;i++)for(var o=n[i],s=0,a=o.lines;s<a.length;s++){var l=a[s];if(e.subtract(o.offset).subtract(l.offset).y<l.layoutBounds.bottom)return{paragraph:o,line:l};t=l,r=o}return{paragraph:r,line:t}},e.prototype.getSelectionFromLayoutPosition=function(e){var t=this.getLineAndParagraphFromLayoutPosition(e);if(t.paragraph&&t.line&&t.line.characters){for(var r=e.subtract(t.paragraph.offset).subtract(t.line.offset),i=0;i<t.line.characters.length;i++)if(r.x<(t.line.characters[i].layoutBounds.right+t.line.characters[i].layoutBounds.left)/2)return{characterIndex:t.paragraph.globalRange.start+t.line.localRange.start+i,isAnchoredToPrevious:!1};return{characterIndex:t.paragraph.globalRange.start+t.line.localRange.last+1,isAnchoredToPrevious:!0}}},e.prototype.hitTest=function(e){for(var t=0,r=this.paragraphs;t<r.length;t++)for(var i=r[t],n=0,o=i.lines||[];n<o.length;n++){var s=o[n],a=e.subtract(i.offset).subtract(s.offset);if(s.layoutBounds.isPointInRect(a))return!0}return!1},e.prototype.getBrushImages=function(){for(var e=[],t=0,r=this.paragraphs;t<r.length;t++){var i=r[t];i.bullet&&i.bullet.style&&e.push.apply(e,i.bullet.style.getBrushImages()),i.stylePerLocalRange.allData.forEach((function(t){e.push.apply(e,t.getBrushImages())})),i.strokesPerLocalRange.allData.forEach((function(t){for(var r=0,i=t.elements;r<i.length;r++){var n=i[r];n.style&&e.push.apply(e,n.style.getBrushImages())}}));for(var n=0,o=i.lines;n<o.length;n++)for(var s=0,a=o[n].characters;s<a.length;s++){var l=a[s];l.textImage&&e.push(l.textImage.image)}}return e},e}());function tt(e,t){e.some((function(e){return e==t}))||e.push(t)}function rt(e,t){tt(e,t.start),tt(e,t.last+1),e.sort((function(e,t){return e-t}));for(var r=[],i=0;i<e.length-1;i++){var n=Ne.FromFirstLast(e[i],e[i+1]-1).getIntersection(t);n&&n.length>0&&r.push(n)}return r}var it=function(){function e(){this.textShapes=[],this.hitTestLineShapes=[]}return e.prototype.clearCache=function(){for(var e=0,t=this.textShapes;e<t.length;e++)t[e].clearCache();for(var r=0,i=this.hitTestLineShapes;r<i.length;r++)i[r].clearCache();for(var n=0,o=this.selectionShapes||[];n<o.length;n++)o[n].clearCache()},e.prototype.getTextShapes=function(){return this.textShapes},e.prototype.getSelectionShapes=function(){return this.selectionShapes||[]},e.prototype.initShapeEffectsAndBoundsOverrides=function(e,t,r,i,n,o){if(t.effects=function(e,t,r){if(e){var i=t?t.fontHeightInPoints:0,n=e.clone(),o=0==i?1:i/yt;return n.glow&&(n.glow.radius=at(n.glow.radius,i,ht,ct,ut)/2),n.shadow&&(n.shadow.radius=at(n.shadow.radius,i,dt,pt,ft),n.shadow.distance=at(n.shadow.distance,i,dt,pt,ft)),n.innerShadow&&(n.innerShadow.radius=at(n.innerShadow.radius,i,gt,mt,vt),n.innerShadow.distance=at(n.innerShadow.distance,i,gt,mt,vt)),n.reflection&&(n.reflection.radius*=o,t&&(n.reflection.distance*=0!=t.ascent&&0!=t.descent?i*t.descent/t.ascent/_t:o)),n.softEdges&&(n.softEdges.radius*=o),n.direction=r,n}}(e.getEffetcsAt(n),r?r.textEffectMetrics:void 0,-e.frameToShape.rotation)||new we,!r.bender){if(e.applyEffectsPerCharacter||o){var s=e.getBoundsOfRange(new Ne(n,1));t.effectsBoundsOverride=s,o&&t.style.fillBrush instanceof ce||(t.fillBoundsOverride=s)}else{var a=r.fillBounds.translate(i).transformedBounds(v.FromTransforms(e.layoutToFrame,e.frameToShape));t.effectsBoundsOverride=a,t.fillBoundsOverride=e.spreadFill?e.getBoundsOfRange(void 0):a}t.textEffectMetrics=r.textEffectMetrics}},e.prototype.getTextShape=function(e,t){var r=e.getStyleAt(t.start),i=e.getTextPathsForRange(t,null==r?void 0:r.hasLine),n=new Ce(i,r),o=e.getLineAndParagraphAt(t.start);return o&&this.initShapeEffectsAndBoundsOverrides(e,n,o.line,o.line.offset.add(o.paragraph.offset),t.start,!1),n.role=3,n.textRange=t,n.overlapMode=1,n.transform=e.frameToShape,n},e.prototype.getStrokeShape=function(e,t,r){var i=new Ce(this.getStrokePaths(e,t,r),r.style?r.style:e.getStyleAt(t.start)),n=e.getLineAndParagraphAt(t.start);return n&&this.initShapeEffectsAndBoundsOverrides(e,i,n.line,n.line.offset.add(n.paragraph.offset),t.start,!1),i.role=3,i.textRange=t,i.overlapMode=1,i.transform=e.frameToShape,i},e.prototype.getSelectionHighlightShapes=function(e){if(e.selectionHighlights){for(var t=[],r=0,i=e.selectionHighlights;r<i.length;r++){var n=i[r];if(n.range.length>0){var o=e.getSelectionRectPaths(n.range);o&&t.push(new Ce(o,n.style))}else{var s=e.getSelectionLayoutCaretPath(n.range.start,n.caretWidth,n.isAnchoredToPrevious);s&&t.push(new Ce([s],n.style))}}return t}},e.prototype.update=function(e){var t,r,i,n,o;if(e.textVersion!=this.lastKnownTextVersion){this.lastKnownTextVersion=e.textVersion,this.clearCache(),this.textShapes=[],this.hitTestLineShapes=[];var s=[],a=[];0!=e.renderMode&&(this.cutoutLayerPaths=void 0);for(var l=0,h=e.paragraphs;l<h.length;l++)if((de=h[l]).bullet){var c=e.getLineAndParagraphAt(de.globalRange.start);if(c){for(var u=new Ne(de.globalRange.start,0),d=0,p=de.bullet.strokes?de.bullet.strokes.elements:[];d<p.length;d++)0==(V=p[d]).type?s.push(this.getStrokeShape(e,u,V)):a.push(this.getStrokeShape(e,u,V));var f=e.getTextPathsForCharacter(de.bullet.character,de.offset,de.lines.length>0?de.lines[0].bender:void 0),g=new Ce(f,de.bullet.style?de.bullet.style:e.getStyleAt(u.start));this.initShapeEffectsAndBoundsOverrides(e,g,c.line,c.paragraph.offset,u.start,!0),g.role=3,g.textRange=new Ne(de.globalRange.start,0),g.transform=e.frameToShape,a.push(g)}}for(var m=0,y=e.getSelectionRectPaths(void 0)||[];m<y.length;m++){var b=y[m],T=new Ce([b],new fe(new ae(ne.Black)));T.transform=e.frameToShape,this.hitTestLineShapes.push(T)}for(var w=[],x=0,C=e.getRunRanges();x<C.length;x++){var S=C[x],P=e.getBoundsOfRange(S);if(P&&P.width>2048)for(var E=Math.ceil(P.width/2048),M=0;M<E;M++){var R=Math.floor(S.start+M*S.length/E),A=M==E-1?S.last+1:Math.floor(S.start+(M+1)*S.length/E);R<A&&w.push(Ne.FromFirstLast(R,A-1))}else w.push(S)}for(var I=0,F=w;I<F.length;I++)S=F[I],a.push(this.getTextShape(e,S));for(var B=0,L=w;B<L.length;B++){S=L[B];for(var k=e.getStrokesAt(S.start),O=0,U=k?k.elements:[];O<U.length;O++){var V;0==(V=U[O]).type?s.push(this.getStrokeShape(e,S,V)):a.push(this.getStrokeShape(e,S,V))}}for(var G=0,z=e.paragraphs;G<z.length;G++)for(var W=0,H=(de=z[G]).lines;W<H.length;W++)for(var j=H[W],q=0;q<j.characters.length;q++){var X=j.characters[q];if(X.textImage){var K=Ce.CreateRectangle(X.textImage.rect,new fe(new ce(X.textImage.image)));K.role=3,K.textRange=new Ne(q+j.localRange.start+de.globalRange.start,1),K.transform=X.textImage.transform,a.push(K)}}if(D){for(var Y=0,$=e.paragraphs;Y<$.length;Y++)for(var Z=0,J=(de=$[Y]).lines;Z<J.length;Z++)if((j=J[Z]).bender instanceof Xe){var Q=new Ce([N.CreateFromFigure(j.bender.topPath)],new fe(void 0,new ae(ne.Cyan),new pe(1))),ee=new Ce([N.CreateFromFigure(j.bender.bottomPath)],new fe(void 0,new ae(ne.Magenta),new pe(1)));Q.textRange=ee.textRange=j.localRange.move(de.globalRange.start),Q.transform=e.frameToShape,ee.transform=e.frameToShape,a.push(Q),a.push(ee)}else if(j.bender instanceof je){var te=new Ce([N.CreateFromFigure(j.bender.path)],new fe(void 0,new ae(ne.Yellow),new pe(1)));te.textRange=j.localRange.move(de.globalRange.start),te.transform=e.frameToShape,a.push(te)}for(var re=0,ie=e.getAnimatablePartRanges(2,void 0,!0)||[];re<ie.length;re++){var oe=ie[re],se=e.getBoundsOfRange(oe);if(se){var le=new Ce([N.CreateFromRect(se)],new fe(void 0,new ae(ne.Blue),new pe(1)));le.textRange=oe,a.push(le)}}for(var he=0,ue=e.paragraphs;he<ue.length;he++)for(var de,ge=0,me=(de=ue[he]).lines;ge<me.length;ge++){var ve=(j=me[ge]).fillBounds.translate(j.offset.add(de.offset)).transformedBounds(v.FromTransforms(e.layoutToFrame,e.frameToShape));if(ve&&j.textEffectMetrics){var ye=new _(ve.left,ve.top,ve.right,ve.top+j.textEffectMetrics.ascent),_e=new _(ve.left,ve.bottom-j.textEffectMetrics.descent,ve.right,ve.bottom),be=new Ce([N.CreateFromRect(ye)],new fe(void 0,new ae(ne.Red),new pe(1))),Te=new Ce([N.CreateFromRect(_e)],new fe(void 0,new ae(ne.Green),new pe(1)));be.textRange=j.localRange.move(de.globalRange.start),Te.textRange=j.localRange.move(de.globalRange.start),a.push(be),a.push(Te)}}}(t=this.textShapes).push.apply(t,s),(r=this.textShapes).push.apply(r,a);for(var we=0,xe=this.textShapes;we<xe.length;we++)xe[we].clipBounds=e.clipBounds;if(0!=e.renderMode){if(this.cutoutLayerPaths=[],3==e.renderMode)for(var Se=0,Pe=e.getCutoutLinePath(void 0,e.linesCutoutMargin)||[];Se<Pe.length;Se++)b=Pe[Se],this.cutoutLayerPaths.push(b);for(var Ee=0,Me=s;Ee<Me.length;Ee++){var Re=Me[Ee];(i=this.cutoutLayerPaths).push.apply(i,Re.paths||[])}for(var Ae=0,Ie=a;Ae<Ie.length;Ae++)Re=Ie[Ae],(n=this.cutoutLayerPaths).push.apply(n,Re.paths||[])}}if(e.selectionVersion!=this.lastKnownSelectionVersion){this.lastKnownSelectionVersion=e.selectionVersion;var Fe=this.getSelectionHighlightShapes(e);if(Fe){if(this.selectionShapes=[],new fe(new ae(ne.White)).blendingMode=2,Fe){(o=this.selectionShapes).push.apply(o,Fe);for(var Be=0,Le=this.selectionShapes;Be<Le.length;Be++)Le[Be].transform=e.frameToShape}}else{for(var De=0,ke=this.selectionShapes||[];De<ke.length;De++)ke[De].clearCache();this.selectionShapes=void 0}}},e.prototype.getStrokePaths=function(e,t,r){for(var i=[],n=0,o=e.paragraphs;n<o.length;n++){var s=o[n];if(s.globalRange.intersects(t))for(var a=0,l=s.lines;a<l.length;a++){var h=l[a],c=void 0,u=void 0,d=new Ne(0,h.characters.length).getIntersection(t.move(-s.globalRange.start-h.localRange.start));if(d)for(var p=d.start;p<=d.last;p++){var f=h.characters[p].layoutBounds;f.isEmpty()||(c=null==c?f.left:Math.min(c,f.left),u=null==u?f.right:Math.max(u,f.right))}if(null!=c&&null!=u&&c<u){var m=v.Translation2D(h.offset.add(s.offset)).multiply(e.layoutToFrame.toMatrix3()).tryGetTransform(g.Zero);if(m){var y=new N({figures:st(r,c,u),transform:m}),_=h.bender instanceof je?h.bender.equivalentWarpingEnvelope:h.bender;_&&(y=_.warpPath(y)),i.push(y)}}}}return i},e}();function nt(e,t,r){var i=t.y-r,n=Math.ceil(t.x/(2*i)),o=e.x,s=new W;s.moveTo(o,e.y),s.lineTo(o,e.y+r);for(var a=0;a<n;a++)o+=i,s.lineTo(o,e.y+t.y),o+=i,s.lineTo(o,e.y+r);for(s.lineTo(o,e.y),a=0;a<n;a++)o-=i,s.lineTo(o,e.y+t.y-r),o-=i,s.lineTo(o,e.y);return s.close(),s.createFigure()}function ot(e,t,r,i,n,o){for(var s=[],a=e.x,l=t.y,h=t.y*r,c=t.y*i,u=o?e.y-t.y:e.y,d=o?e.y+t.y/2:e.y+t.y,p=0;a<e.x+t.x;){var f=n&&p%(n+1)!=0?l:h,g=Math.min(a+f,t.x+e.x);s.push(z.CreateFromRect(new _(a,u,g,d))),a+=c+f,p++}return s}function st(e,t,r){var i=new g(t,e.verticalCenter-.5*e.thickness),n=new g(r-t,e.thickness),o=[],s=3==e.type||5==e.type||7==e.type||9==e.type||11==e.type||13==e.type||15==e.type;switch(e.type){case 3:case 1:case 0:s?o.push(z.CreateFromRect(new _(i.x,i.y-n.y,i.x+n.x,i.y+Math.ceil(n.y/2)))):o.push(z.CreateFromRect(new _(i.x,i.y,i.x+n.x,i.y+n.y)));break;case 2:o.push.apply(o,function(e,t,r){var i=[];return i.push(z.CreateFromRect(new _(e.x,e.y-t.y,e.x+t.x,e.y-t.y/2))),i.push(z.CreateFromRect(new _(e.x,e.y+t.y/2,e.x+t.x,e.y+t.y))),i}(i,n));break;case 5:case 4:o.push.apply(o,ot(i,n,1,1,1,s));break;case 7:case 6:o.push.apply(o,ot(i,n,3,2,0,s));break;case 9:case 8:o.push.apply(o,ot(i,n,7,4,0,s));break;case 10:case 11:o.push.apply(o,ot(i,n,3,2,1,s));break;case 12:case 13:o.push.apply(o,ot(i,n,3,2,2,s));break;case 14:case 15:var a=2*n.y,l=1;15==e.type&&(a=Math.floor(Math.max(3,2*n.y)),l=Math.max(2,Math.floor(n.y/2))),o.push(nt(new g(i.x,i.y-Math.ceil(n.y/2)),new g(n.x,a),l));break;case 16:l=1,a=Math.max(2,n.y);var h=i.y-a;o.push(nt(new g(i.x,h),new g(n.x,a),l)),o.push(nt(i,new g(n.x,a),l));break;default:M.Error(591525085,"Unknown stroke type")}return o}function at(e,t,r,i,n){return 0!=t&&n<e?(e-n)*Math.pow(t,i)/Math.pow(r,i)+n:0==t?e:0}var lt,ht=72,ct=.7,ut=1,dt=72,pt=.7,ft=.4,gt=108,mt=1,vt=.001,yt=72,_t=4,bt=[0,1,2,0,3,4],Tt=function(){function e(){this.totalCostMs=0,this.shapeRenderCostMs=0,this.distanceFieldForTextCostMs=0,this.distanceFieldForGlyphTableCostMs=0,this.distanceFieldForShapeCostMs=0,this.patternTextureCostMs=0,this.pathGradientTextureCostMs=0,this.gradientTextureCostMs=0,this.fadeTextureCostMs=0,this.effectsCostMs=0,this.cacheToSpriteCostMs=0,this.drawTapeCostMs=0,this.glResetCostMs=0,this.glRestoreCostMs=0,this.pathCount=0,this.glyphCount=0,this.glyphCountAddedToCache=0,this.glyphCountReadFromCache=0,this.glyphCountRenderedAsPath=0,this.glyphCountLargeText=0,this.glyphCountTextOutline=0,this.pixelCountDistanceField=0,this.pixelCountShapeRender=0,this.shapeLayerCount=0,this.shapeLayerCountText=0,this.dynamicTextureAlloc=0,this.beginTime=0,this.endTime=0}return e.prototype.add=function(e){this.totalCostMs+=e.totalCostMs,this.shapeRenderCostMs+=e.shapeRenderCostMs,this.distanceFieldForTextCostMs+=e.distanceFieldForTextCostMs,this.distanceFieldForGlyphTableCostMs+=e.distanceFieldForGlyphTableCostMs,this.distanceFieldForShapeCostMs+=e.distanceFieldForShapeCostMs,this.patternTextureCostMs+=e.patternTextureCostMs,this.pathGradientTextureCostMs+=e.pathGradientTextureCostMs,this.gradientTextureCostMs+=e.gradientTextureCostMs,this.fadeTextureCostMs+=e.fadeTextureCostMs,this.effectsCostMs+=e.effectsCostMs,this.cacheToSpriteCostMs+=e.cacheToSpriteCostMs,this.drawTapeCostMs+=e.drawTapeCostMs,this.glResetCostMs+=e.glResetCostMs,this.glRestoreCostMs+=e.glRestoreCostMs,this.pathCount+=e.pathCount,this.glyphCount+=e.glyphCount,this.glyphCountAddedToCache+=e.glyphCountAddedToCache,this.glyphCountReadFromCache+=e.glyphCountReadFromCache,this.glyphCountRenderedAsPath+=e.glyphCountRenderedAsPath,this.glyphCountLargeText+=e.glyphCountLargeText,this.glyphCountTextOutline+=e.glyphCountTextOutline,this.pixelCountDistanceField+=e.pixelCountDistanceField,this.pixelCountShapeRender+=e.pixelCountShapeRender,this.shapeLayerCount+=e.shapeLayerCount,this.shapeLayerCountText+=e.shapeLayerCountText,this.dynamicTextureAlloc+=e.dynamicTextureAlloc,this.beginTime=0,this.endTime=0},e}(),wt=function(){this.frameCount=0},xt=function(){this.recreatingSprites=0,this.pictureCropBWTextures=0},Ct=function(){function e(e,t,r,i){void 0===t&&(t=!1),this.initalize(e,t,r,i)}return e.prototype.initalize=function(e,t,r,i){return void 0===t&&(t=!1),this.mask=e,this.skipNextObservers=t,this.target=r,this.currentTarget=i,this},e}(),St=function(e,t,r){void 0===r&&(r=null),this.callback=e,this.mask=t,this.scope=r,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1},Pt=(function(){function e(){}e.prototype.dispose=function(){if(this._observers&&this._observables)for(var e=0;e<this._observers.length;e++)this._observables[e].remove(this._observers[e]);this._observers=null,this._observables=null},e.Watch=function(t,r,i,n){void 0===i&&(i=-1),void 0===n&&(n=null);var o=new e;o._observers=new Array,o._observables=t;for(var s=0,a=t;s<a.length;s++){var l=a[s].add(r,i,!1,n);l&&o._observers.push(l)}return o}}(),function(){function e(e){this._observers=new Array,this._eventState=new Ct(0),e&&(this._onObserverAdded=e)}return Object.defineProperty(e.prototype,"observers",{get:function(){return this._observers},enumerable:!1,configurable:!0}),e.prototype.add=function(e,t,r,i,n){if(void 0===t&&(t=-1),void 0===r&&(r=!1),void 0===i&&(i=null),void 0===n&&(n=!1),!e)return null;var o=new St(e,t,i);return o.unregisterOnNextCall=n,r?this._observers.unshift(o):this._observers.push(o),this._onObserverAdded&&this._onObserverAdded(o),o},e.prototype.addOnce=function(e){return this.add(e,void 0,void 0,void 0,!0)},e.prototype.remove=function(e){return!!e&&-1!==this._observers.indexOf(e)&&(this._deferUnregister(e),!0)},e.prototype.removeCallback=function(e,t){for(var r=0;r<this._observers.length;r++){var i=this._observers[r];if(!(i._willBeUnregistered||i.callback!==e||t&&t!==i.scope))return this._deferUnregister(i),!0}return!1},e.prototype._deferUnregister=function(e){var t=this;e.unregisterOnNextCall=!1,e._willBeUnregistered=!0,setTimeout((function(){t._remove(e)}),0)},e.prototype._remove=function(e){if(!e)return!1;var t=this._observers.indexOf(e);return-1!==t&&(this._observers.splice(t,1),!0)},e.prototype.makeObserverTopPriority=function(e){this._remove(e),this._observers.unshift(e)},e.prototype.makeObserverBottomPriority=function(e){this._remove(e),this._observers.push(e)},e.prototype.notifyObservers=function(e,t,r,i,n){if(void 0===t&&(t=-1),!this._observers.length)return!0;var o=this._eventState;o.mask=t,o.target=r,o.currentTarget=i,o.skipNextObservers=!1,o.lastReturnValue=e,o.userInfo=n;for(var s=0,a=this._observers;s<a.length;s++){var l=a[s];if(!l._willBeUnregistered&&(l.mask&t&&(l.scope?o.lastReturnValue=l.callback.apply(l.scope,[e,o]):o.lastReturnValue=l.callback(e,o),l.unregisterOnNextCall&&this._deferUnregister(l)),o.skipNextObservers))return!1}return!0},e.prototype.notifyObserversWithPromise=function(e,t,r,i,n){var o=this;void 0===t&&(t=-1);var s=Promise.resolve(e);if(!this._observers.length)return s;var a=this._eventState;return a.mask=t,a.target=r,a.currentTarget=i,a.skipNextObservers=!1,a.userInfo=n,this._observers.forEach((function(r){a.skipNextObservers||r._willBeUnregistered||r.mask&t&&(s=r.scope?s.then((function(t){return a.lastReturnValue=t,r.callback.apply(r.scope,[e,a])})):s.then((function(t){return a.lastReturnValue=t,r.callback(e,a)})),r.unregisterOnNextCall&&o._deferUnregister(r))})),s.then((function(){return e}))},e.prototype.notifyObserver=function(e,t,r){void 0===r&&(r=-1);var i=this._eventState;i.mask=r,i.skipNextObservers=!1,e.callback(t,i)},e.prototype.hasObservers=function(){return this._observers.length>0},e.prototype.clear=function(){this._observers=new Array,this._onObserverAdded=null},e.prototype.clone=function(){var t=new e;return t._observers=this._observers.slice(0),t},e.prototype.hasSpecificMask=function(e){void 0===e&&(e=-1);for(var t=0,r=this._observers;t<r.length;t++){var i=r[t];if(i.mask&e||i.mask===e)return!0}return!1},e}()),Et=function(){},Mt=function(){function e(){}return e.WarnImport=function(e){return e+" needs to be imported before as it contains a side-effect required by your code."},e}();!function(e){e[e.Unknown=0]="Unknown",e[e.Url=1]="Url",e[e.Temp=2]="Temp",e[e.Raw=3]="Raw",e[e.Dynamic=4]="Dynamic",e[e.RenderTarget=5]="RenderTarget",e[e.MultiRenderTarget=6]="MultiRenderTarget",e[e.Cube=7]="Cube",e[e.CubeRaw=8]="CubeRaw",e[e.CubePrefiltered=9]="CubePrefiltered",e[e.Raw3D=10]="Raw3D",e[e.Raw2DArray=11]="Raw2DArray",e[e.Depth=12]="Depth",e[e.CubeRawRGBD=13]="CubeRawRGBD"}(lt||(lt={}));var Rt=function(){function e(e,t,r){void 0===r&&(r=!1),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.is2DArray=!1,this.isMultiview=!1,this.url="",this.samplingMode=-1,this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new Pt,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._source=lt.Unknown,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._MSAARenderBuffer=null,this._attachments=null,this._textureArray=null,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._isDisabled=!1,this._compression=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._comparisonFunction=0,this._sphericalPolynomial=null,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._linearSpecularLOD=!1,this._irradianceTexture=null,this._webGLTexture=null,this._references=1,this._gammaSpace=null,this._engine=e,this._source=t,r||(this._webGLTexture=e._createTexture())}return e.prototype.getEngine=function(){return this._engine},Object.defineProperty(e.prototype,"source",{get:function(){return this._source},enumerable:!1,configurable:!0}),e.prototype.incrementReferences=function(){this._references++},e.prototype.updateSize=function(e,t,r){void 0===r&&(r=1),this.width=e,this.height=t,this.depth=r,this.baseWidth=e,this.baseHeight=t,this.baseDepth=r,this._size=e*t*r},e.prototype._rebuild=function(){var t,r,i=this;switch(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedAnisotropicFilteringLevel=null,this.source){case lt.Temp:return;case lt.Url:return void(r=this._engine.createTexture(null!==(t=this._originalUrl)&&void 0!==t?t:this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,(function(){r._swapAndDie(i),i.isReady=!0}),null,this._buffer,void 0,this.format));case lt.Raw:return(r=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case lt.Raw3D:return(r=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case lt.Raw2DArray:return(r=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case lt.Dynamic:return(r=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode))._swapAndDie(this),void this._engine.updateDynamicTexture(this,this._engine.getRenderingCanvas(),this.invertY,void 0,void 0,!0);case lt.RenderTarget:var n=new Et;if(n.generateDepthBuffer=this._generateDepthBuffer,n.generateMipMaps=this.generateMipMaps,n.generateStencilBuffer=this._generateStencilBuffer,n.samplingMode=this.samplingMode,n.type=this.type,this.isCube)r=this._engine.createRenderTargetCubeTexture(this.width,n);else{var o={width:this.width,height:this.height,layers:this.is2DArray?this.depth:void 0};r=this._engine.createRenderTargetTexture(o,n)}return r._swapAndDie(this),void(this.isReady=!0);case lt.Depth:var s={bilinearFiltering:2!==this.samplingMode,comparisonFunction:this._comparisonFunction,generateStencil:this._generateStencilBuffer,isCube:this.isCube},a={width:this.width,height:this.height,layers:this.is2DArray?this.depth:void 0};return(r=this._engine.createDepthStencilTexture(a,s))._swapAndDie(this),void(this.isReady=!0);case lt.Cube:return void(r=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,(function(){r._swapAndDie(i),i.isReady=!0}),null,this.format,this._extension));case lt.CubeRaw:return(r=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case lt.CubeRawRGBD:return r=this._engine.createRawCubeTexture(null,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),void e._UpdateRGBDAsync(r,this._bufferViewArrayArray,this._sphericalPolynomial,this._lodGenerationScale,this._lodGenerationOffset).then((function(){r._swapAndDie(i),i.isReady=!0}));case lt.CubePrefiltered:return void((r=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,(function(e){e&&e._swapAndDie(i),i.isReady=!0}),null,this.format,this._extension))._sphericalPolynomial=this._sphericalPolynomial)}},e.prototype._swapAndDie=function(e){e._webGLTexture=this._webGLTexture,e._isRGBD=this._isRGBD,this._framebuffer&&(e._framebuffer=this._framebuffer),this._depthStencilBuffer&&(e._depthStencilBuffer=this._depthStencilBuffer),e._depthStencilTexture=this._depthStencilTexture,this._lodTextureHigh&&(e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(e._lodTextureLow&&e._lodTextureLow.dispose(),e._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(e._irradianceTexture&&e._irradianceTexture.dispose(),e._irradianceTexture=this._irradianceTexture);var t,r=this._engine.getLoadedTexturesCache();-1!==(t=r.indexOf(this))&&r.splice(t,1),-1===(t=r.indexOf(e))&&r.push(e)},e.prototype.dispose=function(){this._webGLTexture&&(this._references--,0===this._references&&(this._engine._releaseTexture(this),this._webGLTexture=null))},e._UpdateRGBDAsync=function(e,t,r,i,n){throw Mt.WarnImport("environmentTextureTools")},e}(),At=function(){function e(){}return e.load=function(t){e.m_settings=t},e.readBooleanOrDefault=function(t,r){var i=void 0===e.m_settings?"":typeof e.m_settings[t];return"string"===i?"true"===e.m_settings[t].toLowerCase():"boolean"===i?e.m_settings[t]:r},e.readNumberOrDefault=function(t,r){var i=void 0===e.m_settings?"":typeof e.m_settings[t];return"string"===i||"number"===i?Number(e.m_settings[t]):r},e.readStringOrDefault=function(t,r){return void 0===e.m_settings||"string"!=typeof e.m_settings[t]?r:e.m_settings[t]},e}(),It=1,Ft=1,Bt=4096,Lt=4096,Dt=2048,kt=function(){function e(){this.textureMemoryAllocated=0,this.allocatedTextures=[]}return e.prototype.register=function(e){this.textureMemoryAllocated+=e.memoryUsage,this.allocatedTextures.push(e)},e.prototype.unregister=function(e){this.textureMemoryAllocated-=e.memoryUsage,this.allocatedTextures=this.allocatedTextures.filter((function(t){return t!==e}))},e}();function Ot(e){It=Ft=e}var Ut=!0;function Nt(e){Ut=e}function Vt(e,t){return{center:e.center.add(t.preTranslation).multiply(t.scale).rotate(t.rotation).add(t.translation),size:e.size.multiply(t.scale.abs()),rotation:t.rotation,flipX:t.scale.x<0,flipY:t.scale.y<0}}var Gt=function(){function e(t,r,i,n,o,s,a){if(this.m_originalSize=g.Zero,this.m_changeTracker=new O,this.m_compatibleGraphicsProcessorId=0,this.m_usageRecord=[],Xt(o),this.wrapMode=s,this.releasePolicy=a,this.scenario=t,this.creationTime=performance.now(),this.m_lastRenderTime=i?performance.now():void 0,!isFinite(n.x)||!isFinite(n.y)||n.x<=0||n.y<=0){var l=At.readBooleanOrDefault("throwOnInvalidTextureSize",!1),h=M.Error(572319067,"Invalid texture size: "+n.x+" x "+n.y+", scenario: "+t);if(l)throw h}else{var c=n.ceil();if(c.equals(n)||M.Error(572319068,"Bad texture size. Should be positive integers: "+n.x+" x "+n.y+", scenario: "+t),this.m_graphicsProcessor=r.getGraphicsProcessor(),!this.m_graphicsProcessor)throw M.Error(592525214,"Unable to set texture if processor not initialized");if(this.m_originalSize=c,this.m_babylonTexture=i instanceof Rt?i:i?this.m_graphicsProcessor.createTextureGraphicsResourceFromExternalWebGLTexture(c,o,i,void 0):void 0,this.m_compatibleGraphicsProcessorId=this.m_graphicsProcessor.getUniqueGraphicsProcessorId(),this.m_babylonTexture){var u=e.GetRequiredSizeForWrapMode(this.m_graphicsProcessor,c,s);if(4!=s&&!u.equals(c)){if(At.readBooleanOrDefault("noResample",!1))throw M.Error(572303306,"Invalid texture size for non-clamp scenario: ${scenario}");M.Error(572867283,"Texture size not supported for this wrap mode. The texture will be resampled and the copy will be managed by ShapeBuilder. Please conside resampling explicitely using WrapMode.clamp and cloneWithNewWrapMode when necessary. Scenario: "+t);var d=e.ResampleBabylonTexture(r,this.m_babylonTexture,this.originalSize,4,u,s,o);2==this.releasePolicy?this.releasePolicy=0:this.m_babylonTexture.dispose(),this.m_babylonTexture=d}}}var p=r;this.m_textureManager=p.getTextureManager(),this.m_textureManager.register(this)}return e.CreateFromByteBuffer=function(t,r,i,n,o,s,a,l,h){return e.CreateOrUpdateFromByteBuffer(t,void 0,r,i,n,o,s,a,l,h)},e.CreateOrUpdateFromByteBuffer=function(t,r,i,n,o,s,a,l,h,c,u){var d,p,f=r,g=i.getGraphicsProcessor();if(!g)throw M.Error(592525215,"No Graphics Processor");var m=-1==s||-3==s?4:-2==s?5:s;if(!f||f.isValidForGraphicsProcessor(g)&&f.size.equals(n)&&f.m_babylonTexture&&f.format==m&&f.wrapMode==a&&f.m_babylonTexture.invertY==!!h||(f.release(),f=void 0),4==s||5==s||1==s||2==s)return f&&f.m_babylonTexture?(g.updateTextureGraphicsResourceFromByteBuffer(f.m_babylonTexture,o,o instanceof Float32Array),f.changeTracker.notifyChange(),f.m_lastRenderTime=performance.now(),f):new e(t,i,g.createTextureGraphicsResource(n,o,s,o instanceof Float32Array,!1,!1,a,l,!!h),n,s,a,null==c?0:c);if(-1==s||-2==s||-3==s){var v=(null==f?void 0:f.m_textureConverterCache)||{},y=-3==s?1:m,_=-1==s||-2==s;v.primary=e.CreateOrUpdateFromByteBuffer(t+"/primary",v.primary,i,n,o,y,a,l,h,0),v.secondary=-3==s?e.CreateOrUpdateFromByteBuffer(t+"/secondary",v.secondary,i,n.scale(.5),o.slice(n.x*n.y),2,a,l,h,0):void 0;var b=void 0;if(v.primary.m_babylonTexture&&((b=e.ConvertTexture(t,i,f instanceof zt?f:void 0,v.primary,_,v.secondary,m))&&u?b.m_textureConverterCache=v:(null===(d=v.primary)||void 0===d||d.release(),null===(p=v.secondary)||void 0===p||p.release()),b))return b.m_lastRenderTime=performance.now(),b}throw"Unsupported texture format"},e.CreateFromHTMLElement=function(t,r,i,n,o){void 0===n&&(n=4),void 0===o&&(o=!0);var s=r.getGraphicsProcessor();if(!s)throw M.Error(592525216,"No Graphics Processor");var a=new g(i.width,i.height);return new e(t,r,s.createTextureGraphicsResource(a,i,5,!1,!1,!1,n,o,!0),a,5,n,0)},e.CreateFromHTMLImageElement=function(t,r,i,n,o){return void 0===n&&(n=4),void 0===o&&(o=!0),e.CreateFromHTMLElement(t,r,i,n,o)},e.CreateOrUpdateFromHTMLElement=function(t,r,i,n,o,s){void 0===o&&(o=4),void 0===s&&(s=!0);var a=i.getGraphicsProcessor();if(!a)throw"No Graphics Processor";var l=new g(n.width,n.height);if(r){if(r.isValidForGraphicsProcessor(a)&&r.m_babylonTexture&&r.size.equals(l)&&r.wrapMode==o)return a.updateTextureGraphicsResourceFromHTMLElement(r.m_babylonTexture,n,!0),r.changeTracker.notifyChange(),r.m_lastRenderTime=performance.now(),r;r.release()}return e.CreateFromHTMLElement(t,i,n,o,s)},e.CreateFromTextureAndMask=function(e,t,r,i,n,o,s){void 0===o&&(o=4),void 0===s&&(s=!0);var a=t,l=new zt(e,t,n,0,{disableFiltering:!s,wrapMode:o});return a.drawTextureToTexture(l,r,4,i,void 0),l},Object.defineProperty(e.prototype,"graphicsProcessor",{get:function(){return this.m_graphicsProcessor},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this.m_babylonTexture?new g(this.m_babylonTexture.width,this.m_babylonTexture.height):g.Zero},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"originalSize",{get:function(){return this.m_originalSize},set:function(e){this.m_changeTracker.notifyChange(),this.m_originalSize=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"changeTracker",{get:function(){return this.m_changeTracker},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastUsage",{get:function(){return this.m_usageRecord.length>0?Math.max.apply(Math,this.m_usageRecord.map((function(e){return e.lastUsage}))):0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"format",{get:function(){return this.m_babylonTexture?this.m_babylonTexture.format:(M.Error(572073351,"No texture, no format"),5)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"memoryUsage",{get:function(){if(!this.graphicsProcessor)return 0;var e=bt[this.format],t=0,r=0;if(this.m_babylonTexture){switch(this.m_babylonTexture.type){case 0:t=1;break;case 1:t=4;break;case 2:t=2;break;default:M.Error(572867285,"Unknown texture type")}r=this.m_babylonTexture._generateStencilBuffer?1:0}return this.size.x*this.size.y*(e*t+r)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"usageRecord",{get:function(){return this.m_usageRecord},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastRenderTime",{get:function(){return this.m_lastRenderTime},enumerable:!1,configurable:!0}),e.prototype.tryUseBabylonTexture=function(e,t,r){var i=this.m_usageRecord.find((function(e){return e.clientObject==t}));return i?(i.lastScenario=r,i.lastUsage=performance.now(),i.usageCount++):this.m_usageRecord.push({clientObject:t,lastScenario:r,lastUsage:performance.now(),usageCount:1}),this.isValidForGraphicsProcessor(e)?this.m_babylonTexture:void 0},Object.defineProperty(e.prototype,"contentLocation",{get:function(){var e=this.size;return this.m_contentLocation?this.m_contentLocation:{logicalCenter:e.scale(.5),logicalSize:e,physicalCenter:e.scale(.5),physicalSize:e,rotation:0,flipX:!1,flipY:!1}},set:function(e){this.m_changeTracker.notifyChange(),this.m_contentLocation=e},enumerable:!1,configurable:!0}),e.prototype.generateMipMap=function(){var e=this.graphicsProcessor;e&&this.m_babylonTexture?e.generateMipMap(this.m_babylonTexture):M.Error(592525218,"Cannot generate mipmaps")},e.prototype.isValidForGraphicsProcessor=function(e){return this.m_babylonTexture&&this.m_graphicsProcessor==e&&this.m_compatibleGraphicsProcessorId==e.getUniqueGraphicsProcessorId()},e.prototype.isValid=function(e){var t=e.getGraphicsProcessor();return t&&this.isValidForGraphicsProcessor(t)},e.prototype.getState=function(e){var t=e.getGraphicsProcessor();return this.m_babylonTexture?t&&this.m_graphicsProcessor==t?this.isValidForGraphicsProcessor(t)?0==this.m_babylonTexture._references?2:0:4:3:1},e.prototype.tryGetWebGLTexture=function(){return this.m_babylonTexture&&this.m_babylonTexture._webGLTexture||void 0},e.prototype.unregisterFromTextureManager=function(){this.m_textureManager&&(this.m_textureManager.unregister(this),this.m_textureManager=void 0)},e.prototype.release=function(){var e,t,r,i;this.unregisterFromTextureManager(),this.m_babylonTexture&&2!=this.releasePolicy&&this.m_babylonTexture.dispose(),this.m_babylonTexture=void 0,null===(t=null===(e=this.m_textureConverterCache)||void 0===e?void 0:e.primary)||void 0===t||t.release(),null===(i=null===(r=this.m_textureConverterCache)||void 0===r?void 0:r.secondary)||void 0===i||i.release(),this.m_changeTracker.notifyChange()},e.prototype.cloneWithNewWrapMode=function(t,r,i,n){var o=this.m_graphicsProcessor;if(o&&this.m_babylonTexture&&this.isValidForGraphicsProcessor(o)){this.wrapMode==i&&M.Error(592472277,"Why cloning if the wrapmode is the same?");var s=e.GetRequiredSizeForWrapMode(o,this.size,i),a=e.ResampleBabylonTexture(r,this.m_babylonTexture,this.originalSize,this.wrapMode,s,i,this.format);if(a){var l=new e(t,r,a,s,this.m_babylonTexture.format,i,n);return l.originalSize=this.originalSize,l}}else M.Error(592472278,"Failed to get graphicsProcessor or valid texture")},e.GetRequiredSizeForWrapMode=function(e,t,r){return e.needPowerOf2TexturesForTilingOrMipMap()&&4!=r?qt(t):t},e.ResampleBabylonTexture=function(t,r,i,n,o,s,a){var l=t,h=l.getGraphicsProcessor();if(h){var c=new e("TMP/ResampleSrc",t,r,i,r.format,n,2),u=new zt("TMP/ResampleDst",t,o,0,{disableFiltering:1==r.samplingMode,format:a});l.drawTextureToTexture(u,c,0,void 0,void 0);var d=u.m_babylonTexture;return u.unregisterFromTextureManager(),u.m_babylonTexture=void 0,u.release(),d&&h.setWrapMode(d,s),c.release(),d}M.Error(572867286,"Failed to get graphicsProcessor")},e.ConvertTexture=function(e,t,r,i,n,o,s){var a,l=t;if(l.getGraphicsProcessor()){var h=1==(null===(a=i.m_babylonTexture)||void 0===a?void 0:a.samplingMode),c=zt.RecycleOrReplace(e,r,t,i.size,!1,s,!1,0,i.wrapMode,h);return l.drawTextureToTexture(c,i,n?2:o?3:0,o,void 0),c}M.Error(526714142,"Failed to get graphicsProcessor")},e}(),zt=function(e){function t(t,r,i,n,o){void 0===i&&(i=g.Zero);var s,a=i.ceil(),l=o&&void 0!==o.wrapMode?o.wrapMode:4,h=r,c=h.getGraphicsProcessor();if(c){if(!a.isZero()){var u=o&&o.format?o.format:5;Xt(u);var d;return d=o&&o.externalTexture?c.createTextureGraphicsResourceFromExternalWebGLTexture(a,u,o.externalTexture,o?o.externalFrameBuffer:void 0):c.createTextureGraphicsResource(a,void 0,u,!(!o||!o.useFloat),!0,!!o&&!!o.needsRenderBuffer,l,!o||!o.disableFiltering,!1),s=e.call(this,t,r,d,a,u,l,n)||this,2!=n&&(h.getCurrentFramePerformanceSummary().dynamicTextureAlloc+=s.memoryUsage),s}M.Error(572867287,"Creating TargetTexture of size 0x0")}else M.Error(592525217,"Graphics processor not initialized")}return(0,p.ZT)(t,e),t.prototype.tryGetBabylonTextureForRenderToTexture=function(e){return this.m_lastRenderTime=performance.now(),this.isValidForGraphicsProcessor(e)?this.m_babylonTexture:void 0},t.prototype.tryConvertToBufferRGBA=function(){if(this.m_graphicsProcessor&&this.m_babylonTexture)return this.m_graphicsProcessor.copyTexturePixelsToArray(this.m_babylonTexture,_.FromSize(this.size),!0)},t.prototype.tryConvertToCanvas=function(){if(this.m_graphicsProcessor&&this.m_babylonTexture){var e=document.createElement("canvas");e.width=this.m_babylonTexture.width,e.height=this.m_babylonTexture.height;var t=e.getContext("2d");if(t){var r=this.tryConvertToBufferRGBA();if(r){var i=this.size,n=t.createImageData(i.x,i.y);return n.data.set(r),t.putImageData(n,0,0),t.globalCompositeOperation="copy",t.setTransform(1,0,0,-1,0,i.y),t.drawImage(e,0,0),e}}}},t.prototype.tryConvertToDataURL=function(){var e=this.tryConvertToCanvas();if(e)return e.toDataURL()},t.RecycleOrReplace=function(e,r,i,n,o,s,a,l,h,c){Xt(s);var u=i.getGraphicsProcessor();if(r){if(u&&r.isValidForGraphicsProcessor(u)&&r.size.equals(n)&&r.m_babylonTexture&&r.m_babylonTexture.format==s)return r.releasePolicy!=l&&M.Error(572867288,"RecycleOrReplace with different releasePolicy"),r;r.release()}return new t(e,i,n,l,{format:s,needsRenderBuffer:a,useFloat:o,wrapMode:h,disableFiltering:c})},t}(Gt),Wt=[{attributeName:"a_0",attributeSize:4,offset:0}],Ht=[{attributeName:"a_1",attributeSize:4,offset:0}];function jt(e,t,r,i,n,o,s,a,l,h,c){if(void 0===a&&(a=1),r.isValidForGraphicsProcessor(e)){var u=Math.max(i.length,n.length);if(0!=u){for(var d=new Float32Array(4*u),p=new Float32Array(4*u),f=0;f<u;f++){var g=i[Math.min(f,i.length-1)],m=n[Math.min(f,n.length-1)];d[4*f+0]=g.left/r.size.x,d[4*f+1]=g.top/r.size.y,d[4*f+2]=g.right/r.size.x,d[4*f+3]=g.bottom/r.size.y,p[4*f+0]=m.left/o.x,p[4*f+1]=m.top/o.y,p[4*f+2]=m.right/o.x,p[4*f+3]=m.bottom/o.y}var v=e.getBabylonEngine(),y=v.createVertexBuffer(d),_=v.createVertexBuffer(p);v.bindInstancesBuffer(y,Wt,!1),v.bindInstancesBuffer(_,Ht,!1),t.setTexture("t_0",r.tryUseBabylonTexture(e,void 0,"drawTextureRects")),t.getBabylonEffect().setFloat("ufrag_0",a),6==t.programId&&(t.setTexture("t_1",l?l.tryUseBabylonTexture(e,void 0,"drawTextureRects/Secondary"):void 0),t.getBabylonEffect().setInt("ufrag_1",s),function(e,t){var r=null==t?void 0:t.brightnessContrast;r?(e.getBabylonEffect().setInt("ufrag_3",1),e.getBabylonEffect().setFloat("ufrag_4",r.contrast),e.getBabylonEffect().setFloat("ufrag_5",(r.brightness-.5)*r.contrast+.5)):e.getBabylonEffect().setInt("ufrag_3",0);var i=null==t?void 0:t.hueSaturationLuminance;i?(e.getBabylonEffect().setInt("ufrag_6",1),e.getBabylonEffect().setFloat("ufrag_7",i.hueRotation),e.getBabylonEffect().setFloat("ufrag_8",i.saturationFactor),e.getBabylonEffect().setFloat("ufrag_9",i.luminanceFactor)):e.getBabylonEffect().setInt("ufrag_6",0);var n=null==t?void 0:t.recolor;if(n){var o=void 0===n.threshold?1:255,s=void 0===n.threshold?0:.5-o*n.threshold;e.getBabylonEffect().setInt("ufrag_10",1),e.getBabylonEffect().setFloat("ufrag_11",o),e.getBabylonEffect().setFloat("ufrag_12",s),e.getBabylonEffect().setVector3("ufrag_13",{x:n.darkColor.r,y:n.darkColor.g,z:n.darkColor.b}),e.getBabylonEffect().setVector3("ufrag_14",{x:n.brightColor.r,y:n.brightColor.g,z:n.brightColor.b})}else e.getBabylonEffect().setInt("ufrag_10",0);var a=null==t?void 0:t.colorTemperature;a?(e.getBabylonEffect().setInt("ufrag_15",1),e.getBabylonEffect().setFloat("ufrag_16",a.redGain),e.getBabylonEffect().setFloat("ufrag_17",a.blueGain),e.getBabylonEffect().setFloat("ufrag_18",a.greenGain)):e.getBabylonEffect().setInt("ufrag_15",0);var l=null==t?void 0:t.sharpness;l?(e.getBabylonEffect().setInt("ufrag_20",1),e.getBabylonEffect().setFloat("ufrag_21",l.sharpness)):e.getBabylonEffect().setInt("ufrag_20",0)}(t,h),t.getBabylonEffect().setDirectColor4("ufrag_19",c||ne.Transparent),t.getBabylonEffect().setVector2("ufrag_22",r.size)),t.drawQuadInstances(u),t.disableInstanceAttribute("a_0"),t.disableInstanceAttribute("a_1"),v._releaseBuffer(y),v._releaseBuffer(_)}}else M.Error(591192838,"Invalid Texture")}function qt(e){return new g(x(T(e.x),1,2048),x(T(e.y),1,2048))}function Xt(e){switch(e){case 4:case 5:case 1:case 2:break;default:throw"Unsupported texture format"}}function Kt(e,t){var r=qt(new g(e,t));return(e>r.x||t>r.y)&&(r=new g(Math.min(2*r.x,Bt),Math.min(2*r.y,Bt))),r}!function(){function e(e,t,r,i,n,o,s){void 0===i&&(i=null),this.m_changeTracker=new O,this.m_textureLoaded=!1;var a=this;this.m_renderer=e,this.m_loadPolicy=r,this.m_imageElement=new window.Image,this.m_imageElement.crossOrigin=i,void 0!==n&&(this.m_imageElement.width=n.x,this.m_imageElement.height=n.y),this.m_imageElement.onload=function(){try{if(2==a.m_loadPolicy){var t=Kt(a.m_imageElement.width,a.m_imageElement.height);a.m_imageElement.width=t.x,a.m_imageElement.height=t.y}a.release(),a.m_texture=Gt.CreateFromHTMLElement("ImageTextureLoader",e,a.m_imageElement),a.m_texture.originalSize=new g(a.m_imageElement.naturalWidth,a.m_imageElement.naturalHeight),a.shouldMipMap()&&a.m_texture.generateMipMap(),a.m_changeTracker.replaceListener(void 0,a.m_texture),a.m_textureLoaded=!0,o&&o(a)}catch(e){M.Error(539600867,"exception loading image: "+e),s&&s()}},this.m_imageElement.onerror=function(){M.Error(539600896,"error loading image"),s&&s()},this.m_imageElement.src=t}e.prototype.getTexture=function(e){if(this.m_texture){if(this.m_texture.wrapMode==e)return this.m_texture;this.m_wrapTextures||(this.m_wrapTextures=new Map);var t=this.m_wrapTextures.get(e);return t||((t=Gt.CreateFromHTMLElement("ImageTextureLoader/Wrap",this.m_renderer,this.m_imageElement,e)).originalSize=this.m_texture.originalSize,t&&this.m_wrapTextures.set(e,t)),t}},Object.defineProperty(e.prototype,"lastUsage",{get:function(){var e=this.m_texture?this.m_texture.lastUsage:0;return this.m_wrapTextures&&this.m_wrapTextures.forEach((function(t){return e=Math.max(e,t.lastUsage)})),e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"changeTracker",{get:function(){return this.m_changeTracker},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"loadPolicy",{get:function(){return this.m_loadPolicy},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"releasePolicy",{get:function(){var e;return null===(e=this.m_texture)||void 0===e?void 0:e.releasePolicy},enumerable:!1,configurable:!0}),e.prototype.isValidForGraphicsProcessor=function(e){return!!this.m_texture&&this.m_texture.isValidForGraphicsProcessor(e)},e.prototype.prepareForRenderSize=function(t){if((t.x>Bt||t.y>Bt)&&(t=e.scaleToFitMaxTextureResolution(t)),this.shouldResizeTexture(t)){2==this.m_loadPolicy&&(t=Kt(t.x,t.y)),this.m_imageElement.width=t.x,this.m_imageElement.height=t.y;var r=this.m_texture;this.m_texture=Gt.CreateOrUpdateFromHTMLElement("ImageTextureLoader",this.m_texture,this.m_renderer,this.m_imageElement),this.m_texture.originalSize=new g(this.m_imageElement.naturalWidth,this.m_imageElement.naturalHeight),this.shouldMipMap()&&this.m_texture.generateMipMap(),this.m_changeTracker.replaceListener(r,this.m_texture)}},e.prototype.release=function(){this.m_texture&&this.m_texture.release(),this.m_wrapTextures&&(this.m_wrapTextures.forEach((function(e){return e.release()})),this.m_wrapTextures=void 0)},e.prototype.shouldResizeTexture=function(e){var t;return!!(this.m_imageElement&&this.m_imageElement.complete&&this.m_textureLoaded)&&(e.x<=0||e.y<=0?(M.Error(539575455,"invalid texture size"),!1):!(null===(t=this.m_texture)||void 0===t?void 0:t.isValid(this.m_renderer))||0!=this.m_loadPolicy&&(1==this.m_loadPolicy||2==this.m_loadPolicy?e.x>this.m_imageElement.width||e.y>this.m_imageElement.height:(M.Error(539313604,"unsupported texture load policy"),!1)))},e.prototype.shouldMipMap=function(){var e;return 2===this.m_loadPolicy&&(null===(e=this.m_renderer.getBabylonEngine())||void 0===e?void 0:e._gl)instanceof WebGL2RenderingContext},e.scaleToFitMaxTextureResolution=function(e){var t=Math.max(e.x,e.y),r=Bt/t;return new g(r*e.x,r*e.y)}}();var Yt=function(){function e(e,t,r,i){this.triangleCount=t,this.vertexBuffer=r,this.indexBuffer=i,this.m_engine=e.getBabylonEngine(),this.m_compatibleGraphicsProcessorId=e.getUniqueGraphicsProcessorId()}return e.prototype.isValid=function(e){return this.m_compatibleGraphicsProcessorId==e.getUniqueGraphicsProcessorId()},e.prototype.discard=function(){this.m_engine._releaseBuffer(this.vertexBuffer),this.m_engine._releaseBuffer(this.indexBuffer)},e.CreateGridXY=function(t,r,i,n){for(var o=new Float32Array(r*i*2),s=0;s<i;s++)for(var a=C(n.top,n.bottom,s/(i-1)),l=0;l<r;l++){var h=2*(l+s*r);o[h]=C(n.left,n.right,l/(r-1)),o[h+1]=a}var c=new Uint16Array((r-1)*(i-1)*2*3);for(s=0;s<i-1;s++)for(l=0;l<r-1;l++)c.set([l+s*r,l+1+s*r,l+(s+1)*r,l+1+(s+1)*r,l+(s+1)*r,l+1+s*r],6*(l+s*(r-1)));var u=t.getBabylonEngine();return new e(t,(r-1)*(i-1)*2,u.createVertexBuffer(o),u.createIndexBuffer(c))},e}(),$t=[{attributeName:"a_0",attributeSize:2,offset:0,divisor:0}],Zt=[{attributeName:"a_1",attributeSize:2,offset:0,divisor:0}];function Jt(e,t,r,i,n,o,s,a,l,h){var c=r.tryUseBabylonTexture(e,h,"blurSrc");if(c){var u=i.tryGetBabylonTextureForRenderToTexture(e);if(u){var d=e.activateShaderProgram(3);d.begin(u,ne.Transparent,!1);var p=d.getBabylonEffect();p.setFloat("u_0",o),p.setVector2("u_1",t),p.setVector2("u_2",a),p.setVector2("u_3",r.size),p.setInt("u_4",l?1:2),d.setTexture("tex_0",c),p.setDirectColor4("ufrag_0",n||ne.Transparent),p.setFloat("ufrag_2",Math.log(o/4)/Math.log(2)),p.setInt("ufrag_3",s),p.setInt("ufrag_4",l?1:2),d.drawQuads(1),d.end(),i.generateMipMap()}else M.Error(572867298,"Invalid Texture")}else M.Error(592525250,"Invalid Texture")}function Qt(e,t){var r=sr(t,e.contentLocation.logicalSize),i=v.Scale2D(r.multiply(g.Flip(e.contentLocation.flipX,e.contentLocation.flipY)));return(i=(i=(i=i.multiply(v.RotationZ(e.contentLocation.rotation))).multiply(v.Translation2D(e.contentLocation.logicalCenter))).multiply(v.Scale2D(e.size.inverse()))).multiply(v.Translation2D(new g(-.5,-.5)))}function er(e){return e?e.size.x+"x"+e.size.y:"undefined"}var tr=function(){function e(e,t){this.contentRotation=0,this.depth=0,this.depthFar=0,this.depthNear=0,this.blendingMode=0,this.contentCenter=e?e.center:g.Zero,this.contentSize=e?e.size:g.One,this.contentFlip=e?g.Flip(e.flipX,e.flipY):g.One,this.contentRotation=e?e.rotation:0,this.customMesh=t}return e.prototype.getDebugStringInfo=function(){return["Layer"]},e}(),rr=function(e){function t(t,r,i){var n=e.call(this,r,i)||this;return n.texture=t,n}return(0,p.ZT)(t,e),t.prototype.getDebugStringInfo=function(){return["Texture: "+er(this.texture),(this.fadeInfo?" +Fade ":"")+(this.reflectionGradient?" + Reflection ":"")+(this.customMesh?" + CustomMesh ":"")]},t}(tr),ir=function(e){function t(t,r,i,n,o,s){var a=e.call(this,{center:g.Zero,size:g.One,rotation:0,flipX:!1,flipY:!1},o)||this;return a.progress=0,a.textureA=t,a.textureB=r,a.panVector=s,i&&n&&(a.morphingGrid=[i,n]),a}return(0,p.ZT)(t,e),t.prototype.getDebugStringInfo=function(){return["Textures: "+er(this.textureA)+"  "+er(this.textureB),(this.fadeInfo?" +Fade ":"")+(this.customMesh?" + CustomMesh ":"")+(this.morphingGrid?" + MorphingGrid ":"")]},t}(tr),nr=function(e){function t(t,r,i,n,o,s,a,l,h,c){var u=e.call(this,t,r,a,l,h,c)||this;return u.textureDeltaWhiteA=i,u.textureDeltaWhiteB=n,u.texturePictureA=o,u.texturePictureB=s,u}return(0,p.ZT)(t,e),t.prototype.getDebugStringInfo=function(){return["Textures: "+er(this.textureA)+"  "+er(this.textureB),"TexturesW: "+er(this.textureDeltaWhiteA)+"  "+er(this.textureDeltaWhiteB),"TextureP: "+er(this.texturePictureA)+"  "+er(this.texturePictureB),(this.fadeInfo?" +Fade ":"")+(this.customMesh?" + CustomMesh ":"")+(this.morphingGrid?" + MorphingGrid ":"")]},t}(ir),or=function(e){function t(t,r,i,n){var o=e.call(this,t,r,n)||this;return o.fillBrightness=0,o.distanceFieldMode=2,o.style=i,o}return(0,p.ZT)(t,e),t.prototype.getDebugStringInfo=function(){return["Texture: "+er(this.texture),(this.fadeInfo?" +Fade ":"")+(this.reflectionGradient?" + Reflection ":"")+(this.customMesh?" + CustomMesh ":"")]},t}(rr);function sr(e,t){return 0!=e.x&&0!=e.y?t.divide(e):0!=e.x?g.One.scale(t.x/e.x):0!=e.y?g.One.scale(t.y/e.y):g.Zero}function ar(e,t,r){var i=sr(t,e.logicalSize),n=_.FromSizeAndCenter(e.physicalSize,e.physicalCenter.subtract(e.logicalCenter)),o=v.RotationZ(-e.rotation),s=v.ScaleTranslation2D(g.Flip(e.flipX,e.flipY).divide(i),r);return n.transformedBounds(o.multiply(s))}function lr(e,t,r,i){var n=Ie(t.alignment,e),o=t.isStretched?e:e.transformedBounds(new y(n.negate(),r.originalSize.divide(e.size),0,n));if(o){var s=t.isStretched?t.offset.multiply(o.size):t.offset,a=t.scale;if(t.isStretched&&t.fillToPreserveAspectRatio){var l=r.originalSize.x/r.originalSize.y,h=e.size.x/e.size.y;a=a.multiply(new g(l>h?l/h:1,l<h?h/l:1))}var c=o.transformedBounds(new y(n.negate(),a,0,n.add(s)));return c&&i?c.transformedBounds(i):c}}function hr(e,t,r,i,n,o,s){var a=t instanceof rr?t:void 0,l=t instanceof ir?t:void 0,h=t instanceof nr?t:void 0,c=l?l.textureA:a?a.texture:void 0,u=l?l.textureB:void 0,d=l&&l.panVector&&(!c||!u),p=0;l&&(p=d?c?0:1:l.progress);var f=a?a.reflectionGradient:void 0,m=t instanceof or&&!c;if(m||c&&c.isValidForGraphicsProcessor(e)||u&&u.isValidForGraphicsProcessor(e)){var y=t.contentCenter,b=v.Identity,T=v.Identity,w=r.getBabylonEffect(),C=r.getBabylonEngine();if(l&&l.morphingGrid&&2==l.morphingGrid.length)w.setInt("u_16",1),w.setFloat("u_17",l.progress),C.bindInstancesBuffer(l.morphingGrid[0],$t),C.bindInstancesBuffer(l.morphingGrid[1],Zt),b=v.Scale2D(t.contentSize),T=v.Scale2D(t.contentSize);else{w.setInt("u_16",0),w.setFloat("u_17",0),r.setDummyPointerAttribute("a_0"),r.setDummyPointerAttribute("a_1");var S=c?ar(c.contentLocation,t.contentSize,t.contentCenter):m?_.FromSizeAndCenter(t.contentSize,t.contentCenter):void 0,P=u?ar(u.contentLocation,t.contentSize,t.contentCenter):void 0,E=S&&P?_.UnionRect(S,P):S||P;if(t instanceof or&&t.style.pictureOverflow>0&&t.style.pictureBrush&&t.pictureTexture){var R=lr(t.fillBoundsOverride?t.fillBoundsOverride:_.FromSizeAndCenter(t.contentSize,t.contentCenter),t.style.pictureBrush,t.pictureTexture);R&&(E=_.UnionRect(E,R))}if(!E)return void M.Error(592525253,"Undefined physical bounds");if(E=E.translate(t.contentCenter.negate()),!(E=(E=t.effectTransform?E.transformedBounds(t.effectTransform):E)&&t.localClipRect?_.IntersectRect(E,t.localClipRect):E))return;E=E.translate(t.contentCenter),b=v.ScaleTranslation2D(E.size,E.center.subtract(y));var A=t.effectTransform?t.effectTransform.inverse():void 0;T=A?b.multiply(A):b}var F=c?T.multiply(Qt(c,t.contentSize)):v.Identity,B=u?T.multiply(Qt(u,t.contentSize)):v.Identity,D=v.Identity;if(t instanceof or&&t.textCutoutTexture&&c){var k=t.textCutoutTransform||v.Identity;D=T.multiply(k).multiply(Qt(t.textCutoutTexture,t.contentSize))}var O=y;d&&l&&l.panVector&&(O=y.add(l.panVector.scale(l.progress-(u?1:0))));var U=v.RotationZ(t.contentRotation).multiply(v.Translation2D(O));n&&(U=U.multiply(n)),w.setMatrix3x3("u_0",b.m),w.setVector2("u_15",t.contentFlip),w.setMatrix3x3("u_1",U.m),w.setVector2("u_2",i),w.setMatrix3x3("u_3",F.m),w.setMatrix3x3("u_11",D.m),w.setMatrix3x3("u_4",B.m),w.setFloat2("ufrag_12",f?f.opacity0:1,f?f.opacity1:1),w.setVector2("u_20",f?f.pos0:g.Zero),w.setVector2("u_21",f?f.pos1:g.Zero),w.setDirectColor4("ufrag_13",o||ne.Transparent),w.setFloat("ufrag_36",p);var N=t.fadeInfo?t.fadeInfo.fadeTexture:void 0;r.setTexture("t_3",N?N.tryUseBabylonTexture(e,t.clientObject,"fadeTexture"):void 0);var V=0;if(t.fadeInfo&&t.fadeInfo.fade){V=1;var G=t.fadeInfo.fade,z=G.reverse?1-G.progress:G.progress;w.setVector2("ufrag_17",G.getFadeScaleOffset(z,0)),0!=G.preset&&(t.fadeInfo.fadeTexture&&t.fadeInfo.fadeTexture.isValidForGraphicsProcessor(e)?(V=2,w.setMatrix3x3("u_10",13==G.preset?T.multiply(Qt(t.fadeInfo.fadeTexture,t.contentSize)).m:F.multiply(G.getFadeTransform()).m)):M.Error(592525254,"fade texture missing"))}w.setInt("ufrag_16",V),w.setFloat("u_18",t.depthFar),w.setFloat("u_19",t.depthNear),t instanceof or?(function(e,t,r,i,n,o){var s=r.texture,a=r.style;t.setFloat("ufrag_0",r.distRangeSize?.5/r.distRangeSize:1),t.setInt("ufrag_34",s?0:1);var l=7==o&&a.hitTransparentFill,h=a.fillBrush,c=l?1:h?h.getType():0,u=6==c?r.fillTexture:void 0;6!=c||u||(c=0);var d=h instanceof ae?!h.color.equals(ne.Transparent):0!=c;if(t.setInt("ufrag_10",c),4==c)t.setFloatArray4("ufrag_3",cr(h));else{var p=l?ne.White:1==c?h.color:7==c?h.foregroundColor:ne.Transparent;t.setDirectColor4("ufrag_3",p)}t.setInt("ufrag_18",6==c&&u&&4==u.wrapMode?1:0),t.setFloat("ufrag_20",6==c?h.opacity:1),t.setInt("u_13",7==c?1:0),t.setMatrix3x3("u_4",r.fillTransformUV?7==c?r.fillTransformUV.m:i.multiply(r.fillTransformUV).m:i.m),t.setDirectColor4("ufrag_22",7==c?h.backgroundColor:ne.Transparent),t.setFloat("ufrag_28",r.fillBrightness);var f=r.pictureTexture;if(t.setInt("ufrag_30",f?1:0),f){var m=a.pictureBrush;t.setInt("ufrag_31",f&&4==f.wrapMode?1:0),t.setFloat("ufrag_32",m.opacity),t.setMatrix3x3("u_5",r.pictureTransformUV?i.multiply(r.pictureTransformUV).m:v.Identity.m)}var y=7==L?3:7!=o||!a.hasLine||d||f?0:I,_=a.lineBrush&&2!=o?a.lineBrush.getType():0,b=6==_?r.lineTexture:void 0;6!=_||b||(_=0),y&&(_=1);var T=7==L?y:Math.max(y,a.hasLine?a.pen.adjustedLineWidth:0);t.setFloat("ufrag_1",T),t.setInt("ufrag_11",_),4==_?t.setFloatArray4("ufrag_4",cr(a.lineBrush)):(p=ne.Transparent,y?p=7==L?ne.Red:ne.White:1==_?p=a.lineBrush.color:7==_&&(p=a.lineBrush.foregroundColor),t.setDirectColor4("ufrag_4",p)),t.setInt("ufrag_19",6==_&&b&&4==b.wrapMode?1:0),t.setFloat("ufrag_21",6==_?a.lineBrush.opacity:1),t.setInt("u_14",7==_?1:0),t.setMatrix3x3("u_6",r.lineTransformUV?7==_?r.lineTransformUV.m:i.multiply(r.lineTransformUV).m:i.m),t.setDirectColor4("ufrag_23",7==_?a.lineBrush.backgroundColor:ne.Transparent),t.setFloat("ufrag_29",1==r.mergeMode?1:0),t.setFloat("ufrag_6",a.pen&&0!=a.pen.dashType&&a.pen.useRoundDash?1:0);var w,C=y?ur[0]:!(w=a.pen).compoundType||w.tipType?ur[0]:w.compoundType>=0&&w.compoundType<ur.length?ur[w.compoundType]:(M.Error(587220940,"unsupported compoundType"),ur[0]);t.setFloatArray3("ufrag_8",C.centers),t.setFloatArray3("ufrag_9",C.slopes);var S=Math.sqrt(2)/2,P=new g(S,S),E=n?n.transformVector(P).length():1;if(t.setFloat("ufrag_2",1/E),t.setFloat("ufrag_27",x(Ee(a.pen),-1,1)*T/2),t.setInt("ufrag_37",s&&2==r.distanceFieldMode?1:0),t.setInt("ufrag_38",0==a.pen.dashType&&0==a.pen.compoundType||7==o?1:0),r.softEdges&&r.softEdges.radius>0&&r.softEdgesTexture&&r.softEdgesTexture.isValidForGraphicsProcessor(e)?(t.setInt("ufrag_24",1),t.setMatrix3x3("u_7",i.multiply(Qt(r.softEdgesTexture,r.contentSize)).m)):(t.setInt("ufrag_24",0),r.softEdges&&r.softEdges.radius>0&&M.Error(588006213,"soft edges texture not ready")),r.innerShadow&&r.innerShadow.color.a>0&&r.innerShadowTexture&&r.innerShadowTexture.isValidForGraphicsProcessor(e)){var R=new g(r.innerShadow.distance,0).rotate(r.innerShadow.angle),A=i.multiply(v.Translation2D(R)).multiply(Qt(r.innerShadowTexture,r.contentSize));t.setInt("ufrag_25",1),t.setMatrix3x3("u_8",A.m),t.setDirectColor4("ufrag_26",r.innerShadow.color)}else t.setInt("ufrag_25",0),r.innerShadow&&r.innerShadow.color.a>0&&M.Error(588006214,"inner shadow  exture not ready");t.setInt("ufrag_39",r.textRenderMode||0),t.setFloat("ufrag_40",a.pictureOverflow),t.setInt("ufrag_15",7==o||5==o?1:5==L?10:0!=L&&7!=L?L+10:0),7==L&&(t.setInt("ufrag_10",0),t.setInt("ufrag_11",1)),0==o&&3==r.blendingMode&&t.setDirectColor4("ufrag_13",ne.White)}(e,w,t,T,n,s),r.setTexture("t_0",c?c.tryUseBabylonTexture(e,t.clientObject,"distanceField"):void 0),r.setTexture("t_1",t.fillTexture?t.fillTexture.tryUseBabylonTexture(e,t.clientObject,"fillTexture"):void 0),r.setTexture("t_2",t.lineTexture?t.lineTexture.tryUseBabylonTexture(e,t.clientObject,"lineTexture"):void 0),r.setTexture("t_4",t.softEdgesTexture?t.softEdgesTexture.tryUseBabylonTexture(e,t.clientObject,"softEdgesTexture"):void 0),r.setTexture("t_5",t.innerShadowTexture?t.innerShadowTexture.tryUseBabylonTexture(e,t.clientObject,"innerShadowTexture"):void 0),r.setTexture("t_6",t.pictureTexture?t.pictureTexture.tryUseBabylonTexture(e,t.clientObject,"pictureTexture"):void 0),r.setTexture("t_7",t.textCutoutTexture?t.textCutoutTexture.tryUseBabylonTexture(e,t.clientObject,"textCutoutTexture"):void 0)):(function(e){e.setFloat("ufrag_0",0),e.setFloat("ufrag_1",0),e.setFloat("ufrag_2",0),e.setDirectColor4("ufrag_3",ne.Transparent),e.setDirectColor4("ufrag_4",ne.Transparent),e.setFloat("ufrag_6",0),e.setFloatArray3("ufrag_8",new Float32Array([0,0,0])),e.setFloatArray3("ufrag_9",new Float32Array([0,0,0])),e.setInt("ufrag_10",0),e.setInt("ufrag_11",0),e.setInt("ufrag_18",0),e.setInt("ufrag_19",0),e.setFloat("ufrag_20",1),e.setFloat("ufrag_21",1),e.setDirectColor4("ufrag_22",ne.Transparent),e.setDirectColor4("ufrag_23",ne.Transparent),e.setInt("ufrag_24",0),e.setInt("ufrag_25",0),e.setDirectColor4("ufrag_26",ne.Transparent),e.setFloat("ufrag_27",0),e.setFloat("ufrag_28",0),e.setFloat("ufrag_29",0),e.setInt("ufrag_30",0),e.setInt("ufrag_31",0),e.setFloat("ufrag_32",0),e.setInt("ufrag_34",0),e.setInt("u_13",0),e.setInt("u_14",0),e.setInt("ufrag_39",0),e.setFloat("ufrag_40",0)}(w),w.setInt("ufrag_15",h?3:2),r.setTexture("t_0",c?c.tryUseBabylonTexture(e,t.clientObject,t instanceof ir?"morphA":"sprite"):void 0),r.setTexture("t_1",u?u.tryUseBabylonTexture(e,t.clientObject,"morphB"):void 0),r.setTexture("t_2",h?h.textureDeltaWhiteA.tryUseBabylonTexture(e,t.clientObject,"morphAW"):void 0),r.setTexture("t_4",h?h.textureDeltaWhiteB.tryUseBabylonTexture(e,t.clientObject,"morphBW"):void 0),r.setTexture("t_5",h?h.texturePictureA.tryUseBabylonTexture(e,t.clientObject,"morphAP"):void 0),r.setTexture("t_6",h?h.texturePictureB.tryUseBabylonTexture(e,t.clientObject,"morphBP"):void 0),r.setTexture("t_7",void 0),h&&w.setMatrix3x3("u_5",h.pictureTransformUV?T.multiply(h.pictureTransformUV).m:v.Identity.m));var W=0==s,H=1==t.blendingMode||5==t.blendingMode;w.setInt("ufrag_35",W&&H?1:0),r.setBlendingMode(W?t.blendingMode:0),t.customMesh?r.drawMesh(t.customMesh):r.drawQuads(1)}else M.Error(592525252,"No Texture")}function cr(e){var t=e.fillToRect?e.fillToRect:new _(.5,.5,.5,.5),r=e.fillFromRect?e.fillFromRect:new _(0,0,1,1),i=t.translate(r.leftTop.negate()).multiply(r.size.inverse());return new Float32Array([1/i.left,1/i.top,1/(1-i.right),1/(1-i.bottom)])}var ur=[{centers:new Float32Array([0,0,0]),slopes:new Float32Array([1,1,1])},{centers:new Float32Array([-2/3,2/3,2/3]),slopes:new Float32Array([3,3,3])},{centers:new Float32Array([-.4,.8,.8]),slopes:new Float32Array([5/3,5,5])},{centers:new Float32Array([-.8,.4,.4]),slopes:new Float32Array([5,5/3,5/3])},{centers:new Float32Array([-5/6,0,5/6]),slopes:new Float32Array([6,3,6])}],dr=[1,1,2,4,8,16,16];function pr(e,t,r,i,n){void 0===r&&(r=!1),void 0===i&&(i=!1);var o=[],s=i?[]:void 0;if(!e.figures||0==e.figures.length)return{buffers:o,endDistance:0};for(var a=0,l=0;l<e.figures.length;l++){var h=r?e.figures[l].toPolygon():e.figures[l],c=G(43),u=h.isLastPointDuplicated(),d=h.isClosed||u,p=fr(h.points,h.format,43,0,u?h.points.length-h.pointDataSize:h.points.length,1,3,d,e.maxPressure),f=p.length/c,g=void 0;if(i){var m=gr(p,43,d,a,n,1,3);g=m.distanceArray,a=m.endDistance}var v=p.length;if(v>t)for(var y=t/c-4,_=Math.ceil((f-4)/y),b=y+4,T=0,w=0;w<_;w++){var x=Math.min(b,f-T),C=x-4;o.push(p.subarray(T*c,(T+x)*c)),s&&g&&s.push(g.subarray(T,T+x)),T+=C}else{var S=new Float32Array(4*Math.ceil(v/4));S.set(p,0),o.push(S),s&&g&&s.push(g)}}return s&&s.length!=o.length&&M.Error(592525388,"Invalid distance array"),{buffers:o,distanceBuffers:s,endDistance:a}}function fr(e,t,r,i,n,o,s,a,l){void 0===i&&(i=0),void 0===n&&(n=e.length),void 0===o&&(o=0),void 0===s&&(s=0),void 0===a&&(a=!0),void 0===l&&(l=1);var h=G(t),c=n-i;if(!(c%h==0&&1&t&&1&r))throw M.Error(592525389,"list of source points invalid");var u=e,d=c/h;1==d&&((u=new Float32Array(2*e.length)).set(e,0),u.set(e,e.length),d=2);var p=h;h=G(r);for(var f=new Float32Array((o+d+s)*h),g=0;g<d;g++)for(var m=i+g*p,v=(o+g)*h,y=0,_=dr;y<_.length;y++){var b=_[y];b&r&&(f[v]=8==b?b&t?u[m]/l:1:b&t?u[m]:2==b?1:0,v++),b&t&&m++}if((o||s)&&(o>0&&f.copyWithin(0,f.length-(o+s)*h,f.length-s*h),s>0&&f.copyWithin(f.length-s*h,o*h,(o+s)*h),!a&&2&r)){for(var T=0;T<o;T++)f[T*h+2]=0;for(T=0;T<s;T++)f[f.length-(T+1)*h+2]=0}return f}function gr(e,t,r,i,n,o,s){void 0===i&&(i=0),void 0===o&&(o=0),void 0===s&&(s=0);var a=n?function(e,t,r){var i=G(t);if(0==i||e.length%i!=0||!(1&t))throw M.Error(592525390,"list of points for invalid for measuring distance");for(var n=r.m,o=new Float32Array(e),s=0;s<e.length;s+=i){var a=e[s],l=e[s+1];o[s]=a*n[0]+l*n[3]+n[6],o[s+1]=a*n[1]+l*n[4]+n[7]}return o}(e,t,n):e,l=G(t);if(0==l||a.length%l!=0||a.length/l<o+s+1||!(1&t))throw M.Error(587534800,"list of points for invalid for measuring distance");for(var h=new Float32Array(a.length/l),c=o*l,u=(a.length-s*l-c)/l,d=2&t,p=i||0,f=0;f<u;f++){var g=c+f*l;if(2!=(d?a[g+2]:1)&&(h[o+f]=p,r||f<u-1)){var m=c+(f+1)%u*l,v=d?a[m+2]:1;if(2!=v){var y=a[m]-a[g],_=a[m+1]-a[g+1];p+=Math.sqrt(y*y+_*_)}else if(2==v&&(r||f<u-2)){var b=c+(f+2)%u*l;p+=S(a[g],a[g+1],a[m],a[m+1],a[b],a[b+1])}}}for(var T=p-i,w=0;w<o;w++)h[w]=h[o+u-o+w]-T;for(w=o+u;w<a.length/l;w++)h[w]=h[w+o-(o+u)]+T;for(f=0;f<u;f++)if(g=c+f*l,d&&2==a[g+2]){var x=0==o&&0==f?u-1:o+f-1,C=0==s&&f==u-1?o:o+f+1;h[o+f]=.5*(h[x]+h[C])}return{distanceArray:h,endDistance:p}}var mr=function(){function e(e,t,r,i,n,o,s,a){this.m_renderer=t,this.pathIndexRange=r,this.fillMode=i,this.distRangeSize=0,this.contentQuality=0,this.enableMipMap=!1,this.mergeMode=0,this.distanceFieldMode=o,this.scenario=e,this.releasePolicy=s,this.isDisplacementMap=a}return Object.defineProperty(e.prototype,"size",{get:function(){return this.texture?this.texture.size:g.Zero},enumerable:!1,configurable:!0}),e.prototype.refresh=function(e,t,r){var i=e,n=i.getGraphicsProcessor();if(!n)throw M.Error(591524387,"Graphics processor not initialized");var o=At.readBooleanOrDefault("forceRefreshDistanceField",!1);if(!r&&!o&&this.geometryUniqueId==t.geometryTracker.currentUniqueId&&this.texture&&this.texture.isValidForGraphicsProcessor(n))return!0;var s=this.getContentBounds(t);if(!s)return M.Error(570959637,"Shape has no bounds"),this.texture&&this.texture.release(),!1;var a=this.getQualityToUse(t),l=this.getPixelPaddingInShapeUnits(t),h=s.size.scale(a).add(new g(2*l*a,2*l*a)),c=this.enableMipMap?new g(w(h.x),w(h.y)):h.ceil(),u=c.scale(Math.min(1,Lt/c.x,Lt/c.y)).ceil(),d=new g(x(u.x,16,Lt),x(u.y,16,Lt)),p=this.texture;if(this.texture=zt.RecycleOrReplace(this.scenario,p,e,d,this.isDisplacementMap,5,!0,this.releasePolicy),!this.texture||!this.texture.graphicsProcessor)return!1;if(r&&p!=this.texture)return M.Error(591524416,"Cannot update incrementally: texture had to be recreated"),!1;var f=a*Math.min(d.x/h.x,d.y/h.y),m=_.FromSizeAndCenter(d.scale(1/f),s.center),v=l*f/a;return this.rasterize(t,r,m,f,v,i.getCurrentFramePerformanceSummary()),!0},e.prototype.getQualityToUse=function(e){return this.qualityOverride?this.qualityOverride:e.hasSmallDetails()?2*It:It},e.prototype.getContentBounds=function(e){if(this.contentBoundsOverride)return this.contentBoundsOverride;var t=e.incrementalPath?e.incrementalPath.bounds:Me(e,1!=this.distanceFieldMode);if(t){var r=t.size;if(isFinite(r.x)&&isFinite(r.y)){var i=e.transform.scale;if(isFinite(i.x)&&isFinite(i.y))return t.multiply(i.abs());M.Error(562151698,"Invalid shape scale for SDF: "+i.x+" x "+i.y+", scenario: "+this.scenario)}else M.Error(562151697,"Invalid shape bounds for SDF: "+r.x+" x "+r.y+", scenario: "+this.scenario)}},e.prototype.getFillBrightness=function(){return 2==this.fillMode?.4:3==this.fillMode?.2:4==this.fillMode?-.4:5==this.fillMode?-.2:0},e.prototype.getPixelPaddingInShapeUnits=function(e){if(null!=this.paddingOverride)return this.paddingOverride;var t=At.readNumberOrDefault("maxReasonableZoomOut",10);return e.style.hasLine?Math.ceil(Math.max(I/2,t)):t},e.prototype.rasterize=function(e,t,r,i,n,o){if(!this.texture||!this.texture.graphicsProcessor)return M.Error(591524418,"No gl texture or context"),!1;var s=e.transform.scale.abs(),a=Me(e,!1,v.Scale2D(s).multiply(new y(r.center.negate(),e.transform.scale.sign(),0,r.center).toMatrix3()));if(!a)return M.Error(591524420,"Nothing to render"),!1;var l=new g(i,i),h=r.size,c=this.size.scale(.5),u=new y(r.center.negate(),l,0,c),d=r.transformedBounds(u),p=a.transformedBounds(u);if(!d||!p)return M.Error(588006216,"Nothing to render"),!1;if(this.contentQuality=i,this.localBounds=r?r.multiply(s.inverse()):void 0,this.renderScale=l.divide(this.size),this.uvScale=h.multiply(this.renderScale).multiply(e.transform.scale.sign()),this.texture.contentLocation={logicalCenter:p.center,logicalSize:p.size,physicalCenter:d.center,physicalSize:d.size,rotation:0,flipX:e.transform.scale.x<0,flipY:e.transform.scale.y<0},!this.localBounds||!this.renderScale)return M.Error(591524421,"no bounds or renderScale"),!1;o.pixelCountDistanceField+=Math.floor(this.size.x*this.size.y);var f=5==L,m=.5*(e.style.pen?e.style.pen.adjustedLineWidth*(1+Math.min(Math.abs(Ee(e.style.pen)),1)):0);if(this.isDisplacementMap&&e.shape3D){var _=.5*Math.max(e.shape3D.topBevel?e.shape3D.topBevel.size.x:0,e.shape3D.bottomBevel?e.shape3D.bottomBevel.size.x:0,e.shape3D?.5*e.shape3D.adjustedContourWidth:0);m=Math.max(m,2*_-m)}return this.distRangeSize=f?Math.max(h.x/2,h.y/2):Math.max(m,n),function(e,t,r,i,n,o,s,a,l,h,c,u,d){var p=performance.now(),f=r.texture;if(!f)return M.Error(572842049,"DistanceFieldTexture not initialized"),!1;var m,v=c?void 0:ne.Transparent;if(i.paths&&!i.incrementalPath)m=Er(e,t,i.paths,i.style.hasLine?i.style.pen:void 0,!1,1!=l,2==l,i.transform.scale,n,u,d,!!r.isGlyphCache,!!r.isGlyphCacheDisabled);else if(i.incrementalPath){var y=f.tag,_=y&&y.incrementalPathTrackerId==i.incrementalPath.changeTracker.trackerId;(!_||y&&(0==y.figureCount||1==y.figureCount&&0==y.lastFigurePointCount))&&(v=ne.Transparent);for(var b=_&&y.figureCount>0?y.figureCount-1:0,T=[],w=b;w<i.incrementalPath.figures.length;w++){var x=i.incrementalPath.figures[w],C=_&&w==b&&y.lastFigurePointCount>0?y.lastFigurePointCount-1:0,S=x.getPointCount();T.push(new z(x.data.slice(C*i.incrementalPath.pointDataSize,S*i.incrementalPath.pointDataSize),!1,i.incrementalPath.format))}f.tag={incrementalPathTrackerId:i.incrementalPath.changeTracker.trackerId,figureCount:i.incrementalPath.figures.length,lastFigurePointCount:i.incrementalPath.figures.length>0?i.incrementalPath.figures[i.incrementalPath.figures.length-1].getPointCount():0},m=Er(e,t,[new N({figures:T,fillMode:0})],i.style.hasLine?i.style.pen:void 0,!1,1!=l,2==l,i.transform.scale,n,u,d,!!r.isGlyphCache,!!r.isGlyphCacheDisabled)}if(!m)return M.Error(592525084,"Nothing to render"),!1;var P=e.activateShaderProgram(0);P.begin(f.tryGetBabylonTextureForRenderToTexture(e),v,!1);var E=P.getBabylonEffect();E.setVector2("u_0",o.center.multiply(i.transform.scale)),E.setVector2("u_1",i.transform.scale),E.setVector2("u_2",s),E.setFloat("u_3",h),E.setFloat("ufrag_10",i.style&&i.style.pen?2*h/(i.style.pen.adjustedLineWidthForArrowHead+1):0),E.setFloat("ufrag_11",i.transform.scale.x*i.transform.scale.y),E.setInt("ufrag_7",L),E.setInt("u_13",L),E.setInt("u_15",0==i.style.pen.compoundType?0:1),E.setVector2("u_17",i.style.pen.tipScale?i.style.pen.tipScale:g.One),E.setInt("u_18",i.style.pen.tipType?i.style.pen.tipType:0);var R=(i.style.pen.adjustedLineWidth/2+1/r.contentQuality)/(2*h);E.setFloat("ufrag_15",0==i.style.pen.alignment?R:2*R);for(var A=0,I=m.transformedPaths;A<I.length;A++){var F=I[A],B=Sr(a);if(B)for(var D=B.start;D<=B.last;D++)Pr(D,!0,F,a,u)&&(Rr(P,D,!0,i),2==D?P.drawQuads(1):Ar(P,D,!0,i,[F],a,l,u,t.getCurrentFramePerformanceSummary(),h,null!=i.shape3D))}var k=function(e){return 1==e?Ne.FromFirstLast(0,0):Ne.FromFirstLast(0,1==L||2==L?0:2)}(a);if(k)for(D=k.start;D<=k.last;D++)Rr(P,D,!1,i),2==D?P.drawQuads(1):Ar(P,D,!1,i,m.transformedPaths,a,l,u,t.getCurrentFramePerformanceSummary(),h,null!=i.shape3D);if(P.end(),Ut&&yr&&m.cachedGlyphsPages.length>0){var O=e.activateShaderProgram(5);if(O.begin(f.tryGetBabylonTextureForRenderToTexture(e),void 0,!1),Mr(O,0,0),r.localBounds&&r.uvScale)for(var U=0,V=m.cachedGlyphsPages;U<V.length;U++){var G=V[U];if(G.cachedGlyphInstances.length>0){for(var W=new Array(G.cachedGlyphInstances.length),H=new Array(G.cachedGlyphInstances.length),j=0;j<G.cachedGlyphInstances.length;j++){var q=G.cachedGlyphInstances[j];W[j]=q.srcRect,H[j]=q.dstRect.translate(r.localBounds.center.negate()).multiply(f.size.multiply(r.uvScale).multiply(r.localBounds.size.inverse())).translate(f.size.scale(.5))}var X=yr[G.page].texture;X?jt(e,O,X,W,H,f.size,0,yr[G.page].distRangeSize/r.distRangeSize*(G.cachedGlyphInstances[0].dstRect.size.y/G.cachedGlyphInstances[0].srcRect.size.y)):M.Error(572867297,"glyphPageTexture missing")}}O.end()}return f.renderCost=performance.now()-p,!0}(this.texture.graphicsProcessor,this.m_renderer,this,e,this.pathIndexRange,this.localBounds,this.renderScale,this.mergeMode,this.distanceFieldMode,this.distRangeSize,t,1==this.generateDrawFadeMask,this.isDisplacementMap)&&(this.geometryUniqueId=e.geometryTracker.currentUniqueId,this.lastKnownQualitySetting=It,this.lastKnownLineWidth=e.style.pen.adjustedLineWidth,this.lastKnownLineWidthForArrowHead=e.style.pen.adjustedLineWidthForArrowHead,this.lastKnownHitTestSlop=I,this.enableMipMap&&this.texture.generateMipMap()),!1},e}();function vr(e){return e?e.fontId+":"+e.glyphId:void 0}var yr,_r={},br=[];function Tr(){for(var e=0,t=yr||[];e<t.length;e++){var r=t[e];r.texture&&r.texture.release()}yr=void 0,_r={},br=[]}var wr=1024,xr=[{attributeName:"a_p0",attributeSize:4,offset:0},{attributeName:"a_p1",attributeSize:4,offset:16},{attributeName:"a_p2",attributeSize:4,offset:32},{attributeName:"a_p3",attributeSize:4,offset:48},{attributeName:"a_p4",attributeSize:4,offset:64}],Cr=[{attributeName:"a_d1",attributeSize:1,offset:4},{attributeName:"a_d2",attributeSize:1,offset:8}];function Sr(e){if(1==e)return Ne.FromFirstLast(0,3)}function Pr(e,t,r,i,n){return!(n&&0!=e||1!=i&&t||0!=e&&0==r.fillMode)}function Er(e,t,r,i,n,o,s,a,l,h,c,u,d){var p=4096,m=[],y=[];if(0==r.length)return{transformedPaths:m,cachedGlyphsPages:y};l&&(l.start<0||l.last>=r.length)&&M.Error(592525078,"pathIndexRange out of range");for(var _=l?Math.max(l.start,0):0,b=l?Math.min(l.last,r.length-1):r.length-1,T=i&&(Z(i.headEnd,i.adjustedLineWidthForArrowHead)>0||Z(i.tailEnd,i.adjustedLineWidthForArrowHead)>0),w=h||!!i&&0!=i.dashType||T,x=Ut&&!i,C=function(l){var h=r[l];if(c&&!h.extrusionEnabled)return"continue";var _=h.transform.scale.x>=.013671875;h.glyphCacheId?u?t.getCurrentFramePerformanceSummary().glyphCountAddedToCache++:(t.getCurrentFramePerformanceSummary().glyphCount++,_&&t.getCurrentFramePerformanceSummary().glyphCountLargeText++,null!=i&&t.getCurrentFramePerformanceSummary().glyphCountTextOutline++):t.getCurrentFramePerformanceSummary().pathCount++;var b=!1,T=vr(h.glyphCacheId);if(!d&&T&&x&&yr&&0==h.transform.rotation&&Math.abs(h.transform.scale.x-h.transform.scale.y)<f&&!_&&_r[T]){var C=_r[T];if(C.page<0||C.page>=yr.length)M.Error(592525079,"Invalid glyph page");else{var S=yr[C.page];if(S.texture){var P=S.localBounds?S.localBounds.center:void 0,E=S.localBounds&&P&&S.uvScale?S.localBounds.translate(P.negate()).multiply(S.uvScale.inverse()).translate(P):void 0,R=S.localBounds&&E&&S.uvScale?C.bounds.multiply(S.uvScale).translate(E.leftTop.negate()):void 0,A=C.bounds.translate(C.offset.negate()).multiply(new g(1/C.scale,1/C.scale)).transformedBounds(h.transform);if(R)if(A)if(R.right<0||R.bottom<0||R.left>=wr||R.top>=wr)M.Error(592525082,"Cached glyph src rect out of bounds");else{for(var I={srcRect:R,dstRect:A,distanceScale:1},F=void 0,B=0;B<y.length&&!F;B++)y[B].page==C.page&&(F=y[B]);F||(F={page:C.page,cachedGlyphInstances:[]},y.push(F)),F.cachedGlyphInstances.push(I),b=!0,t.getCurrentFramePerformanceSummary().glyphCountReadFromCache++}else M.Error(592525081,"Cached glyph dst rect undefined");else M.Error(592525080,"Cached glyph src rect undefined")}else M.Error(572867295,"Glyph page texure missing")}}if(!b){h.glyphCacheId&&!u&&t.getCurrentFramePerformanceSummary().glyphCountRenderedAsPath++;var L=t.ensurePathRenderData(h);L.refreshCachedHwTapeBuffers(h,e);var D=L.tapeBuffers,k=void 0,O=0;if(!D||w||n)if(w||n){var U=pr(h,p,n,w,w?v.FromTransforms(h.transform,v.Scale2D(a)):void 0);D=U.buffers,k=U.distanceBuffers,O=U.endDistance}else D=L.refreshCachedTapeBuffers(h);var V=e.getBabylonEngine(),G=L.hwTapeBuffers;G||(G=D.map((function(e){return V.createVertexBuffer(e)})));var z=void 0;k&&(z=k.map((function(e){return V.createVertexBuffer(e)})));var W=h.transform.toMatrix3(),H={tapeBuffers:D,hwTapeBuffers:G,hwDistanceBuffers:z,fillMode:c?1:s?0:h.fillMode,lineEnabled:o&&h.lineEnabled,isArrowHead:!1,transform:W,startDistance:0,endDistance:O};if(m.push(H),s&&i&&(0!=i.headEnd.end||0!=i.tailEnd.end))for(var j=i.adjustedLineWidthForArrowHead,q=W.multiply(v.Scale2D(a)),K=v.Scale2D(a.inverse()),Y=0,Z=h.figures;Y<Z.length;Y++){var J=Z[Y],Q=J.isClosed||J.isLastPointDuplicated();if(i.headEnd&&0!=i.headEnd.end&&!Q){var ee=X(i.headEnd,j);if(ee){var te=$(J,!1,i.headEnd,j,q),re=pr(N.CreateFromFigure(ee),p).buffers;m.push({tapeBuffers:re,hwTapeBuffers:re.map((function(e){return V.createVertexBuffer(e)})),hwDistanceBuffers:void 0,fillMode:5==i.headEnd.end?0:1,lineEnabled:!0,isArrowHead:!0,transform:te?te.multiply(K):void 0,startDistance:0,endDistance:0})}}if(i.tailEnd&&0!=i.tailEnd.end&&!Q){var ie=X(i.tailEnd,j);if(ie){var ne=$(J,!0,i.tailEnd,j,q),oe=pr(N.CreateFromFigure(ie),p).buffers;m.push({tapeBuffers:oe,hwTapeBuffers:oe.map((function(e){return V.createVertexBuffer(e)})),hwDistanceBuffers:void 0,fillMode:5==i.tailEnd.end?0:1,lineEnabled:!0,isArrowHead:!0,transform:ne?ne.multiply(K):void 0,startDistance:0,endDistance:0})}}}}},S=_;S<=b;S++)C(S);return{transformedPaths:m,cachedGlyphsPages:y}}function Mr(e,t,r){var i=e.getBabylonEngine();0==t?(i.setColorWrite(!0),i.depthCullingState.depthMask=!0,i.stencilState.stencilTest=!1,i.stencilState.stencilMask=255,i.stencilState.stencilFunc=519,i.stencilState.stencilFuncRef=0,i.stencilState.stencilFuncMask=3,i.alphaState.alphaBlend=!0,i.alphaState.setAlphaBlendFunctionParameters(1,1,1,1),i.alphaState.setAlphaEquationParameters(32776,32776),i.clear(null,!1,!1,!0)):1==t?(i.setColorWrite(!1),i.depthCullingState.depthMask=!1,i.stencilState.stencilTest=!0,i.stencilState.stencilMask=255,i.stencilState.stencilFunc=519,i.stencilState.stencilFuncRef=1,i.stencilState.stencilFuncMask=255):(i.setColorWrite(!0),i.depthCullingState.depthMask=!0,i.stencilState.stencilMask=0,2==t?(i.stencilState.stencilTest=!0,i.stencilState.stencilFunc=517,i.stencilState.stencilFuncRef=0,i.stencilState.stencilFuncMask=1==r?255:3,i.alphaState.alphaBlend=!0,i.alphaState.setAlphaBlendFunctionParameters(775,769,773,771),i.alphaState.setAlphaEquationParameters(32774,32774)):3==t&&(i.stencilState.stencilTest=!1,i.alphaState.alphaBlend=!0,i.alphaState.setAlphaBlendFunctionParameters(772,1,0,0),i.alphaState.setAlphaEquationParameters(32774,32774)))}function Rr(e,t,r,i){var n=r&&!(3==t);Mr(e,t,i.overlapMode);var o=e.getBabylonEffect();o.setInt("u_7",t),o.setInt("ufrag_0",t),o.setFloat("ufrag_8",n?1:0);var s=0,a=Fr(i.style.pen);if(a&&a.length>0)for(var l=0;l<a.length;l++)s+=a[l];0==s&&(s=1);var h=0==i.style.pen.headEnd.cap?1:0;o.setFloat("ufrag_5",a&&a.length>0?.5-(a[0]-h)/(2*s):0),o.setFloat("ufrag_4",a&&a.length>0?1/(s*i.style.pen.adjustedLineWidth):0)}function Ar(e,t,r,i,n,o,s,a,l,h,c){if(0!=t||3!=L){var u=-performance.now(),d=e.getBabylonEffect(),p=e.getBabylonEngine();d.setFloat("u_12",i.style.pen.adjustedLineWidth),d.setFloat("u_5",i.style.pen.miterLimit);var f=0,g=Fr(i.style.pen),m=g?g.length:0;if(i.style.pen&&g){for(var y=0;y<m;y++)f+=g[y];f=f>0?f:1,d.setFloat("ufrag_12",f/2),d.setFloat4("ufrag_13",m>=2?g[0]/2:f,m>=3?g[0]/2+g[1]:f,m>=4?g[0]/2+g[1]+g[2]:f,m>=5?g[0]/2+g[1]+g[2]+g[3]:f)}else d.setFloat("ufrag_12",.5),d.setFloat4("ufrag_13",1,1,1,1);d.setFloat("u_14",n.length>0&&n[0].isArrowHead||0==i.style.pen.headEnd.cap?1:0);for(var _=0,b=n;_<b.length;_++){var T=b[_];if(Pr(t,r,T,o,a)){var w=(0!=T.fillMode||2==s)&&2==s==T.isArrowHead&&(0==o||1==o&&r),x=T.lineEnabled&&!T.isArrowHead,C=T.isArrowHead&&0==T.fillMode,S=C?x:w,P=C?w:x;d.setMatrix3x3("u_8",T.transform?T.transform.m:v.Identity.m),d.setInt("ufrag_17",a?1:0),a&&d.setFloat("ufrag_12",1/T.endDistance),d.setFloat("ufrag_19",T.isArrowHead&&0==T.fillMode&&h?i.style.pen.adjustedLineWidth/4/h:0);var E=n.length>0&&T.isArrowHead||c?1:i.style.pen?i.style.pen.lineJoin:0;for(d.setInt("u_4",E),d.setInt("ufrag_1",E),y=0;y<T.tapeBuffers.length;y++){var M=T.tapeBuffers[y],R=T.hwTapeBuffers[y],A=T.hwDistanceBuffers?T.hwDistanceBuffers[y]:void 0,I=M.length/4-4;if(p.bindInstancesBuffer(R,xr,!1),A?(d.setInt("u_19",0),p.bindInstancesBuffer(A,Cr,!1)):(d.setInt("u_19",1),e.setDummyPointerAttribute("a_d1"),e.setDummyPointerAttribute("a_d2")),0==M[2]&&T.startDistance!=T.endDistance){var F=Z(i.style.pen.headEnd,i.style.pen.adjustedLineWidthForArrowHead),B=Z(i.style.pen.tailEnd,i.style.pen.adjustedLineWidthForArrowHead);d.setFloat2("ufrag_16",T.startDistance+F,T.endDistance-B)}else d.setFloat2("ufrag_16",0,0);d.setFloat("ufrag_2",S?1:0),d.setFloat("ufrag_3",P?1:0),d.setFloat("ufrag_18",C?1:0),1==t?(d.setFloat("ufrag_6",1),e.setDistanceFieldStencilSumIncrement(!0),e.drawQuadInstances(I),d.setFloat("ufrag_6",-1),e.setDistanceFieldStencilSumIncrement(!1),e.drawQuadInstances(I)):e.drawQuadInstances(I)}}}e.disableInstanceAttribute("a_p0"),e.disableInstanceAttribute("a_p1"),e.disableInstanceAttribute("a_p2"),e.disableInstanceAttribute("a_p3"),e.disableInstanceAttribute("a_p4"),e.disableInstanceAttribute("a_d1"),e.disableInstanceAttribute("a_d2"),u+=performance.now(),l.drawTapeCostMs+=u}}function Ir(e,t,r,i){for(var n=[],o=0,s=br[t];o<s.length;o++){var a=s[o];i&&a.ready||(n.push(a.path),a.ready=!0)}if(n.length>0){var l=new Ce(n);return l.style.pen.lineWidth=4,l.overlapMode=1,r.refresh(e,l,i)}return!0}function Fr(e){if(1!=e.tipType)return e.dashType>=0&&e.dashType<Br.length?Br[e.dashType]:void M.Error(591192836,"unsupported dashType")}var Br=[null,new Float32Array([3,1]),new Float32Array([1,1]),new Float32Array([3,1,1,1]),new Float32Array([3,1,1,1,1,1]),new Float32Array([1,3]),new Float32Array([4,3]),new Float32Array([8,3]),new Float32Array([4,3,1,3]),new Float32Array([8,3,1,3]),new Float32Array([8,3,1,3,1,3])],Lr=function(){function e(){this.m_compatibleGraphicsProcessorId=0}return Object.defineProperty(e.prototype,"tapeBuffers",{get:function(){return this.m_tapeBuffers},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hwTapeBuffers",{get:function(){return this.m_hwTapeBuffers},enumerable:!1,configurable:!0}),e.prototype.releaseGeneratedResources=function(){if(this.m_hwTapeBuffers&&this.m_engine)for(var e=0,t=this.m_hwTapeBuffers;e<t.length;e++){var r=t[e];this.m_engine._releaseBuffer(r)}this.m_hwTapeBuffers=void 0},e.prototype.onFinalization=function(){},e.prototype.refreshCachedTapeBuffers=function(e){return this.m_tapeBuffers||(this.m_tapeBuffers=pr(e,4096).buffers),this.m_tapeBuffers},e.prototype.refreshCachedHwTapeBuffers=function(e,t){if(!this.m_hwTapeBuffers||!this.m_engine||this.m_compatibleGraphicsProcessorId!=t.getUniqueGraphicsProcessorId()){var r=pr(e,4096,!1,!1,void 0),i=t.getBabylonEngine();this.m_hwTapeBuffers=r.buffers.map((function(e){return i.createVertexBuffer(e)})),this.m_compatibleGraphicsProcessorId=t.getUniqueGraphicsProcessorId(),this.m_engine=t.getBabylonEngine()}return this.m_hwTapeBuffers},e}(),Dr=function(){function e(e,t){this.m_state=e,this.m_texture=t}return e.prototype.getState=function(){return this.m_state},e.prototype.getSize=function(){return this.m_texture?this.m_texture.size:void 0},e.prototype.getLogicalCenter=function(){return this.m_texture&&this.m_texture.contentLocation?this.m_texture.contentLocation.logicalCenter:void 0},e.prototype.tryConvertToBufferRGBA=function(){return this.m_texture instanceof zt?this.m_texture.tryConvertToBufferRGBA():void 0},e}(),kr=function(){function e(){this.m_state=0}return e.prototype.releaseGeneratedResources=function(){this.m_texture&&(this.m_texture.release(),this.m_state=2)},e.prototype.onFinalization=function(){},Object.defineProperty(e.prototype,"texture",{get:function(){return this.m_texture},set:function(e){this.m_loader&&(this.m_loader.release(),this.m_loader=void 0),this.m_texture=e,this.m_state=1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"loader",{get:function(){return this.m_loader},set:function(e){this.m_texture&&(this.m_texture=void 0),this.m_loader&&this.m_loader!=e&&this.m_loader.release(),this.m_loader=e,this.m_state=1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return this.m_state},enumerable:!1,configurable:!0}),e}();var Or=new g(1024,1024);function Ur(e){for(var t=e.gradientStops.length,r=new Float32Array(t+2),i=new Float32Array(4*(t+2)),n=0;n<t+2;n++){var o=Math.min(Math.max(n-1,0),t-1),s=e.gradientStops[o].color;r[n]=0==n?0:n==t+1?1:e.gradientStops[o].position,i[4*n+0]=s.r,i[4*n+1]=s.g,i[4*n+2]=s.b,i[4*n+3]=s.a}return{stops:r,colors:i}}var Nr,Vr=[{attributeName:"a_p1",attributeSize:4,offset:16},{attributeName:"a_p2",attributeSize:4,offset:32}],Gr=new g(8,8),zr=[[255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[3,0,3,0,3,0,3,0,3,0,3,0,3,0,3,0],[7,64,29,0,116,0,208,1,64,7,0,29,0,116,1,208],[1,208,0,116,0,29,64,7,208,1,116,0,29,0,7,64],[255,255,3,0,3,0,3,0,3,0,3,0,3,0,3,0],[7,208,29,116,116,29,208,7,208,7,116,29,29,116,7,208],[3,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0],[3,0,0,0,0,3,0,0,3,0,0,0,0,3,0,0],[3,3,0,0,48,48,0,0,3,3,0,0,48,48,0,0],[3,3,48,48,3,3,48,48,3,3,48,48,3,3,48,48],[51,51,12,12,51,51,192,192,51,51,12,12,51,51,192,192],[51,51,204,204,51,51,204,192,51,51,204,204,51,51,192,204],[51,51,204,204,51,51,204,204,51,51,204,204,51,51,204,204],[63,63,204,204,243,243,204,204,63,63,204,204,243,243,204,204],[252,252,207,207,252,252,207,207,252,252,207,207,252,252,207,207],[252,252,255,255,207,207,255,255,252,252,255,255,207,207,255,255],[63,255,255,255,255,63,255,255,63,255,255,255,255,63,255,255],[255,255,255,255,255,255,255,252,255,255,255,255,255,255,252,255],[3,3,12,12,48,48,192,192,3,3,12,12,48,48,192,192],[192,192,48,48,12,12,3,3,192,192,48,48,12,12,3,3],[15,15,60,60,240,240,195,195,15,15,60,60,240,240,195,195],[240,240,60,60,15,15,195,195,240,240,60,60,15,15,195,195],[15,192,63,0,252,0,240,3,192,15,0,63,0,252,3,240],[3,240,0,252,0,63,192,15,240,3,252,0,63,0,15,192],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[255,255,0,0,0,0,0,0,255,255,0,0,0,0,0,0],[204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204],[255,255,0,0,255,255,0,0,255,255,0,0,255,255,0,0],[15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15],[255,255,255,255,0,0,0,0,255,255,255,255,0,0,0,0],[0,0,0,0,3,3,12,12,48,48,192,192,0,0,0,0],[0,0,0,0,192,192,48,48,12,12,3,3,0,0,0,0],[255,0,0,0,0,0,0,0,0,255,0,0,0,0,0,0],[3,0,3,0,3,0,3,0,0,3,0,3,0,3,0,3],[3,0,0,3,12,0,0,48,192,0,0,192,48,0,0,12],[243,192,240,0,0,240,192,243,207,3,15,0,0,15,3,207],[3,192,12,48,48,12,192,3,3,192,12,48,48,12,192,3],[0,0,192,3,48,204,15,0,0,0,192,3,48,204,15,0],[0,192,0,48,0,12,0,3,192,3,48,12,12,48,3,192],[255,255,3,0,3,0,3,0,255,255,0,3,0,3,0,3],[3,3,204,12,48,48,12,204,3,3,192,12,48,48,204,192],[51,51,204,204,51,51,204,204,255,0,255,0,255,0,255,0],[0,0,192,0,0,3,192,0,0,0,3,0,0,192,3,0],[51,51,0,0,3,0,0,0,3,0,0,0,3,0,0,0],[3,0,0,0,48,48,0,0,0,3,0,0,48,48,0,0],[0,240,3,12,12,3,240,0,0,15,0,48,0,192,0,192],[255,255,60,60,255,255,195,195,255,255,60,60,255,255,195,195],[252,252,3,195,3,255,3,255,252,252,195,3,255,3,255,3],[255,255,3,3,3,3,3,3,255,255,3,3,3,3,3,3],[195,195,60,60,60,60,195,195,195,195,60,60,60,60,195,195],[255,0,255,0,255,0,255,0,0,255,0,255,0,255,0,255],[3,48,12,12,48,3,192,0,48,3,12,12,3,48,0,192],[192,0,240,3,252,15,255,63,252,15,240,3,192,0,0,0]];!function(e){e[e.fromBegining=0]="fromBegining",e[e.distanceFieldsReady=1]="distanceFieldsReady",e[e.brushTexturesReady=2]="brushTexturesReady",e[e.fadeReady=3]="fadeReady",e[e.effectsReady=4]="effectsReady"}(Nr||(Nr={}));var Wr=function(){function e(){this.initTextureStage=Nr.fromBegining,this.spriteQuality=0,this.isBlankSlate=!1}return Object.defineProperty(e.prototype,"resolvedFillTexture",{get:function(){var e;return this.fillTexture instanceof Gt?this.fillTexture:null===(e=this.fillTexture)||void 0===e?void 0:e.loader.getTexture(this.fillTexture.wrapMode)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"resolvedLineTexture",{get:function(){var e;return this.lineTexture instanceof Gt?this.lineTexture:null===(e=this.lineTexture)||void 0===e?void 0:e.loader.getTexture(this.lineTexture.wrapMode)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"resolvedPictureTexture",{get:function(){var e;return this.pictureTexture instanceof Gt?this.pictureTexture:null===(e=this.pictureTexture)||void 0===e?void 0:e.loader.getTexture(this.pictureTexture.wrapMode)},enumerable:!1,configurable:!0}),e.prototype.beforeInitTextures=function(e,t){if(this.isBlankSlate=!1,this.clientData=e.clientData,this.hasInvalidTexture(t)&&this.clearTextures(),this.checkDistanceFields(e),this.lastKnownShapeVersion==e.version&&e.alphaTracker.version==this.lastKnownAlphaVersion||(this.clearEffectsTextures(this.lastKnownShapeVersion!=e.version,e.alphaTracker.version!=this.lastKnownAlphaVersion),this.drawDistribution=void 0),this.lastKnownShapeVersion=e.version,this.lastKnownAlphaVersion=e.alphaTracker.version,1==e.getType()){var r=e;r.geometryTracker.version!=this.lastKnownGeometryVersion&&(this.initTextureStage=Nr.fromBegining,this.lastKnownGeometryVersion=r.geometryTracker.version)}},e.prototype.getFulltextureList=function(){for(var e=[this.resolvedFillTexture,this.resolvedLineTexture,this.resolvedPictureTexture,this.innerShadowTexture,this.softEdgesTexture,this.glowTexture,this.shadowTexture,this.reflectionTexture,this.fadeTexture,this.spriteTexture],t=0,r=this.distanceFields||[];t<r.length;t++){var i=r[t];e.push(i.texture)}return this.coutoutLayer&&e.push(this.coutoutLayer.texture),e},e.prototype.getBevelDistanceField=function(){for(var e=0,t=this.distanceFields||[];e<t.length;e++){var r=t[e];if(r.isDisplacementMap)return r}},e.prototype.hasInvalidTexture=function(e){for(var t=this.getFulltextureList(),r=0,i=this.distanceFields||[];r<i.length;r++){var n=i[r];t.push(n.texture)}for(var o=0,s=t;o<s.length;o++){var a=s[o];if(a&&!a.isValidForGraphicsProcessor(e))return!0}return!1},e.prototype.checkDistanceFields=function(e){if(1==e.getType())for(var t=e,r=0,i=this.distanceFields||[];r<i.length;r++){var n=i[r];if(n.geometryUniqueId!=t.geometryTracker.currentUniqueId||n.lastKnownQualitySetting!=It||n.lastKnownLineWidth!=t.style.pen.adjustedLineWidth||n.lastKnownLineWidthForArrowHead!=t.style.pen.adjustedLineWidthForArrowHead||n.lastKnownHitTestSlop!=I)return void this.clearTextures()}},e.prototype.clearBounds=function(){this.initTextureStage=Nr.fromBegining},e.prototype.clearEffectsTextures=function(e,t){this.initTextureStage=Nr.fromBegining,e&&(this.reflectionTexture&&this.reflectionTexture.release(),this.fadeTexture&&this.fadeTexture.release(),this.spriteTexture&&this.spriteTexture.release(),this.reflectionTexture=this.fadeTexture=this.spriteTexture=void 0),t&&(this.innerShadowTexture&&this.innerShadowTexture.release(),this.softEdgesTexture&&this.softEdgesTexture.release(),this.glowTexture&&this.glowTexture.release(),this.shadowTexture&&this.shadowTexture.release(),this.innerShadowTexture=this.softEdgesTexture=this.glowTexture=this.shadowTexture=void 0)},e.prototype.clearBrushTextures=function(){this.fillTexture instanceof Gt&&1==this.fillTexture.releasePolicy&&(this.fillTexture.release(),this.fillTexture=void 0),this.lineTexture instanceof Gt&&1==this.lineTexture.releasePolicy&&(this.lineTexture.release(),this.lineTexture=void 0),this.pictureTexture instanceof Gt&&1==this.pictureTexture.releasePolicy&&(this.pictureTexture.release(),this.pictureTexture=void 0)},e.prototype.clearTextures=function(){this.initTextureStage=Nr.fromBegining;for(var e=0,t=this.distanceFields||[];e<t.length;e++){var r=t[e];r&&r.texture&&r.texture.release()}this.clearBrushTextures(),this.clearEffectsTextures(!0,!0),this.distanceFields=void 0},e.prototype.releaseGeneratedResources=function(){var e;this.clearBounds(),this.clearTextures(),this.isBlankSlate=!0,this.coutoutLayer&&(null===(e=this.coutoutLayer.texture)||void 0===e||e.release(),this.coutoutLayer=void 0)},e.prototype.initFadeTexture=function(e,t,r){if(e.getGraphicsProcessor()){var i=r?13==r.preset?t.changeTracker.currentUniqueId:r.param+":"+r.preset:"";if(!this.fadeTexture||r&&0!=r.preset&&this.fadeTexture.isValid(e)&&this.fadeTexture.tag==i||(this.fadeTexture.release(),this.fadeTexture=void 0),!this.fadeTexture)if(1==t.getType()&&r&&13==r.preset){var n=t;if(n.paths&&n.paths.length>0){var o=new mr("FadeMask/Draw",e,void 0,1,n.mergeMode,0,1,!1);o.generateDrawFadeMask=!0,o.refresh(e,n,!1),this.fadeTexture=o.texture}}else r&&0!=r.preset&&13!=r.preset&&(this.fadeTexture=function(e,t,r,i,n){var o=e.getGraphicsProcessor();if(!o)throw M.Error(592525321,"Graphics processor not initialized");var s=zt.RecycleOrReplace("FadeMask/Standard",t,e,Or,!1,5,!1,1);return s.tag=n,function(e,t,r,i){var n=performance.now(),o=e.activateShaderProgram(4);o.begin(t.tryGetBabylonTextureForRenderToTexture(e),ne.Black,!1);var s=o.getBabylonEffect();s.setInt("ufrag_0",r),s.setFloat("ufrag_1",i),o.drawQuads(1),o.end(),t.renderCost=performance.now()-n}(o,s,r,i),s}(e,this.fadeTexture,r.preset,r.param,i))}},e.prototype.getBrushTexture=function(e){switch(e){case 0:return this.fillTexture;case 1:return this.lineTexture;case 2:return this.pictureTexture}M.Error(591192833,"Invalid brush source")},e.prototype.setBrushTexture=function(e,t){switch(e){case 0:this.fillTexture=t;break;case 1:this.lineTexture=t;break;case 2:this.pictureTexture=t;break;default:M.Error(591192834,"Invalid brush source")}},e.prototype.initBrushTexture=function(e,t,r){var i=this.getBrushTexture(r),n=function(e,t,r,i){var n=e.getGraphicsProcessor();if(n){var o=t instanceof Gt&&!t.isValidForGraphicsProcessor(n),s=t,a=function(e,t){var r=e.getType();if(1==r){var i=e.style;switch(t){case 0:return i.fillBrush;case 1:return i.lineBrush;case 2:return i.pictureBrush}}if(2==r&&0==t)return e.groupFillBrush;M.Error(591192835,"Invalid item or brush")}(r,i);if(a){var l=a.getType();if(6==l){var h=a;if(h.image){var c=a.wrapMode,u=void 0!==c?c:4,d=e.ensureImageRenderData(h.image);2==d.state?M.Error(592472275,"Trying to use deleted texture id:"+h.image.id):0==d.state&&M.Error(592472276,"Trying to use uninitialized texture id:"+h.image.id);var p=d.texture,f=h.pictureEffects||(r instanceof Ce&&2==i?r.style.pictureEffects:void 0);if(d.loader&&r instanceof Ce){var m=Me(r,!1,v.Scale2D(r.transform.scale.abs()));m&&d.loader.prepareForRenderSize(m.size),s={loader:d.loader,wrapMode:u}}else!o&&t instanceof Gt&&(t==p||p&&t.tag==p.changeTracker.currentUniqueId)||(s=!(null==f?void 0:f.hasImpact)&&p&&p.wrapMode!=u?p.cloneWithNewWrapMode("ImageWrapResample",e,u,1):p);if(null==f?void 0:f.hasImpact){var y=s instanceof Gt?s:null==s?void 0:s.loader.getTexture(s.wrapMode);if(y){var _=y.changeTracker.currentUniqueId+"/"+f.changeTracker.currentUniqueId+"/"+u;t instanceof Gt&&!o&&t.tag==_?s=t:(s=function(e,t,r,i,n){if(e.getGraphicsProcessor()){var o=zt.RecycleOrReplace("PictureEffects",t,e,r.size,!1,r.format,!1,1,n);return o.originalSize=r.originalSize,e.drawTextureToTexture(o,r,1,void 0,i),o}}(e,t!=p&&t instanceof zt?t:void 0,y,f,u),s&&(s.tag=_))}}}else s=void 0}else if(7==l){var b=-performance.now();t&&!o&&t instanceof Gt&&t.tag==a.pattern||(s=function(e,t,r){if(!e.getGraphicsProcessor())throw M.Error(592525326,"Graphics processor not initialized");if(!(t<0||t>53)){for(var i=new Uint8Array(64),n=zr[t],o=0;o<16;o++)for(var s=n[o],a=0;a<4;a++){var l=(s&3<<2*a)>>2*a,h=0==l?255:1==l?127:0;i[4*o+a]=h}var c=Gt.CreateFromByteBuffer("Pattern",e,Gr,i,1,0,!1,!1,1);return c.tag=t,c}M.Error(592525327,"pattern out of range")}(e,a.pattern)),b+=performance.now(),e.getCurrentFramePerformanceSummary().patternTextureCostMs+=b}else if(se.IsGradient(l)){var T,w=-performance.now();5==l?((T=t instanceof zt?t:void 0)&&!o&&T.tag==r.changeTracker.currentUniqueId||(r instanceof Ce?s=function(e,t,r,i,n){var o=e.getGraphicsProcessor();if(!o)throw M.Error(592525324,"Graphics processor not initialized");if(5!=i.getType())throw M.Error(592525325,"This is not a path gradient");var s=Me(r,!1);if(s&&!s.isEmpty()&&r.paths){var a=s.size.multiply(r.transform.scale.abs()),l=a.scale(Math.min(1,Lt/a.x,Lt/a.y)),h=new g(Math.floor(l.x+1),Math.floor(l.y+1)),c=zt.RecycleOrReplace("PathGradient",t,e,h,!1,5,!1,1);return c.tag=r.changeTracker.currentUniqueId,function(e,t,r,i,n,o){var s=performance.now(),a=Ur(r),l=a.colors,h=a.colors.length<4?ne.Transparent:new ne(l[l.length-4],l[l.length-3],l[l.length-2],l[l.length-1]),c=e.activateShaderProgram(2);c.begin(t.tryGetBabylonTextureForRenderToTexture(e),h,!1);var u=c.getBabylonEffect(),d=c.getBabylonEngine();if(u.setInt("u_0",1),u.setVector2("u_1",n),u.setVector2("u_2",o),u.setFloatArray("bfrag_0",a.stops),u.setFloatArray4("bfrag_1",a.colors),u.setInt("ufrag_0",0),u.setInt("ufrag_3",r&&r.isGammaCorrected?1:0),u.setInt("ufrag_4",r.blendBellShape?1:0),u.setVector2("ufrag_5",r.blendBellShape||g.Zero),i){for(var p=0,f=i;p<f.length;p++)for(var m=f[p],v=m.transform.toMatrix3(),y=pr(m,4096,!0).buffers,_=y.map((function(e){return d.createVertexBuffer(e)})),b=0;b<y.length;b++){var T=y[b].length/4-4;d.bindInstancesBuffer(_[b],Vr,!1),u.setMatrix3x3("u_3",v.m),c.drawQuadInstances(T),d._releaseBuffer(_[b])}c.disableInstanceAttribute("a_p1"),c.disableInstanceAttribute("a_p2")}c.end(),t.renderCost=performance.now()-s}(o,c,i,r.paths,s.center,s.size.inverse()),c}}(e,T,r,a):M.Error(592525320,"Path gradient only supported on Shape items")),w+=performance.now(),e.getCurrentFramePerformanceSummary().pathGradientTextureCostMs+=w):((T=t instanceof zt?t:void 0)&&!o&&T.tag==a.changeTracker.currentUniqueId||(s=function(e,t,r,i){var n=e.getGraphicsProcessor();if(!n)throw M.Error(592525322,"Graphics processor not initialized");var o=r.getType();if(2!=o&&4!=o&&3!=o)throw M.Error(592525323,"Unsupported Gradient type");var s=new g(256,2==o||4==o?1:256),a=2==o?"LinearGradient":4==o?"RectangularGradient":"RadialGradient",l=zt.RecycleOrReplace(a,t,e,s,!1,5,!1,1);return l.tag=r.changeTracker.currentUniqueId,function(e,t,r){var i=performance.now(),n=Ur(r),o=e.activateShaderProgram(2);o.begin(t.tryGetBabylonTextureForRenderToTexture(e),ne.Black,!1);var s=o.getBabylonEffect();o.setDummyPointerAttribute("a_p1"),o.setDummyPointerAttribute("a_p2"),s.setFloatArray("bfrag_0",n.stops),s.setFloatArray4("bfrag_1",n.colors),s.setInt("u_0",0);var a=r&&3==r.getType();if(s.setInt("ufrag_0",a?1:0),s.setInt("ufrag_3",r&&r.isGammaCorrected?1:0),r&&a){var l=r.fillToRect?r.fillToRect.center:new g(.5,.5),h=r.fillFromRect?l.subtract(r.fillFromRect.leftTop).divide(r.fillFromRect.size):l;s.setVector2("ufrag_2",h)}s.setInt("ufrag_4",r.blendBellShape?1:0),s.setVector2("ufrag_5",r.blendBellShape||g.Zero),o.drawQuads(1),o.end(),t.renderCost=performance.now()-i}(n,l,r),l}(e,T,a)),w+=performance.now(),e.getCurrentFramePerformanceSummary().gradientTextureCostMs+=w)}}else s=void 0;return t&&t!=s&&t instanceof Gt&&1==t.releasePolicy&&t.release(),s}}(e,i,t,r);i!=n&&this.setBrushTexture(r,n)},e.prototype.initTextCutoutLayer=function(e,t,r){var i;if(t){this.coutoutLayer=new mr("TextCutoutLayer",e,void 0,1,0,0,1,!1),this.coutoutLayer.isGlyphCacheDisabled=!0;var n=new Ce(t,r.style);this.coutoutLayer.refresh(e,n,!1);var o=Me(n,!1);this.coutoutLayerCenter=null==o?void 0:o.center}else this.coutoutLayer&&(null===(i=this.coutoutLayer.texture)||void 0===i||i.release(),this.coutoutLayer=void 0)},e}(),Hr=function(){function e(){}return e.prototype.releaseGeneratedResources=function(){this.texture&&1==this.texture.releasePolicy&&this.texture.release(),this.textureDeltaWhite&&1==this.textureDeltaWhite.releasePolicy&&this.textureDeltaWhite.release(),this.texturePicture&&1==this.texturePicture.releasePolicy&&this.texturePicture.release()},e.prototype.onFinalization=function(){},e}(),jr=function(){function e(){}return e.prototype.releaseGeneratedResources=function(){},e.prototype.onFinalization=function(){},e}();function qr(e,t,r,i){var n=e.getGraphicsProcessor();if(n){if(At.readBooleanOrDefault("morphOptimizeImages",!1)&&1==t.contents.length&&t.contents[0].item instanceof Ce){var o=t.contents[0].item,s=function(e){if(e.isSolidRectGeometry()&&!e.style.hasLine&&!e.effects.hasEffects&&!e.shape3D&&!e.text&&(e.style.fillBrush||e.style.pictureBrush)&&(!e.style.fillBrush||!e.style.pictureBrush)){var t=e.style.fillBrush||e.style.pictureBrush;if(t instanceof ce&&t.isStretched&&t.scale.equals(g.One)&&t.offset.equals(g.Zero)&&t.rotateWithShape&&1===t.opacity)return t.image}}(o);if(s){var a=e.getTextureFromImage(s),l=Me(o,!1,t.parentTransform?t.parentTransform.toMatrix3():v.Identity);if(a&&l){var h=a.tryUseBabylonTexture(n,void 0,"MorphKeyFrameImgRef");if(h){var c=new Gt("MorphKeyFrameImgRef",e,h,a.size,a.format,a.wrapMode,2),u=c.size.divide(l.size);return c.contentLocation={logicalCenter:t.location.center.subtract(r.leftTop).multiply(u),logicalSize:t.location.size.multiply(u),physicalCenter:c.size.scale(.5),physicalSize:c.size,rotation:t.location.rotation-o.transform.rotation,flipX:t.location.flipX,flipY:t.location.flipY},c}}}}for(var d=Math.min(It,Lt/Math.max(r.width,r.height)),p=new zt("MorphKeyFrame",e,new g(Math.max(1,Math.ceil(r.size.x*d)),Math.max(1,Math.ceil(r.size.y*d))),1),f=new y(r.leftTop.negate(),new g(d,d)),m=0;m<t.contents.length;m++){var _=t.contents[m],b=void 0,T=void 0;i&&_.item instanceof Ce?((T=_.item.clone()).style.pictureBrush=void 0,T.style.fillBrush=new ae(i),e.tryPrepareItemInWebGlScope(T,n,!0,void 0)||M.Error(572073354,"Failed to prepare color clone"),b=T):b=_.item,e.renderItemInWebGLRenderScope(b,0==m?ne.Transparent:void 0,{target:p,noSubtree:!_.includeSubtree,textRange:_.textRange,transform:v.FromTransforms(t.parentTransform||v.Identity,v.FromTransforms(f))}),T&&T.clearCache()}return t.location?p.contentLocation={logicalCenter:t.location.center.subtract(r.leftTop).scale(d),logicalSize:t.location.size.scale(d),physicalCenter:p.size.scale(.5),physicalSize:p.size,rotation:t.location.rotation,flipX:t.location.flipX,flipY:t.location.flipY}:M.Error(572073355,"No KeyFrame location"),p}M.Error(572073353,"glContext must be provided")}function Xr(e){return e.isStretched&&(4==e.wrapMode||void 0===e.wrapMode)&&1==e.rotateWithShape&&1==e.opacity}function Kr(e){if(At.readBooleanOrDefault("morphPictureCrop",!0)&&2==e.keyFrames.length){var t=e.keyFrames[0],r=e.keyFrames[1];if(t&&r&&1==t.contents.length&&1==r.contents.length){var i=t.contents[0],n=r.contents[0];if(i&&n&&i.item instanceof Ce&&n.item instanceof Ce){var o=i.item.style.pictureBrush,s=n.item.style.pictureBrush;if(o&&s&&Xr(o)&&Xr(s)&&(e.hasDynamicContent||!o.scale.equals(s.scale)||!o.offset.equals(s.offset)||o.alignment!=s.alignment)&&i.item.transform.scale.sign().equals(n.item.transform.scale.sign()))return!0}}}return!1}!function(){function e(){}e.prototype.tryInitMorphKeyFrame=function(e,t,r){var i,n,o=e.ensureMorphKeyFrameRenderData(t);if(!(o.texture&&!o.texture.size.isZero()&&o.texture.isValid(e)&&(!o.textureDeltaWhite||o.textureDeltaWhite.isValid(e))&&(!o.texturePicture||o.texturePicture.isValid(e)))&&r&&(o.texture&&(e.fixedMemoryLeakAmounts.pictureCropBWTextures+=o.texture.memoryUsage),o.textureDeltaWhite&&(e.fixedMemoryLeakAmounts.pictureCropBWTextures+=o.textureDeltaWhite.memoryUsage)),r){var s=function(e,t){if(1==t.contents.length){var r=t.contents[0];if(r&&r.item instanceof Ce){var i=r.item.style.pictureBrush;if(i&&i.image){var n=e.getTextureFromImageBrush(i),o=Ie(i.alignment).multiply(g.One.subtract(i.scale)),s=_.FromSize(i.scale).translate(o.add(i.offset).subtract(new g(.5,.5)));if(n)return{texture:n,pictureRelativeBounds:s}}}}M.Error(572073356,"Texture not found")}(e,t);s&&(o.texturePicture=s.texture,o.pictureRelativeBounds=s.pictureRelativeBounds)}if(o.texture&&!o.texture.size.isZero()&&o.texture.isValid(e)&&(!o.textureDeltaWhite||o.textureDeltaWhite.isValid(e)))return!0;for(var a=void 0,l=0,h=t.contents;l<h.length;l++){var c=h[l],u=v.FromTransforms(t.parentTransform||v.Identity,c.item.animationTransform||v.Identity),d=Re(c.item,c.includeSubtree||null!=c.textRange,31,31,u,c.includeSubtree,c.textRange);a=_.UnionRect(a,d)}return null===(i=o.texture)||void 0===i||i.release(),null===(n=o.textureDeltaWhite)||void 0===n||n.release(),a&&(t.location?r?(o.texture=qr(e,t,a,ne.Black),o.textureDeltaWhite=qr(e,t,a,ne.White)):o.texture=qr(e,t,a,void 0):M.Error(591672911,"No KeyFrame location")),!0},e.prototype.tryPrepareMorphInRenderScope=function(e,t,r){if(!e.getGraphicsProcessor())return M.Error(575942947,"glContext must be provided"),!1;var i=performance.now();e.m_initDeadline=r?i+r:void 0;for(var n=[],o=0,s=t.elements;o<s.length;o++)for(var a=0,l=(_=s[o]).keyFrames;a<l.length;a++)if(x=l[a]){var h=e.ensureMorphKeyFrameRenderData(x);if(!h.texture||h.texture.size.isZero()||!h.texture.isValid(e))for(var c=function(e){if(e.item instanceof Ce){var t=e.item;if(e.textRange)if(t.text){var r=t.text.getFullRange();r&&r.contains(e.textRange)?e.textRange.equals(r)||t.text.forceSplit(2):M.Error(591672913,"Text KeyFrame out of range: ["+e.textRange.start+", "+e.textRange.last+"], fullRange: "+(r?"["+r.start+", "+r.last+"]":"undefined"))}else M.Error(591672914,"Text KeyFrame on Shape with no Text")}e.item&&!n.find((function(t){return t==e.item}))&&n.push(e.item)},u=0,d=x.contents;u<d.length;u++)c(d[u])}for(var p=0,f=n;p<f.length;p++){var g=f[p],m=e.m_initDeadline?e.m_initDeadline-performance.now():void 0;if(null!=m&&m<=0)return!1;if(!e.tryPrepareItemInWebGlScope(g,e.getGraphicsProcessor(),!0,m))return!1}for(var v=0,y=t.elements;v<y.length;v++)for(var _,b=Kr(_=y[v]),T=0,w=_.keyFrames;T<w.length;T++){var x;if(x=w[T]){if(!this.tryInitMorphKeyFrame(e,x,b))return!1;if(e.initOutOfTime())return!1}}return!0},e.prototype.tryPrepareMorph=function(e,t,r){var i=e.getGraphicsProcessor();if(!i)return M.Error(591672912,"glContext must be provided"),!1;var n=i.isInRenderScope(),o=!1;return(n||i.beginRenderScope())&&(o=this.tryPrepareMorphInRenderScope(e,t,r),n||i.endRenderScope()),o},e.prototype.renderMorph=function(e,t,r,i,n){var o=e.getGraphicsProcessor();if(o){if(!o||o.beginRenderScope()){var s=o.getBabylonEngine();if(this.tryPrepareMorph(e,t,void 0)){for(var a=[],l=0,h=t.elements;l<h.length;l++){for(var c=h[l],u=c.keyFrames.length>0&&c.keyFrames[0]?c.keyFrames[0]:void 0,d=c.keyFrames.length>1&&c.keyFrames[1]?c.keyFrames[1]:void 0,p=u?u.location:d?d.location:void 0,f=d?d.location:p,m=u?e.ensureMorphKeyFrameRenderData(u):void 0,y=d?e.ensureMorphKeyFrameRenderData(d):void 0,b=e.ensureMorphElementRenderData(c),T=m?[m.texture,m.textureDeltaWhite,m.texturePicture]:[void 0,void 0,void 0],w=y?[y.texture,y.textureDeltaWhite,y.texturePicture]:[void 0,void 0,void 0],S=b.layer instanceof nr?[b.layer.textureA,b.layer.textureDeltaWhiteA,b.layer.texturePictureA]:[b.layer?b.layer.textureA:void 0,void 0,void 0],E=b.layer instanceof nr?[b.layer.textureB,b.layer.textureDeltaWhiteB,b.layer.texturePictureB]:[b.layer?b.layer.textureB:void 0,void 0,void 0],R=!1,A=0;A<3;A++)S[A]==T[A]&&E[A]==w[A]||(R=!0);if(p&&f){if(!b.layer||R){var I=void 0,F=void 0,B=void 0;if(u&&d&&u.morphingGrid&&d.morphingGrid){var L=u.morphingGrid.size.x*u.morphingGrid.size.y*2;u.morphingGrid.size.equals(d.morphingGrid.size)&&L>0&&u.morphingGrid.data.length==L&&d.morphingGrid.data.length==L?(I=s.createVertexBuffer(u.morphingGrid.data),F=s.createVertexBuffer(d.morphingGrid.data),B=Yt.CreateGridXY(o,u.morphingGrid.size.x,u.morphingGrid.size.y,new _(-1,-1,1,1))):M.Error(591672917,"Wrong morphing grid size")}else(u&&u.morphingGrid||d&&d.morphingGrid)&&M.Error(591672918,"Morphing grids should come by pair");b.layer=T[0]&&w[0]&&T[1]&&w[1]&&T[2]&&w[2]?new nr(T[0],w[0],T[1],w[1],T[2],w[2],I,F,B,t.panVector):new ir(T[0],w[0],I,F,B,t.panVector),b.layer.clientObject=c}if(b.layer){var D=u?u.zPosition:d?d.zPosition:0,k=d?d.zPosition:D,O=!(u&&d||t.panVector);if(b.layer.progress=O?x(u?3*r:3*r-2,0,1):r,b.layer.contentCenter=g.InterpolateLinear(p.center,f.center,r),b.layer.contentSize=g.InterpolateLinear(p.size,f.size,r),b.layer.contentFlip=g.InterpolateLinear(g.Flip(p.flipX,p.flipY),g.Flip(f.flipX,f.flipY),r),b.layer.contentRotation=P(p.rotation,f.rotation,r,c.rotateClockwise),b.layer.depth=C(D,k,r),b.layer instanceof nr){var U=u?e.ensureMorphKeyFrameRenderData(u).pictureRelativeBounds:void 0,N=d?e.ensureMorphKeyFrameRenderData(d).pictureRelativeBounds:void 0;if(U&&N){var V=new _(C(U.left,N.left,r),C(U.top,N.top,r),C(U.right,N.right,r),C(U.bottom,N.bottom,r)),G=b.layer.contentSize,z=V.size.multiply(G),W=V.center.multiply(G);b.layer.pictureTransformUV=v.Translation2D(W.negate()).multiply(v.Scale2D(z.inverse()))}else M.Error(572073352,"PictureMorphLayer needs pictureCrop"),b.layer.pictureTransformUV=void 0}a.push(b.layer)}}}o.updateViewportSize();var H=o.getCurrentViewportSize(),j=o.activateShaderProgram(1);j.begin(void 0,i,!0),a.sort((function(e,t){return e.depth-t.depth}));for(var q=0;q<a.length;q++){var X=a[q];X.depthFar=1-q/t.elements.length,X.depthNear=1-(q+.9)/t.elements.length,hr(o,X,j,H,n?n.toMatrix3():void 0,void 0)}j.end(),o.endRenderScope()}else M.Error(591672916,"failed to initialize Morph")}}else M.Error(591672915,"glContext must be provided")}}();var Yr=function(){function e(){this.renderers=[]}return e.prototype.dumpLastScene=function(){console.log(this.lastRenderer&&this.lastScene?this.lastRenderer.getDebugString(this.lastScene):void 0)},e.OnRender=function(t,r){if(At.readBooleanOrDefault("debugTool",!1)){var i=window;i.shapeBuilderDebugTool||(i.shapeBuilderDebugTool=new e);var n=i.shapeBuilderDebugTool;if(n.lastRenderer=t,n.lastScene=1==r.length?r[0].item:void 0,r.length>1){for(var o=new Se,s=0,a=r;s<a.length;s++){var l=a[s];o.items.push(l.item)}n.lastScene=o}n.renderers.includes(t)||n.renderers.push(t)}},e}();function $r(e,t,r,i,n){if(!r)return v.Identity;var o=r.getType();if(7==o)return v.Scale2D(n.scale(1/16));var s=se.IsGradient(o);if(6!=o&&!s)return v.Identity;var a=r.rotateWithShape,l=0,h=a?v.Scale2D(t.transform.scale):t.transform.toMatrix3(),c=Me(t,i,h),u=t.fillBoundsOverride?t.fillBoundsOverride:c;if(t.fillBoundsOverride&&u&&a&&(u=u.transformedBounds(v.FromTransforms(t.transform.toInverseMatrix3(),h))),!c||!u)return v.Identity;var d=u.size,p=g.One,f=g.Zero,m=!0,y=4;if(6==o){var b=r;if(f=b.offset,p=b.scale.abs(),m=b.isStretched,y=b.alignment,m){if(p=p.multiply(d),b.fillToPreserveAspectRatio)if(x=e.getTextureFromImageBrush(b)){var T=x.originalSize.x/x.originalSize.y,w=d.x/d.y;p=p.multiply(new g(T>w?T/w:1,T<w?w/T:1))}else M.Error(524026452,"No texture");f=f.multiply(d)}else{var x;(x=e.getTextureFromImageBrush(b))?p=p.multiply(x.originalSize):M.Error(590960595,"No texture")}}else if(5==o)p=d;else if(s){var C=r;if(p=C.fillFromRect?C.fillFromRect.size:g.One,f=(C.fillFromRect?C.fillFromRect.center:g.Zero).subtract(new g(.5,.5)).multiply(d),m=C.isStretched||4==o,2==o){p=p.multiply(d);var S=m?_.FromSize(g.One):_.FromSize(p),P=S.transformedBounds(v.RotationZ(C.angle));p=P?p.scale(P.width/S.width):p,l-=C.angle}else m?p=p.multiply(d):(p=p.scale(Math.max(d.x,d.y)),3==o&&(p=p.scale(Math.sqrt(d.x*d.x+d.y*d.y)/Math.max(d.x,d.y))))}else p=p.multiply(d);var E=new _(-d.x/2+p.x/2,-d.y/2+p.y/2,d.x/2-p.x/2,d.y/2-p.y/2);f=f.add(Ie(y,E)).multiply(new g(1,-1));var R=v.Identity;return R=(R=R.multiply(v.Translation2D(c.center.subtract(u.center)))).multiply(v.Scale2D(new g(1,-1))),a||(R=(R=R.multiply(v.Scale2D(t.transform.scale.sign()))).multiply(v.RotationZ(-t.transform.rotation))),R=R.multiply(v.Translation2D(f.negate())),2==o&&(R=R.multiply(v.Translation2D(u.center.subtract(c.center))),m&&(R=R.multiply(v.Scale2D(d.inverse()))),R=R.multiply(v.RotationZ(-l)),m&&(R=R.multiply(v.Scale2D(d))),R=R.multiply(v.Translation2D(c.center.subtract(u.center)))),(R=R.multiply(v.Scale2D(p.inverse()))).multiply(v.Scale2D(new g(1,-1)))}function Zr(e,t,r,i,n,o,s,a,l,h,c){var u=e.getGraphicsProcessor();if(u){var d=Me(o,!1);if(d){var p=new or(r?r.texture:void 0,Vt(d,o.transform),o.style);if(p.fillTexture=t.resolvedFillTexture||void 0,p.lineTexture=t.resolvedLineTexture||void 0,p.pictureTexture=t.resolvedPictureTexture||void 0,p.innerShadowTexture=t.innerShadowTexture||void 0,p.softEdgesTexture=t.softEdgesTexture||void 0,p.fillTransformUV=$r(e,o,o.style.fillBrush,!1,s),p.pictureTransformUV=$r(e,o,o.style.pictureBrush,!1,s),p.lineTransformUV=$r(e,o,o.style.lineBrush,!0,s),p.localClipRect=c,p.fillBrightness=r?r.getFillBrightness():0,p.mergeMode=o.mergeMode,p.distanceFieldMode=r?r.distanceFieldMode:2,p.distRangeSize=r?r.distRangeSize:0,p.softEdges=o.effects&&16&i?o.effects.softEdges:void 0,p.innerShadow=o.effects&&8&i?o.effects.innerShadow:void 0,p.blendingMode=o.style.blendingMode,p.fillBoundsOverride=o.fillBoundsOverride,(0==l||7==l)&&t.fade&&(p.fadeInfo={fade:t.fade,fadeTexture:t.fadeTexture}),p.clientObject=t,o.text&&0!=o.text.renderMode)if(o.text&&o.text.cache instanceof it&&t.coutoutLayer&&t.coutoutLayer.texture&&t.coutoutLayerCenter){p.textRenderMode=o.text.renderMode;var f=t.coutoutLayer.texture.contentLocation.logicalSize.scale(1/t.coutoutLayer.contentQuality),g=d.multiply(o.transform.scale.abs()),m=t.coutoutLayerCenter;p.textCutoutTransform=v.Scale2D(o.transform.scale.sign()),p.textCutoutTransform=p.textCutoutTransform.multiply(v.Translation2D(g.center)),p.textCutoutTransform=p.textCutoutTransform.multiply(o.text.frameToShape.toInverseMatrix3()),p.textCutoutTransform=p.textCutoutTransform.multiply(v.Translation2D(o.transform.preTranslation.multiply(o.transform.scale.abs()).subtract(m))),p.textCutoutTransform=p.textCutoutTransform.multiply(v.Scale2D(g.size.divide(f))),p.textCutoutTexture=t.coutoutLayer.texture}else if(2!=o.text.renderMode)return;var y=performance.now();hr(u,p,n,s,a,5==l?ne.White:h,l),e.onLayerRendered(3==o.role?"text":"shape","SDF",y,p)}else M.Error(588006215,"Unable to get bounds")}else M.Error(572867293,"Unable to get graphicsProcessor")}var Jr=function(){function e(){}return e._AddLogEntry=function(t){e._LogCache=t+e._LogCache,e.OnNewCacheEntry&&e.OnNewCacheEntry(t)},e._FormatMessage=function(e){var t=function(e){return e<10?"0"+e:""+e},r=new Date;return"["+t(r.getHours())+":"+t(r.getMinutes())+":"+t(r.getSeconds())+"]: "+e},e._LogDisabled=function(e){},e._LogEnabled=function(t){var r=e._FormatMessage(t);console.log("BJS - "+r);var i="<div style='color:white'>"+r+"</div><br>";e._AddLogEntry(i)},e._WarnDisabled=function(e){},e._WarnEnabled=function(t){var r=e._FormatMessage(t);console.warn("BJS - "+r);var i="<div style='color:orange'>"+r+"</div><br>";e._AddLogEntry(i)},e._ErrorDisabled=function(e){},e._ErrorEnabled=function(t){e.errorsCount++;var r=e._FormatMessage(t);console.error("BJS - "+r);var i="<div style='color:red'>"+r+"</div><br>";e._AddLogEntry(i)},Object.defineProperty(e,"LogCache",{get:function(){return e._LogCache},enumerable:!1,configurable:!0}),e.ClearLogCache=function(){e._LogCache="",e.errorsCount=0},Object.defineProperty(e,"LogLevels",{set:function(t){(t&e.MessageLogLevel)===e.MessageLogLevel?e.Log=e._LogEnabled:e.Log=e._LogDisabled,(t&e.WarningLogLevel)===e.WarningLogLevel?e.Warn=e._WarnEnabled:e.Warn=e._WarnDisabled,(t&e.ErrorLogLevel)===e.ErrorLogLevel?e.Error=e._ErrorEnabled:e.Error=e._ErrorDisabled},enumerable:!1,configurable:!0}),e.NoneLogLevel=0,e.MessageLogLevel=1,e.WarningLogLevel=2,e.ErrorLogLevel=4,e.AllLogLevel=7,e._LogCache="",e.errorsCount=0,e.Log=e._LogEnabled,e.Warn=e._WarnEnabled,e.Error=e._ErrorEnabled,e}(),Qr=function(){function e(){}return Object.defineProperty(e,"LastCreatedEngine",{get:function(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]},enumerable:!1,configurable:!0}),Object.defineProperty(e,"LastCreatedScene",{get:function(){return this._LastCreatedScene},enumerable:!1,configurable:!0}),e.Instances=new Array,e._LastCreatedScene=null,e.UseFallbackTexture=!0,e.FallbackTexture="",e}(),ei=function(){function e(){}return e.IsWindowObjectExist=function(){return"undefined"!=typeof window},e.IsNavigatorAvailable=function(){return"undefined"!=typeof navigator},e.IsDocumentAvailable=function(){return"undefined"!=typeof document},e.GetDOMTextContent=function(e){for(var t="",r=e.firstChild;r;)3===r.nodeType&&(t+=r.textContent),r=r.nextSibling;return t},e}(),ti=function(){function e(){}return e.EndsWith=function(e,t){return-1!==e.indexOf(t,e.length-t.length)},e.StartsWith=function(e,t){return!!e&&0===e.indexOf(t)},e.Decode=function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",r=0;r<e.byteLength;r++)t+=String.fromCharCode(e[r]);return t},e.EncodeArrayBufferToBase64=function(e){for(var t,r,i,n,o,s,a,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",h="",c=0,u=ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e);c<u.length;)n=(t=u[c++])>>2,o=(3&t)<<4|(r=c<u.length?u[c++]:Number.NaN)>>4,s=(15&r)<<2|(i=c<u.length?u[c++]:Number.NaN)>>6,a=63&i,isNaN(r)?s=a=64:isNaN(i)&&(a=64),h+=l.charAt(n)+l.charAt(o)+l.charAt(s)+l.charAt(a);return h},e.PadNumber=function(e,t){for(var r=String(e);r.length<t;)r="0"+r;return r},e}(),ri=function(){function e(){this.children=[]}return e.prototype.isValid=function(e){return!0},e.prototype.process=function(e,t){var r="";if(this.line){var i=this.line,n=t.processor;n&&(n.lineProcessor&&(i=n.lineProcessor(i,t.isFragment)),n.attributeProcessor&&ti.StartsWith(this.line,"attribute")?i=n.attributeProcessor(this.line):n.varyingProcessor&&ti.StartsWith(this.line,"varying")?i=n.varyingProcessor(this.line,t.isFragment):(n.uniformProcessor||n.uniformBufferProcessor)&&ti.StartsWith(this.line,"uniform")&&(/uniform (.+) (.+)/.test(this.line)?n.uniformProcessor&&(i=n.uniformProcessor(this.line,t.isFragment)):n.uniformBufferProcessor&&(i=n.uniformBufferProcessor(this.line,t.isFragment),t.lookForClosingBracketForUniformBuffer=!0)),n.endOfUniformBufferProcessor&&t.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(t.lookForClosingBracketForUniformBuffer=!1,i=n.endOfUniformBufferProcessor(this.line,t.isFragment))),r+=i+"\r\n"}return this.children.forEach((function(i){r+=i.process(e,t)})),this.additionalDefineKey&&(e[this.additionalDefineKey]=this.additionalDefineValue||"true"),r},e}(),ii=function(){function e(){}return Object.defineProperty(e.prototype,"currentLine",{get:function(){return this._lines[this.lineIndex]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canRead",{get:function(){return this.lineIndex<this._lines.length-1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lines",{set:function(e){this._lines=[];for(var t=0,r=e;t<r.length;t++){var i=r[t];if("#"!==i[0])for(var n=i.split(";"),o=0;o<n.length;o++){var s=n[o];(s=s.trim())&&this._lines.push(s+(o!==n.length-1?";":""))}else this._lines.push(i)}},enumerable:!1,configurable:!0}),e}(),ni=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,p.ZT)(t,e),t.prototype.process=function(e,t){for(var r=0;r<this.children.length;r++){var i=this.children[r];if(i.isValid(e))return i.process(e,t)}return""},t}(ri),oi=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,p.ZT)(t,e),t.prototype.isValid=function(e){return this.testExpression.isTrue(e)},t}(ri),si=function(){function e(){}return e.prototype.isTrue=function(e){return!0},e.postfixToInfix=function(t){for(var r=[],i=0,n=t;i<n.length;i++){var o=n[i];if(void 0===e._OperatorPriority[o])r.push(o);else{var s=r[r.length-1],a=r[r.length-2];r.length-=2,r.push("("+a+o+s+")")}}return r[r.length-1]},e.infixToPostfix=function(t){for(var r=[],i=-1,n=function(){""!==(h=h.trim())&&(r.push(h),h="")},o=function(t){i<e._Stack.length-1&&(e._Stack[++i]=t)},s=function(){return e._Stack[i]},a=function(){return-1===i?"!!INVALID EXPRESSION!!":e._Stack[i--]},l=0,h="";l<t.length;){var c=t.charAt(l),u=l<t.length-1?t.substr(l,2):"";if("("===c)h="",o(c);else if(")"===c){for(n();-1!==i&&"("!==s();)r.push(a());a()}else if(e._OperatorPriority[u]>1){for(n();-1!==i&&e._OperatorPriority[s()]>=e._OperatorPriority[u];)r.push(a());o(u),l++}else h+=c;l++}for(n();-1!==i;)"("===s()?a():r.push(a());return r},e._OperatorPriority={")":0,"(":1,"||":2,"&&":3},e._Stack=["","","","","","","","","","","","","","","","","","","",""],e}(),ai=function(e){function t(t,r){void 0===r&&(r=!1);var i=e.call(this)||this;return i.define=t,i.not=r,i}return(0,p.ZT)(t,e),t.prototype.isTrue=function(e){var t=void 0!==e[this.define];return this.not&&(t=!t),t},t}(si),li=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,p.ZT)(t,e),t.prototype.isTrue=function(e){return this.leftOperand.isTrue(e)||this.rightOperand.isTrue(e)},t}(si),hi=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,p.ZT)(t,e),t.prototype.isTrue=function(e){return this.leftOperand.isTrue(e)&&this.rightOperand.isTrue(e)},t}(si),ci=function(e){function t(t,r,i){var n=e.call(this)||this;return n.define=t,n.operand=r,n.testValue=i,n}return(0,p.ZT)(t,e),t.prototype.isTrue=function(e){var t=e[this.define];void 0===t&&(t=this.define);var r=!1,i=parseInt(t),n=parseInt(this.testValue);switch(this.operand){case">":r=i>n;break;case"<":r=i<n;break;case"<=":r=i<=n;break;case">=":r=i>=n;break;case"==":r=i===n}return r},t}(si),ui=/defined\s*?\((.+?)\)/g,di=/defined\s*?\[(.+?)\]/g,pi=function(){function e(){}return e.Process=function(e,t,r,i){var n=this;this._ProcessIncludes(e,t,(function(e){var o=n._ProcessShaderConversion(e,t,i);r(o)}))},e._ProcessPrecision=function(e,t){var r=t.shouldUseHighPrecisionShader;return-1===e.indexOf("precision highp float")?e=r?"precision highp float;\n"+e:"precision mediump float;\n"+e:r||(e=e.replace("precision highp float","precision mediump float")),e},e._ExtractOperation=function(e){var t=/defined\((.+)\)/.exec(e);if(t&&t.length)return new ai(t[1].trim(),"!"===e[0]);for(var r="",i=0,n=0,o=["==",">=","<=","<",">"];n<o.length&&(r=o[n],!((i=e.indexOf(r))>-1));n++);if(-1===i)return new ai(e);var s=e.substring(0,i).trim(),a=e.substring(i+r.length).trim();return new ci(s,r,a)},e._BuildSubExpression=function(e){e=e.replace(ui,"defined[$1]");for(var t=[],r=0,i=si.infixToPostfix(e);r<i.length;r++){var n=i[r];if("||"!==n&&"&&"!==n)t.push(n);else if(t.length>=2){var o=t[t.length-1],s=t[t.length-2];t.length-=2;var a="&&"==n?new hi:new li;"string"==typeof o&&(o=o.replace(di,"defined($1)")),"string"==typeof s&&(s=s.replace(di,"defined($1)")),a.leftOperand="string"==typeof s?this._ExtractOperation(s):s,a.rightOperand="string"==typeof o?this._ExtractOperation(o):o,t.push(a)}}var l=t[t.length-1];return"string"==typeof l&&(l=l.replace(di,"defined($1)")),"string"==typeof l?this._ExtractOperation(l):l},e._BuildExpression=function(e,t){var r=new oi,i=e.substring(0,t),n=e.substring(t);return n=n.substring(0,(n.indexOf("//")+1||n.length+1)-1).trim(),r.testExpression="#ifdef"===i?new ai(n):"#ifndef"===i?new ai(n,!0):this._BuildSubExpression(n),r},e._MoveCursorWithinIf=function(e,t,r){for(var i=e.currentLine;this._MoveCursor(e,r);){var n=(i=e.currentLine).substring(0,5).toLowerCase();if("#else"===n){var o=new ri;return t.children.push(o),void this._MoveCursor(e,o)}if("#elif"===n){var s=this._BuildExpression(i,5);t.children.push(s),r=s}}},e._MoveCursor=function(e,t){for(;e.canRead;){e.lineIndex++;var r=e.currentLine,i=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/.exec(r);if(i&&i.length)switch(i[0]){case"#ifdef":var n=new ni;t.children.push(n);var o=this._BuildExpression(r,6);n.children.push(o),this._MoveCursorWithinIf(e,n,o);break;case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":n=new ni,t.children.push(n),o=this._BuildExpression(r,7),n.children.push(o),this._MoveCursorWithinIf(e,n,o);break;case"#if":n=new ni,o=this._BuildExpression(r,3),t.children.push(n),n.children.push(o),this._MoveCursorWithinIf(e,n,o)}else{var s=new ri;if(s.line=r,t.children.push(s),"#"===r[0]&&"d"===r[1]){var a=r.replace(";","").split(" ");s.additionalDefineKey=a[1],3===a.length&&(s.additionalDefineValue=a[2])}}}return!1},e._EvaluatePreProcessors=function(e,t,r){var i=new ri,n=new ii;return n.lineIndex=-1,n.lines=e.split("\n"),this._MoveCursor(n,i),i.process(t,r)},e._PreparePreProcessors=function(e){for(var t={},r=0,i=e.defines;r<i.length;r++){var n=i[r].replace("#define","").replace(";","").trim().split(" ");t[n[0]]=n.length>1?n[1]:""}return t.GL_ES="true",t.__VERSION__=e.version,t[e.platformName]="true",t},e._ProcessShaderConversion=function(e,t,r){var i=this._ProcessPrecision(e,t);if(!t.processor)return i;if(-1!==i.indexOf("#version 3"))return i.replace("#version 300 es","");var n=t.defines,o=this._PreparePreProcessors(t);return t.processor.preProcessor&&(i=t.processor.preProcessor(i,n,t.isFragment)),i=this._EvaluatePreProcessors(i,o,t),t.processor.postProcessor&&(i=t.processor.postProcessor(i,n,t.isFragment,r)),i},e._ProcessIncludes=function(t,r,i){for(var n=this,o=/#include<(.+)>(\((.*)\))*(\[(.*)\])*/g,s=o.exec(t),a=new String(t),l=!1;null!=s;){var h=s[1];if(-1!==h.indexOf("__decl__")&&(h=h.replace(/__decl__/,""),r.supportsUniformBuffers&&(h=(h=h.replace(/Vertex/,"Ubo")).replace(/Fragment/,"Ubo")),h+="Declaration"),!r.includesShadersStore[h]){var c=r.shadersRepository+"ShadersInclude/"+h+".fx";return void e._FileToolsLoadFile(c,(function(e){r.includesShadersStore[h]=e,n._ProcessIncludes(a,r,i)}))}var u=r.includesShadersStore[h];if(s[2])for(var d=s[3].split(","),p=0;p<d.length;p+=2){var f=new RegExp(d[p],"g"),g=d[p+1];u=u.replace(f,g)}if(s[4]){var m=s[5];if(-1!==m.indexOf("..")){var v=m.split(".."),y=parseInt(v[0]),_=parseInt(v[1]),b=u.slice(0);u="",isNaN(_)&&(_=r.indexParameters[v[1]]);for(var T=y;T<_;T++)r.supportsUniformBuffers||(b=b.replace(/light\{X\}.(\w*)/g,(function(e,t){return t+"{X}"}))),u+=b.replace(/\{X\}/g,T.toString())+"\n"}else r.supportsUniformBuffers||(u=u.replace(/light\{X\}.(\w*)/g,(function(e,t){return t+"{X}"}))),u=u.replace(/\{X\}/g,m)}a=a.replace(s[0],u),l=l||u.indexOf("#include<")>=0,s=o.exec(t)}l?this._ProcessIncludes(a.toString(),r,i):i(a)},e._FileToolsLoadFile=function(e,t,r,i,n,o){throw Mt.WarnImport("FileTools")},e}(),fi=function(){function e(t,r,i,n,o,s,a,l,h,c){var u,d=this;void 0===n&&(n=null),void 0===s&&(s=null),void 0===a&&(a=null),void 0===l&&(l=null),void 0===h&&(h=null),this.name=null,this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new Pt,this.onErrorObservable=new Pt,this._onBindObservable=null,this._wasPreviouslyReady=!1,this._bonesComputationForcedToCPU=!1,this._multiTarget=!1,this._uniformBuffersNames={},this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._pipelineContext=null,this._valueCache={},this.name=t;var p,f,g=null;if(r.attributes){var m=r;if(this._engine=i,this._attributesNames=m.attributes,this._uniformsNames=m.uniformsNames.concat(m.samplers),this._samplerList=m.samplers.slice(),this.defines=m.defines,this.onError=m.onError,this.onCompiled=m.onCompiled,this._fallbacks=m.fallbacks,this._indexParameters=m.indexParameters,this._transformFeedbackVaryings=m.transformFeedbackVaryings||null,this._multiTarget=!!m.multiTarget,m.uniformBuffersNames){this._uniformBuffersNamesList=m.uniformBuffersNames.slice();for(var v=0;v<m.uniformBuffersNames.length;v++)this._uniformBuffersNames[m.uniformBuffersNames[v]]=v}g=null!==(u=m.processFinalCode)&&void 0!==u?u:null}else this._engine=o,this.defines=null==s?"":s,this._uniformsNames=i.concat(n),this._samplerList=n?n.slice():[],this._attributesNames=r,this._uniformBuffersNamesList=[],this.onError=h,this.onCompiled=l,this._indexParameters=c,this._fallbacks=a;this._attributeLocationByName={},this.uniqueId=e._uniqueIdSeed++;var y=ei.IsWindowObjectExist()?this._engine.getHostDocument():null;t.vertexSource?p="source:"+t.vertexSource:t.vertexElement?(p=y?y.getElementById(t.vertexElement):null)||(p=t.vertexElement):p=t.vertex||t,t.fragmentSource?f="source:"+t.fragmentSource:t.fragmentElement?(f=y?y.getElementById(t.fragmentElement):null)||(f=t.fragmentElement):f=t.fragment||t;var _={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:this._engine._shaderProcessor,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:e.ShadersRepository,includesShadersStore:e.IncludesShadersStore,version:(100*this._engine.webGLVersion).toString(),platformName:this._engine.webGLVersion>=2?"WEBGL2":"WEBGL1"};this._loadShader(p,"Vertex","",(function(e){d._rawVertexSourceCode=e,d._loadShader(f,"Fragment","Pixel",(function(r){d._rawFragmentSourceCode=r,pi.Process(e,_,(function(e){g&&(e=g("vertex",e)),_.isFragment=!0,pi.Process(r,_,(function(r){g&&(r=g("fragment",r)),d._useFinalCode(e,r,t)}),d._engine)}),d._engine)}))}))}return Object.defineProperty(e.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new Pt),this._onBindObservable},enumerable:!1,configurable:!0}),e.prototype._useFinalCode=function(e,t,r){if(r){var i=r.vertexElement||r.vertex||r.spectorName||r,n=r.fragmentElement||r.fragment||r.spectorName||r;this._vertexSourceCode="#define SHADER_NAME vertex:"+i+"\n"+e,this._fragmentSourceCode="#define SHADER_NAME fragment:"+n+"\n"+t}else this._vertexSourceCode=e,this._fragmentSourceCode=t;this._prepareEffect()},Object.defineProperty(e.prototype,"key",{get:function(){return this._key},enumerable:!1,configurable:!0}),e.prototype.isReady=function(){try{return this._isReadyInternal()}catch(e){return!1}},e.prototype._isReadyInternal=function(){return!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady},e.prototype.getEngine=function(){return this._engine},e.prototype.getPipelineContext=function(){return this._pipelineContext},e.prototype.getAttributesNames=function(){return this._attributesNames},e.prototype.getAttributeLocation=function(e){return this._attributes[e]},e.prototype.getAttributeLocationByName=function(e){return this._attributeLocationByName[e]},e.prototype.getAttributesCount=function(){return this._attributes.length},e.prototype.getUniformIndex=function(e){return this._uniformsNames.indexOf(e)},e.prototype.getUniform=function(e){return this._uniforms[e]},e.prototype.getSamplers=function(){return this._samplerList},e.prototype.getUniformNames=function(){return this._uniformsNames},e.prototype.getUniformBuffersNames=function(){return this._uniformBuffersNamesList},e.prototype.getIndexParameters=function(){return this._indexParameters},e.prototype.getCompilationError=function(){return this._compilationError},e.prototype.allFallbacksProcessed=function(){return this._allFallbacksProcessed},e.prototype.executeWhenCompiled=function(e){var t=this;this.isReady()?e(this):(this.onCompileObservable.add((function(t){e(t)})),this._pipelineContext&&!this._pipelineContext.isAsync||setTimeout((function(){t._checkIsReady(null)}),16))},e.prototype._checkIsReady=function(e){var t=this;try{if(this._isReadyInternal())return}catch(t){return void this._processCompilationErrors(t,e)}setTimeout((function(){t._checkIsReady(e)}),16)},e.prototype._loadShader=function(t,r,i,n){var o;"undefined"!=typeof HTMLElement&&t instanceof HTMLElement?n(ei.GetDOMTextContent(t)):"source:"!==t.substr(0,7)?"base64:"!==t.substr(0,7)?e.ShadersStore[t+r+"Shader"]?n(e.ShadersStore[t+r+"Shader"]):i&&e.ShadersStore[t+i+"Shader"]?n(e.ShadersStore[t+i+"Shader"]):(o="."===t[0]||"/"===t[0]||t.indexOf("http")>-1?t:e.ShadersRepository+t,this._engine._loadFile(o+"."+r.toLowerCase()+".fx",n)):n(window.atob(t.substr(7))):n(t.substr(7))},Object.defineProperty(e.prototype,"vertexSourceCode",{get:function(){return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:this._vertexSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fragmentSourceCode",{get:function(){return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:this._fragmentSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rawVertexSourceCode",{get:function(){return this._rawVertexSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rawFragmentSourceCode",{get:function(){return this._rawFragmentSourceCode},enumerable:!1,configurable:!0}),e.prototype._rebuildProgram=function(e,t,r,i){var n=this;this._isReady=!1,this._vertexSourceCodeOverride=e,this._fragmentSourceCodeOverride=t,this.onError=function(e,t){i&&i(t)},this.onCompiled=function(){var e=n.getEngine().scenes;if(e)for(var t=0;t<e.length;t++)e[t].markAllMaterialsAsDirty(63);n._pipelineContext._handlesSpectorRebuildCallback(r)},this._fallbacks=null,this._prepareEffect()},e.prototype._prepareEffect=function(){var e=this,t=this._attributesNames,r=this.defines;this._valueCache={};var i=this._pipelineContext;try{var n=this._engine;this._pipelineContext=n.createPipelineContext();var o=this._rebuildProgram.bind(this);this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?n._preparePipelineContext(this._pipelineContext,this._vertexSourceCodeOverride,this._fragmentSourceCodeOverride,!0,o,null,this._transformFeedbackVaryings):n._preparePipelineContext(this._pipelineContext,this._vertexSourceCode,this._fragmentSourceCode,!1,o,r,this._transformFeedbackVaryings),n._executeWhenRenderingStateIsCompiled(this._pipelineContext,(function(){if(n.supportsUniformBuffers)for(var r in e._uniformBuffersNames)e.bindUniformBlock(r,e._uniformBuffersNames[r]);var o;if(n.getUniforms(e._pipelineContext,e._uniformsNames).forEach((function(t,r){e._uniforms[e._uniformsNames[r]]=t})),e._attributes=n.getAttributes(e._pipelineContext,t),t)for(var s=0;s<t.length;s++){var a=t[s];e._attributeLocationByName[a]=e._attributes[s]}for(o=0;o<e._samplerList.length;o++)null==e.getUniform(e._samplerList[o])&&(e._samplerList.splice(o,1),o--);e._samplerList.forEach((function(t,r){e._samplers[t]=r})),n.bindSamplers(e),e._compilationError="",e._isReady=!0,e.onCompiled&&e.onCompiled(e),e.onCompileObservable.notifyObservers(e),e.onCompileObservable.clear(),e._fallbacks&&e._fallbacks.unBindMesh(),i&&e.getEngine()._deletePipelineContext(i)})),this._pipelineContext.isAsync&&this._checkIsReady(i)}catch(e){this._processCompilationErrors(e,i)}},e.prototype._getShaderCodeAndErrorLine=function(e,t,r){var i=r?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/,n=null;if(t&&e){var o=t.match(i);if(o&&2===o.length){var s=parseInt(o[1]),a=e.split("\n",-1);a.length>=s&&(n="Offending line ["+s+"] in "+(r?"fragment":"vertex")+" code: "+a[s-1])}}return[e,n]},e.prototype._processCompilationErrors=function(t,r){var i,n,o,s,a;void 0===r&&(r=null),this._compilationError=t.message;var l=this._attributesNames,h=this._fallbacks;if(Jr.Error("Unable to compile effect:"),Jr.Error("Uniforms: "+this._uniformsNames.map((function(e){return" "+e}))),Jr.Error("Attributes: "+l.map((function(e){return" "+e}))),Jr.Error("Defines:\r\n"+this.defines),e.LogShaderCodeOnCompilationError){var c=null,u=null,d=null;(null===(o=this._pipelineContext)||void 0===o?void 0:o._getVertexShaderCode())&&(d=(i=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1))[0],c=i[1],d&&(Jr.Error("Vertex code:"),Jr.Error(d))),(null===(s=this._pipelineContext)||void 0===s?void 0:s._getFragmentShaderCode())&&(d=(n=this._getShaderCodeAndErrorLine(null===(a=this._pipelineContext)||void 0===a?void 0:a._getFragmentShaderCode(),this._compilationError,!0))[0],u=n[1],d&&(Jr.Error("Fragment code:"),Jr.Error(d))),c&&Jr.Error(c),u&&Jr.Error(u)}Jr.Error("Error: "+this._compilationError),r&&(this._pipelineContext=r,this._isReady=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)),h?(this._pipelineContext=null,h.hasMoreFallbacks?(this._allFallbacksProcessed=!1,Jr.Error("Trying next fallback."),this.defines=h.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):this._allFallbacksProcessed=!0},Object.defineProperty(e.prototype,"isSupported",{get:function(){return""===this._compilationError},enumerable:!1,configurable:!0}),e.prototype._bindTexture=function(e,t){this._engine._bindTexture(this._samplers[e],t)},e.prototype.setTexture=function(e,t){this._engine.setTexture(this._samplers[e],this._uniforms[e],t)},e.prototype.setDepthStencilTexture=function(e,t){this._engine.setDepthStencilTexture(this._samplers[e],this._uniforms[e],t)},e.prototype.setTextureArray=function(e,t){var r=e+"Ex";if(-1===this._samplerList.indexOf(r+"0")){for(var i=this._samplerList.indexOf(e),n=1;n<t.length;n++){var o=r+(n-1).toString();this._samplerList.splice(i+n,0,o)}for(var s=0,a=0,l=this._samplerList;a<l.length;a++){var h=l[a];this._samplers[h]=s,s+=1}}this._engine.setTextureArray(this._samplers[e],this._uniforms[e],t)},e.prototype.setTextureFromPostProcess=function(e,t){this._engine.setTextureFromPostProcess(this._samplers[e],t)},e.prototype.setTextureFromPostProcessOutput=function(e,t){this._engine.setTextureFromPostProcessOutput(this._samplers[e],t)},e.prototype._cacheMatrix=function(e,t){var r=this._valueCache[e],i=t.updateFlag;return(void 0===r||r!==i)&&(this._valueCache[e]=i,!0)},e.prototype._cacheFloat2=function(e,t,r){var i=this._valueCache[e];if(!i||2!==i.length)return i=[t,r],this._valueCache[e]=i,!0;var n=!1;return i[0]!==t&&(i[0]=t,n=!0),i[1]!==r&&(i[1]=r,n=!0),n},e.prototype._cacheFloat3=function(e,t,r,i){var n=this._valueCache[e];if(!n||3!==n.length)return n=[t,r,i],this._valueCache[e]=n,!0;var o=!1;return n[0]!==t&&(n[0]=t,o=!0),n[1]!==r&&(n[1]=r,o=!0),n[2]!==i&&(n[2]=i,o=!0),o},e.prototype._cacheFloat4=function(e,t,r,i,n){var o=this._valueCache[e];if(!o||4!==o.length)return o=[t,r,i,n],this._valueCache[e]=o,!0;var s=!1;return o[0]!==t&&(o[0]=t,s=!0),o[1]!==r&&(o[1]=r,s=!0),o[2]!==i&&(o[2]=i,s=!0),o[3]!==n&&(o[3]=n,s=!0),s},e.prototype.bindUniformBuffer=function(t,r){var i=this._uniformBuffersNames[r];void 0!==i&&e._baseCache[i]!==t&&(e._baseCache[i]=t,this._engine.bindUniformBufferBase(t,i))},e.prototype.bindUniformBlock=function(e,t){this._engine.bindUniformBlock(this._pipelineContext,e,t)},e.prototype.setInt=function(e,t){var r=this._valueCache[e];return void 0!==r&&r===t||this._engine.setInt(this._uniforms[e],t)&&(this._valueCache[e]=t),this},e.prototype.setIntArray=function(e,t){return this._valueCache[e]=null,this._engine.setIntArray(this._uniforms[e],t),this},e.prototype.setIntArray2=function(e,t){return this._valueCache[e]=null,this._engine.setIntArray2(this._uniforms[e],t),this},e.prototype.setIntArray3=function(e,t){return this._valueCache[e]=null,this._engine.setIntArray3(this._uniforms[e],t),this},e.prototype.setIntArray4=function(e,t){return this._valueCache[e]=null,this._engine.setIntArray4(this._uniforms[e],t),this},e.prototype.setFloatArray=function(e,t){return this._valueCache[e]=null,this._engine.setArray(this._uniforms[e],t),this},e.prototype.setFloatArray2=function(e,t){return this._valueCache[e]=null,this._engine.setArray2(this._uniforms[e],t),this},e.prototype.setFloatArray3=function(e,t){return this._valueCache[e]=null,this._engine.setArray3(this._uniforms[e],t),this},e.prototype.setFloatArray4=function(e,t){return this._valueCache[e]=null,this._engine.setArray4(this._uniforms[e],t),this},e.prototype.setArray=function(e,t){return this._valueCache[e]=null,this._engine.setArray(this._uniforms[e],t),this},e.prototype.setArray2=function(e,t){return this._valueCache[e]=null,this._engine.setArray2(this._uniforms[e],t),this},e.prototype.setArray3=function(e,t){return this._valueCache[e]=null,this._engine.setArray3(this._uniforms[e],t),this},e.prototype.setArray4=function(e,t){return this._valueCache[e]=null,this._engine.setArray4(this._uniforms[e],t),this},e.prototype.setMatrices=function(e,t){return t?(this._valueCache[e]=null,this._engine.setMatrices(this._uniforms[e],t),this):this},e.prototype.setMatrix=function(e,t){return this._cacheMatrix(e,t)&&(this._engine.setMatrices(this._uniforms[e],t.toArray())||(this._valueCache[e]=null)),this},e.prototype.setMatrix3x3=function(e,t){return this._valueCache[e]=null,this._engine.setMatrix3x3(this._uniforms[e],t),this},e.prototype.setMatrix2x2=function(e,t){return this._valueCache[e]=null,this._engine.setMatrix2x2(this._uniforms[e],t),this},e.prototype.setFloat=function(e,t){var r=this._valueCache[e];return void 0!==r&&r===t||this._engine.setFloat(this._uniforms[e],t)&&(this._valueCache[e]=t),this},e.prototype.setBool=function(e,t){var r=this._valueCache[e];return void 0!==r&&r===t||this._engine.setInt(this._uniforms[e],t?1:0)&&(this._valueCache[e]=t),this},e.prototype.setVector2=function(e,t){return this._cacheFloat2(e,t.x,t.y)&&(this._engine.setFloat2(this._uniforms[e],t.x,t.y)||(this._valueCache[e]=null)),this},e.prototype.setFloat2=function(e,t,r){return this._cacheFloat2(e,t,r)&&(this._engine.setFloat2(this._uniforms[e],t,r)||(this._valueCache[e]=null)),this},e.prototype.setVector3=function(e,t){return this._cacheFloat3(e,t.x,t.y,t.z)&&(this._engine.setFloat3(this._uniforms[e],t.x,t.y,t.z)||(this._valueCache[e]=null)),this},e.prototype.setFloat3=function(e,t,r,i){return this._cacheFloat3(e,t,r,i)&&(this._engine.setFloat3(this._uniforms[e],t,r,i)||(this._valueCache[e]=null)),this},e.prototype.setVector4=function(e,t){return this._cacheFloat4(e,t.x,t.y,t.z,t.w)&&(this._engine.setFloat4(this._uniforms[e],t.x,t.y,t.z,t.w)||(this._valueCache[e]=null)),this},e.prototype.setFloat4=function(e,t,r,i,n){return this._cacheFloat4(e,t,r,i,n)&&(this._engine.setFloat4(this._uniforms[e],t,r,i,n)||(this._valueCache[e]=null)),this},e.prototype.setColor3=function(e,t){return this._cacheFloat3(e,t.r,t.g,t.b)&&(this._engine.setFloat3(this._uniforms[e],t.r,t.g,t.b)||(this._valueCache[e]=null)),this},e.prototype.setColor4=function(e,t,r){return this._cacheFloat4(e,t.r,t.g,t.b,r)&&(this._engine.setFloat4(this._uniforms[e],t.r,t.g,t.b,r)||(this._valueCache[e]=null)),this},e.prototype.setDirectColor4=function(e,t){return this._cacheFloat4(e,t.r,t.g,t.b,t.a)&&(this._engine.setFloat4(this._uniforms[e],t.r,t.g,t.b,t.a)||(this._valueCache[e]=null)),this},e.prototype.dispose=function(){this._engine._releaseEffect(this)},e.RegisterShader=function(t,r,i){r&&(e.ShadersStore[t+"PixelShader"]=r),i&&(e.ShadersStore[t+"VertexShader"]=i)},e.ResetCache=function(){e._baseCache={}},e.ShadersRepository="src/Shaders/",e.LogShaderCodeOnCompilationError=!0,e._uniqueIdSeed=0,e._baseCache={},e.ShadersStore={},e.IncludesShadersStore={},e}(),gi=function(){function e(){this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,this.reset()}return Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zOffset",{get:function(){return this._zOffset},set:function(e){this._zOffset!==e&&(this._zOffset=e,this._isZOffsetDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cullFace",{get:function(){return this._cullFace},set:function(e){this._cullFace!==e&&(this._cullFace=e,this._isCullFaceDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cull",{get:function(){return this._cull},set:function(e){this._cull!==e&&(this._cull=e,this._isCullDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"depthFunc",{get:function(){return this._depthFunc},set:function(e){this._depthFunc!==e&&(this._depthFunc=e,this._isDepthFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"depthMask",{get:function(){return this._depthMask},set:function(e){this._depthMask!==e&&(this._depthMask=e,this._isDepthMaskDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"depthTest",{get:function(){return this._depthTest},set:function(e){this._depthTest!==e&&(this._depthTest=e,this._isDepthTestDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"frontFace",{get:function(){return this._frontFace},set:function(e){this._frontFace!==e&&(this._frontFace=e,this._isFrontFaceDirty=!0)},enumerable:!1,configurable:!0}),e.prototype.reset=function(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1},e.prototype.apply=function(e){this.isDirty&&(this._isCullDirty&&(this.cull?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(e.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(e.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(e.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset?(e.enable(e.POLYGON_OFFSET_FILL),e.polygonOffset(this.zOffset,0)):e.disable(e.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(e.frontFace(this.frontFace),this._isFrontFaceDirty=!1))},e}(),mi=function(){function e(){this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.reset()}return Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilFunc",{get:function(){return this._stencilFunc},set:function(e){this._stencilFunc!==e&&(this._stencilFunc=e,this._isStencilFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilFuncRef",{get:function(){return this._stencilFuncRef},set:function(e){this._stencilFuncRef!==e&&(this._stencilFuncRef=e,this._isStencilFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilFuncMask",{get:function(){return this._stencilFuncMask},set:function(e){this._stencilFuncMask!==e&&(this._stencilFuncMask=e,this._isStencilFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilOpStencilFail",{get:function(){return this._stencilOpStencilFail},set:function(e){this._stencilOpStencilFail!==e&&(this._stencilOpStencilFail=e,this._isStencilOpDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilOpDepthFail",{get:function(){return this._stencilOpDepthFail},set:function(e){this._stencilOpDepthFail!==e&&(this._stencilOpDepthFail=e,this._isStencilOpDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilOpStencilDepthPass",{get:function(){return this._stencilOpStencilDepthPass},set:function(e){this._stencilOpStencilDepthPass!==e&&(this._stencilOpStencilDepthPass=e,this._isStencilOpDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilMask",{get:function(){return this._stencilMask},set:function(e){this._stencilMask!==e&&(this._stencilMask=e,this._isStencilMaskDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilTest",{get:function(){return this._stencilTest},set:function(e){this._stencilTest!==e&&(this._stencilTest=e,this._isStencilTestDirty=!0)},enumerable:!1,configurable:!0}),e.prototype.reset=function(){this._stencilTest=!1,this._stencilMask=255,this._stencilFunc=e.ALWAYS,this._stencilFuncRef=1,this._stencilFuncMask=255,this._stencilOpStencilFail=e.KEEP,this._stencilOpDepthFail=e.KEEP,this._stencilOpStencilDepthPass=e.REPLACE,this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0},e.prototype.apply=function(e){this.isDirty&&(this._isStencilTestDirty&&(this.stencilTest?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(e.stencilMask(this.stencilMask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(e.stencilFunc(this.stencilFunc,this.stencilFuncRef,this.stencilFuncMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(e.stencilOp(this.stencilOpStencilFail,this.stencilOpDepthFail,this.stencilOpStencilDepthPass),this._isStencilOpDirty=!1))},e.ALWAYS=519,e.KEEP=7680,e.REPLACE=7681,e}(),vi=function(){function e(){this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this.reset()}return Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alphaBlend",{get:function(){return this._alphaBlend},set:function(e){this._alphaBlend!==e&&(this._alphaBlend=e,this._isAlphaBlendDirty=!0)},enumerable:!1,configurable:!0}),e.prototype.setAlphaBlendConstants=function(e,t,r,i){this._blendConstants[0]===e&&this._blendConstants[1]===t&&this._blendConstants[2]===r&&this._blendConstants[3]===i||(this._blendConstants[0]=e,this._blendConstants[1]=t,this._blendConstants[2]=r,this._blendConstants[3]=i,this._isBlendConstantsDirty=!0)},e.prototype.setAlphaBlendFunctionParameters=function(e,t,r,i){this._blendFunctionParameters[0]===e&&this._blendFunctionParameters[1]===t&&this._blendFunctionParameters[2]===r&&this._blendFunctionParameters[3]===i||(this._blendFunctionParameters[0]=e,this._blendFunctionParameters[1]=t,this._blendFunctionParameters[2]=r,this._blendFunctionParameters[3]=i,this._isBlendFunctionParametersDirty=!0)},e.prototype.setAlphaEquationParameters=function(e,t){this._blendEquationParameters[0]===e&&this._blendEquationParameters[1]===t||(this._blendEquationParameters[0]=e,this._blendEquationParameters[1]=t,this._isBlendEquationParametersDirty=!0)},e.prototype.reset=function(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1},e.prototype.apply=function(e){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?e.enable(e.BLEND):e.disable(e.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(e.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(e.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(e.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))},e}(),yi=function(){function e(){}return e.prototype.postProcessor=function(e,t,r,i){return i.getCaps().drawBuffersExtension||(e=e.replace(/#extension.+GL_EXT_draw_buffers.+(enable|require)/g,"")),e},e}(),_i=function(){function e(){}return e.prototype.attributeProcessor=function(e){return e.replace("attribute","in")},e.prototype.varyingProcessor=function(e,t){return e.replace("varying",t?"in":"out")},e.prototype.postProcessor=function(e,t,r){var i=-1!==e.search(/#extension.+GL_EXT_draw_buffers.+require/);if(e=(e=e.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),r)e=(e=(e=(e=(e=(e=(e=e.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(i?"":"out vec4 glFragColor;\n")+"void main(");else if(-1!==t.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+e;return e},e}(),bi=function(e){function t(t){var r=e.call(this)||this;return r._buffer=t,r}return(0,p.ZT)(t,e),Object.defineProperty(t.prototype,"underlyingResource",{get:function(){return this._buffer},enumerable:!1,configurable:!0}),t}(function(){function e(){this.references=0,this.capacity=0,this.is32Bits=!1}return Object.defineProperty(e.prototype,"underlyingResource",{get:function(){return null},enumerable:!1,configurable:!0}),e}()),Ti=function(){function e(){this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null}return Object.defineProperty(e.prototype,"isAsync",{get:function(){return this.isParallelCompiled},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isReady",{get:function(){return!!this.program&&(!this.isParallelCompiled||this.engine._isRenderingStateCompiled(this))},enumerable:!1,configurable:!0}),e.prototype._handlesSpectorRebuildCallback=function(e){e&&this.program&&e(this.program)},e.prototype._getVertexShaderCode=function(){return this.vertexShader?this.engine._getShaderSource(this.vertexShader):null},e.prototype._getFragmentShaderCode=function(){return this.fragmentShader?this.engine._getShaderSource(this.fragmentShader):null},e}(),wi=function(){function e(){}return e.CreateCanvas=function(e,t){if("undefined"==typeof document)return new OffscreenCanvas(e,t);var r=document.createElement("canvas");return r.width=e,r.height=t,r},e}(),xi=function(){function e(){}return e.SetMatrixPrecision=function(t){if(e.MatrixTrackPrecisionChange=!1,t&&!e.MatrixUse64Bits&&e.MatrixTrackedMatrices)for(var r=0;r<e.MatrixTrackedMatrices.length;++r){var i=e.MatrixTrackedMatrices[r],n=i._m;i._m=new Array(16);for(var o=0;o<16;++o)i._m[o]=n[o]}e.MatrixUse64Bits=t,e.MatrixCurrentType=e.MatrixUse64Bits?Array:Float32Array,e.MatrixTrackedMatrices=null},e.MatrixUse64Bits=!1,e.MatrixTrackPrecisionChange=!0,e.MatrixCurrentType=Float32Array,e.MatrixTrackedMatrices=[],e}(),Ci=function(){},Si=function(){function e(t,r,i,n){var o=this;void 0===n&&(n=!1),this.forcePOTTextures=!1,this.isFullscreen=!1,this.cullBackFaces=!0,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this.validateShaderPrograms=!1,this.useReverseDepthBuffer=!1,this.disableUniformBuffers=!1,this._uniformBuffers=new Array,this._webGLVersion=1,this._windowIsBackground=!1,this._highPrecisionShadersAllowed=!0,this._badOS=!1,this._badDesktopOS=!1,this._renderingQueueLaunched=!1,this._activeRenderLoops=new Array,this.onContextLostObservable=new Pt,this.onContextRestoredObservable=new Pt,this._contextWasLost=!1,this._doNotHandleContextLost=!1,this.disableVertexArrayObjects=!1,this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new gi,this._stencilState=new mi,this._alphaState=new vi,this._alphaMode=1,this._alphaEquation=0,this._internalTexturesCache=new Array,this._activeChannel=0,this._currentTextureChannel=-1,this._boundTexturesCache={},this._compiledEffects={},this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._activeRequests=new Array,this._transformTextureUrl=null,this.hostInformation={isMobile:!1},this.premultipliedAlpha=!0,this.onBeforeTextureInitObservable=new Pt,this._viewportCached={x:0,y:0,z:0,w:0},this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._getDepthStencilBuffer=function(e,t,r,i,n,s){var a=o._gl,l=a.createRenderbuffer();return a.bindRenderbuffer(a.RENDERBUFFER,l),r>1&&a.renderbufferStorageMultisample?a.renderbufferStorageMultisample(a.RENDERBUFFER,r,n,e,t):a.renderbufferStorage(a.RENDERBUFFER,i,e,t),a.framebufferRenderbuffer(a.FRAMEBUFFER,s,a.RENDERBUFFER,l),a.bindRenderbuffer(a.RENDERBUFFER,null),l},this._boundUniforms={};var s=null;if(t){if(i=i||{},xi.SetMatrixPrecision(!!i.useHighPrecisionMatrix),t.getContext){if(s=t,this._renderingCanvas=s,null!=r&&(i.antialias=r),void 0===i.deterministicLockstep&&(i.deterministicLockstep=!1),void 0===i.lockstepMaxSteps&&(i.lockstepMaxSteps=4),void 0===i.timeStep&&(i.timeStep=1/60),void 0===i.preserveDrawingBuffer&&(i.preserveDrawingBuffer=!1),void 0===i.audioEngine&&(i.audioEngine=!0),void 0===i.stencil&&(i.stencil=!0),!1===i.premultipliedAlpha&&(this.premultipliedAlpha=!1),void 0===i.xrCompatible&&(i.xrCompatible=!0),this._doNotHandleContextLost=!!i.doNotHandleContextLost,navigator&&navigator.userAgent){var a=navigator.userAgent;this.hostInformation.isMobile=-1!==a.indexOf("Mobile");for(var l=0,h=e.ExceptionList;l<h.length;l++){var c=h[l],u=c.key,d=c.targets;if(new RegExp(u).test(a)){if(c.capture&&c.captureConstraint){var p=c.capture,f=c.captureConstraint,g=new RegExp(p).exec(a);if(g&&g.length>0&&parseInt(g[g.length-1])>=f)continue}for(var m=0,v=d;m<v.length;m++)switch(v[m]){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0}}}}if(this._doNotHandleContextLost||(this._onContextLost=function(e){e.preventDefault(),o._contextWasLost=!0,Jr.Warn("WebGL context lost."),o.onContextLostObservable.notifyObservers(o)},this._onContextRestored=function(){setTimeout((function(){o._initGLContext(),o._rebuildEffects(),o._rebuildInternalTextures(),o._rebuildBuffers(),o.wipeCaches(!0),Jr.Warn("WebGL context successfully restored."),o.onContextRestoredObservable.notifyObservers(o),o._contextWasLost=!1}),0)},s.addEventListener("webglcontextlost",this._onContextLost,!1),s.addEventListener("webglcontextrestored",this._onContextRestored,!1),i.powerPreference="high-performance"),!i.disableWebGL2Support)try{this._gl=s.getContext("webgl2",i)||s.getContext("experimental-webgl2",i),this._gl&&(this._webGLVersion=2,this._gl.deleteQuery||(this._webGLVersion=1))}catch(e){}if(!this._gl){if(!s)throw new Error("The provided canvas is null or undefined.");try{this._gl=s.getContext("webgl",i)||s.getContext("experimental-webgl",i)}catch(e){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=t,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample&&(this._webGLVersion=2);var y=this._gl.getContextAttributes();y&&(i.stencil=y.stencil)}this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==i.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=i.useHighPrecisionFloats);var _=ei.IsWindowObjectExist()&&window.devicePixelRatio||1,b=i.limitDeviceRatio||_;this._hardwareScalingLevel=n?1/Math.min(b,_):1,this.resize(),this._isStencilEnable=!!i.stencil,this._initGLContext();for(var T=0;T<this._caps.maxVertexAttribs;T++)this._currentBufferPointers[T]=new Ci;this.webGLVersion>1?this._shaderProcessor=new _i:this._shaderProcessor=new yi,this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this._creationOptions=i,console.log("Babylon.js v"+e.Version+" - "+this.description)}}return Object.defineProperty(e,"NpmPackage",{get:function(){return"babylonjs@4.2.2"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"Version",{get:function(){return"4.2.2"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"description",{get:function(){var e="WebGL"+this.webGLVersion;return this._caps.parallelShaderCompile&&(e+=" - Parallel shader compilation"),e},enumerable:!1,configurable:!0}),Object.defineProperty(e,"ShadersRepository",{get:function(){return fi.ShadersRepository},set:function(e){fi.ShadersRepository=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"supportsUniformBuffers",{get:function(){return this.webGLVersion>1&&!this.disableUniformBuffers},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_shouldUseHighPrecisionShader",{get:function(){return!(!this._caps.highPrecisionShaderSupported||!this._highPrecisionShadersAllowed)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"needPOTTextures",{get:function(){return this._webGLVersion<2||this.forcePOTTextures},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"doNotHandleContextLost",{get:function(){return this._doNotHandleContextLost},set:function(e){this._doNotHandleContextLost=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_supportsHardwareTextureRescaling",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"framebufferDimensionsObject",{set:function(e){this._framebufferDimensionsObject=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentViewport",{get:function(){return this._cachedViewport},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"emptyTexture",{get:function(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"emptyTexture3D",{get:function(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"emptyTexture2DArray",{get:function(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"emptyCubeTexture",{get:function(){if(!this._emptyCubeTexture){var e=new Uint8Array(4),t=[e,e,e,e,e,e];this._emptyCubeTexture=this.createRawCubeTexture(t,1,5,0,!1,!1,1)}return this._emptyCubeTexture},enumerable:!1,configurable:!0}),e.prototype._rebuildInternalTextures=function(){for(var e=0,t=this._internalTexturesCache.slice();e<t.length;e++)t[e]._rebuild()},e.prototype._rebuildEffects=function(){for(var e in this._compiledEffects)this._compiledEffects[e]._prepareEffect();fi.ResetCache()},e.prototype.areAllEffectsReady=function(){for(var e in this._compiledEffects)if(!this._compiledEffects[e].isReady())return!1;return!0},e.prototype._rebuildBuffers=function(){for(var e=0,t=this._uniformBuffers;e<t.length;e++)t[e]._rebuild()},e.prototype._initGLContext=function(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile"),standardDerivatives:this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float"),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1},this._glVersion=this._gl.getParameter(this._gl.VERSION);var e=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=e&&(this._glRenderer=this._gl.getParameter(e.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(e.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor="Unknown vendor"),this._glRenderer||(this._glRenderer="Unknown renderer"),36193!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=36193),34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._webGLVersion>1&&5131!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=this._gl.getParameter(this._gl.MAX_SAMPLES);else{var t=this._gl.getExtension("WEBGL_draw_buffers");if(null!==t){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=t.drawBuffersWEBGL.bind(t),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(var r=0;r<16;r++)this._gl["COLOR_ATTACHMENT"+r+"_WEBGL"]=t["COLOR_ATTACHMENT"+r+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{var i=this._gl.getExtension("WEBGL_depth_texture");null!=i&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=i.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{var n=this._gl.getExtension("OES_vertex_array_object");null!=n&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=n.createVertexArrayOES.bind(n),this._gl.bindVertexArray=n.bindVertexArrayOES.bind(n),this._gl.deleteVertexArray=n.deleteVertexArrayOES.bind(n))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{var o=this._gl.getExtension("ANGLE_instanced_arrays");null!=o?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=o.drawArraysInstancedANGLE.bind(o),this._gl.drawElementsInstanced=o.drawElementsInstancedANGLE.bind(o),this._gl.vertexAttribDivisor=o.vertexAttribDivisorANGLE.bind(o)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){var s=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),a=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);s&&a&&(this._caps.highPrecisionShaderSupported=0!==s.precision&&0!==a.precision)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{var l=this._gl.getExtension("EXT_blend_minmax");null!=l&&(this._caps.blendMinMax=!0,this._gl.MAX=l.MAX_EXT,this._gl.MIN=l.MIN_EXT)}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(var h=0;h<this._maxSimultaneousTextures;h++)this._nextFreeTextureSlots.push(h)},Object.defineProperty(e.prototype,"webGLVersion",{get:function(){return this._webGLVersion},enumerable:!1,configurable:!0}),e.prototype.getClassName=function(){return"ThinEngine"},Object.defineProperty(e.prototype,"isStencilEnable",{get:function(){return this._isStencilEnable},enumerable:!1,configurable:!0}),e.prototype._prepareWorkingCanvas=function(){if(!this._workingCanvas){this._workingCanvas=wi.CreateCanvas(1,1);var e=this._workingCanvas.getContext("2d");e&&(this._workingContext=e)}},e.prototype.resetTextureCache=function(){for(var e in this._boundTexturesCache)this._boundTexturesCache.hasOwnProperty(e)&&(this._boundTexturesCache[e]=null);this._currentTextureChannel=-1},e.prototype.getGlInfo=function(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}},e.prototype.setHardwareScalingLevel=function(e){this._hardwareScalingLevel=e,this.resize()},e.prototype.getHardwareScalingLevel=function(){return this._hardwareScalingLevel},e.prototype.getLoadedTexturesCache=function(){return this._internalTexturesCache},e.prototype.getCaps=function(){return this._caps},e.prototype.stopRenderLoop=function(e){if(e){var t=this._activeRenderLoops.indexOf(e);t>=0&&this._activeRenderLoops.splice(t,1)}else this._activeRenderLoops=[]},e.prototype._renderLoop=function(){if(!this._contextWasLost){var e=!0;if(!this.renderEvenInBackground&&this._windowIsBackground&&(e=!1),e){this.beginFrame();for(var t=0;t<this._activeRenderLoops.length;t++)(0,this._activeRenderLoops[t])();this.endFrame()}}this._activeRenderLoops.length>0?this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()):this._renderingQueueLaunched=!1},e.prototype.getRenderingCanvas=function(){return this._renderingCanvas},e.prototype.getHostWindow=function(){return ei.IsWindowObjectExist()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null},e.prototype.getRenderWidth=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth},e.prototype.getRenderHeight=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight},e.prototype._queueNewFrame=function(t,r){return e.QueueNewFrame(t,r)},e.prototype.runRenderLoop=function(e){-1===this._activeRenderLoops.indexOf(e)&&(this._activeRenderLoops.push(e),this._renderingQueueLaunched||(this._renderingQueueLaunched=!0,this._boundRenderFunction=this._renderLoop.bind(this),this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))},e.prototype.clear=function(e,t,r,i){void 0===i&&(i=!1),this.applyStates();var n=0;t&&e&&(this._gl.clearColor(e.r,e.g,e.b,void 0!==e.a?e.a:1),n|=this._gl.COLOR_BUFFER_BIT),r&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GREATER,this._gl.clearDepth(0)):this._gl.clearDepth(1),n|=this._gl.DEPTH_BUFFER_BIT),i&&(this._gl.clearStencil(0),n|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(n)},e.prototype._viewport=function(e,t,r,i){e===this._viewportCached.x&&t===this._viewportCached.y&&r===this._viewportCached.z&&i===this._viewportCached.w||(this._viewportCached.x=e,this._viewportCached.y=t,this._viewportCached.z=r,this._viewportCached.w=i,this._gl.viewport(e,t,r,i))},e.prototype.setViewport=function(e,t,r){var i=t||this.getRenderWidth(),n=r||this.getRenderHeight(),o=e.x||0,s=e.y||0;this._cachedViewport=e,this._viewport(o*i,s*n,i*e.width,n*e.height)},e.prototype.beginFrame=function(){},e.prototype.endFrame=function(){this._badOS&&this.flushFramebuffer()},e.prototype.resize=function(){var e,t;ei.IsWindowObjectExist()?(e=this._renderingCanvas?this._renderingCanvas.clientWidth||this._renderingCanvas.width:window.innerWidth,t=this._renderingCanvas?this._renderingCanvas.clientHeight||this._renderingCanvas.height:window.innerHeight):(e=this._renderingCanvas?this._renderingCanvas.width:100,t=this._renderingCanvas?this._renderingCanvas.height:100),this.setSize(e/this._hardwareScalingLevel,t/this._hardwareScalingLevel)},e.prototype.setSize=function(e,t){return!(!this._renderingCanvas||(e|=0,t|=0,this._renderingCanvas.width===e&&this._renderingCanvas.height===t||(this._renderingCanvas.width=e,this._renderingCanvas.height=t,0)))},e.prototype.bindFramebuffer=function(e,t,r,i,n,o,s){void 0===t&&(t=0),void 0===o&&(o=0),void 0===s&&(s=0),this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=e,this._bindUnboundFramebuffer(e._MSAAFramebuffer?e._MSAAFramebuffer:e._framebuffer);var a=this._gl;e.is2DArray?a.framebufferTextureLayer(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,e._webGLTexture,o,s):e.isCube&&a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+t,e._webGLTexture,o);var l=e._depthStencilTexture;if(l){var h=l._generateStencilBuffer?a.DEPTH_STENCIL_ATTACHMENT:a.DEPTH_ATTACHMENT;e.is2DArray?a.framebufferTextureLayer(a.FRAMEBUFFER,h,l._webGLTexture,o,s):e.isCube?a.framebufferTexture2D(a.FRAMEBUFFER,h,a.TEXTURE_CUBE_MAP_POSITIVE_X+t,l._webGLTexture,o):a.framebufferTexture2D(a.FRAMEBUFFER,h,a.TEXTURE_2D,l._webGLTexture,o)}this._cachedViewport&&!n?this.setViewport(this._cachedViewport,r,i):(r||(r=e.width,o&&(r/=Math.pow(2,o))),i||(i=e.height,o&&(i/=Math.pow(2,o))),this._viewport(0,0,r,i)),this.wipeCaches()},e.prototype._bindUnboundFramebuffer=function(e){this._currentFramebuffer!==e&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,e),this._currentFramebuffer=e)},e.prototype.unBindFramebuffer=function(e,t,r){void 0===t&&(t=!1),this._currentRenderTarget=null;var i=this._gl;if(e._MSAAFramebuffer){if(e._textureArray)return void this.unBindMultiColorAttachmentFramebuffer(e._textureArray,t,r);i.bindFramebuffer(i.READ_FRAMEBUFFER,e._MSAAFramebuffer),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,e._framebuffer),i.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,i.COLOR_BUFFER_BIT,i.NEAREST)}!e.generateMipMaps||t||e.isCube||(this._bindTextureDirectly(i.TEXTURE_2D,e,!0),i.generateMipmap(i.TEXTURE_2D),this._bindTextureDirectly(i.TEXTURE_2D,null)),r&&(e._MSAAFramebuffer&&this._bindUnboundFramebuffer(e._framebuffer),r()),this._bindUnboundFramebuffer(null)},e.prototype.flushFramebuffer=function(){this._gl.flush()},e.prototype.restoreDefaultFramebuffer=function(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()},e.prototype._resetVertexBufferBinding=function(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null},e.prototype.createVertexBuffer=function(e){return this._createVertexBuffer(e,this._gl.STATIC_DRAW)},e.prototype._createVertexBuffer=function(e,t){var r=this._gl.createBuffer();if(!r)throw new Error("Unable to create vertex buffer");var i=new bi(r);return this.bindArrayBuffer(i),e instanceof Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(e),this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.STATIC_DRAW),this._resetVertexBufferBinding(),i.references=1,i},e.prototype.createDynamicVertexBuffer=function(e){return this._createVertexBuffer(e,this._gl.DYNAMIC_DRAW)},e.prototype._resetIndexBufferBinding=function(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null},e.prototype.createIndexBuffer=function(e,t){var r=this._gl.createBuffer(),i=new bi(r);if(!r)throw new Error("Unable to create index buffer");this.bindIndexBuffer(i);var n=this._normalizeIndexData(e);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,n,t?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),i.references=1,i.is32Bits=4===n.BYTES_PER_ELEMENT,i},e.prototype._normalizeIndexData=function(e){if(e instanceof Uint16Array)return e;if(this._caps.uintIndices){if(e instanceof Uint32Array)return e;for(var t=0;t<e.length;t++)if(e[t]>=65535)return new Uint32Array(e);return new Uint16Array(e)}return new Uint16Array(e)},e.prototype.bindArrayBuffer=function(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.bindBuffer(e,this._gl.ARRAY_BUFFER)},e.prototype.bindUniformBlock=function(e,t,r){var i=e.program,n=this._gl.getUniformBlockIndex(i,t);this._gl.uniformBlockBinding(i,n,r)},e.prototype.bindIndexBuffer=function(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.bindBuffer(e,this._gl.ELEMENT_ARRAY_BUFFER)},e.prototype.bindBuffer=function(e,t){(this._vaoRecordInProgress||this._currentBoundBuffer[t]!==e)&&(this._gl.bindBuffer(t,e?e.underlyingResource:null),this._currentBoundBuffer[t]=e)},e.prototype.updateArrayBuffer=function(e){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,e)},e.prototype._vertexAttribPointer=function(e,t,r,i,n,o,s){var a=this._currentBufferPointers[t];if(a){var l=!1;a.active?(a.buffer!==e&&(a.buffer=e,l=!0),a.size!==r&&(a.size=r,l=!0),a.type!==i&&(a.type=i,l=!0),a.normalized!==n&&(a.normalized=n,l=!0),a.stride!==o&&(a.stride=o,l=!0),a.offset!==s&&(a.offset=s,l=!0)):(l=!0,a.active=!0,a.index=t,a.size=r,a.type=i,a.normalized=n,a.stride=o,a.offset=s,a.buffer=e),(l||this._vaoRecordInProgress)&&(this.bindArrayBuffer(e),this._gl.vertexAttribPointer(t,r,i,n,o,s))}},e.prototype._bindIndexBufferWithCache=function(e){null!=e&&this._cachedIndexBuffer!==e&&(this._cachedIndexBuffer=e,this.bindIndexBuffer(e),this._uintIndicesCurrentlySet=e.is32Bits)},e.prototype._bindVertexBuffersAttributes=function(e,t){var r=t.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var i=0;i<r.length;i++){var n=t.getAttributeLocation(i);if(n>=0){var o=e[r[i]];if(!o)continue;this._gl.enableVertexAttribArray(n),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[n]=!0);var s=o.getBuffer();s&&(this._vertexAttribPointer(s,n,o.getSize(),o.type,o.normalized,o.byteStride,o.byteOffset),o.getIsInstanced()&&(this._gl.vertexAttribDivisor(n,o.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(n),this._currentInstanceBuffers.push(s))))}}},e.prototype.recordVertexArrayObject=function(e,t,r){var i=this._gl.createVertexArray();return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(i),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(e,r),this.bindIndexBuffer(t),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),i},e.prototype.bindVertexArrayObject=function(e,t){this._cachedVertexArrayObject!==e&&(this._cachedVertexArrayObject=e,this._gl.bindVertexArray(e),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=t&&t.is32Bits,this._mustWipeVertexAttributes=!0)},e.prototype.bindBuffersDirectly=function(e,t,r,i,n){if(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==n){this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=n;var o=n.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var s=0,a=0;a<o;a++)if(a<r.length){var l=n.getAttributeLocation(a);l>=0&&(this._gl.enableVertexAttribArray(l),this._vertexAttribArraysEnabled[l]=!0,this._vertexAttribPointer(e,l,r[a],this._gl.FLOAT,!1,i,s)),s+=4*r[a]}}this._bindIndexBufferWithCache(t)},e.prototype._unbindVertexArrayObject=function(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))},e.prototype.bindBuffers=function(e,t,r){this._cachedVertexBuffers===e&&this._cachedEffectForVertexBuffers===r||(this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=r,this._bindVertexBuffersAttributes(e,r)),this._bindIndexBufferWithCache(t)},e.prototype.unbindInstanceAttributes=function(){for(var e,t=0,r=this._currentInstanceLocations.length;t<r;t++){var i=this._currentInstanceBuffers[t];e!=i&&i.references&&(e=i,this.bindArrayBuffer(i));var n=this._currentInstanceLocations[t];this._gl.vertexAttribDivisor(n,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0},e.prototype.releaseVertexArrayObject=function(e){this._gl.deleteVertexArray(e)},e.prototype._releaseBuffer=function(e){return e.references--,0===e.references&&(this._deleteBuffer(e),!0)},e.prototype._deleteBuffer=function(e){this._gl.deleteBuffer(e.underlyingResource)},e.prototype.updateAndBindInstancesBuffer=function(e,t,r){if(this.bindArrayBuffer(e),t&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t),void 0!==r[0].index)this.bindInstancesBuffer(e,r,!0);else for(var i=0;i<4;i++){var n=r[i];this._vertexAttribArraysEnabled[n]||(this._gl.enableVertexAttribArray(n),this._vertexAttribArraysEnabled[n]=!0),this._vertexAttribPointer(e,n,4,this._gl.FLOAT,!1,64,16*i),this._gl.vertexAttribDivisor(n,1),this._currentInstanceLocations.push(n),this._currentInstanceBuffers.push(e)}},e.prototype.bindInstancesBuffer=function(e,t,r){void 0===r&&(r=!0),this.bindArrayBuffer(e);var i=0;if(r)for(var n=0;n<t.length;n++)i+=4*(o=t[n]).attributeSize;for(n=0;n<t.length;n++){var o;void 0===(o=t[n]).index&&(o.index=this._currentEffect.getAttributeLocationByName(o.attributeName)),o.index<0||(this._vertexAttribArraysEnabled[o.index]||(this._gl.enableVertexAttribArray(o.index),this._vertexAttribArraysEnabled[o.index]=!0),this._vertexAttribPointer(e,o.index,o.attributeSize,o.attributeType||this._gl.FLOAT,o.normalized||!1,i,o.offset),this._gl.vertexAttribDivisor(o.index,void 0===o.divisor?1:o.divisor),this._currentInstanceLocations.push(o.index),this._currentInstanceBuffers.push(e))}},e.prototype.disableInstanceAttributeByName=function(e){if(this._currentEffect){var t=this._currentEffect.getAttributeLocationByName(e);this.disableInstanceAttribute(t)}},e.prototype.disableInstanceAttribute=function(e){for(var t,r=!1;-1!==(t=this._currentInstanceLocations.indexOf(e));)this._currentInstanceLocations.splice(t,1),this._currentInstanceBuffers.splice(t,1),r=!0,t=this._currentInstanceLocations.indexOf(e);r&&(this._gl.vertexAttribDivisor(e,0),this.disableAttributeByIndex(e))},e.prototype.disableAttributeByIndex=function(e){this._gl.disableVertexAttribArray(e),this._vertexAttribArraysEnabled[e]=!1,this._currentBufferPointers[e].active=!1},e.prototype.draw=function(e,t,r,i){this.drawElementsType(e?0:1,t,r,i)},e.prototype.drawPointClouds=function(e,t,r){this.drawArraysType(2,e,t,r)},e.prototype.drawUnIndexed=function(e,t,r,i){this.drawArraysType(e?0:1,t,r,i)},e.prototype.drawElementsType=function(e,t,r,i){this.applyStates(),this._reportDrawCall();var n=this._drawMode(e),o=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,s=this._uintIndicesCurrentlySet?4:2;i?this._gl.drawElementsInstanced(n,r,o,t*s,i):this._gl.drawElements(n,r,o,t*s)},e.prototype.drawArraysType=function(e,t,r,i){this.applyStates(),this._reportDrawCall();var n=this._drawMode(e);i?this._gl.drawArraysInstanced(n,t,r,i):this._gl.drawArrays(n,t,r)},e.prototype._drawMode=function(e){switch(e){case 0:default:return this._gl.TRIANGLES;case 2:case 3:return this._gl.POINTS;case 1:case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN}},e.prototype._reportDrawCall=function(){},e.prototype._releaseEffect=function(e){this._compiledEffects[e._key]&&(delete this._compiledEffects[e._key],this._deletePipelineContext(e.getPipelineContext()))},e.prototype._deletePipelineContext=function(e){var t=e;t&&t.program&&(t.program.__SPECTOR_rebuildProgram=null,this._gl.deleteProgram(t.program))},e.prototype.createEffect=function(e,t,r,i,n,o,s,a,l){var h=(e.vertexElement||e.vertex||e.vertexToken||e.vertexSource||e)+"+"+(e.fragmentElement||e.fragment||e.fragmentToken||e.fragmentSource||e)+"@"+(n||t.defines);if(this._compiledEffects[h]){var c=this._compiledEffects[h];return s&&c.isReady()&&s(c),c}var u=new fi(e,t,r,i,this,n,o,s,a,l);return u._key=h,this._compiledEffects[h]=u,u},e._ConcatenateShader=function(e,t,r){return void 0===r&&(r=""),r+(t?t+"\n":"")+e},e.prototype._compileShader=function(t,r,i,n){return this._compileRawShader(e._ConcatenateShader(t,i,n),r)},e.prototype._compileRawShader=function(e,t){var r=this._gl,i=r.createShader("vertex"===t?r.VERTEX_SHADER:r.FRAGMENT_SHADER);if(!i)throw new Error("Something went wrong while compile the shader.");return r.shaderSource(i,e),r.compileShader(i),i},e.prototype._getShaderSource=function(e){return this._gl.getShaderSource(e)},e.prototype.createRawShaderProgram=function(e,t,r,i,n){void 0===n&&(n=null),i=i||this._gl;var o=this._compileRawShader(t,"vertex"),s=this._compileRawShader(r,"fragment");return this._createShaderProgram(e,o,s,i,n)},e.prototype.createShaderProgram=function(e,t,r,i,n,o){void 0===o&&(o=null),n=n||this._gl;var s=this._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"",a=this._compileShader(t,"vertex",i,s),l=this._compileShader(r,"fragment",i,s);return this._createShaderProgram(e,a,l,n,o)},e.prototype.createPipelineContext=function(){var e=new Ti;return e.engine=this,this._caps.parallelShaderCompile&&(e.isParallelCompiled=!0),e},e.prototype._createShaderProgram=function(e,t,r,i,n){void 0===n&&(n=null);var o=i.createProgram();if(e.program=o,!o)throw new Error("Unable to create program");return i.attachShader(o,t),i.attachShader(o,r),i.linkProgram(o),e.context=i,e.vertexShader=t,e.fragmentShader=r,e.isParallelCompiled||this._finalizePipelineContext(e),o},e.prototype._finalizePipelineContext=function(e){var t=e.context,r=e.vertexShader,i=e.fragmentShader,n=e.program;if(!t.getProgramParameter(n,t.LINK_STATUS)){var o,s;if(!this._gl.getShaderParameter(r,this._gl.COMPILE_STATUS)&&(o=this._gl.getShaderInfoLog(r)))throw e.vertexCompilationError=o,new Error("VERTEX SHADER "+o);if(!this._gl.getShaderParameter(i,this._gl.COMPILE_STATUS)&&(o=this._gl.getShaderInfoLog(i)))throw e.fragmentCompilationError=o,new Error("FRAGMENT SHADER "+o);if(s=t.getProgramInfoLog(n))throw e.programLinkError=s,new Error(s)}if(this.validateShaderPrograms&&(t.validateProgram(n),!t.getProgramParameter(n,t.VALIDATE_STATUS)&&(s=t.getProgramInfoLog(n))))throw e.programValidationError=s,new Error(s);t.deleteShader(r),t.deleteShader(i),e.vertexShader=void 0,e.fragmentShader=void 0,e.onCompiled&&(e.onCompiled(),e.onCompiled=void 0)},e.prototype._preparePipelineContext=function(e,t,r,i,n,o,s){var a=e;a.program=i?this.createRawShaderProgram(a,t,r,void 0,s):this.createShaderProgram(a,t,r,o,void 0,s),a.program.__SPECTOR_rebuildProgram=n},e.prototype._isRenderingStateCompiled=function(e){var t=e;return!!this._gl.getProgramParameter(t.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)&&(this._finalizePipelineContext(t),!0)},e.prototype._executeWhenRenderingStateIsCompiled=function(e,t){var r=e;if(r.isParallelCompiled){var i=r.onCompiled;r.onCompiled=i?function(){i(),t()}:t}else t()},e.prototype.getUniforms=function(e,t){for(var r=new Array,i=e,n=0;n<t.length;n++)r.push(this._gl.getUniformLocation(i.program,t[n]));return r},e.prototype.getAttributes=function(e,t){for(var r=[],i=e,n=0;n<t.length;n++)try{r.push(this._gl.getAttribLocation(i.program,t[n]))}catch(e){r.push(-1)}return r},e.prototype.enableEffect=function(e){e&&e!==this._currentEffect&&(this.bindSamplers(e),this._currentEffect=e,e.onBind&&e.onBind(e),e._onBindObservable&&e._onBindObservable.notifyObservers(e))},e.prototype.setInt=function(e,t){return!!e&&(this._gl.uniform1i(e,t),!0)},e.prototype.setIntArray=function(e,t){return!!e&&(this._gl.uniform1iv(e,t),!0)},e.prototype.setIntArray2=function(e,t){return!(!e||t.length%2!=0||(this._gl.uniform2iv(e,t),0))},e.prototype.setIntArray3=function(e,t){return!(!e||t.length%3!=0||(this._gl.uniform3iv(e,t),0))},e.prototype.setIntArray4=function(e,t){return!(!e||t.length%4!=0||(this._gl.uniform4iv(e,t),0))},e.prototype.setArray=function(e,t){return!!e&&(this._gl.uniform1fv(e,t),!0)},e.prototype.setArray2=function(e,t){return!(!e||t.length%2!=0||(this._gl.uniform2fv(e,t),0))},e.prototype.setArray3=function(e,t){return!(!e||t.length%3!=0||(this._gl.uniform3fv(e,t),0))},e.prototype.setArray4=function(e,t){return!(!e||t.length%4!=0||(this._gl.uniform4fv(e,t),0))},e.prototype.setMatrices=function(e,t){return!!e&&(this._gl.uniformMatrix4fv(e,!1,t),!0)},e.prototype.setMatrix3x3=function(e,t){return!!e&&(this._gl.uniformMatrix3fv(e,!1,t),!0)},e.prototype.setMatrix2x2=function(e,t){return!!e&&(this._gl.uniformMatrix2fv(e,!1,t),!0)},e.prototype.setFloat=function(e,t){return!!e&&(this._gl.uniform1f(e,t),!0)},e.prototype.setFloat2=function(e,t,r){return!!e&&(this._gl.uniform2f(e,t,r),!0)},e.prototype.setFloat3=function(e,t,r,i){return!!e&&(this._gl.uniform3f(e,t,r,i),!0)},e.prototype.setFloat4=function(e,t,r,i,n){return!!e&&(this._gl.uniform4f(e,t,r,i,n),!0)},e.prototype.applyStates=function(){if(this._depthCullingState.apply(this._gl),this._stencilState.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;var e=this._colorWrite;this._gl.colorMask(e,e,e,e)}},e.prototype.setColorWrite=function(e){e!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=e)},e.prototype.getColorWrite=function(){return this._colorWrite},Object.defineProperty(e.prototype,"depthCullingState",{get:function(){return this._depthCullingState},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alphaState",{get:function(){return this._alphaState},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilState",{get:function(){return this._stencilState},enumerable:!1,configurable:!0}),e.prototype.clearInternalTexturesCache=function(){this._internalTexturesCache=[]},e.prototype.wipeCaches=function(e){this.preventCacheWipeBetweenFrames&&!e||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),e&&(this._currentProgram=null,this.resetTextureCache(),this._stencilState.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))},e.prototype._getSamplingParameters=function(e,t){var r=this._gl,i=r.NEAREST,n=r.NEAREST;switch(e){case 11:i=r.LINEAR,n=t?r.LINEAR_MIPMAP_NEAREST:r.LINEAR;break;case 3:i=r.LINEAR,n=t?r.LINEAR_MIPMAP_LINEAR:r.LINEAR;break;case 8:i=r.NEAREST,n=t?r.NEAREST_MIPMAP_LINEAR:r.NEAREST;break;case 4:i=r.NEAREST,n=t?r.NEAREST_MIPMAP_NEAREST:r.NEAREST;break;case 5:i=r.NEAREST,n=t?r.LINEAR_MIPMAP_NEAREST:r.LINEAR;break;case 6:i=r.NEAREST,n=t?r.LINEAR_MIPMAP_LINEAR:r.LINEAR;break;case 7:i=r.NEAREST,n=r.LINEAR;break;case 1:i=r.NEAREST,n=r.NEAREST;break;case 9:i=r.LINEAR,n=t?r.NEAREST_MIPMAP_NEAREST:r.NEAREST;break;case 10:i=r.LINEAR,n=t?r.NEAREST_MIPMAP_LINEAR:r.NEAREST;break;case 2:i=r.LINEAR,n=r.LINEAR;break;case 12:i=r.LINEAR,n=r.NEAREST}return{min:n,mag:i}},e.prototype._createTexture=function(){var e=this._gl.createTexture();if(!e)throw new Error("Unable to create texture");return e},e.prototype.createTexture=function(t,r,i,n,o,s,a,l,h,c,u,d,p){var f=this;void 0===o&&(o=3),void 0===s&&(s=null),void 0===a&&(a=null),void 0===l&&(l=null),void 0===h&&(h=null),void 0===c&&(c=null),void 0===u&&(u=null);var g="data:"===(t=t||"").substr(0,5),m="blob:"===t.substr(0,5),v=g&&-1!==t.indexOf(";base64,"),y=h||new Rt(this,lt.Url),_=t;!this._transformTextureUrl||v||h||l||(t=this._transformTextureUrl(t)),_!==t&&(y._originalUrl=_);var b=t.lastIndexOf("."),T=u||(b>-1?t.substring(b).toLowerCase():""),w=null;T.indexOf("?")>-1&&(T=T.split("?")[0]);for(var x=0,C=e._TextureLoaders;x<C.length;x++){var S=C[x];if(S.canLoad(T,d)){w=S;break}}n&&n._addPendingData(y),y.url=t,y.generateMipMaps=!r,y.samplingMode=o,y.invertY=i,this._doNotHandleContextLost||(y._buffer=l);var P=null;s&&!h&&(P=y.onLoadedObservable.add(s)),h||this._internalTexturesCache.push(y);var E=function(e,i){n&&n._removePendingData(y),t===_?(P&&y.onLoadedObservable.remove(P),Qr.UseFallbackTexture&&f.createTexture(Qr.FallbackTexture,r,y.invertY,n,o,null,a,l,y),a&&a((e||"Unknown error")+(Qr.UseFallbackTexture?" - Fallback texture was used":""),i)):(Jr.Warn("Failed to load "+t+", falling back to "+_),f.createTexture(_,r,y.invertY,n,o,s,a,l,y,c,u,d,p))};if(w){var M=function(e){w.loadData(e,y,(function(e,t,r,i,s,a){a?E("TextureLoader failed to load data"):f._prepareWebGLTexture(y,n,e,t,y.invertY,!r,i,(function(){return s(),!1}),o)}),p)};l?l instanceof ArrayBuffer?M(new Uint8Array(l)):ArrayBuffer.isView(l)?M(l):a&&a("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(t,(function(e){return M(new Uint8Array(e))}),void 0,n?n.offlineProvider:void 0,!0,(function(e,t){E("Unable to load "+(e&&e.responseURL,t))}))}else{var R=function(e){m&&!f._doNotHandleContextLost&&(y._buffer=e),f._prepareWebGLTexture(y,n,e.width,e.height,y.invertY,r,!1,(function(t,r,i){var o=f._gl,s=e.width===t&&e.height===r,a=c?f._getInternalFormat(c):".jpg"===T?o.RGB:o.RGBA;if(s)return o.texImage2D(o.TEXTURE_2D,0,a,a,o.UNSIGNED_BYTE,e),!1;var l=f._caps.maxTextureSize;if(e.width>l||e.height>l||!f._supportsHardwareTextureRescaling)return f._prepareWorkingCanvas(),!(!f._workingCanvas||!f._workingContext||(f._workingCanvas.width=t,f._workingCanvas.height=r,f._workingContext.drawImage(e,0,0,e.width,e.height,0,0,t,r),o.texImage2D(o.TEXTURE_2D,0,a,a,o.UNSIGNED_BYTE,f._workingCanvas),y.width=t,y.height=r,1));var h=new Rt(f,lt.Temp);return f._bindTextureDirectly(o.TEXTURE_2D,h,!0),o.texImage2D(o.TEXTURE_2D,0,a,a,o.UNSIGNED_BYTE,e),f._rescaleTexture(h,y,n,a,(function(){f._releaseTexture(h),f._bindTextureDirectly(o.TEXTURE_2D,y,!0),i()})),!0}),o)};!g||v?l&&(l.decoding||l.close)?R(l):e._FileToolsLoadImage(t,R,E,n?n.offlineProvider:null,d):"string"==typeof l||l instanceof ArrayBuffer||ArrayBuffer.isView(l)||l instanceof Blob?e._FileToolsLoadImage(l,R,E,n?n.offlineProvider:null,d):l&&R(l)}return y},e._FileToolsLoadImage=function(e,t,r,i,n){throw Mt.WarnImport("FileTools")},e.prototype._rescaleTexture=function(e,t,r,i,n){},e.prototype.createRawTexture=function(e,t,r,i,n,o,s,a,l){throw void 0===a&&(a=null),void 0===l&&(l=0),Mt.WarnImport("Engine.RawTexture")},e.prototype.createRawCubeTexture=function(e,t,r,i,n,o,s,a){throw void 0===a&&(a=null),Mt.WarnImport("Engine.RawTexture")},e.prototype.createRawTexture3D=function(e,t,r,i,n,o,s,a,l,h){throw void 0===l&&(l=null),void 0===h&&(h=0),Mt.WarnImport("Engine.RawTexture")},e.prototype.createRawTexture2DArray=function(e,t,r,i,n,o,s,a,l,h){throw void 0===l&&(l=null),void 0===h&&(h=0),Mt.WarnImport("Engine.RawTexture")},e.prototype._unpackFlipY=function(e){this._unpackFlipYCached!==e&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,e?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=e))},e.prototype._getUnpackAlignement=function(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)},e.prototype._getTextureTarget=function(e){return e.isCube?this._gl.TEXTURE_CUBE_MAP:e.is3D?this._gl.TEXTURE_3D:e.is2DArray||e.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D},e.prototype.updateTextureSamplingMode=function(e,t,r){void 0===r&&(r=!1);var i=this._getTextureTarget(t),n=this._getSamplingParameters(e,t.generateMipMaps||r);this._setTextureParameterInteger(i,this._gl.TEXTURE_MAG_FILTER,n.mag,t),this._setTextureParameterInteger(i,this._gl.TEXTURE_MIN_FILTER,n.min),r&&(t.generateMipMaps=!0,this._gl.generateMipmap(i)),this._bindTextureDirectly(i,null),t.samplingMode=e},e.prototype.updateTextureWrappingMode=function(e,t,r,i){void 0===r&&(r=null),void 0===i&&(i=null);var n=this._getTextureTarget(e);null!==t&&(this._setTextureParameterInteger(n,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(t),e),e._cachedWrapU=t),null!==r&&(this._setTextureParameterInteger(n,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(r),e),e._cachedWrapV=r),(e.is2DArray||e.is3D)&&null!==i&&(this._setTextureParameterInteger(n,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(i),e),e._cachedWrapR=i),this._bindTextureDirectly(n,null)},e.prototype._setupDepthStencilTexture=function(e,t,r,i,n){var o=t.width||t,s=t.height||t,a=t.layers||0;e.baseWidth=o,e.baseHeight=s,e.width=o,e.height=s,e.is2DArray=a>0,e.depth=a,e.isReady=!0,e.samples=1,e.generateMipMaps=!1,e._generateDepthBuffer=!0,e._generateStencilBuffer=r,e.samplingMode=i?2:1,e.type=0,e._comparisonFunction=n;var l=this._gl,h=this._getTextureTarget(e),c=this._getSamplingParameters(e.samplingMode,!1);l.texParameteri(h,l.TEXTURE_MAG_FILTER,c.mag),l.texParameteri(h,l.TEXTURE_MIN_FILTER,c.min),l.texParameteri(h,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(h,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),0===n?(l.texParameteri(h,l.TEXTURE_COMPARE_FUNC,515),l.texParameteri(h,l.TEXTURE_COMPARE_MODE,l.NONE)):(l.texParameteri(h,l.TEXTURE_COMPARE_FUNC,n),l.texParameteri(h,l.TEXTURE_COMPARE_MODE,l.COMPARE_REF_TO_TEXTURE))},e.prototype._uploadCompressedDataToTextureDirectly=function(e,t,r,i,n,o,s){void 0===o&&(o=0),void 0===s&&(s=0);var a=this._gl,l=a.TEXTURE_2D;e.isCube&&(l=a.TEXTURE_CUBE_MAP_POSITIVE_X+o),this._gl.compressedTexImage2D(l,s,t,r,i,0,n)},e.prototype._uploadDataToTextureDirectly=function(e,t,r,i,n,o){void 0===r&&(r=0),void 0===i&&(i=0),void 0===o&&(o=!1);var s=this._gl,a=this._getWebGLTextureType(e.type),l=this._getInternalFormat(e.format),h=void 0===n?this._getRGBABufferInternalSizedFormat(e.type,e.format):this._getInternalFormat(n);this._unpackFlipY(e.invertY);var c=s.TEXTURE_2D;e.isCube&&(c=s.TEXTURE_CUBE_MAP_POSITIVE_X+r);var u=Math.round(Math.log(e.width)*Math.LOG2E),d=Math.round(Math.log(e.height)*Math.LOG2E),p=o?e.width:Math.pow(2,Math.max(u-i,0)),f=o?e.height:Math.pow(2,Math.max(d-i,0));s.texImage2D(c,i,h,p,f,0,l,a,t)},e.prototype.updateTextureData=function(e,t,r,i,n,o,s,a){void 0===s&&(s=0),void 0===a&&(a=0);var l=this._gl,h=this._getWebGLTextureType(e.type),c=this._getInternalFormat(e.format);this._unpackFlipY(e.invertY);var u=l.TEXTURE_2D;e.isCube&&(u=l.TEXTURE_CUBE_MAP_POSITIVE_X+s),l.texSubImage2D(u,a,r,i,n,o,c,h,t)},e.prototype._uploadArrayBufferViewToTexture=function(e,t,r,i){void 0===r&&(r=0),void 0===i&&(i=0);var n=this._gl,o=e.isCube?n.TEXTURE_CUBE_MAP:n.TEXTURE_2D;this._bindTextureDirectly(o,e,!0),this._uploadDataToTextureDirectly(e,t,r,i),this._bindTextureDirectly(o,null,!0)},e.prototype._prepareWebGLTextureContinuation=function(e,t,r,i,n){var o=this._gl;if(o){var s=this._getSamplingParameters(n,!r);o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,s.mag),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,s.min),r||i||o.generateMipmap(o.TEXTURE_2D),this._bindTextureDirectly(o.TEXTURE_2D,null),t&&t._removePendingData(e),e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear()}},e.prototype._prepareWebGLTexture=function(t,r,i,n,o,s,a,l,h){var c=this;void 0===h&&(h=3);var u=this.getCaps().maxTextureSize,d=Math.min(u,this.needPOTTextures?e.GetExponentOfTwo(i,u):i),p=Math.min(u,this.needPOTTextures?e.GetExponentOfTwo(n,u):n),f=this._gl;f&&(t._webGLTexture?(this._bindTextureDirectly(f.TEXTURE_2D,t,!0),this._unpackFlipY(void 0===o||!!o),t.baseWidth=i,t.baseHeight=n,t.width=d,t.height=p,t.isReady=!0,l(d,p,(function(){c._prepareWebGLTextureContinuation(t,r,s,a,h)}))||this._prepareWebGLTextureContinuation(t,r,s,a,h)):r&&r._removePendingData(t))},e.prototype._setupFramebufferDepthAttachments=function(e,t,r,i,n){void 0===n&&(n=1);var o=this._gl;if(e&&t)return this._getDepthStencilBuffer(r,i,n,o.DEPTH_STENCIL,o.DEPTH24_STENCIL8,o.DEPTH_STENCIL_ATTACHMENT);if(t){var s=o.DEPTH_COMPONENT16;return this._webGLVersion>1&&(s=o.DEPTH_COMPONENT32F),this._getDepthStencilBuffer(r,i,n,s,s,o.DEPTH_ATTACHMENT)}return e?this._getDepthStencilBuffer(r,i,n,o.STENCIL_INDEX8,o.STENCIL_INDEX8,o.STENCIL_ATTACHMENT):null},e.prototype._releaseFramebufferObjects=function(e){var t=this._gl;e._framebuffer&&(t.deleteFramebuffer(e._framebuffer),e._framebuffer=null),e._depthStencilBuffer&&(t.deleteRenderbuffer(e._depthStencilBuffer),e._depthStencilBuffer=null),e._MSAAFramebuffer&&(t.deleteFramebuffer(e._MSAAFramebuffer),e._MSAAFramebuffer=null),e._MSAARenderBuffer&&(t.deleteRenderbuffer(e._MSAARenderBuffer),e._MSAARenderBuffer=null)},e.prototype._releaseTexture=function(e){this._releaseFramebufferObjects(e),this._deleteTexture(e._webGLTexture),this.unbindAllTextures();var t=this._internalTexturesCache.indexOf(e);-1!==t&&this._internalTexturesCache.splice(t,1),e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureLow&&e._lodTextureLow.dispose(),e._irradianceTexture&&e._irradianceTexture.dispose()},e.prototype._deleteTexture=function(e){this._gl.deleteTexture(e)},e.prototype._setProgram=function(e){this._currentProgram!==e&&(this._gl.useProgram(e),this._currentProgram=e)},e.prototype.bindSamplers=function(e){var t=e.getPipelineContext();this._setProgram(t.program);for(var r=e.getSamplers(),i=0;i<r.length;i++){var n=e.getUniform(r[i]);n&&(this._boundUniforms[i]=n)}this._currentEffect=null},e.prototype._activateCurrentTexture=function(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)},e.prototype._bindTextureDirectly=function(e,t,r,i){void 0===r&&(r=!1),void 0===i&&(i=!1);var n=!1,o=t&&t._associatedChannel>-1;return r&&o&&(this._activeChannel=t._associatedChannel),this._boundTexturesCache[this._activeChannel]!==t||i?(this._activateCurrentTexture(),t&&t.isMultiview?this._gl.bindTexture(e,t?t._colorTextureArray:null):this._gl.bindTexture(e,t?t._webGLTexture:null),this._boundTexturesCache[this._activeChannel]=t,t&&(t._associatedChannel=this._activeChannel)):r&&(n=!0,this._activateCurrentTexture()),o&&!r&&this._bindSamplerUniformToChannel(t._associatedChannel,this._activeChannel),n},e.prototype._bindTexture=function(e,t){if(void 0!==e){t&&(t._associatedChannel=e),this._activeChannel=e;var r=t?this._getTextureTarget(t):this._gl.TEXTURE_2D;this._bindTextureDirectly(r,t)}},e.prototype.unbindAllTextures=function(){for(var e=0;e<this._maxSimultaneousTextures;e++)this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))},e.prototype.setTexture=function(e,t,r){void 0!==e&&(t&&(this._boundUniforms[e]=t),this._setTexture(e,r))},e.prototype._bindSamplerUniformToChannel=function(e,t){var r=this._boundUniforms[e];r&&r._currentState!==t&&(this._gl.uniform1i(r,t),r._currentState=t)},e.prototype._getTextureWrapMode=function(e){switch(e){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT},e.prototype._setTexture=function(e,t,r,i){if(void 0===r&&(r=!1),void 0===i&&(i=!1),!t)return null!=this._boundTexturesCache[e]&&(this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(t.video)this._activeChannel=e,t.update();else if(4===t.delayLoadState)return t.delayLoad(),!1;var n;n=i?t.depthStencilTexture:t.isReady()?t.getInternalTexture():t.isCube?this.emptyCubeTexture:t.is3D?this.emptyTexture3D:t.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!r&&n&&(n._associatedChannel=e);var o=!0;this._boundTexturesCache[e]===n&&(r||this._bindSamplerUniformToChannel(n._associatedChannel,e),o=!1),this._activeChannel=e;var s=this._getTextureTarget(n);if(o&&this._bindTextureDirectly(s,n,r),n&&!n.isMultiview){if(n.isCube&&n._cachedCoordinatesMode!==t.coordinatesMode){n._cachedCoordinatesMode=t.coordinatesMode;var a=3!==t.coordinatesMode&&5!==t.coordinatesMode?1:0;t.wrapU=a,t.wrapV=a}n._cachedWrapU!==t.wrapU&&(n._cachedWrapU=t.wrapU,this._setTextureParameterInteger(s,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(t.wrapU),n)),n._cachedWrapV!==t.wrapV&&(n._cachedWrapV=t.wrapV,this._setTextureParameterInteger(s,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(t.wrapV),n)),n.is3D&&n._cachedWrapR!==t.wrapR&&(n._cachedWrapR=t.wrapR,this._setTextureParameterInteger(s,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(t.wrapR),n)),this._setAnisotropicLevel(s,n,t.anisotropicFilteringLevel)}return!0},e.prototype.setTextureArray=function(e,t,r){if(void 0!==e&&t){this._textureUnits&&this._textureUnits.length===r.length||(this._textureUnits=new Int32Array(r.length));for(var i=0;i<r.length;i++){var n=r[i].getInternalTexture();n?(this._textureUnits[i]=e+i,n._associatedChannel=e+i):this._textureUnits[i]=-1}this._gl.uniform1iv(t,this._textureUnits);for(var o=0;o<r.length;o++)this._setTexture(this._textureUnits[o],r[o],!0)}},e.prototype._setAnisotropicLevel=function(e,t,r){var i=this._caps.textureAnisotropicFilterExtension;11!==t.samplingMode&&3!==t.samplingMode&&2!==t.samplingMode&&(r=1),i&&t._cachedAnisotropicFilteringLevel!==r&&(this._setTextureParameterFloat(e,i.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(r,this._caps.maxAnisotropy),t),t._cachedAnisotropicFilteringLevel=r)},e.prototype._setTextureParameterFloat=function(e,t,r,i){this._bindTextureDirectly(e,i,!0,!0),this._gl.texParameterf(e,t,r)},e.prototype._setTextureParameterInteger=function(e,t,r,i){i&&this._bindTextureDirectly(e,i,!0,!0),this._gl.texParameteri(e,t,r)},e.prototype.unbindAllAttributes=function(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(var e=0;e<this._caps.maxVertexAttribs;e++)this.disableAttributeByIndex(e)}else{e=0;for(var t=this._vertexAttribArraysEnabled.length;e<t;e++)e>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[e]||this.disableAttributeByIndex(e)}},e.prototype.releaseEffects=function(){for(var e in this._compiledEffects){var t=this._compiledEffects[e].getPipelineContext();this._deletePipelineContext(t)}this._compiledEffects={}},e.prototype.dispose=function(){this.stopRenderLoop(),this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.releaseEffects(),this.unbindAllAttributes(),this._boundUniforms=[],ei.IsWindowObjectExist()&&this._renderingCanvas&&(this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored))),this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers=[],this._renderingCanvas=null,this._currentProgram=null,this._boundRenderFunction=null,fi.ResetCache();for(var e=0,t=this._activeRequests;e<t.length;e++)t[e].abort()},e.prototype.attachContextLostEvent=function(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",e,!1)},e.prototype.attachContextRestoredEvent=function(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",e,!1)},e.prototype.getError=function(){return this._gl.getError()},e.prototype._canRenderToFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)},e.prototype._canRenderToHalfFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)},e.prototype._canRenderToFramebuffer=function(e){for(var t=this._gl;t.getError()!==t.NO_ERROR;);var r=!0,i=t.createTexture();t.bindTexture(t.TEXTURE_2D,i),t.texImage2D(t.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(e),1,1,0,t.RGBA,this._getWebGLTextureType(e),null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST);var n=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0);var o=t.checkFramebufferStatus(t.FRAMEBUFFER);if((r=(r=r&&o===t.FRAMEBUFFER_COMPLETE)&&t.getError()===t.NO_ERROR)&&(t.clear(t.COLOR_BUFFER_BIT),r=r&&t.getError()===t.NO_ERROR),r){t.bindFramebuffer(t.FRAMEBUFFER,null);var s=t.RGBA,a=t.UNSIGNED_BYTE,l=new Uint8Array(4);t.readPixels(0,0,1,1,s,a,l),r=r&&t.getError()===t.NO_ERROR}for(t.deleteTexture(i),t.deleteFramebuffer(n),t.bindFramebuffer(t.FRAMEBUFFER,null);!r&&t.getError()!==t.NO_ERROR;);return r},e.prototype._getWebGLTextureType=function(e){if(1===this._webGLVersion){switch(e){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(e){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE},e.prototype._getInternalFormat=function(e){var t=this._gl.RGBA;switch(e){case 0:t=this._gl.ALPHA;break;case 1:t=this._gl.LUMINANCE;break;case 2:t=this._gl.LUMINANCE_ALPHA;break;case 6:t=this._gl.RED;break;case 7:t=this._gl.RG;break;case 4:t=this._gl.RGB;break;case 5:t=this._gl.RGBA}if(this._webGLVersion>1)switch(e){case 8:t=this._gl.RED_INTEGER;break;case 9:t=this._gl.RG_INTEGER;break;case 10:t=this._gl.RGB_INTEGER;break;case 11:t=this._gl.RGBA_INTEGER}return t},e.prototype._getRGBABufferInternalSizedFormat=function(e,t){if(1===this._webGLVersion){if(void 0!==t)switch(t){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return this._gl.RGB}return this._gl.RGBA}switch(e){case 3:switch(t){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(t){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return this._gl.RGB8;case 5:default:return this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA}case 4:switch(t){case 8:return this._gl.R16I;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;default:return this._gl.RGBA16I}case 5:switch(t){case 8:return this._gl.R16UI;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;default:return this._gl.RGBA16UI}case 6:switch(t){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;default:return this._gl.RGBA32I}case 7:switch(t){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;default:return this._gl.RGBA32UI}case 1:switch(t){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;default:return this._gl.RGBA32F}case 2:switch(t){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(t){case 5:default:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI}}return this._gl.RGBA8},e.prototype._getRGBAMultiSampleBufferFormat=function(e){return 1===e?this._gl.RGBA32F:2===e?this._gl.RGBA16F:this._gl.RGBA8},e.prototype._loadFile=function(t,r,i,n,o,s){var a=this,l=e._FileToolsLoadFile(t,r,i,n,o,s);return this._activeRequests.push(l),l.onCompleteObservable.add((function(e){a._activeRequests.splice(a._activeRequests.indexOf(e),1)})),l},e._FileToolsLoadFile=function(e,t,r,i,n,o){throw Mt.WarnImport("FileTools")},e.prototype.readPixels=function(e,t,r,i,n){void 0===n&&(n=!0);var o=n?4:3,s=n?this._gl.RGBA:this._gl.RGB,a=new Uint8Array(i*r*o);return this._gl.readPixels(e,t,r,i,s,this._gl.UNSIGNED_BYTE,a),a},Object.defineProperty(e,"IsSupported",{get:function(){return this.isSupported()},enumerable:!1,configurable:!0}),e.isSupported=function(){if(null!==this._HasMajorPerformanceCaveat)return!this._HasMajorPerformanceCaveat;if(null===this._IsSupported)try{var e=wi.CreateCanvas(1,1),t=e.getContext("webgl")||e.getContext("experimental-webgl");this._IsSupported=null!=t&&!!window.WebGLRenderingContext}catch(e){this._IsSupported=!1}return this._IsSupported},Object.defineProperty(e,"HasMajorPerformanceCaveat",{get:function(){if(null===this._HasMajorPerformanceCaveat)try{var e=wi.CreateCanvas(1,1),t=e.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||e.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!t}catch(e){this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat},enumerable:!1,configurable:!0}),e.CeilingPOT=function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e},e.FloorPOT=function(e){return e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,(e|=e>>16)-(e>>1)},e.NearestPOT=function(t){var r=e.CeilingPOT(t),i=e.FloorPOT(t);return r-t>t-i?i:r},e.GetExponentOfTwo=function(t,r,i){var n;switch(void 0===i&&(i=2),i){case 1:n=e.FloorPOT(t);break;case 2:n=e.NearestPOT(t);break;default:n=e.CeilingPOT(t)}return Math.min(n,r)},e.QueueNewFrame=function(e,t){return ei.IsWindowObjectExist()?(t||(t=window),t.requestPostAnimationFrame?t.requestPostAnimationFrame(e):t.requestAnimationFrame?t.requestAnimationFrame(e):t.msRequestAnimationFrame?t.msRequestAnimationFrame(e):t.webkitRequestAnimationFrame?t.webkitRequestAnimationFrame(e):t.mozRequestAnimationFrame?t.mozRequestAnimationFrame(e):t.oRequestAnimationFrame?t.oRequestAnimationFrame(e):window.setTimeout(e,16)):"undefined"!=typeof requestAnimationFrame?requestAnimationFrame(e):setTimeout(e,16)},e.prototype.getHostDocument=function(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:document},e.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]}],e._TextureLoaders=[],e.CollisionsEpsilon=.001,e._IsSupported=null,e._HasMajorPerformanceCaveat=null,e}();Si.prototype.createRenderTargetTexture=function(e,t){var r=new Et;void 0!==t&&"object"==typeof t?(r.generateMipMaps=t.generateMipMaps,r.generateDepthBuffer=!!t.generateDepthBuffer,r.generateStencilBuffer=!!t.generateStencilBuffer,r.type=void 0===t.type?0:t.type,r.samplingMode=void 0===t.samplingMode?3:t.samplingMode,r.format=void 0===t.format?5:t.format):(r.generateMipMaps=t,r.generateDepthBuffer=!0,r.generateStencilBuffer=!1,r.type=0,r.samplingMode=3,r.format=5),(1!==r.type||this._caps.textureFloatLinearFiltering)&&(2!==r.type||this._caps.textureHalfFloatLinearFiltering)||(r.samplingMode=1),1!==r.type||this._caps.textureFloat||(r.type=0,Jr.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type"));var i=this._gl,n=new Rt(this,lt.RenderTarget),o=e.width||e,s=e.height||e,a=e.layers||0,l=this._getSamplingParameters(r.samplingMode,!!r.generateMipMaps),h=0!==a?i.TEXTURE_2D_ARRAY:i.TEXTURE_2D,c=this._getRGBABufferInternalSizedFormat(r.type,r.format),u=this._getInternalFormat(r.format),d=this._getWebGLTextureType(r.type);this._bindTextureDirectly(h,n),0!==a?(n.is2DArray=!0,i.texImage3D(h,0,c,o,s,a,0,u,d,null)):i.texImage2D(h,0,c,o,s,0,u,d,null),i.texParameteri(h,i.TEXTURE_MAG_FILTER,l.mag),i.texParameteri(h,i.TEXTURE_MIN_FILTER,l.min),i.texParameteri(h,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(h,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),r.generateMipMaps&&this._gl.generateMipmap(h),this._bindTextureDirectly(h,null);var p=this._currentFramebuffer,f=i.createFramebuffer();return this._bindUnboundFramebuffer(f),n._depthStencilBuffer=this._setupFramebufferDepthAttachments(!!r.generateStencilBuffer,r.generateDepthBuffer,o,s),n.is2DArray||i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,n._webGLTexture,0),this._bindUnboundFramebuffer(p),n._framebuffer=f,n.baseWidth=o,n.baseHeight=s,n.width=o,n.height=s,n.depth=a,n.isReady=!0,n.samples=1,n.generateMipMaps=!!r.generateMipMaps,n.samplingMode=r.samplingMode,n.type=r.type,n.format=r.format,n._generateDepthBuffer=r.generateDepthBuffer,n._generateStencilBuffer=!!r.generateStencilBuffer,this._internalTexturesCache.push(n),n},Si.prototype.createDepthStencilTexture=function(e,t){if(t.isCube){var r=e.width||e;return this._createDepthStencilCubeTexture(r,t)}return this._createDepthStencilTexture(e,t)},Si.prototype._createDepthStencilTexture=function(e,t){var r=this._gl,i=e.layers||0,n=0!==i?r.TEXTURE_2D_ARRAY:r.TEXTURE_2D,o=new Rt(this,lt.Depth);if(!this._caps.depthTextureExtension)return Jr.Error("Depth texture is not supported by your browser or hardware."),o;var s=(0,p.pi)({bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1},t);this._bindTextureDirectly(n,o,!0),this._setupDepthStencilTexture(o,e,s.generateStencil,s.bilinearFiltering,s.comparisonFunction);var a=s.generateStencil?r.UNSIGNED_INT_24_8:r.UNSIGNED_INT,l=s.generateStencil?r.DEPTH_STENCIL:r.DEPTH_COMPONENT,h=l;return this.webGLVersion>1&&(h=s.generateStencil?r.DEPTH24_STENCIL8:r.DEPTH_COMPONENT24),o.is2DArray?r.texImage3D(n,0,h,o.width,o.height,i,0,l,a,null):r.texImage2D(n,0,h,o.width,o.height,0,l,a,null),this._bindTextureDirectly(n,null),o};var Pi=1,Ei=[{v:"precision highp float;const int pc=0,qc=1,rc=2,sc=3,tc=-1;const int k=0,l=1,m=2,n=3;const int uc=0,vc=1,wc=2;uniform vec2 u_0;uniform vec2 u_1;uniform vec2 u_2;uniform float u_3;uniform int u_4;uniform float u_5;uniform int u_6;uniform int u_7;uniform mat3 u_8;uniform float u_12;uniform int u_13;uniform float u_14;uniform int u_15;uniform vec2 u_17;uniform int u_18;uniform int u_19;attribute vec2 a_v;attribute vec4 a_p0;attribute vec4 a_p1;attribute vec4 a_p2;attribute vec4 a_p3;attribute vec4 a_p4;attribute float a_d1;attribute float a_d2;const float o=0.0,p=1.0,q=3.0,s=4.0,t=5.0,u=6.0,v=7.0;const float xc=0.001;const float yc=0.001;varying float frag_type;varying vec3 frag_geoUVS;varying vec2 frag_geoRange;varying vec4 frag_specialParam1;varying vec4 frag_specialParam2;varying vec4 frag_specialParam3;varying vec3 frag_specialParam4;varying vec2 frag_specialParam5;const int zc=2,Ac=5;const int Bc=0,Cc=1,Dc=2,Ec=3;vec2 Fc(vec4 Gc){mat3 Hc=u_8;vec2 Ic=u_0;vec2 Jc=u_1;vec2 Kc=u_17;return((Hc*vec3(Gc.xy,1.0)).xy*Jc-Ic)/Kc;}vec2 Lc(vec2 wb){return vec2(-wb.y,wb.x);}void main(){vec2 Mc=a_v;int Y=u_7;vec2 Nc=u_2;float Oc=u_3;int Z=u_4;float Pc=u_5;float Qc=u_12;int fb=u_13;float Rc=u_14;int Sc=u_15;vec2 Kc=u_17;bool Tc=u_18 !=0;bool Uc=u_19 !=0;frag_type=0.0;frag_geoRange=frag_specialParam5=vec2(0.0,0.0);frag_geoUVS=frag_specialParam4=vec3(0.0,0.0,0.0);frag_specialParam1=frag_specialParam2=frag_specialParam3=vec4(0.0,0.0,0.0,0.0);if(Y==rc || Y==sc){gl_Position=vec4(Mc,0.0,1.0);frag_type=p;}else{vec2 Vc=Fc(a_p0),Wc=Fc(a_p1),Xc=Fc(a_p2),Yc=Fc(a_p3),Zc=Fc(a_p4);int ad=int(a_p0.z),bd=int(a_p1.z),cd=int(a_p2.z),dd=int(a_p3.z),ed=int(a_p4.z);float fd=Uc ? 0.0 : a_d1,gd=Uc ? 0.0 : a_d2;float hd=a_p1.w,id=a_p2.w,jd=a_p3.w;bool kd=bd==wc;bool ld=cd==wc;vec2 md,nd,od;int pd,qd;if(ld){md=Wc;nd=Xc;od=Yc;pd=bd;qd=dd;}else if(kd){md=Vc;nd=Wc;od=Xc;pd=ad;qd=cd;}else{md=Wc;nd=(Wc+Xc)*0.5;od=Xc;pd=bd;qd=cd;}vec2 rd=od-md,sd=nd-md,td=od-nd;float ud=length(rd),vd=length(sd),wd=length(td);vec2 xd=rd/ud,yd=sd/vd,zd=td/wd;vec2 Ad=Lc(xd),Bd=Lc(yd),Cd=Lc(zd);float Dd=dot(Bd,zd);mat2 Ed;vec2 Fd,Gd;float Hd;bool Id=false;vec2 Jd;if(ld || kd){vec2 Kd=td-sd;float Ld=(dot(-sd,td)+dot(-sd,-sd))/dot(Kd,Kd);vec2 Md=mix(md,nd,Ld),Nd=mix(nd,od,Ld),Od=normalize(Nd-Md);float Pd=sign(Dd);mat2 Qd=mat2(Od,vec2(-Od.y,Od.x)*Pd);vec2 Rd=mix(Md,Nd,Ld);vec2 Sd=(md-Rd)*Qd,Td=(od-Rd)*Qd;float Ud=abs(Sd.x)> abs(Td.x)?(Sd.x*Sd.x)/Sd.y :(Td.x*Td.x)/Td.y;Ed=Qd/Ud;Fd=Rd;Gd=vec2(Sd.x,Td.x)/Ud;Hd=Ud*Pd;Id=Tc || abs(Dd)< xc || min(abs(ud),min(abs(vd/ud),abs(wd/ud)))< Oc*yc;if(Id){nd=(md+od)*0.5;sd=nd-md;td=od-nd;vd=wd=ud*0.5;yd=zd=xd;Bd=Cd=Ad;Dd=1.0;}}bool Vd=ld || kd;vec2 Wd=Vc;int Xd=ad;vec2 Yd=Vd ? Zc : Yc;int Zd=Vd ? ed : dd;bool ae=(Xd==0),be=(Zd==0),ce=(qd==0);if(Xd==0)Wd=md-(nd-md);if(Zd==0)Yd=od-(od-nd);vec2 de=md-Wd,ee=-de,fe=Yd-od,ge=-fe;float he=length(de),ie=length(fe);vec2 je=de/he,ke=fe/ie;vec2 le=Lc(je),me=Lc(ke);if(! Vd || Id){if(vd < yc){yd=je;Bd=le;}if(wd < yc){zd=ke;Cd=me;}if(ud < yc){xd=normalize(Yd-Wd);Ad=Lc(xd);}if(ud < yc){xd=vec2(1.0,0.0);Ad=vec2(0.0,-1.0);ud=yc;}if(vd < yc){yd=xd;Bd=Ad;}if(wd < yc){zd=xd;Cd=Ad;}if(he < yc){je=yd;le=Bd;}if(ie < yc){ke=zd;me=Cd;}Ed=mat2(xd/ud,Ad/ud);Fd=md;Gd=vec2(0.0,1.0);Hd=ud;}vec2 ne=vec2(0.0,0.0);if(Y==pc &&(! Vd || ld)){if(Tc){bool ce=(qd==0);if(ce || abs(ud)< Oc*yc)frag_type=o;else{float oe=clamp(hd,0.0,1.0);float pe=clamp((Vd ? jd : id),0.0,1.0);float qe=Vd ? fd+(gd-fd)*2.0 : gd;float re=Qc*0.5;vec4 se=vec4(min(md.x,od.x)-Oc*Kc.x,min(md.y,od.y)-Oc*Kc.y,max(md.x,od.x)+Oc*Kc.x,max(md.y,od.y)+Oc*Kc.y);ne=Mc*vec2(se [ 2 ]-se [ 0 ],se [ 3 ]-se [ 1 ])/2.0+vec2(se [ 2 ]+se [ 0 ],se [ 3 ]+se [ 1 ])/2.0;vec2 te=vec2(xd.x==0.0 ? 1.0 : sign(xd.x),xd.y==0.0 ? 1.0 : sign(xd.y));float ue=re*(1.0-oe),ve=re*(1.0-pe);float we=re*oe,xe=re*pe;vec2 ye=md-te*we,ze=od+te*xe;vec2 Ae=ye+vec2(te.x*2.0*we,0.0),Be=ze-vec2(te.x*2.0*xe,0.0);vec2 Ce=ye+vec2(0.0,te.y*2.0*we),De=ze-vec2(0.0,te.y*2.0*xe);bool Ee=dot(Ad,Ae-md)>=0.0,Fe=dot(Ad,Be-md)>=0.0;vec2 Ge=Ee ? Ae : Ce,He=Fe ? Be : De;vec2 Ie=Ee ? Ce : Ae,Je=Fe ? De : Be;float Ke=max(abs(xd.x),abs(xd.y));float Le=dot(ne-Ge,Lc(normalize(He-Ge)))*Ke+re;float Me=dot(ne-Ie,-Lc(normalize(Je-Ie)))*Ke+re;float Ne=dot(ne-md,Ad);float Oe=dot(ne-md,(oe > xc)? Lc(Ie-Ge): xd);float Pe=dot(ne-od,(pe > xc)? Lc(He-Je):-xd);frag_specialParam1=vec4(ne-md,ne-od)*0.5/Oc;frag_specialParam2=vec4(Le,Me,ue,ve)*0.5/Oc;frag_specialParam3=vec4(gd-fd,fd,0.0,0.0);frag_specialParam4=vec3(Ne,Oe,Pe);frag_type=v;}}else{float Qe=dot(le,yd),Re=dot(Cd,ke),Se=dot(le,xd),Te=dot(Ad,ke);bool Ue=abs(Qe)< xc,Ve=abs(Re)< xc;bool We=Ue && dot(je,yd)< 0.0,Xe=Ve && dot(zd,ke)< 0.0;float Ye=(! Ue)? sign(Qe):(Se !=0.0)? sign(Se): sign(Te);float Ze=(! Ve)? sign(Re):(Te !=0.0)? sign(Te): sign(Se);vec2 af=normalize(le+Bd)*-Ye;float bf=abs(dot(af,Bd));float cf=(Z==k)? bf :(Z==l)? 1.0/max(bf,xc): 1.0;vec2 df=We ? yd*Ye : af*cf;vec2 ef=normalize(Cd+me)*-Ze;float ff=abs(dot(ef,Cd));float gf=(Z==k)? ff :(Z==l)? 1.0/max(ff,xc): 1.0;vec2 hf=Xe ?-zd*Ze : ef*gf;vec4 se=vec4(min(min(min(min(md.x,od.x),nd.x),md.x+df.x*Oc),od.x+hf.x*Oc)-Oc,min(min(min(min(md.y,od.y),nd.y),md.y+df.y*Oc),od.y+hf.y*Oc)-Oc,max(max(max(max(md.x,od.x),nd.x),md.x+df.x*Oc),od.x+hf.x*Oc)+Oc,max(max(max(max(md.y,od.y),nd.y),md.y+df.y*Oc),od.y+hf.y*Oc)+Oc);ne=Mc*vec2(se [ 2 ]-se [ 0 ],se [ 3 ]-se [ 1 ])/2.0+vec2(se [ 2 ]+se [ 0 ],se [ 3 ]+se [ 1 ])/2.0;vec2 jf=normalize(Bd+df*Ye);vec2 kf=-normalize(le+df*Ye);bool lf=ce || We || Ue || cf > vd*10.0 || cf > he*10.0;vec2 mf=ne-md;vec2 nf=normalize(df);float Cb=-dot(mf,(vd < xc || We)? xd : yd);float Db=lf ? Cb :-dot(mf,Lc(nf))*Ye;float Eb=lf ?-dot(mf,Bd)*Ye : dot(mf,Lc(jf))/(2.0*Oc*length(df+jf*dot(-df,jf)));float Fb=lf ? 0.5 :(dot(mf,nf)/Oc-Pc)/abs(dot(nf,Bd));float Gb=lf ? 1.0 : dot(mf,Lc(kf))/(2.0*Oc*length(df+kf*dot(-df,kf)));vec2 of=-normalize(Cd+hf*Ze);vec2 pf=normalize(me+hf*Ze);bool qf=ce || Xe || Ve || gf > wd*10.0 || gf > ie*10.0;vec2 rf=ne-od;vec2 sf=normalize(hf);float Hb=dot(rf,(wd < xc || Xe)? xd : zd);float Ib=qf ? Hb : dot(rf,Lc(sf))*Ze;float Jb=qf ?-dot(rf,Cd)*Ze : dot(rf,Lc(of))/(2.0*Oc*length(hf+of*dot(-hf,of)));float Kb=qf ? 0.5 :(dot(rf,sf)/Oc-Pc)/abs(dot(sf,Cd));float Lb=qf ? 1.0 : dot(rf,Lc(pf))/(2.0*Oc*length(hf+pf*dot(-hf,pf)));float tf=(1.0-Rc)*Qc/(4.0*Oc);if(ae)Gb=-dot(mf,yd)/(2.0*Oc)+tf;if(be)Lb=dot(rf,zd)/(2.0*Oc)+tf;float uf,vf;if(Vd && ! Id){float wf=fd,qe=fd+(gd-fd)*2.0;float xf=sqrt(1.0+4.0*Gd [ 0 ]*Gd [ 0 ]),yf=sqrt(1.0+4.0*Gd [ 1 ]*Gd [ 1 ]);float zf=sign(Gd [ 0 ])*0.5*(abs(Gd [ 0 ])*xf+0.5*log(2.0*abs(Gd [ 0 ])+xf));float Af=sign(Gd [ 1 ])*0.5*(abs(Gd [ 1 ])*yf+0.5*log(2.0*abs(Gd [ 1 ])+yf));uf=(qe-wf)/abs(Af-zf);vf=wf-zf*uf;}else{float wf=fd;float qe=gd;uf=qe-wf;vf=wf;}float oe=hd;float pe=Vd ? jd : id;vec2 Bf=(vec2(1.0,1.0)-clamp(vec2(oe,pe),0.0,1.0))*Qc/(4.0*Oc);frag_specialParam1=vec4(vec2(Cb,Db)/Qc,Eb,Fb);frag_specialParam2=vec4(vec2(Hb,Ib)/Qc,Jb,Kb);frag_specialParam3=vec4(uf,vf,Bf.x,Bf.y);if(Sc==0 || Rc > 0.0)frag_specialParam4=vec3(ae ? 0.0 : 1.0,be ? 0.0 : 1.0,ce ? 0.0 : 1.0);else frag_specialParam4=vec3(1.0,1.0,ce ? 0.0 : 1.0);frag_specialParam5=vec2(Gb,Lb);frag_type=(Vd && ! Id)? s : q;}}else if(Y==qc &&(! Id || ld)){float Cf=(Mc.y)/(Kc.x*Nc.x);if(! Vd || Id){vec2 Df=(Mc.x < 0.0)? md : od;ne=Df+vec2(Cf,0.0);frag_type=t;}else{float Ef=clamp((md.y-nd.y)/(md.y+od.y-2.0*nd.y),0.0,1.0);vec2 Ff=mix(mix(md,nd,Ef),mix(nd,od,Ef),Ef);vec2 Gf=ld ? md : Ff;vec2 Hf=ld ? Ff : od;vec2 Df=(Mc.x < 0.0)? Gf : Hf;vec2 If=(Ff-Fd)*Ed;vec2 Jf=(Df+vec2(Cf,0.0)-Fd)*Ed;vec2 Kf=((ld ? md : od)-Fd)*Ed;float Lf=Jf.x-If.x;float Mf=sign(Kf.x-If.x);float fc=Lf*Mf;float gc=sign(dot(Bd,zd));ne=Df+vec2(Cf,0.0);frag_specialParam1.x=dot(ne-md,Bd*sign(dot(Bd,xd)));frag_specialParam1.y=dot(ne-nd,Cd*sign(dot(Cd,-yd)));frag_specialParam1.z=dot(ne-od,Ad*sign(dot(Ad,-zd)));frag_specialParam1.w=dot(ne-Gf,vec2(Gf.y-Hf.y,Hf.x-Gf.x));frag_specialParam2.x=fc;frag_specialParam2.y=gc;frag_type=u;}}else{gl_Position=vec4(0.0,0.0,0.0,0.0);frag_type=o;}gl_Position=vec4(ne.x*Nc.x*2.0*Kc.x,-ne.y*Nc.y*2.0*Kc.y,0.0,1.0);frag_geoRange=Gd;frag_geoUVS.xy=(ne-Fd)*Ed;frag_geoUVS.z=Hd*0.5/Oc;if(fb==2)frag_specialParam3=vec4(Mc.x*0.5+0.5,Mc.y*0.5+0.5,rd.x+rd.y,0.0);}}",f:"precision highp float;const int c=0,d=1,e=2,f=3,h=4,i=5,j=6;const int k=0,l=1,m=2,n=3;uniform int ufrag_0;uniform int ufrag_1;uniform float ufrag_2;uniform float ufrag_3;uniform float ufrag_4;uniform float ufrag_5;uniform float ufrag_6;uniform int ufrag_7;uniform float ufrag_8;uniform float ufrag_10;uniform float ufrag_11;uniform float ufrag_12;uniform vec4 ufrag_13;uniform float ufrag_15;uniform vec2 ufrag_16;uniform int ufrag_17;uniform float ufrag_18;uniform float ufrag_19;varying float frag_type;const float o=0.0,p=1.0,q=3.0,s=4.0,t=5.0,u=6.0,v=7.0;varying vec3 frag_geoUVS;varying vec2 frag_geoRange;varying vec4 frag_specialParam1;varying vec4 frag_specialParam2;varying vec4 frag_specialParam3;varying vec3 frag_specialParam4;varying vec2 frag_specialParam5;float A(vec2 B,vec2 C){float a=0.5-B.y;float b=-0.5*B.x;float D=b*0.5;float E=(b*b)*0.25;float F=(a*a*a)/27.0;if(E+F > 0.0){float G=sqrt(E+F);float H=G-D;float I=sign(H)*pow(abs(H),1.0/3.0);float J=G+D;float K=-sign(J)*pow(abs(J),1.0/3.0);float x=I+K;return clamp(x,C [ 0 ],C [ 1 ]);}else{const float L=0.333333333;const vec3 M=vec3(0.0,2.094395102,4.188790205);float N=1.0/a;vec3 O=2.0*sqrt(-a*L)*cos(L*acos(sqrt(-6.75*N)*b*N)-M);vec3 x=clamp(O,C [ 0 ],C [ 1 ]);vec3 P=B.x-x,Q=B.y-x*x,R=P*P+Q*Q;return(R [ 0 ] < R [ 1 ] && R [ 0 ] < R [ 2 ])? x [ 0 ] :(R [ 1 ] < R [ 2 ])? x [ 1 ] : x [ 2 ];}}bool S(float T){return T-0.4 < frag_type && frag_type < T+0.4;}float U(float V,float a,float b,float W,float X){return clamp((abs(V*2.0-a-b)+a-b)*W*0.5+X,0.0,1.0);}void main(){int Y=ufrag_0;int Z=ufrag_1;float ab=ufrag_2;float bb=ufrag_3;float cb=ufrag_4;float db=ufrag_5;float eb=ufrag_6;int fb=ufrag_7;float gb=ufrag_8;float hb=ufrag_10;float ib=ufrag_11;float jb=ufrag_12;vec4 kb=ufrag_13;float lb=ufrag_15;vec2 mb=ufrag_16;bool nb=(ufrag_17==1);float ob=ufrag_18;float pb=ufrag_19;const float qb=1.0;float F=qb;float rb;float sb=0.0;float tb=0.0;if(Y==0 && ! S(v)){float V=0.0;float ub=0.0;vec2 vb;if(S(s)){float x=A(frag_geoUVS.xy,frag_geoRange);vb=frag_geoUVS.xy-vec2(x,x*x);vec2 wb=normalize(vec2(1.0,2.0*x));sb=dot(vb,vec2(-wb.y,wb.x))*frag_geoUVS.z;float xb=2.0*abs(x),yb=sqrt(1.0+xb*xb);float zb=sign(x)*(xb*yb+log(xb+yb))*0.25;float Ab=1.0-abs(sign((x-frag_geoRange [ 0 ])*(x-frag_geoRange [ 1 ])));V=zb+Ab*dot(vb,wb);ub=(x-frag_geoRange [ 0 ])/(frag_geoRange [ 1 ]-frag_geoRange [ 0 ]);}else{vb=frag_geoUVS.xy-vec2(clamp(frag_geoUVS.x,0.0,1.0),0.0);V=ub=frag_geoUVS.x;sb=frag_geoUVS.y;}F=length(vb)*abs(frag_geoUVS.z);ub=clamp(ub,0.0,1.0);const float Bb=0.01;float Cb=frag_specialParam1 [ 0 ],Db=frag_specialParam1 [ 1 ],Eb=frag_specialParam1 [ 2 ],Fb=frag_specialParam1 [ 3 ],Gb=frag_specialParam5 [ 0 ];float Hb=frag_specialParam2 [ 0 ],Ib=frag_specialParam2 [ 1 ],Jb=frag_specialParam2 [ 2 ],Kb=frag_specialParam2 [ 3 ],Lb=frag_specialParam5 [ 1 ];float Mb=frag_specialParam4.x,Nb=frag_specialParam4.y,Ob=frag_specialParam4.z;bool Pb=ub < 0.5 ?(Mb !=0.0 &&(Db > Bb || Fb > 1.0)):(Nb !=0.0 &&(Ib > Bb || Kb > 1.0));if(Z !=m){if(Pb)F=qb;else{const float Qb=0.001;if(ub < 0.5 && Cb > Bb && Mb !=0.0)F=(Db <=Qb)? Eb :(Fb >=0.0)? Gb : qb;if(ub > 0.5 && Hb > Bb && Nb !=0.0)F=(Ib <=Qb)? Jb :(Kb >=0.0)? Lb : qb;}}float Rb=F;if(Mb==0.0)Rb=max(Rb,Gb);if(Nb==0.0)Rb=max(Rb,Lb);tb=V*frag_specialParam3.x+frag_specialParam3.y;bool Sb=(mb==vec2(0.0,0.0))||(mb [ 0 ] <=tb && tb <=mb [ 1 ]);bb=Sb ? bb*Ob : 0.0;float Tb=(F <=lb && Sb)? bb : 0.0;float Ub=Pb ? 0.0 : Tb;const float Vb=0.2;const float Wb=(1.0-2.0*Vb)*2.0;float Xb=abs(fract(db+tb*cb)*2.0-1.0)*jb;float Yb=U(Xb,kb [ 0 ],kb [ 1 ],Wb,Vb)*U(Xb,kb [ 2 ],kb [ 3 ],Wb,Vb)*Tb;float Zb=clamp(0.5-F*sign(sb)*ib,0.0,1.0)*Ub;rb=sign(Rb)*max(0.0,abs(Rb)+mix(frag_specialParam3.z,frag_specialParam3.w,ub));float ac=(0.5-rb+pb)*bb;float bc=(0.5-F)*ab;vec4 cc=vec4(bc,ac,Zb,Yb);vec4 dc=vec4(ac,bc,0.0,0.0);vec4 ec=mix(cc,dc,ob);gl_FragColor=clamp(ec,0.0,1.0);}else if(S(t)){gl_FragColor=vec4(0.0,0.0,0.0,1.0);if(eb==sign(frag_geoUVS.y))discard;}else if(S(u)){gl_FragColor=vec4(0.0,0.0,0.0,0.0);if(frag_specialParam1.x > 0.0 && frag_specialParam1.y > 0.0 && frag_specialParam1.z > 0.0){float fc=frag_specialParam2.x,gc=frag_specialParam2.y;float hc=((fc >=0.0)? sign((frag_geoUVS.y-frag_geoUVS.x*frag_geoUVS.x)): 1.0)*gc;if(eb==hc)discard;}else if(eb==sign(frag_specialParam1.w))discard;}else if(S(v)){tb=frag_geoUVS.x*frag_specialParam3.x+frag_specialParam3.y;float ic=max(abs(frag_specialParam1.x),abs(frag_specialParam1.y))+frag_specialParam2.z;float jc=max(abs(frag_specialParam1.z),abs(frag_specialParam1.w))+frag_specialParam2.w;rb=min(ic,jc);if(frag_specialParam4.y >=0.0 && frag_specialParam4.z >=0.0)rb=min(rb,frag_specialParam4.x >=0.0 ? frag_specialParam2.x : frag_specialParam2.y);float kc=0.5-clamp(rb,0.0,0.5);gl_FragColor=vec4(kc*ab,kc*bb,0.0,1.0);}else gl_FragColor=vec4(frag_type*(1.0-gb),0.0,0.0,frag_type*gb);if(Y==0 && nb){float lc=smoothstep(lb,lb*1.5,rb);float mc=(tb+32.0*rb/lb)*jb;float nc=1.0-(mc+lc);gl_FragColor=vec4(nc,nc,nc,1.0);}if(fb==e){gl_FragColor.rgb=clamp(vec3(1.0-F*2.0,1.0-F*4.0,1.0-F*8.0),0.0,1.0);float oc=0.25+clamp((abs(frag_specialParam3.x+frag_specialParam3.y-1.0)+abs(frag_specialParam3.x-frag_specialParam3.y))*4.0-2.75,0.0,1.0);gl_FragColor+=vec4(oc*(1.0+sin(frag_specialParam3.z))/2.0,oc*(1.0+cos(frag_specialParam3.z))/2.0,oc*frag_specialParam3.z/18.0,1.0);}}",a:["a_v","a_p0","a_p1","a_p2","a_p3","a_p4","a_d1","a_d2"],u:["ufrag_0","ufrag_1","ufrag_2","ufrag_3","ufrag_4","ufrag_5","ufrag_6","ufrag_7","ufrag_8","ufrag_10","ufrag_11","ufrag_12","ufrag_13","ufrag_15","ufrag_16","ufrag_17","ufrag_18","ufrag_19","u_0","u_1","u_2","u_3","u_4","u_5","u_6","u_7","u_8","u_12","u_13","u_14","u_15","u_17","u_18","u_19"],s:[]},{v:"precision highp float;uniform mat3 u_0;uniform mat3 u_1;uniform vec2 u_2;uniform mat3 u_3;uniform mat3 u_4;uniform mat3 u_5;uniform mat3 u_6;uniform mat3 u_7;uniform mat3 u_8;uniform mat3 u_10;uniform mat3 u_11;uniform int u_13;uniform int u_14;uniform vec2 u_15;uniform int u_16;uniform float u_17;uniform float u_18;uniform float u_19;uniform vec2 u_20;uniform vec2 u_21;attribute vec2 a_v;attribute vec2 a_0;attribute vec2 a_1;varying vec2 l,m,n,o,p,q,s,t;varying float u;mat2 Uc(float Vc){return mat2(cos(Vc),-sin(Vc),sin(Vc),cos(Vc));}vec2 Wc(vec2 Xc){return vec2(Xc.x/2.0,Xc.y/-2.0)+vec2(0.5,0.5);}vec2 Yc(vec2 Xc,mat3 Zc){return(Zc*vec3(vec2(Xc.x/2.0,Xc.y/2.0),1.0)).xy*vec2(1.0,-1.0)+vec2(0.5,0.5);}mat4 ad(float bd,float cd,float dd,float ed){float a=1.0/tan(bd*0.5),b=1.0/(dd-ed);return mat4(a/cd,0.0,0.0,0.0,0.0,-a,0.0,0.0,0.0,0.0,(dd+ed)*b,-1.0,0.0,0.0,2.0*dd*ed*b,0.0);}mat4 fd(float Vc){float gd=cos(Vc),hd=sin(Vc);return mat4(1.0,0.0,0.0,0.0,0.0,gd,-hd,0.0,0.0,hd,gd,0.0,0.0,0.0,0.0,1.0);}mat4 id(float Vc){float gd=cos(Vc),hd=sin(Vc);return mat4(gd,0.0,hd,0.0,0.0,1.0,0.0,0.0,-hd,0.0,gd,0.0,0.0,0.0,0.0,1.0);}void main(){vec2 jd=a_v;mat3 kd=u_0;vec2 ld=u_15;mat3 md=u_1;vec2 nd=u_2;mat3 od=u_3;mat3 pd=u_4;mat3 qd=u_5;mat3 rd=u_6;mat3 sd=u_7;mat3 td=u_8;mat3 ud=u_10;mat3 vd=u_11;vec2 wd=u_20;vec2 xd=u_21;int yd=u_13;int zd=u_14;float Ad=u_18;float Bd=u_19;vec2 Cd=jd;vec2 Dd=jd;if(u_16 !=0){Cd=jd+a_0*2.0;Dd=jd+a_1*2.0;jd=mix(Cd,Dd,u_17);}vec2 Ed=(kd*vec3(jd.xy/2.0,1.0)).xy;vec2 Fd;if(ld !=vec2(1.0,1.0)){const float Gd=1.57079632679;mat4 Hd=id((1.0-ld.x)*Gd),Id=fd((1.0-ld.y)*Gd);mat4 Jd=mat4(mat2(md));Jd [ 3 ] [ 0 ]=md [ 2 ] [ 0 ];Jd [ 3 ] [ 1 ]=md [ 2 ] [ 1 ];vec4 Kd=Jd*Id*Hd*vec4(Ed,0.0,1.0)-vec4(nd*0.5,0.0,0.0);gl_Position=vec4((Kd.xy/nd)*vec2(2.0,-2.0),0.0,1.0);const float Ld=0.78539816339;float Md=nd.y/(2.0*tan(Ld*0.5));Kd.z-=Md;vec4 Nd=ad(Ld,nd.x/nd.y,Md/2.0,Md*2.0)*Kd;gl_Position=Nd/Nd.w;}else{vec2 Fd=(md*vec3(Ed,1.0)).xy;gl_Position=vec4((Fd/nd-vec2(0.5,0.5))*vec2(2.0,-2.0),0.0,1.0);}gl_Position.z=mix(Ad,Bd,jd.y*0.5+0.5);l=Yc(Cd.xy,od);t=Yc(Cd.xy,vd);m=Yc((yd !=0)? gl_Position.xy : Dd.xy,pd);o=Yc((zd !=0)? gl_Position.xy : jd.xy,rd);n=Yc(jd.xy,qd);q=Yc(jd.xy,sd);s=Yc(jd.xy,td);p=Yc(jd.xy,ud);if(wd==xd){u=1.0;}else{vec2 Od=xd-wd;u=dot(Ed-wd,Od)/dot(Od,Od);}}",f:"precision highp float;uniform sampler2D t_0;uniform sampler2D t_1;uniform sampler2D t_2;uniform sampler2D t_3;uniform sampler2D t_4;uniform sampler2D t_5;uniform sampler2D t_6;uniform sampler2D t_7;uniform float ufrag_0;uniform float ufrag_1;uniform float ufrag_2;uniform vec4 ufrag_3;uniform vec4 ufrag_4;uniform float ufrag_6;uniform vec3 ufrag_8;uniform vec3 ufrag_9;uniform int ufrag_10;uniform int ufrag_11;uniform vec2 ufrag_12;uniform vec4 ufrag_13;uniform int ufrag_14;uniform int ufrag_15;uniform int ufrag_16;uniform vec2 ufrag_17;uniform int ufrag_18;uniform int ufrag_19;uniform float ufrag_20;uniform float ufrag_21;uniform vec4 ufrag_22;uniform vec4 ufrag_23;uniform int ufrag_24;uniform int ufrag_25;uniform vec4 ufrag_26;uniform float ufrag_27;uniform float ufrag_28;uniform float ufrag_29;uniform int ufrag_30;uniform int ufrag_31;uniform float ufrag_32;uniform int ufrag_34;uniform int ufrag_35;uniform float ufrag_36;uniform int ufrag_37;uniform int ufrag_38;uniform int ufrag_39;uniform float ufrag_40;const int c=0,d=1,e=2,f=3,h=10,i=11,j=14,k=16;varying vec2 l,m,n,o,p,q,s,t;varying float u;float v(float A){return clamp(A,0.0,1.0);}const vec2 B=vec2(.5,.5);vec4 C(vec4 D,vec4 E){float F=E.a+D.a*(1.0-E.a);return vec4((E.rgb*E.a+D.rgb*D.a*(1.0-E.a))/F,F);}float G(float H,vec3 I,vec3 J){float K=clamp(H,I [ 0 ],I [ 2 ]);vec3 L=abs((K-I)*J);return min(L [ 0 ],min(L [ 1 ],L [ 2 ]));}float M(vec2 N){vec2 O=sign(B-abs(N-B));return max(0.0,O.x+O.y)*.5;}float P(float Q,float R,float S){const float T=-0.5;const float U=0.16;const float V=0.5;float W=mix(U,T,v(S*V));float X=min(S,R);float Y=1.0-v((Q-W)/X);return Y*Y;}vec2 Z(vec4 ab,float bb,float cb,float db,vec3 eb,vec3 fb,float S,float gb){bool hb=ufrag_38 !=0;float ib=max(cb,S)*0.5;float jb=ab.r-0.5;float kb=P(-jb/bb,0.5/bb,S);float lb=clamp(0.5-mix(ab.g,min(1.0-ab.r,ab.g),ufrag_29),0.0,0.5);float mb=(hb && gb==0.0)? lb : 0.5-ab.b;float H=lb*sign(mb)/bb;bool nb=fb [ 0 ]==fb [ 2 ];if(! nb && abs(H)< cb*0.5-S*2.0)H=mb/bb;H+=gb;const float ob=0.2;const float pb=1.0/(1.0-ob*2.0);const float qb=0.5-0.5*pb;float rb=ab.a;float sb=rb*pb+qb;float tb=(1.0-sb)*ib;float ub=abs(H);if(rb <(1.0-ob)&& ! hb)ub=mix(max(tb,ub),length(vec2(tb,ub)),db);const float vb=0.49;float wb=min(ib,vb/bb);float xb=P(ub-wb,0.5/bb-wb,S);if(rb < ob && ! hb){xb=0.0;}if(sb >=db && ! hb){float yb=G(H,eb*ib,fb);float zb=min(min(fb [ 0 ],fb [ 1 ]),fb [ 2 ]);float Ab=S*zb;float Bb=P(yb-wb,0.5/bb-wb,Ab);xb=min(xb,Bb);}if(ufrag_37==0)return vec2(clamp(kb,0.0,1.0),clamp(xb,0.0,1.0));else return vec2(0.0,clamp(max(kb,xb),0.0,1.0));}const int Cb=0,Db=1,Eb=2,Fb=3,Gb=4,Hb=5,Ib=6,Jb=7,Kb=8,Lb=9;vec2 Mb(int Nb,vec4 Ob,vec2 N,float bb){if(Nb==Gb)return vec2(1.0-min(min(Ob [ 0 ]*N.x,Ob [ 3 ]*N.y),min(Ob [ 2 ]*(1.0-N.x),Ob [ 1 ]*(1.0-N.y))),0.0);if(Nb==Eb){float Pb=N.x,Qb=floor(Pb),K=Pb-Qb;Pb=(fract(Qb*0.5)==0.0)? K : 1.0-K;return vec2(Pb,0.0);}else return N;}vec4 Rb(int Nb,vec4 Ob,vec4 Sb,vec2 N,sampler2D Tb,int Ub,vec4 ab,float bb){if(Nb==Cb)return vec4(0.0,0.0,0.0,0.0);if(Nb==Db)return Ob;if(Ub !=0 && Nb !=0 && Nb > 1 &&(N.x < 0.0 || N.x > 1.0 || N.y < 0.0 || N.y > 1.0))return vec4(0.0,0.0,0.0,0.0);vec4 Y=texture2D(Tb,Mb(Nb,Ob,N,bb));if(Nb==Jb)return mix(Ob,Sb,Y.r);else{if(Nb==Ib && Y.a > 0.0)Y.rgb/=Y.a;return Y;}}void main(){float bb=ufrag_0;float cb=ufrag_1;float Vb=ufrag_2;vec4 Wb=ufrag_3;vec4 Xb=ufrag_4;float db=ufrag_6;vec3 eb=ufrag_8;vec3 fb=ufrag_9;int Yb=ufrag_10;int Zb=ufrag_11;vec2 ac=ufrag_12;vec4 bc=ufrag_13;int cc=ufrag_15;int dc=ufrag_16;vec2 ec=ufrag_17;int fc=ufrag_18;int gc=ufrag_19;float hc=ufrag_20;float ic=ufrag_21;vec4 jc=ufrag_22;vec4 kc=ufrag_23;int lc=ufrag_24;int mc=ufrag_25;vec4 nc=ufrag_26;float gb=ufrag_27;float oc=ufrag_28;int pc=ufrag_30;int qc=ufrag_31;float rc=ufrag_32;bool sc=ufrag_34 !=0;float tc=ufrag_36;int uc=ufrag_39;float vc=ufrag_40;vec4 wc=sc ? vec4(0.0,0.0,0.0,0.0): texture2D(t_0,l);if(cc==e || cc==f){float xc=M(l);float yc=M(m);wc*=xc;if(tc > 0.0){vec4 zc=texture2D(t_1,m)*yc;wc=mix(wc,zc,v(tc));}if(cc==f){vec4 Ac=texture2D(t_2,l)*xc;vec4 Bc=texture2D(t_4,m)*yc;vec4 Cc=mix(Ac,Bc,v(tc));vec4 Dc=vec4(0.0,0.0,0.0,0.0);if(n.x >=0.0 && n.x <=1.0 && n.y >=0.0 && n.y <=1.0){Dc=mix(texture2D(t_5,n),texture2D(t_6,n),tc);}float Ec=abs(Cc.r-wc.r);wc=mix(wc*0.5+Cc*0.5,Dc,Ec);}gl_FragColor=wc;if(gl_FragColor.a > 0.0){gl_FragColor.rgb/=gl_FragColor.a;}}else if(cc <=d){vec2 Fc=sc ? vec2(1.0,0.0): Z(wc,bb,cb,db,eb,fb,Vb,gb);if(uc !=0 && ufrag_37==0){vec4 Gc=texture2D(t_7,t)*M(t);vec2 Hc=Z(Gc,bb,cb,db,eb,fb,Vb,gb);Fc=(uc==2)? vec2(v(Fc.x-Hc.x),v(Fc.y*(1.0-Hc.x)+Fc.x*Hc.y)):(uc==1)? vec2(Hc.x*Fc.x,v(Hc.y*Fc.x+Fc.y*Hc.x)): Hc;}vec4 Ic=Rb(Yb,Wb,jc,m,t_1,fc,wc,bb);Ic.a*=hc;vec4 Jc=vec4(Ic.rgb,0.0);if(pc !=0){vec4 Kc=Rb(Ib,vec4(0.0,0.0,0.0,0.0),vec4(0.0,0.0,0.0,0.0),n,t_6,qc,wc,bb);Kc.a*=rc;if(Kc.a > 0.0)Ic=C(Ic,Kc);Jc=vec4(Kc.rgb,Kc.a*vc*M(n));}Ic.rgb=clamp(mix(Ic.rgb,vec3(0.5)*sign(oc)+0.5,abs(oc)),0.0,1.0);if(mc !=0){float Lc=texture2D(t_5,s).a;Ic.rgb=mix(Ic.rgb,nc.rgb,(1.0-Lc)*nc.a);}vec4 Mc=mix(Jc,Ic,Fc [ 0 ]);vec4 Nc=Rb(Zb,Xb,kc,o,t_2,gc,wc,bb);vec4 Oc=vec4(Nc.rgb,Nc.a*Fc [ 1 ]*ic);gl_FragColor=C(Mc,Oc);}else if(cc==h){float Pc=(wc.r-0.5);float Qc=v(1.0-2.0*abs(sin(Pc*64.0)))*0.5;if(Pc < 0.0)gl_FragColor=vec4(0.0,Qc*(1.0+Pc),1.0+Pc,1.0+Pc);else gl_FragColor=vec4(1.0-Pc,Qc*(1.0-Pc),0.0,1.0);}else{if(cc==i)gl_FragColor=vec4(wc.r,wc.g*2.0,0.0,1.0);else if(cc==j)gl_FragColor=vec4(wc.r,0.0,0.0,1.0);else if(cc==k)gl_FragColor=vec4(wc.b,wc.b > 0.95 ?(wc.b-0.95)*20.0 : 0.0,wc.a,1.0);else gl_FragColor=vec4(wc.r,wc.g,wc.b,1.0);}float Rc=ac [ 0 ]+(ac [ 1 ]-ac [ 0 ])*v(u);if(lc !=0)Rc-=1.0-texture2D(t_4,q).a;if(dc !=0 &&(cc==0 || cc==2)){if(dc==1){Rc-=1.0-ec [ 1 ];}else if(dc==2){float Sc=1.0-texture2D(t_3,p).r;Rc-=1.0-v(Sc*ec [ 0 ]+ec [ 1 ]);}}gl_FragColor.a=v(gl_FragColor.a)*v(Rc);if(cc !=d && bc.a > 0.0)gl_FragColor.rgb=bc.rgb;gl_FragColor.rgb*=gl_FragColor.a;gl_FragColor.rgb=clamp(gl_FragColor.rgb,0.0,1.0);if(cc==d){if(gl_FragColor.a > 0.0)gl_FragColor=bc;else gl_FragColor=vec4(0.0,0.0,0.0,0.0);}if(ufrag_35==1){float Tc=1.0-gl_FragColor.a;gl_FragColor=vec4(Tc+gl_FragColor.rgb,gl_FragColor.a);}}",a:["a_v","a_0","a_1"],u:["ufrag_0","ufrag_1","ufrag_2","ufrag_3","ufrag_4","ufrag_6","ufrag_8","ufrag_9","ufrag_10","ufrag_11","ufrag_12","ufrag_13","ufrag_14","ufrag_15","ufrag_16","ufrag_17","ufrag_18","ufrag_19","ufrag_20","ufrag_21","ufrag_22","ufrag_23","ufrag_24","ufrag_25","ufrag_26","ufrag_27","ufrag_28","ufrag_29","ufrag_30","ufrag_31","ufrag_32","ufrag_34","ufrag_35","ufrag_36","ufrag_37","ufrag_38","ufrag_39","ufrag_40","u_0","u_1","u_2","u_3","u_4","u_5","u_6","u_7","u_8","u_10","u_11","u_13","u_14","u_15","u_16","u_17","u_18","u_19","u_20","u_21"],s:["t_0","t_1","t_2","t_3","t_4","t_5","t_6","t_7"]},{v:"precision highp float;uniform int u_0;uniform vec2 u_1;uniform vec2 u_2;uniform mat3 u_3;attribute vec2 a_v;attribute vec4 a_p1;attribute vec4 a_p2;varying vec2 c;void main(){if(u_0==0){gl_Position=vec4(a_v,0.0,1.0);}else{vec2 p;if(a_v.x > 0.0){vec2 L=(a_v.y < 0.0)? a_p1.xy : a_p2.xy;gl_Position=vec4((((u_3*vec3(L,1.0)).xy-u_1)*u_2)*vec2(2.0,-2.0),0.0,1.0);}else gl_Position=vec4(0.0,0.0,0.0,1.0);}c=a_v*vec2(0.5,-0.5)+vec2(0.5,0.5);}",f:"precision highp float;uniform float bfrag_0 [ 11 ];uniform vec4 bfrag_1 [ 11 ];uniform int ufrag_0;uniform vec2 ufrag_2;uniform int ufrag_3;uniform int ufrag_4;uniform vec2 ufrag_5;varying vec2 c;const float d=2.2;const float e=1.0/2.2;vec4 f(vec4 h,float i){if(ufrag_3==1)return vec4(pow(h.r,i),pow(h.g,i),pow(h.b,i),h.a);else return h;}vec4 j(float k){for(int l=0;l < 10;l++){if(k <=bfrag_0 [ l+1 ]){vec4 m=f(bfrag_1 [ l ],d);vec4 n=f(bfrag_1 [ l+1 ],d);return f(mix(m,n,(k-bfrag_0 [ l ])/(bfrag_0 [ l+1 ]-bfrag_0 [ l ])),e);}}return bfrag_1 [ 10 ];}float o(vec2 p,vec2 q){vec2 s=p-q;float t=dot(s,s);float u=q.x*p.y-p.x*q.y;vec2 v=s*u;float A=sqrt(t-u*u);vec2 B=s*A;vec2 C=vec2((v.y+sign(B.y)*B.x),(-v.x+abs(B.y)))/t;vec2 D=vec2((v.y-sign(B.y)*B.x),(-v.x-abs(B.y)))/t;vec2 E=sign(length(C-q)-length(D-q))==sign(dot(q-p,q))? C : D;float k=length(p-q)/length(E-q);return clamp(k,0.0,1.0);}float F(float x){return x < 0.5 ? 2.0*x*x : 2.0*x*(2.0-x)-1.0;}float G(float x,float H){return x < H ? F(x/H): F((1.0-x)/(1.0-H));}float I(float x,float H){return x < H ? x/H :(1.0-x)/(1.0-H);}void main(){float k=c.x;if(ufrag_0==1){vec2 q=ufrag_2;k=o(c*2.0-1.0,q*2.0-1.0);}if(ufrag_4 !=0){float J=G(k,ufrag_5.x)*ufrag_5.y;float K=I(k,ufrag_5.x)*ufrag_5.y;gl_FragColor=vec4(j(J).rgb,j(K).a);}else{gl_FragColor=j(k);}}",a:["a_v","a_p1","a_p2"],u:["bfrag_0","bfrag_1","ufrag_0","ufrag_2","ufrag_3","ufrag_4","ufrag_5","u_0","u_1","u_2","u_3"],s:[]},{v:"precision highp float;uniform float u_0;uniform vec2 u_1;uniform vec2 u_2;uniform vec2 u_3;uniform int u_4;attribute vec2 a_v;varying vec2 c,d,e,f,h,i,j,k,l;void main(){vec2 G=a_v;float H=u_0;vec2 I=u_1;vec2 J=u_2;vec2 K=u_3;int p=u_4;gl_Position=vec4(G.x,-G.y,0.0,1.0);vec2 L=(vec2(G.x,-G.y)*I/2.0)+vec2(0.5,0.5);if(p==1){vec2 M=J*vec2(2.0*H/(K.x*8.0),2.0*H/(K.y*8.0));vec2 N=L-J*vec2(H/K.x,H/K.y);c=N;d=N+M;e=N+M*2.0;f=N+M*3.0;h=N+M*4.0;i=N+M*5.0;j=N+M*6.0;k=N+M*7.0;l=N+M*8.0;}else{vec2 r=vec2(H/K.x,H/K.y);c=L+r*vec2(-0.7,-0.7);d=L+r*vec2(0.0,-1.0);e=L+r*vec2(0.7,-0.7);f=L+r*vec2(-1.0,0.0);h=L;i=L+r*vec2(1.0,0.0);j=L+r*vec2(-0.7,0.7);k=L+r*vec2(0.0,1.0);l=L+r*vec2(0.7,0.7);}}",f:"precision highp float;uniform sampler2D tex_0;uniform vec4 ufrag_0;uniform float ufrag_2;uniform int ufrag_3;uniform int ufrag_4;varying vec2 c,d,e,f,h,i,j,k,l;void main(){vec4 m=ufrag_0;int n=ufrag_3;float o=ufrag_2;int p=ufrag_4;vec4 q=p==1 ? vec4(1.20,1.15,1.10,1.05)*o : vec4(1.20,1.20,1.20,1.20)*o;vec4 s=texture2D(tex_0,c,q [ 0 ]);vec4 t=texture2D(tex_0,d,q [ 1 ]);vec4 u=texture2D(tex_0,e,q [ 2 ]);vec4 v=texture2D(tex_0,f,q [ 3 ]);vec4 A=texture2D(tex_0,h,o);vec4 B=texture2D(tex_0,i,q [ 3 ]);vec4 C=texture2D(tex_0,j,q [ 2 ]);vec4 D=texture2D(tex_0,k,q [ 1 ]);vec4 E=texture2D(tex_0,l,q [ 0 ]);if(n==0){vec4 F=s*0.000229+t*0.005977+u*0.060598+v*0.241732+A*0.382928+B*0.241732+C*0.060598+D*0.005977+E*0.000229;gl_FragColor=clamp(F,0.0,1.0);}else if(n==1){float F=s.a*0.000229+t.a*0.005977+u.a*0.060598+v.a*0.241732+A.a*0.382928+B.a*0.241732+C.a*0.060598+D.a*0.005977+E.a*0.000229;gl_FragColor=vec4(m.rgb,1.0)*m.a*F;}else if(n==2){float F=min(min(min(min(s.a,t.a),min(u.a,v.a)),min(min(A.a,B.a),min(C.a,D.a))),E.a);gl_FragColor=vec4(m.rgb,1.0)*m.a*F;}else if(n==3){float F=max(max(max(max(s.a,t.a),max(u.a,v.a)),max(max(A.a,B.a),max(C.a,D.a))),E.a);gl_FragColor=vec4(m.rgb,1.0)*m.a*F;}}",a:["a_v"],u:["ufrag_0","ufrag_2","ufrag_3","ufrag_4","u_0","u_1","u_2","u_3","u_4"],s:["tex_0"]},{v:"precision highp float;attribute vec2 a_v;varying vec2 c;void main(){vec2 v=a_v;gl_Position=vec4(v.x,-v.y,0.0,1.0);c=(vec2(v.x,v.y)/2.0)+vec2(0.5,0.5);}",f:"precision highp float;varying vec2 c;const int d=1,e=2,f=3,h=4,i=5,j=6,k=7,l=8,m=9,n=10,o=11,p=12;uniform int ufrag_0;uniform float ufrag_1;void main(){const float PI=3.141592653;const float q=0.707106781;int s=ufrag_0;float t=ufrag_1;float u=0.0,x=c.x,y=c.y;if(s==d)u=1.0-x*t;else if(s==e)u=max(abs(x*2.0-1.0),abs(y*2.0-1.0));else if(s==f)u=1.0-(x*t+floor(y*t)/2.0);else if(s==h)u=length(c*2.0-vec2(1.0,1.0))*q;else if(s==i)u=(abs(x*2.0-1.0)+abs(y*2.0-1.0))*0.5;else if(s==j)u=fract(sin(dot(c,vec2(12.9898,78.233)))*43758.5453);else if(s==k)u=min(abs(x*2.0-1.0),abs(y*2.0-1.0));else if(s==l)u=fract(sin(x*12.9898)*43758.5453);else if(s==m)u=abs(x*2.0-1.0);else if(s==n)u=1.0-(ceil(x*t)+ceil(y*t))/(2.0*t);else if(s==o)u=1.0-atan(abs(x-0.5),0.5-y)/PI;else if(s==p)u=1.0-atan(x-0.5,0.5-y)*t/(2.0*PI);gl_FragColor=vec4(mod(u,1.0),0.0,0.0,1.0);}",a:["a_v"],u:["ufrag_0","ufrag_1"],s:[]},{v:"precision highp float;attribute vec2 a_v;attribute vec4 a_0;attribute vec4 a_1;varying vec2 c;const int i=0,j=1,k=2,l=3;void main(){vec2 m=a_v;vec4 n=a_0,o=a_1;vec2 p=m*0.5+0.5;c=vec2(n [ i ]+(n [ k ]-n [ i ])*p.x,1.0-(n [ j ]+(n [ l ]-n [ j ])*p.y));gl_Position=vec4((o [ i ]+(o [ k ]-o [ i ])*p.x)*2.0-1.0,1.0-((o [ j ]+(o [ l ]-o [ j ])*p.y)*2.0),0.0,1.0);}",f:"precision highp float;uniform sampler2D t_0;uniform float ufrag_0;varying vec2 c;float d(float e){return clamp(e,0.0,1.0);}void main(){float f=ufrag_0;vec4 h=texture2D(t_0,c);h.rgb=(h.rgb-0.5)*f+0.5;gl_FragColor=h;}",a:["a_v","a_0","a_1"],u:["ufrag_0"],s:["t_0"]},{v:"precision highp float;attribute vec2 a_v;attribute vec4 a_0;attribute vec4 a_1;varying vec2 c;const int nb=0,ob=1,pb=2,qb=3;void main(){vec2 rb=a_v;vec4 sb=a_0,tb=a_1;vec2 ub=rb*0.5+0.5;c=vec2(sb [ nb ]+(sb [ pb ]-sb [ nb ])*ub.x,1.0-(sb [ ob ]+(sb [ qb ]-sb [ ob ])*ub.y));gl_Position=vec4((tb [ nb ]+(tb [ pb ]-tb [ nb ])*ub.x)*2.0-1.0,1.0-((tb [ ob ]+(tb [ qb ]-tb [ ob ])*ub.y)*2.0),0.0,1.0);}",f:"precision highp float;uniform sampler2D t_0;uniform sampler2D t_1;uniform float ufrag_0;uniform int ufrag_1;varying vec2 c;uniform int ufrag_3;uniform float ufrag_4;uniform float ufrag_5;uniform int ufrag_6;uniform float ufrag_7;uniform float ufrag_8;uniform float ufrag_9;uniform int ufrag_10;uniform float ufrag_11;uniform float ufrag_12;uniform vec3 ufrag_13;uniform vec3 ufrag_14;uniform int ufrag_15;uniform float ufrag_16;uniform float ufrag_17;uniform float ufrag_18;uniform vec4 ufrag_19;uniform int ufrag_20;uniform float ufrag_21;uniform vec2 ufrag_22;const int d=0;const int e=1;const int f=2;const int h=3;const int i=4;float j(float k){return clamp(k,0.0,1.0);}vec3 l(vec3 rgb){float m=max(rgb.r,max(rgb.g,rgb.b));float n=min(rgb.r,min(rgb.g,rgb.b));float o=(m+n)*0.5;if(m==n)return vec3(0.0,0.0,o);float p=(m-n)*2.0;float q=m+n;float s=0.5*p/((o <=0.5)? q : 2.0-q);float t=(rgb.r==m)?((rgb.g-rgb.b)/p)/3.0 :(rgb.g==m)?(1.0+(rgb.b-rgb.r)/p)/3.0 :(2.0+(rgb.r-rgb.g)/p)/3.0;return vec3(fract(t),s,o);}float u(float v,float A,float B){return(B*6.0 < 1.0)? v+(A-v)*B*6.0 :(B*2.0 < 1.0)? A :(B*3.0 < 2.0)? v+(A-v)*(4.0-B*6.0): v;}vec3 C(vec3 D){float A=(D.z <=0.5)? D.z+D.z*D.y : D.z+D.y-D.z*D.y;float v=2.0*D.z-A;return vec3(u(v,A,fract(D.x+1.0/3.0)),u(v,A,fract(D.x)),u(v,A,fract(D.x-1.0/3.0)));}const vec3 E=vec3(2.2,2.2,2.2);const vec3 F=vec3(1.0/2.2,1.0/2.2,1.0/2.2);const vec2 G=vec2(.5,.5);vec4 H(vec4 I,vec3 J){return vec4(pow(I.rgb,J),I.a);}vec4 K(vec4 L){const int M=7;const int N=(M-1)/2;float O [ M ];float P=ufrag_21 < 0.0 ?-1.0*ufrag_21*5.0 : 5.0;float Q=1.0/P;float R=Q*Q;float S=0.0;for(int T=0;T < N;T++){float U=float(T);float V=0.39894*Q*exp(-0.5*U*U*R);O [ N+T ]=V;O [ N-T ]=V;S+=2.0*V;}S-=O [ N ];vec4 W=vec4(0.0);for(int T=-N;T <=N;T++){for(int X=-N;X <=N;X++){vec4 Y=texture2D(t_0,c+3.0*vec2(float(T),float(X))/ufrag_22);W+=O [ N+X ]*O [ N+T ]*Y;}}W/=S*S;if(ufrag_21 < 0.0){return W;}else{vec4 Z=L-W;vec4 ab=L+Z*ufrag_21*4.0;return clamp(ab,0.0,1.0);}}vec4 bb(vec4 L){if(ufrag_3+ufrag_6+ufrag_10+ufrag_15+ufrag_20==0){return L;}vec4 cb=vec4(L);if(ufrag_20==1){cb=K(cb);}if(ufrag_15==1){cb.r*=ufrag_16;cb.b*=ufrag_17;cb.g*=ufrag_18;}if(ufrag_6==1){vec3 D=l(cb.rgb);D=vec3(fract(D.x+ufrag_7),D.yz*vec2(ufrag_8,ufrag_9));cb.rgb=clamp(C(D),0.0,1.0);}if(ufrag_3==1){cb.rgb=clamp(cb.rgb*ufrag_4+vec3(ufrag_5),0.0,1.0);}if(ufrag_10==1){const vec3 db=vec3(0.2125,0.7154,0.0721);float eb=clamp(dot(cb.rgb,db)*ufrag_11+ufrag_12,0.0,1.0);cb.rgb=mix(ufrag_13,ufrag_14,eb);}return cb;}void main(){float fb=ufrag_0;int gb=ufrag_1;vec4 hb=ufrag_19;vec4 ib=texture2D(t_0,c);ib.rgb=(ib.rgb-0.5)*fb+0.5;ib.rgb=(gb==f)? vec3(ib.b,ib.g,ib.r): ib.rgb;if(gb==h || gb==i){vec4 jb=texture2D(t_1,c);if(gb==h){vec4 kb=jb;vec3 lb=vec3(ib.r,kb.r,kb.a)*255.0-vec3(16.0,128.0,128.0);vec3 rgb=lb*mat3(1.164383,0.0,1.596027,1.164383,-0.391762,-0.812968,1.164383,2.017232,0.0);ib.rgb=clamp(rgb/255.0,0.0,1.0);}else if(gb==i){ib*=jb.r;}}else if(gb==e){ib=bb(ib);}if(hb.a !=0.0){float mb=hb.a*ib.a;ib=vec4(hb.rgb*mb,mb);}gl_FragColor=ib;}",a:["a_v","a_0","a_1"],u:["ufrag_0","ufrag_1","ufrag_3","ufrag_4","ufrag_5","ufrag_6","ufrag_7","ufrag_8","ufrag_9","ufrag_10","ufrag_11","ufrag_12","ufrag_13","ufrag_14","ufrag_15","ufrag_16","ufrag_17","ufrag_18","ufrag_19","ufrag_20","ufrag_21","ufrag_22"],s:["t_0","t_1"]},{v:"precision highp float;uniform mat3 u_0;uniform mat3 u_1;uniform mat3 u_2;uniform mat3 u_3;uniform vec2 u_4;attribute vec2 a_v;varying vec2 c;varying vec2 d;vec2 Kb(vec2 Lb,mat3 Mb){return(Mb*vec3(vec2(Lb.x/2.0,Lb.y/2.0),1.0)).xy*vec2(1.0,-1.0)+vec2(0.5,0.5);}void main(){vec2 Nb=a_v;mat3 Ob=u_0;mat3 Pb=u_1;mat3 Qb=u_2;mat3 Rb=u_3;vec2 Sb=u_4;c=Kb(Nb.xy,Qb);d=Kb(Nb.xy,Rb);vec2 Tb=(Ob*vec3(Nb.xy/2.0,1.0)).xy;vec2 Ub=(Pb*vec3(Tb,1.0)).xy;gl_Position=vec4((Ub/Sb-vec2(0.5,0.5))*vec2(2.0,-2.0),0.0,1.0);}",f:"precision highp float;uniform sampler2D t_0;uniform sampler2D t_1;uniform sampler2D t_2;varying vec2 c;varying vec2 d;uniform int ufrag_0;uniform vec2 ufrag_1;uniform float ufrag_2;uniform float ufrag_3;uniform vec2 ufrag_4;uniform vec4 ufrag_5;uniform vec4 ufrag_6 [ 4 ];uniform vec3 ufrag_7 [ 4 ];uniform vec4 ufrag_8 [ 4 ];uniform vec4 ufrag_9;uniform vec4 ufrag_10;uniform vec4 ufrag_11;uniform vec4 ufrag_12;uniform vec4 ufrag_13;uniform int ufrag_14;uniform float ufrag_15;uniform vec4 ufrag_16;uniform float ufrag_17;const int e=0;const int f=1;const int h=2;float i(vec2 j,float k,float l){vec2 m=ufrag_1;float n=ufrag_2;float o=ufrag_3;vec2 p=ufrag_4;float q=texture2D(t_1,j+m*vec2(k,l)).r;float s=clamp((q*n+o)/p.x,0.0,1.0);return texture2D(t_2,vec2(s,1.0)).r*p.y;}vec3 t(vec2 j){float u=i(j,-1.0,-1.0);float v=i(j,0.0,-1.0);float A=i(j,1.0,-1.0);float B=i(j,-1.0,0.0);float C=i(j,0.0,0.0);float D=i(j,1.0,0.0);float E=i(j,-1.0,1.0);float F=i(j,0.0,1.0);float G=i(j,1.0,1.0);vec3 H=normalize(vec3(1.0,0.0,v-u));vec3 I=normalize(vec3(1.0,0.0,A-v));vec3 J=normalize(vec3(1.0,0.0,C-B));vec3 K=normalize(vec3(1.0,0.0,D-C));vec3 L=normalize(vec3(1.0,0.0,F-E));vec3 M=normalize(vec3(1.0,0.0,G-F));vec3 N=normalize(vec3(0.0,1.0,B-u));vec3 O=normalize(vec3(0.0,1.0,C-v));vec3 P=normalize(vec3(0.0,1.0,D-A));vec3 Q=normalize(vec3(0.0,1.0,E-B));vec3 R=normalize(vec3(0.0,1.0,F-C));vec3 S=normalize(vec3(0.0,1.0,G-D));return normalize(cross(H,N)+cross(H,O)+cross(I,O)+cross(I,P)+cross(J,N)+cross(J,O)+cross(K,O)+cross(K,P)+cross(J,Q)+cross(J,R)+cross(K,R)+cross(K,S)+cross(L,Q)+cross(L,R)+cross(M,R)+cross(M,S));}vec4 T(vec4 U,vec4 V){float W=V.a+U.a*(1.0-V.a);return vec4((V.rgb*V.a+U.rgb*U.a*(1.0-V.a))/W,W);}void main(){int X=ufrag_0;vec4 Y=texture2D(t_0,c);if(X !=0){vec4 Z=vec4(Y.rgb/Y.a,Y.a);int ab=ufrag_14;if(ab==f){Z=vec4(0.0,0.0,0.0,0.0);}else{vec3 bb=t(d);vec4 cb=ufrag_5;vec4 db=ufrag_9;vec4 eb=ufrag_10;vec4 fb=ufrag_11;vec4 gb=ufrag_12;vec4 hb=ufrag_13;vec3 ib=gb.rgb+cb.rgb*fb.rgb;vec3 jb=vec3(0.0,0.0,-1.0);float kb=hb.x;bool lb=hb.y !=0.0;;vec3 mb=vec3(0.0,0.0,0.0);vec3 nb=vec3(0.0,0.0,0.0);for(int ob=0;ob < 4;ob++){vec3 pb=ufrag_6 [ ob ].rgb;vec3 qb=ufrag_7 [ ob ];float rb=ufrag_8 [ ob ].x;float sb=ufrag_8 [ ob ].y;float tb=ufrag_8 [ ob ].z;float ub=ufrag_8 [ ob ].w;float vb=-dot(bb,qb);vb=vb*rb+sb;mb+=clamp(vb,0.0,1.0)*tb*pb;float wb=0.0;if(lb){vec3 xb=-normalize(jb+qb);wb=dot(xb,bb);}else{vec3 yb=jb-2.0*bb*dot(bb,jb);wb=-dot(yb,qb);}wb=pow(max(0.0,wb),kb);nb+=clamp(wb,0.0,1.0)*ub*pb;}mb*=db.rgb;nb*=eb.rgb;float zb=Z.a*db.a;float Ab=hb.z;float Bb=hb.w;float Cb=1.0-abs(dot(jb,bb));if(Bb > 0.0){zb+=(1.0-zb)*pow(Cb,Bb);}else if(Bb < 0.0){zb-=zb*pow(Cb,-Bb);}if(Ab > 0.0){mb+=(vec3(1.0,1.0,1.0)-mb)*pow(Cb,Ab);}else if(Ab < 0.0){mb-=mb*pow(Cb,-Ab);}if(ab==h){const float Db=0.5;mb+=nb*Db;nb*=(1.0-Db);}Z.rgb=clamp(Z.rgb*(ib+mb)+nb,0.0,1.0);Z.a=clamp(zb,0.0,1.0);}float Eb=ufrag_15;if(Eb > 0.0){float n=ufrag_2;float o=ufrag_3;vec4 Fb=ufrag_16;float Gb=ufrag_17;float Hb=max(Eb,Gb)*0.5;float Ib=abs(texture2D(t_1,d).r*n+o);float Jb=clamp(Hb-Ib,0.0,1.0);Z=T(Z,Fb*vec4(1.0,1.0,1.0,Jb));}Y=vec4(Z.rgb*Z.a,Z.a);}gl_FragColor=Y;}",a:["a_v"],u:["ufrag_0","ufrag_1","ufrag_2","ufrag_3","ufrag_4","ufrag_5","ufrag_6","ufrag_7","ufrag_8","ufrag_9","ufrag_10","ufrag_11","ufrag_12","ufrag_13","ufrag_14","ufrag_15","ufrag_16","ufrag_17","u_0","u_1","u_2","u_3","u_4"],s:["t_0","t_1","t_2"]}],Mi={x:0,y:0,width:1,height:1},Ri=[{attributeName:"",index:0,attributeSize:2,offset:0,divisor:0}],Ai=function(){function e(e,t,r,i){this.m_shaderPrograms=new Array(8),this.m_isInitializeReady=!0,this.m_isInScope=!1,this.m_stateRestorer=i,this.m_wipeStateBetweenScopes=t,this.m_disableParallelShaderCompile=r,this.setWebGLContextOrBabylonEngine(e)}return e.prototype.getBabylonEngine=function(){return this.m_engine},Object.defineProperty(e.prototype,"quadMesh",{get:function(){return this.m_quadMesh},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"emptyTexture",{get:function(){return this.m_emptyTexture},enumerable:!1,configurable:!0}),e.prototype.needPowerOf2TexturesForTilingOrMipMap=function(){return this.m_needPowerOf2TexturesForTilingOrMipMap},e.prototype.isCurrentWebGLContext=function(e){return this.m_gl==e},e.prototype.setWebGLContextOrBabylonEngine=function(e){var t=e instanceof WebGLRenderingContext||e instanceof WebGL2RenderingContext?e:e._gl;if(this.m_gl!=t){this.m_engine&&(this.m_emptyTexture&&this.m_engine._releaseTexture(this.m_emptyTexture),this.m_quadMesh&&this.m_quadMesh.discard()),this.m_gl=t;var r=t.canvas.width,i=t.canvas.height;this.m_canvasRenderSize=new g(r,i),e instanceof Si?this.m_engine=e:(this.m_engine=new Si(t),this.m_engine.preventCacheWipeBetweenFrames=!0,this.m_engine.doNotHandleContextLost=!0,this.m_engine.setSize(r,i),this.m_engine.setViewport(Mi));var n=this.m_engine.getCaps();this.m_parallelShaderCompilationExtension=n.parallelShaderCompile,n.parallelShaderCompile=void 0,this.m_renderToFilteredFloat=n.textureFloatRender&&n.textureFloatLinearFiltering,this.m_renderToFilteredHalfFloat=n.textureHalfFloatRender&&n.textureHalfFloatLinearFiltering,this.m_needPowerOf2TexturesForTilingOrMipMap=this.m_engine.needPOTTextures,this.m_uniqueGraphicsProcessorId=Pi,Pi++;for(var o=0;o<8;o++)this.m_shaderPrograms[o]=void 0}},e.prototype.updateViewportSize=function(){var e=this.m_gl.canvas.width,t=this.m_gl.canvas.height;this.m_canvasRenderSize=new g(e,t),this.m_engine.setSize(e,t),this.m_engine.setViewport(Mi)},e.prototype.onWebGLContextLost=function(){for(var e=0;e<8;e++)this.m_shaderPrograms[e]=void 0},e.prototype.initializeProgramsAsync=function(){return(0,p.mG)(this,void 0,void 0,(function(){var e,t,r,i;return(0,p.Jh)(this,(function(n){switch(n.label){case 0:if(this.m_isInitializeReady=!1,e=this.m_engine.getCaps(),this.m_disableParallelShaderCompile||(e.parallelShaderCompile=this.m_parallelShaderCompilationExtension),t=[],!this.beginRenderScopeInternal(!1))throw M.Error(592328457,"Failed to enter render scope.");for(r=0;r<8;r++)i=this.getProgramInWebGlScope(r),t.push(i.enureDoneAsync());return this.endRenderScopeInternal(!1),[4,Promise.all(t)];case 1:return n.sent(),this.m_isInitializeReady=!0,[2]}}))}))},e.prototype.isInRenderScope=function(){return this.m_isInScope},e.prototype.beginRenderScope=function(){if(!this.m_isInitializeReady)throw M.Error(592525269,"Please, wait for onDone to be called in initialize.");return this.beginRenderScopeInternal(!0)},e.prototype.endRenderScope=function(){this.endRenderScopeInternal(!0)},e.prototype.beginRenderScopeInternal=function(e){var t=this.m_gl.isContextLost();return this.m_isInScope&&M.Error(592525270,"already in glContext scope"),t&&M.Error(592525271,"Invalnew glContext context is lostid"),!this.m_gl||t?this.m_isInScope=!1:(this.m_isInScope=!0,e&&(this.m_stateRestorer?(this.m_stateRestorer.init(this.m_gl),this.m_stateRestorer.setDefaults(),this.m_engine.wipeCaches(!0),this.m_engine.depthCullingState.cull=!1):this.m_wipeStateBetweenScopes&&(this.m_engine.wipeCaches(!0),this.m_engine.depthCullingState.cull=!1)),this.ensureVertexBufferAndMaxTapeInitialized()),this.m_isInScope},e.prototype.endRenderScopeInternal=function(e){this.m_isInScope?this.m_gl.isContextLost()?M.Error(592525273,"leaving glContext context is lost"):this.m_stateRestorer&&e&&this.m_stateRestorer.restore():M.Error(592525272,"leaving glContext not in scope"),this.m_isInScope=!1},e.prototype.ensureVertexBufferAndMaxTapeInitialized=function(){this.m_emptyTexture||(this.m_emptyTexture=this.createTextureGraphicsResource(g.One,new Uint8Array([0,0,0,0]),5,!1,!1,!1,4,!1,!1)),this.m_quadMesh||(this.m_quadMesh=Yt.CreateGridXY(this,2,2,new _(-1,-1,1,1)))},e.prototype.getProgramInWebGlScope=function(e){var t=this.m_shaderPrograms[e];return t||(t=this.m_shaderPrograms[e]=new Ii(this,e)),t},e.prototype.createTextureGraphicsResourceFromExternalWebGLTexture=function(e,t,r,i){var n=r instanceof WebGLTexture?r:null;if(r instanceof Rt&&(n=r._webGLTexture),!n)throw M.Error(592525275,"wrong texture type");var o=new Rt(this.m_engine,0);return o._webGLTexture=n,i&&(o._framebuffer=i),o.width=e.x,o.height=e.y,o.baseWidth=e.x,o.baseHeight=e.y,o.type=0,o.format=t,o},e.prototype.updateTextureGraphicsResourceFromHTMLElement=function(e,t,r){if(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement){var i=this.m_gl,n=e._webGLTexture;n&&(i.bindTexture(i.TEXTURE_2D,n),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,r),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t),i.bindTexture(i.TEXTURE_2D,null))}},e.prototype.updateTextureGraphicsResourceFromByteBuffer=function(e,t,r){var i=this.m_engine;if(t instanceof Uint8Array||t instanceof Float32Array){var n=t,o=this.getTypeFromData(t,r);if(!(t instanceof Uint8Array&&0==o||t instanceof Float32Array&&1==o)){M.Error(572867294,"Wrong buffer data type: needs conversion");for(var s=0==o?new Uint8Array(t.length):new Float32Array(t.length),a=0==o?255:1/255,l=0;l<t.length;l++)s[l]=t[l]*a;n=s}i._bindTextureDirectly(3553,e,!0,!0),i._uploadDataToTextureDirectly(e,n,0,0,void 0,!0),i._bindTextureDirectly(3553,null,!0,!0)}},e.prototype.createTextureGraphicsResource=function(e,t,r,i,n,o,s,a,l){if(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement){var h,c=this.m_gl;if(h=c.createTexture()){c.bindTexture(c.TEXTURE_2D,h),c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,l),c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,t),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.bindTexture(c.TEXTURE_2D,null);var u=this.createTextureGraphicsResourceFromExternalWebGLTexture(e,r,h,void 0);return u&&this.setWrapMode(u,s),u}}var d,p=this.m_engine,f=this.getTypeFromData(t,i),g=a?2:1;if(n)d=p.createRenderTargetTexture({width:e.x,height:e.y},{generateDepthBuffer:!1,generateStencilBuffer:o,format:r,type:f,samplingMode:g,generateMipMaps:!1});else{var m=new Rt(p,lt.Unknown);m.updateSize(e.x,e.y),m.type=f,m.format=r,m.invertY=l,p.updateTextureSamplingMode(g,m),(t instanceof Uint8Array||t instanceof Float32Array)&&this.updateTextureGraphicsResourceFromByteBuffer(m,t,i),d=m}return this.setWrapMode(d,s),d},e.prototype.getTypeFromData=function(e,t){var r=0;return t&&(e instanceof Float32Array&&this.m_renderToFilteredFloat?r=1:e||(this.m_renderToFilteredHalfFloat?r=2:this.m_renderToFilteredFloat&&(r=1))),r},e.prototype.setRenderTarget=function(e){e?(this.m_engine.bindFramebuffer(e),this.m_currentRenderTarget=e):(this.m_engine.restoreDefaultFramebuffer(),this.m_currentRenderTarget=void 0)},e.prototype.generateMipMap=function(e){this.m_engine.updateTextureSamplingMode(3,e,!0)},e.prototype.setWrapMode=function(e,t){var r=4==t?0:1==t||3==t?2:1,i=4==t?0:2==t||3==t?2:1;this.m_engine.updateTextureWrappingMode(e,r,i)},e.prototype.copyTexturePixelsToArray=function(e,t,r){var i=Math.floor(t.left),n=Math.floor(t.top),o=Math.floor(t.width),s=Math.floor(t.height);this.setRenderTarget(e);var a=this.m_engine.readPixels(i,n,o,s,r);return this.setRenderTarget(void 0),a},e.prototype.getCurrentViewportSize=function(){return this.m_currentRenderTarget?new g(this.m_currentRenderTarget.width,this.m_currentRenderTarget.height):this.m_canvasRenderSize},e.prototype.setScissorRect=function(e,t){if(t||!E(e,this.m_currentScissorRect)){var r=this.m_gl,i=this.getCurrentViewportSize();e?(r.enable(r.SCISSOR_TEST),r.scissor(e.left,i.y-e.bottom,e.width,e.height)):(r.disable(r.SCISSOR_TEST),r.scissor(0,0,i.x,i.y))}this.m_currentScissorRect=e},e.prototype.getUniqueGraphicsProcessorId=function(){return this.m_uniqueGraphicsProcessorId},e.prototype.isFloatTextureSupported=function(){return this.m_renderToFilteredFloat||this.m_renderToFilteredHalfFloat},e.prototype.activateShaderProgram=function(e){var t=this.getProgramInWebGlScope(e);return t.activate(),t},e.prototype.preCompileShaderAsync=function(e){this.beginRenderScopeInternal(!1)&&(this.getProgramInWebGlScope(e),this.endRenderScopeInternal(!1))},e.prototype.preLinkShaderAsync=function(e){this.preCompileShaderAsync(e)},e.prototype.tryPrepareProgramResourcesInWebGlScope=function(e){for(var t=0;t<2;t++)this.m_shaderPrograms[t]||this.getProgramInWebGlScope(t);return!0},e}(),Ii=function(){function e(e,t){this.graphicsProcessor=e,this.m_engine=e.getBabylonEngine(),this.programId=t,this.m_effect=this.createEffect()}return e.prototype.getBabylonEngine=function(){return this.m_engine},e.prototype.getBabylonEffect=function(){return this.m_effect},e.prototype.done=function(){return void 0!==this.effectErrors||this.m_effect.isReady()},e.prototype.enureDoneAsync=function(){var e=this;return new Promise((function(t,r){e.done()?t(void 0):(e.m_effect.onCompileObservable.add((function(){return t(void 0)})),e.m_effect.onErrorObservable.add(r))}))},e.prototype.createEffect=function(){var e=this;return M.Message(592525280,"Compiling shader "+this.programId),new fi({vertexSource:Ei[this.programId].v,fragmentSource:Ei[this.programId].f,spectorName:this.programId},Ei[this.programId].a,Ei[this.programId].u,Ei[this.programId].s,this.m_engine,void 0,void 0,void 0,(function(t,r){e.effectErrors=r}))},e.prototype.activate=function(){this.handleActivationErrors(),this.m_engine.enableEffect(this.m_effect),this.m_currentMesh=void 0,this.bindMesh(void 0)},e.prototype.bindMesh=function(e){var t=e||this.graphicsProcessor.quadMesh;t&&t.isValid(this.graphicsProcessor)?this.m_currentMesh!=t&&(t.vertexBuffer&&t.indexBuffer&&t.isValid(this.graphicsProcessor)&&(this.m_engine._bindIndexBufferWithCache(t.indexBuffer),Ri[0].index=this.m_effect.getAttributeLocationByName("a_v"),this.m_engine.bindInstancesBuffer(t.vertexBuffer,Ri,!1)),this.m_currentMesh=t):M.Error(592525281,"Invalid Mesh")},e.prototype.handleActivationErrors=function(){if(this.effectErrors||!this.m_effect.isReady()){var e="Program "+this.programId+" ";if(this.effectErrors){var t=this.m_effect.getPipelineContext();if(t.vertexCompilationError)throw M.Error(592525282,e+"V compile failed: "+t.vertexCompilationError);if(t.fragmentCompilationError)throw M.Error(592525283,e+"V compile failed: "+t.fragmentCompilationError);if(t.programLinkError)throw M.Error(592525312,e+"link failed: "+t.programLinkError);if(t.programValidationError)throw M.Error(592525313,e+"validation failed: "+t.programValidationError);throw M.Error(592525314,e+"preparation failed:"+this.effectErrors)}if(!this.m_effect.isReady())throw M.Error(592525315,e+"Effect not ready yet.")}},e.prototype.setTexture=function(e,t){var r=t||this.graphicsProcessor.emptyTexture;this.m_effect._bindTexture(e,r||null)},e.prototype.clearAndEnbaleDepthBuffer=function(){this.m_engine.depthCullingState.depthFunc=513,this.m_engine.depthCullingState.depthMask=!0,this.m_engine.depthCullingState.depthTest=!0,this.m_engine.clear(null,!1,!0,!1)},e.prototype.setDistanceFieldStencilSumIncrement=function(e){var t=e?34055:34056,r=this.m_engine;r.stencilState.stencilOpStencilFail=t,r.stencilState.stencilOpDepthFail=t,r.stencilState.stencilOpStencilDepthPass=t},e.prototype.setBlendingMode=function(e){var t=this.m_engine;t.alphaState.alphaBlend=!0,0==e?(t.alphaState.setAlphaBlendFunctionParameters(1,771,1,771),t.alphaState.setAlphaEquationParameters(32774,32774)):1==e?(t.alphaState.setAlphaBlendFunctionParameters(1,1,0,1),t.alphaState.setAlphaEquationParameters(32775,32774)):2==e?(t.alphaState.setAlphaBlendFunctionParameters(775,769,0,1),t.alphaState.setAlphaEquationParameters(32774,32774)):3==e?(t.alphaState.setAlphaBlendFunctionParameters(1,1,1,1),t.alphaState.setAlphaEquationParameters(32779,32779)):4==e?(t.alphaState.setAlphaBlendFunctionParameters(1,1,1,1),t.alphaState.setAlphaEquationParameters(32774,32774)):5==e?(t.alphaState.setAlphaBlendFunctionParameters(774,0,0,1),t.alphaState.setAlphaEquationParameters(32774,32774)):M.Error(592525318,"Wrong blending mode")},e.prototype.begin=function(e,t,r){var i=this.m_engine;this.graphicsProcessor.setRenderTarget(e),this.m_engine.setViewport(Mi),t&&i.clear(t,!0,!1,!1),r?this.setBlendingMode(0):i.alphaState.alphaBlend=!1,i.depthCullingState.depthTest=!1,i.depthCullingState.depthMask=!0,i.stencilState.stencilTest=!1,i.stencilState.stencilMask=255,i.setColorWrite(!0)},e.prototype.end=function(){this.graphicsProcessor.setRenderTarget(void 0),this.m_engine.unbindInstanceAttributes(),this.m_engine.setViewport(Mi)},e.prototype.drawQuads=function(e){this.bindMesh(void 0),this.m_engine.drawElementsType(0,0,6*e)},e.prototype.drawQuadInstances=function(e){this.bindMesh(void 0),this.m_engine.drawElementsType(0,0,6,e)},e.prototype.drawMesh=function(e){this.bindMesh(e),this.m_engine.drawElementsType(0,0,3*e.triangleCount)},e.prototype.setDummyPointerAttribute=function(e){if(this.graphicsProcessor.quadMesh&&this.graphicsProcessor.quadMesh.vertexBuffer){var t=this.graphicsProcessor.quadMesh.vertexBuffer,r=this.m_engine,i=[{attributeName:e,attributeSize:1,offset:0,divisor:0,index:this.m_effect.getAttributeLocationByName(e)}];r.bindInstancesBuffer(t,i,!1)}else M.Error(592525319,"Quad not initialized")},e.prototype.disableInstanceAttribute=function(e){this.m_engine.disableInstanceAttributeByName(e)},e}(),Fi={itemHit:void 0,itemStack:void 0,textHit:void 0},Bi=function(){function e(e){this.cache=new Wr,this.isGroup=e}return e.prototype.releaseGeneratedResources=function(){this.cache.releaseGeneratedResources()},e.prototype.onFinalization=function(){},e}(),Li=function(){function e(){this.index=0}return Object.defineProperty(e.prototype,"color",{get:function(){var e=this.index%256,t=(this.index-e)/256%256,r=(this.index-e-256*t)/65536%256;return new ne(e/255,t/255,r/255,1)},enumerable:!1,configurable:!0}),e.prototype.next=function(){this.index++},e}(),Di=function(e,t,r,i){var n,o;this.scene3D=null!==(n=null==e?void 0:e.scene3D)&&void 0!==n?n:t.scene3D;var s=null!==(o=null==e?void 0:e.fade)&&void 0!==o?o:t.fade;if(s){if(this.fade=s.clone(),s.isDistributedByLength&&(null==e?void 0:e.drawDistribution)&&i+1<e.drawDistribution.length){var a=e.drawDistribution[i],l=e.drawDistribution[i+1];this.fade.progress=(s.progress-a)/(l-a)}else s.isDistributedByLength&&e&&M.Error(592525086,"Unable to distribute by length"),this.fade.progress=s.progress;if(2==t.getType()&&s.isDistributedByLength){if(!r.cache.drawDistribution){var h=0,c=function(e){for(var t=0,r=e.paths||[];t<r.length;t++){var i=r[t];h+=i.measureLength(v.FromTransforms(i.transform,e.transform))}return!0};Pe(t,c);var u=h,d=0,p=t;r.cache.drawDistribution=[];for(var f=0;f<p.items.length;f++)r.cache.drawDistribution.push(d/u),h=0,Pe(p.items.getAt(f),c),d+=h;r.cache.drawDistribution.push(1)}this.drawDistribution=r.cache.drawDistribution}}},ki=1,Oi=function(){function e(e){this.m_babylonWipeStateBetweenScopes=!0,this.m_babylonDisableParallelShaderCompile=!1,this.m_currentFramePerformanceSummary=new Tt,this.m_textureManager=new kt,this.m_glyphCachePreviouslyFailed=!1,this.m_verboseRenderLogging=!1,this.fixedMemoryLeakAmounts=new xt,this.m_babylonWipeStateBetweenScopes=!!e.stateRestorer,this.m_babylonDisableParallelShaderCompile=1==e.babylonDisableParallelShaderCompile,this.m_stateRestorer=e.stateRestorer,this.m_morphPlayer=e.morphPlayer,this.m_debugStringProvider=e.debugStringProvider,this.m_perfSummary=new wt,this.m_rendererId=""+ki++}return e.prototype.getTextureManager=function(){return this.m_textureManager},e.prototype.hasMorphPlayer=function(){return!!this.m_morphPlayer},e.prototype.setMorphPlayer=function(e){this.m_morphPlayer=e},e.prototype.hasDebugStringProvider=function(){return!!this.m_debugStringProvider},e.prototype.setDebugStringProvider=function(e){this.m_debugStringProvider=e},e.prototype.initializeAsync=function(e){return(0,p.mG)(this,void 0,void 0,(function(){return(0,p.Jh)(this,(function(t){switch(t.label){case 0:if(this.setWebGLContextOrBabylonEngine(e),!this.m_graphicsProcessor)throw M.Error(592328459,"Failed to initialize graphics processor.");return[4,this.m_graphicsProcessor.initializeProgramsAsync()];case 1:return t.sent(),[2]}}))}))},e.prototype.setBabylonEngine=function(e){this.setWebGLContextOrBabylonEngine(e)},e.prototype.setWebGLContext=function(e){this.setWebGLContextOrBabylonEngine(e)},e.prototype.setWebGLContextOrBabylonEngine=function(e){var t=e instanceof WebGLRenderingContext||e instanceof WebGL2RenderingContext?e:e._gl;this.m_graphicsProcessor&&!this.m_graphicsProcessor.isCurrentWebGLContext(t)&&this.onWebGLContextLost(),this.m_graphicsProcessor?this.m_graphicsProcessor.setWebGLContextOrBabylonEngine(e):this.m_graphicsProcessor=new Ai(e,this.m_babylonWipeStateBetweenScopes,this.m_babylonDisableParallelShaderCompile,this.m_stateRestorer)},e.prototype.onWebGLContextLost=function(){if(this.m_scratchBuffers){for(var e=0,t=this.m_scratchBuffers;e<t.length;e++)t[e].release();this.m_scratchBuffers=void 0}Tr(),this.m_graphicsProcessor&&(this.m_graphicsProcessor.onWebGLContextLost(),this.m_graphicsProcessor=void 0)},e.prototype.verifyGlyphCacheIntegrityAndTryRecover=function(){return!function(){for(var e=0,t=0,r=0,i=0,n=0,o=0,s=0;s<br.length;s++){for(var a=0,l=0,h=yr&&s<yr.length?yr[s].texture:void 0,c=h?h.tryConvertToBufferRGBA():void 0,u=0;u<br[s].length;u++){var d=br[s][u];if(d.ready){if(!h||!c)return M.Error(555782370,"Glyph ready but texture missing"),!0;for(var p=0,f=Math.ceil(d.bounds.top);f<d.bounds.bottom;f++)for(var g=h.size.y-1-f,m=Math.ceil(d.bounds.left);m<d.bounds.right;m++)p+=c[4*(m+g*h.size.x)];if(void 0===d.checksum){if(0==p&&d.path.figures.length>0){var v=j(d.path.figures);v&&v.isValid()&&!v.isEmpty()&&e++}}else a+=p,l+=d.checksum,p>d.checksum&&t++,p<d.checksum&&(0==p?r++:(M.Error(555782402,"Glyph was ready but got partially erased (-"+100*(d.checksum-p)/d.checksum+"%)"),i++));d.checksum=p,o++}}0==a&&l>0&&n++}return e>0&&M.Error(555782371,"Glyph(s) with figures look empty: glyphCount="+e+", totalGlyphCount="+o),t>0&&M.Error(555782400,"Glyph(s) ready but additional pixels rendered on top: glyphCount="+t+", totalGlyphCount="+o),(r>0||i>0)&&M.Error(555782401,"Glyph(s) ready but erased from cache: glyphCountErased="+r+", glyphCountPartiallyErased="+i+", totalGlyphCount="+o+", pageCountErased="+n+", totalPageCount="+br.length),e>0||r>0||i>0}()||(this.m_glyphCachePreviouslyFailed?(M.Error(555782369,"GlyphCache failed for the second time: disable glyph cache"),Nt(!1)):this.m_glyphCachePreviouslyFailed=!0,Tr(),!1)},e.prototype.getGraphicsProcessor=function(){return this.m_graphicsProcessor},e.prototype.getBabylonEngine=function(){return this.m_graphicsProcessor?this.m_graphicsProcessor.getBabylonEngine():void 0},e.prototype.getPerformanceSummary=function(){var e=function(e){if(e){var t=e;for(var r in t)r.endsWith("Ms")&&(t[r]=ji(t[r]))}};return this.m_perfSummary.averageFrameCost&&(this.m_perfSummary.averageFrameCost=ji(this.m_perfSummary.averageFrameCost)),e(this.m_perfSummary.perfInfoCurrentFrame),e(this.m_perfSummary.perfInfoFirstFrame),e(this.m_perfSummary.perfInfoSumOfAllFrames),this.m_perfSummary},e.prototype.resetPerformanceSummary=function(){this.m_perfSummary=new wt},e.prototype.getCurrentFramePerformanceSummary=function(){return this.m_currentFramePerformanceSummary},e.prototype.getDebugStringProvider=function(){return this.m_debugStringProvider},e.prototype.ensureScratchBuffers=function(){if(!this.m_scratchBuffers){this.m_scratchBuffers=[];for(var e=0;e<2;e++)this.m_scratchBuffers.push(new zt("ScratchBuffer",this,new g(Dt,Dt),0))}return this.m_scratchBuffers},e.prototype.ensureRenderNode=function(e){var t=e.renderDataMap[this.m_rendererId];return t||(t=new Bi(2==e.getType()),e.renderDataMap[this.m_rendererId]=t),t},e.prototype.ensurePathRenderData=function(e){var t=e.renderDataMap[this.m_rendererId];return t||(t=new Lr,e.renderDataMap[this.m_rendererId]=t),t},e.prototype.ensureImageRenderData=function(e){var t=e.renderDataMap[this.m_rendererId];return t||(t=new kr,e.renderDataMap[this.m_rendererId]=t),t},e.prototype.ensureMorphKeyFrameRenderData=function(e){var t=e.renderDataMap[this.m_rendererId];return t||(t=new Hr,e.renderDataMap[this.m_rendererId]=t),t},e.prototype.ensureMorphElementRenderData=function(e){var t=e.renderDataMap[this.m_rendererId];return t||(t=new jr,e.renderDataMap[this.m_rendererId]=t),t},e.prototype.attachTextureToImage=function(e,t){var r=this.ensureImageRenderData(e);e.changeTracker.replaceListener(r.texture,t),r.texture=t},e.prototype.attachLoaderToImage=function(e,t){var r=this.ensureImageRenderData(e);e.changeTracker.replaceListener(r.texture,t),r.loader=t},e.prototype.getTextureFromImage=function(e){if(e){var t=this.ensureImageRenderData(e);return t.loader?(M.Error(520663959,"getTextureFromImage may return the wrong wrap mode for ImageTextureLoader"),t.loader.getTexture(4)):t.texture}},e.prototype.getTextureFromImageBrush=function(e){var t;if(e.image){var r=this.ensureImageRenderData(e.image);return r.loader?r.loader.getTexture(null!==(t=e.wrapMode)&&void 0!==t?t:4):r.texture}},e.prototype.deleteAllTextures=function(e){e.releaseGeneratedResources()},e.prototype.tryGetImageDebugData=function(e){var t=this.ensureImageRenderData(e);return new Dr(t.state,t.texture)},e.prototype.getDebugGlyphCacheInfo=function(e){return function(e){var t=vr(e);if(t){var r=_r[t];if(r)return r.page}}(e)},e.prototype.generateTextureMemoryReport=function(e,t){for(var r={externalImages:0,managedImages:0,scratchBuffers:this.hasHitTestTexture()?4:0,glyphPages:0,shapeDistanceFields:0,textDistanceFields:0,otherBrushes:0,effects:0,rasterizedItems:0,fadeMasks:0,morphTextures:0,totalTarget:0,totalTargetExpected:this.getTextureManager().textureMemoryAllocated},i=0,n=this.m_scratchBuffers||[];i<n.length;i++){var o=n[i];r.scratchBuffers+=o.memoryUsage}for(var s=0,a=yr||[];s<a.length;s++){var l=a[s];r.glyphPages+=l.texture?l.texture.memoryUsage:0}for(var h=0,c=e;h<c.length;h++)zi(this,c[h],r);for(var u=0,d=t||[];u<d.length;u++)Wi(this,d[u],r);return r.totalTarget=r.scratchBuffers+r.glyphPages+r.shapeDistanceFields+r.textDistanceFields+r.otherBrushes+r.effects+r.rasterizedItems+r.fadeMasks+r.morphTextures,r},e.prototype.initOutOfTime=function(){return this.m_initDeadline&&this.m_initDeadline<performance.now()},e.prototype.updateSettingsBeforeRender=function(){var e=At.readNumberOrDefault("debugMode",-1);-1!=e&&(L=e);var t=At.readBooleanOrDefault("debugTextLines",!1);t&&(D=t);var r=At.readNumberOrDefault("quality",0);0!=r&&Ot(r),At.readBooleanOrDefault("disableGlyphTable",!1)&&Nt(!1);var i=At.readNumberOrDefault("hitTestSlop",0);0!=i&&function(e){I=e}(i);var n=At.readNumberOrDefault("minLineWidth",0),o=At.readNumberOrDefault("minLineWidthForArrowHead",0);0==n&&0==o||B(n||R,o||A);var s=At.readNumberOrDefault("hitTestCache",0);0!=s&&function(e){F=e}(s)},e.prototype.fillRenderRectMap=function(e,t,r,i,n,o,s,a,l){for(var h=t.changeTracker.currentUniqueId+","+t.animationChangeTracker.currentUniqueId+","+o.index+(s?"+"+s:"")+(l?"*":""),c=t.instanceOffsets?t.instanceOffsets.length:1,u=0;u<c;u++){var d=t.instanceOffsets?v.Translation2D(t.instanceOffsets[u]).multiply(i):i,p=t.instanceOffsets?h+","+u:h;if(t instanceof Ce||t.effects.hasEffects){var f=t.getBounds(!a,!0,!0,d);if(t instanceof Ce&&t.style.pictureOverflow&&t.style.pictureBrush){var g=t.fillBoundsOverride?t.fillBoundsOverride:Me(t,!1),m=this.getTextureFromImageBrush(t.style.pictureBrush);if(g&&m){var y=t.animationTransform?v.FromTransforms(t.transform,d,t.animationTransform):v.FromTransforms(t.transform,d),b=lr(g,t.style.pictureBrush,m,y);b&&(f=_.UnionRect(f,b))}}a&&(f=f?f.transformedBounds(a):f),f=f?f.transformedBounds(n):f,(f=r?_.IntersectRect(r,f):f)&&(e[p]=f)}if(t instanceof Se)for(var T=t.animationTransform||t.fade?t.animationChangeTracker.currentUniqueId+"/"+s:s,w=a||t.animationTransform,x=0,C=t.items.elements;x<C.length;x++){var S=C[x];o.next(),this.fillRenderRectMap(e,S,r,t.transform.toMatrix3().multiply(d),n,o,T,w,l||t.isHidden)}}},e.prototype.calculateDirtyRect=function(e,t){var r,i=function(i){var n=e[i],o=t[i];E(n,o)||(r=_.UnionRect(r,n),r=_.UnionRect(r,o))};for(var n in e)i(n);for(var n in t)i(n);return r?r.inflate(2):void 0},e.prototype.getLastRenderRectMap=function(){return this.m_lastRenderRectMap},e.prototype.render=function(e,t,r,i){this.renderBatch([{item:e,eraseBackground:t,options:r}],i)},e.prototype.renderBatch=function(e,t){var r,i,n,o,s,a;this.m_lastRenderRectMap=void 0,this.m_verboseRenderLogging&&M.Message(538208403,"RenderBatch begin");var l,h,c=null===(r=t)||void 0===r?void 0:r.enableDirtyRect,u=null===(i=t)||void 0===i?void 0:i.previousRenderRectMap,d=this.m_graphicsProcessor;if(d){this.updateSettingsBeforeRender();var p=performance.now();if(c){l={};for(var f=0,g=e;f<g.length;f++){var m=g[f],y=new Li;this.fillRenderRectMap(l,m.item,null===(n=m.options)||void 0===n?void 0:n.scissor,v.Identity,(null===(s=null===(o=m.options)||void 0===o?void 0:o.transform)||void 0===s?void 0:s.toMatrix3())||v.Identity,y,void 0,void 0,!1)}u&&(h=this.calculateDirtyRect(u,l))}if(this.m_verboseRenderLogging&&M.Message(525960788,"RenderBatch computed RenderRectMap"),d.beginRenderScope()){this.m_verboseRenderLogging&&M.Message(538208404,"RenderBatch entered render scope");var _=new Tt;_.glResetCostMs+=performance.now()-p,_.beginTime=(new Date).getTime(),this.m_currentFramePerformanceSummary=_,_.totalCostMs=-performance.now();for(var b=0,T=e;b<T.length;b++)m=T[b],this.tryPrepareItemInWebGlScope(m.item,d,!0,void 0)||M.Error(592525120,"could not fully prepare scene");if(_.shapeRenderCostMs=-performance.now(),this.m_verboseRenderLogging&&M.Message(538208405,"RenderBatch Items prepared"),h||!c||!u)for(var w=0,x=e;w<x.length;w++)m=x[w],this.renderItemInWebGLRenderScope(m.item,m.eraseBackground,m.options,h);this.m_verboseRenderLogging&&M.Message(538208406,"RenderBatch Items rendered");var C=e.length>0&&(null===(a=e[0].options)||void 0===a?void 0:a.target)instanceof zt?e[0].options.target.size:d.getCurrentViewportSize();if(_.shapeRenderCostMs+=performance.now(),_.glRestoreCostMs=-performance.now(),h&&At.readBooleanOrDefault("debugDirtyRects",!1)){var S=Ce.CreateRectangle(h,new fe(new ae(new ne(Math.random(),Math.random(),Math.random(),.25))));this.renderItemInWebGLRenderScope(S,void 0)}if(d.endRenderScope(),_.glRestoreCostMs+=performance.now(),_.totalCostMs+=performance.now(),_.endTime=(new Date).getTime(),this.m_perfSummary.perfInfoCurrentFrame=_,this.m_perfSummary.perfInfoFirstFrame||(this.m_perfSummary.perfInfoFirstFrame=_),this.m_perfSummary.perfInfoSumOfAllFrames||(this.m_perfSummary.perfInfoSumOfAllFrames=new Tt),this.m_perfSummary.perfInfoSumOfAllFrames.add(_),this.m_perfSummary.frameCount++,this.m_perfSummary.averageFrameCost=this.m_perfSummary.perfInfoSumOfAllFrames.totalCostMs/this.m_perfSummary.frameCount,this.m_perfSummary.viewWidth=C.x,this.m_perfSummary.viewHeight=C.y,this.m_perfSummary.frameCount>1){var P=(this.m_perfSummary.perfInfoSumOfAllFrames.totalCostMs-this.m_perfSummary.perfInfoFirstFrame.totalCostMs)/(this.m_perfSummary.frameCount-1);this.m_perfSummary.estimatedFps=Math.floor(Math.min(1e3/P,60))}else this.m_perfSummary.estimatedFps=Math.floor(Math.min(1e3/this.m_perfSummary.perfInfoCurrentFrame.shapeRenderCostMs,60));this.m_currentFramePerformanceSummary=new Tt,Yr.OnRender(this,e),this.m_verboseRenderLogging&&M.Message(538208407,"RenderBatch finished"),this.m_lastRenderRectMap=l}}else M.Error(592525091,"glContext must be provided")},e.prototype.renderItemInWebGLRenderScope=function(e,t,r,i){var n=this.m_graphicsProcessor;if(n){n.updateViewportSize();var o=r?r.target:void 0,s=o?o.size:n.getCurrentViewportSize(),a=r?r.transform:void 0,l=(null==r?void 0:r.scissor)&&i?_.IntersectRect(null==r?void 0:r.scissor,i):(null==r?void 0:r.scissor)||i;if(!(null==r?void 0:r.scissor)&&!i||l){n.setScissorRect(null==l?void 0:l.inflateToInteger(),!0);var h=performance.now(),c=n.activateShaderProgram(1);if(this.isVerboseRenderLoggingEnabled()){var u=ji(performance.now()-h);M.Message(529077967,"RenderBatch shapeRender shader activation cost "+u+"ms")}c.begin(o?o.tryGetBabylonTextureForRenderToTexture(n):void 0,t,!0),this.drawItem(31,c,e,s,v.Identity,void 0,a?a.toMatrix3():v.Identity,0,void 0,!1,r,l),c.end(),n.setScissorRect(void 0)}}else M.Error(592525121,"glContext must be provided")},e.prototype.renderMorph=function(e,t,r,i){if(!this.m_morphPlayer)throw M.Error(591667344,"Morph not available for this renderer");this.m_morphPlayer.renderMorph(this,e,t,r,i)},e.prototype.tryPrepareMorph=function(e,t){if(!this.m_morphPlayer)throw M.Error(591667345,"Morph not available for this renderer");return this.m_morphPlayer.tryPrepareMorph(this,e,t)},e.prototype.tryGetImageDebugDataForMorphKeyFrame=function(e){var t=this.ensureMorphKeyFrameRenderData(e);return t.texture?new Dr(1,t.texture):void 0},e.prototype.renderLayers=function(e,t,r){var i=this.m_graphicsProcessor;if(i){if(!i||i.beginRenderScope()){var n=this.m_targetTexture?this.m_targetTexture.size:i.getCurrentViewportSize(),o=i.activateShaderProgram(1);o.begin(this.m_targetTexture?this.m_targetTexture.tryGetBabylonTextureForRenderToTexture(i):void 0,t,!0);for(var s=0;s<e.length;s++)hr(i,e[s],o,n,r?r.toMatrix3():void 0,void 0);o.end(),i.endRenderScope()}}else M.Error(592525125,"glContext must be provided")},e.prototype.retrieveHitTestResult=function(e,t,r,i){if(t==r.index){var n={itemHit:e,itemStack:[e],textHit:void 0};if(e instanceof Ce){var o=e.text;if(o){var s=i.transformPoint(v.FromTransforms(new y(e.transform.translation.negate(),e.transform.scale.inverse()),o.frameToShape.toInverseMatrix3(),o.layoutToFrame.toInverseMatrix3()));n.textHit=o.hitTest(s)?o.getSelectionFromLayoutPosition(s):void 0}}return n}if(e instanceof Se)for(var a=0,l=e.items.elements;a<l.length;a++){var h=l[a];r.next();var c=this.retrieveHitTestResult(h,t,r,i.transformPoint(e.transform.toInverseMatrix3()));if(null==c?void 0:c.itemStack)return c.itemStack.splice(0,0,e),c}},e.prototype.renderHitTestBuffer=function(e,t,r,i,n){var o=performance.now();this.m_hitTestCache=void 0;var s=this.m_graphicsProcessor;if(s){if(s.beginRenderScope()){this.tryPrepareItemInWebGlScope(e,s,!0,void 0)||M.Error(592525131,"could not fully prepare"),this.m_hitTestTexture&&this.m_hitTestTexture.isValid(this)&&this.m_hitTestTexture.size.equals(r)||(this.m_hitTestTexture&&this.m_hitTestTexture.release(),this.m_hitTestTexture=new zt("HitTestPixel",this,r,0));var a=new Li,l=s.activateShaderProgram(1);l.begin(this.m_hitTestTexture.tryGetBabylonTextureForRenderToTexture(s),ne.Transparent,!0);var h=t.negate(),c=i?i.toMatrix3().multiply(v.Translation2D(h)):v.Translation2D(h);this.drawItem(0,l,e,this.m_hitTestTexture.size,v.Identity,void 0,c,7,a,!1,{filter:n}),l.end(),this.m_hitTestTexture.renderCost=performance.now()-o;var u=this.m_hitTestTexture.tryUseBabylonTexture(s,void 0,"hitTest"),d=u?s.copyTexturePixelsToArray(u,new _(0,0,this.m_hitTestTexture.size.x,this.m_hitTestTexture.size.y),!0):void 0;s.endRenderScope(),d&&(this.m_hitTestCache={buffer:d,uniqueId:e.changeTracker.currentUniqueId,origin:t,renderTransform:i})}}else M.Error(592525129,"glContext must be provided")},e.prototype.isHitTestBufferValid=function(e,t,r,i,n){if(n||0==F||!this.m_hitTestCache||this.m_hitTestCache.uniqueId!=e.changeTracker.currentUniqueId)return!1;if(!this.m_hitTestCache.renderTransform&&!i||this.m_hitTestCache.renderTransform&&i&&!this.m_hitTestCache.renderTransform.toMatrix3().equals(i.toMatrix3()))return!1;var o=this.m_hitTestCache.origin?new _(this.m_hitTestCache.origin.x,this.m_hitTestCache.origin.y,this.m_hitTestCache.origin.x+r.x-1,this.m_hitTestCache.origin.y+r.y-1):void 0;return!(!o||!o.isPointInRect(t))},e.prototype.hitTestScene=function(e,t,r,i){var n=F&&!i?new g(F,F):g.One;if(!this.isHitTestBufferValid(e,t,n,r,i)){var o=t.floor().subtract(new g(Math.floor(n.x/2),Math.floor(n.y/2)));this.renderHitTestBuffer(e,o,n,r,i)}if(!this.m_hitTestCache)return Fi;var s=t.subtract(this.m_hitTestCache.origin).floor(),a=4*(s.x+(n.y-1-s.y)*n.x);if(a<0||a+3>=this.m_hitTestCache.buffer.length||0==this.m_hitTestCache.buffer[a+3])return Fi;var l=this.m_hitTestCache.buffer[a+0]+256*this.m_hitTestCache.buffer[a+1]+65536*this.m_hitTestCache.buffer[a+2],h=new Li,c=r instanceof v?r.tryGetTransform(g.Zero):r,u=c?c.toInverseMatrix3():void 0,d=this.retrieveHitTestResult(e,l,h,u?t.transformPoint(u):t);if(d)return d;throw M.Error(592525132,"Unable to retrieve hit shape")},e.prototype.hasHitTestTexture=function(){return null!=this.m_hitTestTexture},e.prototype.tryInitTextures=function(e,t,r,i,n){var o,s,a;if(t.isHidden)return!0;var l=this.ensureRenderNode(t);l.cache.beforeInitTextures(t,e);var h=new Di(i,t,l,n),c=t instanceof Ce&&t.shape3D;if(t instanceof Ce){var u=t;if(u.incrementalPath&&(l.cache.initTextureStage=Nr.fromBegining),l.cache.initTextureStage<Nr.distanceFieldsReady){if(u.incrementalPath)l.cache.distanceFields&&1==l.cache.distanceFields.length||(l.cache.distanceFields=[new mr("DistanceField/incremental",this,void 0,0,0,0,1,!1)]);else if(u.paths&&!l.cache.distanceFields&&!u.isSolidRect()){var d=-performance.now();if(l.cache.distanceFields=[],(null===(o=u.paths)||void 0===o?void 0:o.length)>0){for(var p=0,f=0,m=u.paths[0].fillMode,y=0;y<u.paths.length;y++){var _=y==u.paths.length-1,b=_?0:u.paths[y+1].fillMode;(_||b!=m)&&(!u.style.hasLine||0==u.style.pen.headEnd.end&&0==u.style.pen.tailEnd.end?l.cache.distanceFields.push(new mr("DistanceField/fillAndLine",this,Ne.FromFirstLast(p,f),m,u.mergeMode,0,1,!1)):(0!=m&&null!=u.style.fillBrush&&l.cache.distanceFields.push(new mr("DistanceField/fillOnly",this,Ne.FromFirstLast(p,f),m,u.mergeMode,1,1,!1)),l.cache.distanceFields.push(new mr("DistanceField/arrowAndLine",this,Ne.FromFirstLast(p,f),m,u.mergeMode,2,1,!1))),m=b,p=y+1),f=y+1}c&&l.cache.distanceFields.push(new mr("DistanceField/displacement",this,void 0,m,u.mergeMode,0,1,!0))}if(d+=performance.now(),3==u.role?this.m_currentFramePerformanceSummary.distanceFieldForTextCostMs+=d:this.m_currentFramePerformanceSummary.distanceFieldForShapeCostMs+=d,this.initOutOfTime())return!1}for(var T=0,w=l.cache.distanceFields||[];T<w.length;T++){var x=w[T],C=(d=-performance.now(),null!=u.incrementalPath),S=x.refresh(this,u,C);if(!S&&C&&(S=x.refresh(this,u,!1)),S||M.Error(592525133,"error in distanceField refresh"),d+=performance.now(),3==u.role?this.m_currentFramePerformanceSummary.distanceFieldForTextCostMs+=d:this.m_currentFramePerformanceSummary.distanceFieldForShapeCostMs+=d,this.initOutOfTime())return!1}l.cache.initTextureStage=Nr.distanceFieldsReady}if(l.cache.initTextureStage<Nr.brushTexturesReady){if(l.cache.initBrushTexture(this,t,0),this.initOutOfTime())return!1;if(l.cache.initBrushTexture(this,t,1),this.initOutOfTime())return!1;if(l.cache.initBrushTexture(this,t,2),this.initOutOfTime())return!1;l.cache.initTextureStage=Nr.brushTexturesReady}if(u.text&&u.text.cache)if(0==u.text.renderMode){for(var P=0,E=0,R=u.text.cache.textShapes||[];E<R.length;E++){var A=R[E];if(u.text.animationProps)if(A.textRange){var I=u.text.animationProps.getAt(A.textRange.start);A.fade=I.fade,A.animationTransform=I.animationTransform,A.isHidden=I.isHidden}else M.Error(592525134,"no range");else A.fade=void 0,A.animationTransform=v.Identity,A.isHidden=!1;if(!this.tryInitTextures(e,A,r,h,P))return!1;P++}for(var F=0,B=u.text.cache.selectionShapes||[];F<B.length;F++){var L=B[F];if(!this.tryInitTextures(e,L,r,h,0))return!1}}else l.cache.initTextCutoutLayer(this,u.text.cache.cutoutLayerPaths,u)}else{if(!(t instanceof Se))throw M.Error(592525135,"Unknown Item type");l.cache.initTextureStage<Nr.brushTexturesReady&&(l.cache.initBrushTexture(this,t,0),l.cache.initTextureStage=Nr.brushTexturesReady);var D=t;for(y=0;y<D.items.length;y++){var k=D.items.getAt(y);if(k&&!this.tryInitTextures(e,k,r,h,y))return!1;if(this.initOutOfTime())return!1}}var O=-performance.now();if(l.cache.fade=h.fade,l.cache.initFadeTexture(this,t,h.fade),O+=performance.now(),t.fade&&(this.m_currentFramePerformanceSummary.fadeTextureCostMs+=O),this.initOutOfTime())return!1;if(r&&l.cache.initTextureStage<Nr.effectsReady){if(t.effects){if(t.effects.innerShadow&&t.effects.innerShadow.color.a>0&&!l.cache.innerShadowTexture&&(l.cache.innerShadowTexture=this.createTextureRasterizedItem("Effect/InnerShadow",t,0,l.cache.innerShadowTexture,ne.Black,t.effects.innerShadow.radius,8,2,Ft,1),this.initOutOfTime()))return!1;if(t.effects.softEdges&&t.effects.softEdges.radius>0&&!l.cache.softEdgesTexture&&(l.cache.softEdgesTexture=this.createTextureRasterizedItem("Effect/SoftEdges",t,0,l.cache.softEdgesTexture,ne.Black,t.effects.softEdges.radius,16,5,Ft,1),this.initOutOfTime()))return!1;if(t.effects.glow&&t.effects.glow.radius>0&&t.effects.glow.color.a>0&&!l.cache.glowTexture&&(l.cache.glowTexture=this.createTextureRasterizedItem("Effect/Glow",t,16,l.cache.glowTexture,t.effects.glow.color,t.effects.glow.radius?2*t.effects.glow.radius:0,1,t.effects.glow.isSharp?4:3,Ft,1),this.initOutOfTime()))return!1;if(t.effects.shadow&&t.effects.shadow.color.a>0&&!l.cache.shadowTexture&&(l.cache.shadowTexture=this.createTextureRasterizedItem("Effect/Shadow",t,17,l.cache.shadowTexture,t.effects.shadow.color,t.effects.shadow.radius?t.effects.shadow.radius:0,2,6,Ft,1),this.initOutOfTime()))return!1;if(t.effects.reflection&&!l.cache.reflectionTexture&&(l.cache.reflectionTexture=this.createTextureRasterizedItem("Effect/Reflection",t,27,l.cache.reflectionTexture,void 0,t.effects.reflection.radius,4,6,Ft,1),this.initOutOfTime()))return!1}l.cache.initTextureStage=Nr.effectsReady}if(r)if(c||t.fade&&13!=t.fade.preset){var U=t.animationTransform?t.animationTransform.transformVector(g.One.scale(Math.sqrt(2)/2)).length():1,N=It*U;if((!l.cache.spriteTexture||l.cache.spriteTexture.tag!=t.changeTracker.currentUniqueId||l.cache.spriteQuality<N)&&(l.cache.spriteTexture&&(this.fixedMemoryLeakAmounts.recreatingSprites+=l.cache.spriteTexture.memoryUsage),null===(a=l.cache.spriteTexture)||void 0===a||a.release(),l.cache.spriteTexture=c?function(e,t,r,i){var n=e.getGraphicsProcessor();if(n){var o,s=e.ensureRenderNode(t),a=Re(t,!0,31,31,t.transform.toInverseMatrix3().multiply(v.Scale2D(t.transform.scale))),l=Ni(t),h=e.createTextureRasterizedItem("RasterizeFor3D/Item",t,24,s.cache.spriteTexture,void 0,0,0,1,i,1),c=s.cache.glowTexture||s.cache.shadowTexture||s.cache.reflectionTexture?e.createTextureRasterizedItem("RasterizeFor3D/Effects",t,31,s.cache.spriteTexture,void 0,0,0,8,i,1):void 0,u=s.cache.getBevelDistanceField();if(a&&l&&h&&(null==u?void 0:u.texture)){var d=Math.min(i,Lt/a.size.x,Lt/a.size.y),p=new g(Math.min(Lt,Math.ceil(a.size.x*d)),Math.min(Lt,Math.ceil(a.size.y*d)));(o=new zt("rasterized3D",e,p,1)).tag=t.changeTracker.currentUniqueId,o.contentLocation={logicalCenter:l.center.subtract(a.leftTop).scale(d),logicalSize:l.size.scale(d),physicalCenter:o.size.scale(.5),physicalSize:o.size,rotation:0,flipX:!1,flipY:!1};var f=o.tryGetBabylonTextureForRenderToTexture(n);if(f){var m=g.Zero,y=void 0;t instanceof Ce&&t.shape3D&&t.shape3D.topBevel&&(y=function(e,t,r,i){function n(e,t,r){for(var i=Math.floor(t.x);i<=Math.floor(r.x);i++)i>=0&&i<e.length&&(e[i]=Math.max(e[i],t.y+(i-t.x)*(r.y-t.y)/(r.x-t.x)))}var o=new Array(t);o.fill(0),r.forEachSegment((function(e,t,r){if(t)for(var i=Math.max(8,r.x-e.x),s=0;s<i;s++)n(o,g.InterpolateQuadratic(e,t,r,s/i),g.InterpolateQuadratic(e,t,r,(s+1)/i));else n(o,e,r);return!0}),v.Scale2D(i));for(var s=new Float32Array(768),a=0;a<t;a++)s[3*a]=s[3*a+1]=s[3*a+2]=o[a];return Gt.CreateFromByteBuffer("PathProfile",e,new g(t,1),s,4,4,!0)}(e,256,t.shape3D.topBevel.profile,new g(255,1)),m=t.shape3D.topBevel.size);var _=n.activateShaderProgram(7);_.begin(f,ne.Transparent,!0),c&&Hi(n,_,c,void 0,void 0,o.size,o.contentLocation.logicalSize,o.contentLocation.logicalCenter,g.Zero,0,void 0,void 0,ne.Transparent,0),Hi(n,_,h,u,y,o.size,o.contentLocation.logicalSize,o.contentLocation.logicalCenter,m,t instanceof Ce?t.style.pen.lineWidth:0,r,t instanceof Ce&&t.shape3D?t.shape3D.material:void 0,t instanceof Ce&&t.shape3D&&t.shape3D.contourColor?t.shape3D.contourColor:ne.Transparent,t instanceof Ce&&t.shape3D?t.shape3D.adjustedContourWidth:0),_.end(),y&&y.release()}else M.Error(572867291,"failed to get textureTarget")}else M.Error(572867292,"failed to get textures for 3D rendering");return h&&h.release(),c&&c.release(),o}M.Error(572867290,"failed to get graphicsProcessor")}(this,t,h.scene3D,N):this.createTextureRasterizedItem("SpriteCache",t,31,l.cache.spriteTexture,void 0,0,0,1,N,1),l.cache.spriteTexture&&(l.cache.spriteTexture.tag=t.changeTracker.currentUniqueId,l.cache.spriteQuality=N),this.initOutOfTime()))return!1}else null===(s=l.cache.spriteTexture)||void 0===s||s.release(),l.cache.spriteTexture=void 0,l.cache.spriteQuality=0;return!0},e.prototype.tryPreparePaths=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];if(this.ensurePathRenderData(i).refreshCachedTapeBuffers(i),this.initOutOfTime())return!1}return!0},e.prototype.tryPrepareGeneratedShapes=function(e){var t=this;return Pe(e,(function(e){return!e.text||(e.text.cache||(e.text.cache=new it),e.text.cache.update(e.text),!t.initOutOfTime())}))},e.prototype.tryPrepareTapes=function(e){var t=this;return Pe(e,(function(e){if(e.paths){if(!t.tryPreparePaths(e.paths))return!1;if(e.shapeBoundsCache&&e.shapeBoundsCache.geometryVersion==e.geometryTracker.version||(e.shapeBoundsCache={geometryVersion:e.geometryTracker.version}),e.shapeBoundsCache.pathsBounds||e.style.hasLine||(e.shapeBoundsCache.pathsBounds=ee(e.paths)),t.initOutOfTime())return!1}return!0}))},e.prototype.tryPrepareItemInWebGlScope=function(e,t,r,i){var n=performance.now();if(this.m_initDeadline=i?n+i:void 0,t&&!t.tryPrepareProgramResourcesInWebGlScope(this.m_initDeadline))return!1;if(!this.tryPrepareGeneratedShapes(e))return!1;if(!this.tryPrepareTapes(e))return!1;if(t){var o=!1;return function(e,t){if(Ut&&e.getGraphicsProcessor()){var r,i=performance.now(),n=yr;yr=void 0,n||(n=[]),r=function(e){return function(e){var t=vr(e.glyphCacheId);if(t&&null==_r[t]){var r=new N(e,y.Identity),i=ee([r]);if(i){0!=br.length&&256!=br[br.length-1].length||br.push([]);var n=br.length-1,o=br[n],s=i.size,a=56/Math.max(4096,Math.max(s.x,s.y)),l=new g(a,a),h=o.length,c=.5+h%16,u=.5+(h-c)/16,d=i.center.scale(-a).add(new g(64*c,64*u)),p=y.fromScaleAndTranslation(l,d),f={page:n,scale:a,offset:d,bounds:i.multiply(l).translate(d).inflate(4),path:new N(r,p),ready:!1};o.push(f),_r[t]=f}}}(e),!0},Pe(t,(function(e){for(var t=0,i=e.paths||[];t<i.length;t++){var n=i[t];if(!r(n))return!1}return!0}));for(var o=0;o<br.length;o++){var s=!0,a=o<n.length?n[o]:void 0;if(a)a.texture&&a.texture.isValid(e)||(M.Error(592525085,"invalid glyph table texture. recreating."),s=!1);else{for(;n.length<o+1;)n.push(new mr("DistanceField/glyphPage",e,void 0,1,0,0,1,!1));(a=n[o]).contentBoundsOverride=new _(0,0,wr,wr),a.paddingOverride=8,a.qualityOverride=1,a.isGlyphCache=!0,s=!1}var l=!1;s&&(l=Ir(e,o,a,!0)),l||Ir(e,o,a,!1)}yr=n,e.getCurrentFramePerformanceSummary().distanceFieldForGlyphTableCostMs+=performance.now()-i}}(this,e),this.initOutOfTime()||(o=this.tryInitTextures(t,e,r,void 0,0)),o}return!0},e.prototype.tryPrepareItem=function(e,t,r){var i=this.m_graphicsProcessor;if(!i)return M.Error(592525136,"glContext must be provided"),!1;if(this.updateSettingsBeforeRender(),!i.beginRenderScope())return!1;var n=this.tryPrepareItemInWebGlScope(e,i,t,r);return i.endRenderScope(),n},e.prototype.drawItem=function(e,t,r,i,n,o,s,a,l,h,c,u){void 0===h&&(h=!1);for(var d=0,p=r.instanceOffsets||[g.Zero];d<p.length;d++){var f=p[d];this.drawItemOnce(e,t,r,i,r.instanceOffsets?v.Translation2D(f).multiply(n):n,o,s,a,l,h,c,u)}},e.prototype.drawItemOnce=function(e,t,r,i,n,o,s,a,l,h,c,u){void 0===h&&(h=!1);var d=0==a||7==a,p=o||r.animationTransform,f=r instanceof Ce?3==r.role?"text":"shape":"group",m=d&&p?n.multiply(p.multiply(s)):n.multiply(s);if(!(!this.m_graphicsProcessor||r.isHidden||c&&c.filter&&!c.filter(r))){this.m_graphicsProcessor.setScissorRect(null==u?void 0:u.inflateToInteger(),!0);var b,T=this.ensureRenderNode(r),w=T.cache?T.cache.fade:void 0,x=Ni(r);if(r instanceof Ce&&r.clipBounds&&x&&(b=(b=(b=(b=r.getBounds())?b.transformedBounds(r.transform.toInverseMatrix3()):void 0)?r.clipBounds.clip(b):void 0)?b.translate(x.center.negate()):void 0),d&&T.cache.spriteTexture){if(x){(M=new rr(T.cache.spriteTexture,Vt(x,r.transform))).fadeInfo=d&&w?{fade:w,fadeTexture:T.cache.fadeTexture}:void 0,M.localClipRect=b,M.clientObject=T.cache;var C=performance.now();hr(this.m_graphicsProcessor,M,t,i,m,l?l.color:void 0),this.onLayerRendered(f,"SpriteCache",C,M)}}else{if(0!=e&&r.effects&&(r.effects.glow||r.effects.shadow||r.effects.reflection)&&0==L&&7!=a&&(!c||!c.textRange)&&x){var S=x.center.transformPoint(r.transform),P=void 0;if(4&e&&r.effects.reflection||2&e&&r.effects.shadow){var E=new y(S.negate(),g.One,r.effects.direction,S);P=r.effectsBoundsOverride?r.effectsBoundsOverride.transformedBounds(E):Re(r,!1,0,1,E.toMatrix3())}var M,R=x?Vt(x,r.transform):void 0,A=R?new y(g.Zero,g.Flip(R.flipX,R.flipY),R.rotation+r.effects.direction,R.center):void 0,I=A?A.toInverseMatrix3():void 0;if(4&e&&r.effects.reflection&&T.cache.reflectionTexture&&P&&x&&R&&A&&I){var F=r.effects.reflection,B=P.bottom+F.distance/2;r instanceof Ce&&r.textEffectMetrics&&(B-=r.textEffectMetrics.descent);var D=v.Translation2D(new g(0,-B)).multiply(v.Scale2D(new g(1,-1))).multiply(v.Translation2D(new g(0,B))),k=new g(P.center.x,B),O=new g(P.center.x,B+P.height),U={opacity0:F.startAlpha,opacity1:F.endAlpha,pos0:g.InterpolateLinear(k,O,F.startPosition).transformPoint(I),pos1:g.InterpolateLinear(k,O,F.endPosition).transformPoint(I)};(M=new rr(T.cache.reflectionTexture,R)).fadeInfo=d&&w?{fade:w,fadeTexture:T.cache.fadeTexture}:void 0,M.effectTransform=v.FromTransforms(A,D,I),M.localClipRect=b,M.reflectionGradient=U,M.clientObject=T.cache,C=performance.now(),hr(this.m_graphicsProcessor,M,t,i,m,l?l.color:void 0),this.onLayerRendered(f,"Reflection",C,M)}if(2&e&&r.effects.shadow&&T.cache.shadowTexture&&P&&x&&R&&A&&I){var N=Ie(r.effects.shadow.alignment,P),V=Fe(r.effects.shadow.angle,r.effects.shadow.distance,r.effects.shadow.scale,r.effects.shadow.skew,N);(M=new rr(T.cache.shadowTexture,R)).fadeInfo=d&&w?{fade:w,fadeTexture:T.cache.fadeTexture}:void 0,M.effectTransform=v.FromTransforms(A,V,I),M.localClipRect=b,M.clientObject=T.cache,C=performance.now(),hr(this.m_graphicsProcessor,M,t,i,m,l?l.color:void 0),this.onLayerRendered(f,"Shadow",C,M)}if(1&e&&r.effects.glow&&T.cache.glowTexture&&x&&R&&A&&I)(M=new rr(T.cache.glowTexture,R)).fadeInfo=d&&w?{fade:w,fadeTexture:T.cache.fadeTexture}:void 0,M.localClipRect=b,M.clientObject=T.cache,C=performance.now(),hr(this.m_graphicsProcessor,M,t,i,m,l?l.color:void 0),this.onLayerRendered(f,"Glow",C,M)}if(8!=a)if(1==r.getType()){var G=r;if(!c||!c.textRange)if(G.isSolidRect())Zr(this,T.cache,void 0,e,t,G,i,m,a,l?l.color:void 0,b);else for(var z=0,W=T.cache.distanceFields||[];z<W.length;z++){var H=W[z];H.isDisplacementMap||Zr(this,T.cache,H,e,t,G,i,m,a,l?l.color:void 0,b)}if(G.text&&G.text.cache&&(!c||!c.noSubtree||c.textRange)){var j=new y(g.Zero,g.One,G.transform.rotation,G.transform.translation),q=j.toMatrix3().multiply(n),X=G.text.animationProps?void 0:p,K=s;if(l)for(var Y=0,$=G.text.cache.hitTestLineShapes||[];Y<$.length;Y++){var Z=$[Y];(!c||!c.textRange||Z.textRange&&c.textRange.includes(Z.textRange.start))&&this.drawItem(31,t,Z,i,q,X,K,a,l,h)}else if(0==G.text.renderMode){for(var J=0,Q=G.text.cache.textShapes||[];J<Q.length;J++){var ee=Q[J];(!c||!c.textRange||ee.textRange&&c.textRange.includes(ee.textRange.start))&&this.drawItem(31,t,ee,i,q,X,K,a,l,h,void 0,u)}if(0==a)for(var te=0,re=G.text.cache.selectionShapes||[];te<re.length;te++){var ie=re[te];this.drawItem(31,t,ie,i,q,X,K,a,l,h,void 0,u)}}}}else if(2==r.getType()&&(!c||!c.noSubtree&&!c.textRange)){var ne=r;if(ne)for(var oe=0;oe<ne.items.length;oe++){var se=ne.items.getAt(oe);l&&l.next();var ae=ne.transform.toMatrix3().multiply(n),le=p,he=s,ce=u,ue=!1;if(ne.clipBounds){var de=u||new _(0,0,i.x,i.y),pe=le?v.FromTransforms(ae,le,he):ae.multiply(he),fe=null==pe?void 0:pe.inverse(),ge=fe?de.transformedBounds(fe):void 0,me=ge?ne.clipBounds.clip(ge):void 0,ve=null==me?void 0:me.transformedBounds(pe);ue=null==(ce=ve?_.IntersectRect(ve,de):void 0)}ue||this.drawItem(31,t,se,i,ae,le,he,a,l,h,c,ce)}}}}},e.prototype.renderToTexture=function(e,t,r,i,n,o,s,a,l){n&&n.size.equals(o)||(n=new zt(e,this,o,l));var h=t.activateShaderProgram(1);h.begin(n.tryGetBabylonTextureForRenderToTexture(t),ne.Transparent,!0);var c={noSubtree:(3==a||4==a)&&r instanceof Ce};return this.drawItemOnce(i,h,r,o,v.Identity,void 0,s.toMatrix3(),a,void 0,!1,c),h.end(),n},e.prototype.drawTextureToTexture=function(e,t,r,i,n){var o=this.m_graphicsProcessor;if(!o)throw M.Error(592525137,"No Graphics Processor");var s=0==r?5:6,a=o.isInRenderScope();if(!a&&!o.beginRenderScope())throw M.Error(591541203,"Failed to begin RenderScope");var l=o.activateShaderProgram(s);l.begin(e.tryGetBabylonTextureForRenderToTexture(o),ne.Transparent,!0),jt(o,l,t,[new _(0,0,t.size.x,t.size.y)],[new _(0,0,e.size.x,e.size.y)],e.size,r,1,i,n),l.end(),a||o.endRenderScope()},e.prototype.createTextureRasterizedItem=function(e,t,r,i,n,o,s,a,l,h){var c=this.m_graphicsProcessor;if(!c)throw M.Error(591541204,"No Graphics Processor");var u=performance.now(),d=4==a,p=!d&&o?l*Math.min(1,4/Math.sqrt(o)):l,f=!!(4&s),m=!!(24&s),b=!(2==t.getType()&&t.isDocumentShape),w=Re(t,f||b&&!m,r,31,t.transform.toInverseMatrix3().multiply(v.Scale2D(t.transform.scale)));if(w){var C=(w=w.inflate(Math.max(2/p,o))).size,S=w.center.divide(t.transform.scale).transformPoint(t.transform);if(C&&S){var P=Math.min(p,Dt/Math.max(C.x,C.y)),E=C.scale(P),R=o||n,A=new g(x(R?T(E.x):E.x,16,Dt),x(R?T(E.y):E.y,16,Dt)),I=Math.min(P,Math.min(A.x/C.x,A.y/C.y)),F=new y(S.negate(),new g(I,I),-t.transform.rotation,new g(A.x/2,A.y/2)),B=Ni(t);if(B){if(d){var L=this.renderToTexture(e,c,t,r,void 0,A,F,a,0);i=function(e,t,r,i,n,o){for(var s=r.size,a=new Array(32),l=new Array(32),h=0;h<32;h++){var c=2*Math.PI*h/32,u=new g(Math.cos(c)*i,Math.sin(c)*i);a[h]=new _(0,0,s.x,s.y),l[h]=new _(0+u.x,u.y,s.x+u.x,s.y+u.y)}var d=new zt("SharpGlow",e,s,o),p=t.activateShaderProgram(6);return p.begin(d.tryGetBabylonTextureForRenderToTexture(t),ne.Transparent,!0),jt(t,p,r,a,l,s,0,1,void 0,void 0,n),p.end(),d}(this,c,L,o*I,n||ne.Black,h),L.release()}else i=this.renderToTexture(e,c,t,r,i,A,F,a,h),R&&(i.generateMipMap(),function(e,t,r,i,n,o){var s=e.getGraphicsProcessor();if(s){var a=e.ensureScratchBuffers(),l=a[0],h=a[1],c=1==i?.12*r:16==i?.47*r:r,u=1==i?.3*r:r,d=1==i?3:16==i?2:n?1:0,p=n?1:0,f=1!=i&&16!=i;Jt(s,h.size.divide(t.size),t,h,n?ne.Black:void 0,c,d,new g(1,0),f,o),Jt(s,g.One,h,l,n?ne.Black:void 0,c,d,new g(0,1),f,void 0),Jt(s,g.One,l,h,n?ne.Black:void 0,u,p,new g(1,0),!0,void 0),Jt(s,t.size.divide(l.size),h,t,n,u,p,new g(0,1),!0,void 0)}else M.Error(592525249,"No GraphicsProcessor")}(this,i,o*I,s,n,this.ensureRenderNode(t).cache));i.contentLocation={logicalCenter:B.center.transformPoint(t.transform).transformPoint(F),logicalSize:B.size.multiply(t.transform.scale).scale(I),physicalCenter:i.size.scale(.5),physicalSize:C.scale(I),rotation:0,flipX:!1,flipY:!1};var D=performance.now()-u;return 6==a||3==a||4==a||2==a||5==a?this.m_currentFramePerformanceSummary.effectsCostMs+=D:1==a&&(this.m_currentFramePerformanceSummary.cacheToSpriteCostMs+=D),i.renderCost=D,i}}}},e.prototype.preCompileShaderAsync=function(e){this.m_graphicsProcessor?this.m_graphicsProcessor.preCompileShaderAsync(e):M.Error(592525138,"Graphics Processor not initoalized")},e.prototype.preLinkShaderAsync=function(e){this.m_graphicsProcessor?this.m_graphicsProcessor.preLinkShaderAsync(e):M.Error(592525139,"Graphics Processor not initoalized")},e.prototype.getDebugString=function(e){return this.m_debugStringProvider?e instanceof xe?this.m_debugStringProvider.getDebugStringForItem(e,this):e instanceof Oe?this.m_debugStringProvider.getDebugStringForMorph(e,this):"unsupported object":"no debug string provider"},e.prototype.getTexturesUsedByObject=function(e,t){var r=this;if(e instanceof Gt&&t.push(e),e instanceof xe){var i=e.getBrushImages();t.push.apply(t,i.map((function(e){return r.ensureImageRenderData(e).texture}))),this.getTexturesUsedItemCacheGL(e,t)}if(e instanceof Oe)for(var n=0,o=e.elements;n<o.length;n++)for(var s=0,a=o[n].keyFrames;s<a.length;s++){var l=a[s];if(l){var h=this.ensureMorphKeyFrameRenderData(l);h.texture&&t.push(h.texture),h.textureDeltaWhite&&t.push(h.textureDeltaWhite),h.texturePicture&&t.push(h.texturePicture)}}},e.prototype.getTexturesUsedItemCacheGL=function(e,t){var r=this.ensureRenderNode(e).cache;if(t.push.apply(t,r.getFulltextureList()),e instanceof Se)for(var i=0,n=e.items.elements;i<n.length;i++){var o=n[i];this.getTexturesUsedItemCacheGL(o,t)}if(e instanceof Ce&&e.text&&e.text.cache){for(var s=0,a=e.text.cache.getTextShapes();s<a.length;s++){var l=a[s];this.getTexturesUsedItemCacheGL(l,t)}for(var h=0,c=e.text.cache.getSelectionShapes();h<c.length;h++)l=c[h],this.getTexturesUsedItemCacheGL(l,t)}},e.prototype.getAllocatedTextures=function(e){for(var t=new Array,r=0,i=e||[];r<i.length;r++){var n=i[r];this.getTexturesUsedByObject(n,t)}return this.getTextureManager().allocatedTextures.filter((function(e){return!t.includes(e)}))},e.prototype.getAllocatedTexturesDebugTable=function(e,t){for(var r=[],i=[" Valid"," Empty"," Sneaky"," WrongR"," WrongC"],n=["Keep","Dispose","External"],o=0,s=this.getAllocatedTextures(t);o<s.length;o++){var a=s[o],l=a.lastUsage?performance.now()-a.lastUsage:void 0,h=a.lastRenderTime?performance.now()-a.lastRenderTime:void 0,c=a.scenario,u=i[a.getState(this)],d=n[a.releasePolicy],p=a.size.x,f=a.size.y,g=a.memoryUsage,m=a.renderCost,v="[ ";if(a.usageRecord.length>0)for(var y=0;y<a.usageRecord.length;y++){var _=a.usageRecord[y];v+=0==y?"":", ",v+='{"id":"'+Ui(_.clientObject,e)+'", "scenario":"'+_.lastScenario+'", "lastRead":'+(performance.now()-_.lastUsage)+"}"}v+="]",r.push({lastRead:l,lastWrite:h,scenario:c,state:u,policy:d,width:p,height:f,memory:g,cost:m,clients:v})}return r},e.prototype.enableVerboseRenderLogging=function(e){this.m_verboseRenderLogging=e},e.prototype.isVerboseRenderLoggingEnabled=function(){return this.m_verboseRenderLogging},e.prototype.onLayerRendered=function(e,t,r,i){var n=Math.ceil(i.contentSize.x)*Math.ceil(i.contentSize.y);if(this.getCurrentFramePerformanceSummary().pixelCountShapeRender+=n,"text"==e&&this.getCurrentFramePerformanceSummary().shapeLayerCountText++,this.isVerboseRenderLoggingEnabled()){var o=ji(performance.now()-r);M.Message(529077968,"RenderBatch "+e+" layer "+t+" rendered "+n+" pixels, cost "+o+"ms")}},e}();function Ui(e,t){if(e){for(var r=e&&e.constructor?e.constructor.name:void 0,i=e,n=0,o=t.split(".");n<o.length;n++){var s=o[n];i=i?i[s]:void 0}return(r||"")+(i?" "+i:"")}}function Ni(e){return 1==e.getType()?Me(e,!1):Re(e,!1,0,0,e.transform.toInverseMatrix3())}function Vi(e){return e?e.memoryUsage:0}function Gi(e,t){e&&(e instanceof zt&&e.tag?t.otherBrushes+=Vi(e):2!=e.releasePolicy?t.managedImages+=Vi(e):t.externalImages+=Vi(e))}function zi(e,t,r,i){var n;void 0===i&&(i=!1);var o=e.ensureRenderNode(t);if(o.cache){for(var s=0,a=o.cache.distanceFields||[];s<a.length;s++){var l=a[s];l.texture&&(i?r.textDistanceFields+=Vi(l.texture):r.shapeDistanceFields+=Vi(l.texture))}Gi(o.cache.resolvedFillTexture,r),Gi(o.cache.resolvedLineTexture,r),Gi(o.cache.resolvedPictureTexture,r),r.effects+=Vi(o.cache.innerShadowTexture),r.effects+=Vi(o.cache.softEdgesTexture),r.effects+=Vi(o.cache.glowTexture),r.effects+=Vi(o.cache.shadowTexture),r.effects+=Vi(o.cache.reflectionTexture),r.fadeMasks+=Vi(o.cache.fadeTexture),r.rasterizedItems+=Vi(o.cache.spriteTexture)}if(t instanceof Ce&&(null===(n=t.text)||void 0===n?void 0:n.cache)){var h=t.text.cache;h.textShapes.forEach((function(t){zi(e,t,r,!0)})),h.hitTestLineShapes.forEach((function(t){zi(e,t,r,!0)})),h.selectionShapes&&h.selectionShapes.forEach((function(t){zi(e,t,r,!0)}))}t instanceof Se&&t.items.elements.forEach((function(t){zi(e,t,r)}))}function Wi(e,t,r){for(var i=0,n=t.elements;i<n.length;i++)for(var o=0,s=n[i].keyFrames;o<s.length;o++){var a=s[o];if(a){var l=e.ensureMorphKeyFrameRenderData(a);l.texture&&(r.morphTextures+=Vi(l.texture))}}}function Hi(e,t,r,i,n,o,s,a,l,h,c,u,d,p){var f=i?i.texture:void 0,m=v.ScaleTranslation2D(o,o.scale(.5).subtract(a)),y=m,_=v.Translation2D(a),b=m.multiply(Qt(r,s)),T=f?m.multiply(Qt(f,s)):v.Identity,w=t.getBabylonEffect();w.setMatrix3x3("u_0",y.m),w.setMatrix3x3("u_1",_.m),w.setMatrix3x3("u_2",b.m),w.setMatrix3x3("u_3",T.m),w.setVector2("u_4",o),w.setInt("ufrag_0",i?1:0),w.setVector2("ufrag_1",i?i.size.inverse().scale(i.contentQuality):g.Zero),w.setFloat("ufrag_2",i?2*i.distRangeSize:0),w.setFloat("ufrag_3",i?-i.distRangeSize+.5*h:0),w.setVector2("ufrag_4",l);var x=new Array(16);x.fill(0);var C=new Array(12);C.fill(0);var S=new Array(16);if(S.fill(0),c)for(var P=0;P<Math.min(c.lights.length,4);P++){var E=c.lights[P],M=Math.sqrt(E.direction.x*E.direction.x+E.direction.y*E.direction.y+E.direction.z*E.direction.z);x[4*P]=Math.abs(E.color.r),x[4*P+1]=Math.abs(E.color.g),x[4*P+2]=Math.abs(E.color.b),x[4*P+3]=Math.abs(E.color.a),C[3*P]=E.direction.x/M,C[3*P+1]=E.direction.y/M,C[3*P+2]=E.direction.z/M,S[4*P]=E.wrapScale,S[4*P+1]=E.wrapOffset,S[4*P+2]=E.diffuse,S[4*P+3]=E.specular}w.setDirectColor4("ufrag_5",c?c.ambientColor:ne.Black),w.setArray4("ufrag_6",x),w.setArray3("ufrag_7",C),w.setArray4("ufrag_8",S),w.setDirectColor4("ufrag_9",u?u.diffuseColor:ne.Black),w.setDirectColor4("ufrag_10",u?u.specularColor:ne.Black),w.setDirectColor4("ufrag_11",u?u.ambientColor:ne.Black),w.setDirectColor4("ufrag_12",u?u.emissiveColor:ne.Black),u?w.setFloat4("ufrag_13",u.specularPower,u.useBlinnHighlight?1:0,u.diffuseFresnel,u.alphaFresnel):w.setFloat4("ufrag_13",0,0,0,0),w.setInt("ufrag_14",u?u.materialType:0),w.setFloat("ufrag_15",p),w.setDirectColor4("ufrag_16",d);var R=_?_.transformVector(g.One.scale(Math.sqrt(2)/2)).length():1;w.setFloat("ufrag_17",1/R),t.setTexture("t_0",r.tryUseBabylonTexture(e,void 0,"draw3D:T")),t.setTexture("t_1",f?f.tryUseBabylonTexture(e,void 0,"draw3D:D"):void 0),t.setTexture("t_2",n?n.tryUseBabylonTexture(e,void 0,"draw3D:P"):void 0),t.drawQuadInstances(1)}function ji(e){return Math.round(1e3*(e+100*Number.EPSILON))/1e3}var qi=function(){function e(e){this.webGLRestoreToDefault=!1,this.old=new Array(57),this.old_VERTEX_ATTRIB_ARRAY_ENABLED=new Array(2),this.webGLRestoreToDefault=e}return e.prototype.init=function(e){this.gl&&M.Error(591663577,"Previous Init has not been Restored");var t=[e.ACTIVE_TEXTURE,e.ARRAY_BUFFER_BINDING,e.BLEND,e.BLEND_COLOR,e.BLEND_DST_ALPHA,e.BLEND_DST_RGB,e.BLEND_EQUATION_ALPHA,e.BLEND_EQUATION_RGB,e.BLEND_SRC_ALPHA,e.BLEND_SRC_RGB,e.COLOR_CLEAR_VALUE,e.COLOR_WRITEMASK,e.CULL_FACE,e.CULL_FACE_MODE,e.CURRENT_PROGRAM,e.DEPTH_CLEAR_VALUE,e.DEPTH_FUNC,e.DEPTH_RANGE,e.DEPTH_TEST,e.DEPTH_WRITEMASK,e.DITHER,e.ELEMENT_ARRAY_BUFFER_BINDING,e.FRAMEBUFFER_BINDING,e.FRONT_FACE,e.GENERATE_MIPMAP_HINT,e.LINE_WIDTH,e.PACK_ALIGNMENT,e.POLYGON_OFFSET_FACTOR,e.POLYGON_OFFSET_FILL,e.POLYGON_OFFSET_UNITS,e.RENDERBUFFER_BINDING,e.SAMPLE_COVERAGE_INVERT,e.SAMPLE_COVERAGE_VALUE,e.SCISSOR_BOX,e.SCISSOR_TEST,e.STENCIL_BACK_FAIL,e.STENCIL_BACK_FUNC,e.STENCIL_BACK_PASS_DEPTH_FAIL,e.STENCIL_BACK_PASS_DEPTH_PASS,e.STENCIL_BACK_REF,e.STENCIL_BACK_VALUE_MASK,e.STENCIL_BACK_WRITEMASK,e.STENCIL_CLEAR_VALUE,e.STENCIL_FAIL,e.STENCIL_FUNC,e.STENCIL_PASS_DEPTH_FAIL,e.STENCIL_PASS_DEPTH_PASS,e.STENCIL_REF,e.STENCIL_TEST,e.STENCIL_VALUE_MASK,e.STENCIL_WRITEMASK,e.TEXTURE_BINDING_2D,e.TEXTURE_BINDING_CUBE_MAP,e.UNPACK_ALIGNMENT,e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.UNPACK_FLIP_Y_WEBGL,e.UNPACK_PREMULTIPLY_ALPHA_WEBGL];if(this.gl=e,this.old_VIEWPORT=e.getParameter(e.VIEWPORT),!this.webGLRestoreToDefault){for(var r=0;r<57;r++)this.old[r]=e.getParameter(t[r]);for(var i=0;i<2;i++)this.old_VERTEX_ATTRIB_ARRAY_ENABLED[i]=e.getVertexAttrib(i,e.VERTEX_ATTRIB_ARRAY_ENABLED)}},e.prototype.setDefaults=function(){var e=this.gl;if(e){e.activeTexture(e.TEXTURE0),e.bindBuffer(e.ARRAY_BUFFER,null),e.disable(e.BLEND),e.blendColor(0,0,0,0),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.clearColor(0,0,0,0),e.colorMask(!0,!0,!0,!0),e.disable(e.CULL_FACE),e.cullFace(e.BACK),e.useProgram(null),e.clearDepth(1),e.depthFunc(e.LESS),e.depthRange(0,1),e.disable(e.DEPTH_TEST),e.depthMask(!0),e.disable(e.DITHER),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.frontFace(e.CCW),e.hint(e.GENERATE_MIPMAP_HINT,e.DONT_CARE),e.lineWidth(1),e.polygonOffset(0,0),e.disable(e.POLYGON_OFFSET_FILL),e.bindRenderbuffer(e.RENDERBUFFER,null),e.sampleCoverage(1,!1),e.scissor(0,0,this.old_VIEWPORT[2],this.old_VIEWPORT[3]),e.disable(e.SCISSOR_TEST),e.stencilFunc(e.ALWAYS,0,1),e.stencilMask(255),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.disable(e.STENCIL_TEST),e.bindTexture(e.TEXTURE_2D,null),e.bindTexture(e.TEXTURE_CUBE_MAP,null),e.pixelStorei(e.PACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.BROWSER_DEFAULT_WEBGL),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),e.viewport(this.old_VIEWPORT[0],this.old_VIEWPORT[1],this.old_VIEWPORT[2],this.old_VIEWPORT[3]);for(var t=0;t<2;t++)e.disableVertexAttribArray(t)}else M.Error(591663578,"Trying to set default without Init")},e.prototype.restore=function(){var e=this.gl;if(e){var t=this.old;if(this.webGLRestoreToDefault)this.setDefaults();else{e.activeTexture(t[0]),e.bindBuffer(e.ARRAY_BUFFER,t[1]),t[2]?e.enable(e.BLEND):e.disable(e.BLEND);var r=t[3];e.blendColor(r[0],r[1],r[2],r[3]),e.blendEquationSeparate(t[7],t[6]),e.blendFuncSeparate(t[9],t[5],t[8],t[4]);var i=t[10];e.clearColor(i[0],i[1],i[2],i[3]);var n=t[11];e.colorMask(n[0],n[1],n[2],n[3]),t[12]?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),e.cullFace(t[13]),e.useProgram(t[14]),e.clearDepth(t[15]),e.depthFunc(t[16]),e.depthRange(t[17][0],t[17][1]),t[18]?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),e.depthMask(t[19]),t[20]?e.enable(e.DITHER):e.disable(e.DITHER),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t[21]),e.bindFramebuffer(e.FRAMEBUFFER,t[22]),e.frontFace(t[23]),e.hint(e.GENERATE_MIPMAP_HINT,t[24]),e.lineWidth(t[25]),e.pixelStorei(e.PACK_ALIGNMENT,t[26]),e.polygonOffset(t[27],t[29]),t[28]?e.enable(e.POLYGON_OFFSET_FILL):e.disable(e.POLYGON_OFFSET_FILL),e.bindRenderbuffer(e.RENDERBUFFER,t[30]),e.sampleCoverage(t[32],t[31]);var o=t[33];e.scissor(o[0],o[1],o[2],o[3]),t[34]?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST),e.stencilFuncSeparate(e.FRONT,t[44],t[47],t[49]),e.stencilFuncSeparate(e.BACK,t[36],t[39],t[40]),e.stencilMaskSeparate(e.FRONT,t[50]),e.stencilMaskSeparate(e.BACK,t[41]),e.stencilOpSeparate(e.FRONT,t[43],t[45],t[46]),e.stencilOpSeparate(e.BACK,t[35],t[37],t[38]),e.clearStencil(t[42]),t[48]?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),e.bindTexture(e.TEXTURE_2D,t[51]),e.bindTexture(e.TEXTURE_CUBE_MAP,t[52]),e.pixelStorei(e.UNPACK_ALIGNMENT,t[53]),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,t[54]),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t[55]),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t[56]),e.viewport(this.old_VIEWPORT[0],this.old_VIEWPORT[1],this.old_VIEWPORT[2],this.old_VIEWPORT[3]);for(var s=0;s<2;s++)this.old_VERTEX_ATTRIB_ARRAY_ENABLED[s]?e.enableVertexAttribArray(s):e.disableVertexAttribArray(s)}this.gl=void 0}else M.Error(591663579,"Trying to Restore without Init")},e}();class Xi{sendTraceTag(e,t,r,i){10===r?(0,u.H)(e,2503,i):(0,u.PN)(e,2503,i)}shipAssertTag(e,t,r,i){r&&(0,u.H)(e,2503,i)}debugAssertTag(e,t,r,i){r&&(0,u.H)(e,2503,i)}}class Ki{get webGLContext(){return this._webGLContext}constructor(e){var t,r;this._isRendererReady=!1,this._webGLContextRestoredStartTime=0,this._webGLContextLostStartTime=0,this.handleContextNotRestored=()=>{this._webGLContextLostStartTime>this._webGLContextRestoredStartTime&&(0,u.H)(0,2503,"webglcontext not restored after 3seconds")},(0,u.PN)(0,2503,"ShapeBuilderContext ctor"),t=new Xi,M.setLogger(t),this._shapeBuilderConfig=e,this._renderer=(void 0===(r={stateRestorer:(!0,new qi(!0))})&&(r={}),function(e){return void 0===e&&(e={}),new Oi(e)}(r))}async setupWebGLContext(){const e=this.shapeBuilderConfig.webGLCanvas,t={preserveDrawingBuffer:this.shapeBuilderConfig.preserveDrawingBuffer};let r=e.getContext("webgl",t);return r=void 0!==r?r:e.getContext("experimental-webgl",t),this._webGLContext=r,this._webGLContextRestoredStartTime=performance.now(),this.preloadShaders(r)}handleContextLost(){this._webGLContextLostStartTime=performance.now(),(0,u.PN)(0,2503,"webgl context is lost."),this._isRendererReady=!1,this._renderer.onWebGLContextLost(),this._webGLContext=void 0,window.setTimeout(this.handleContextNotRestored,3e3),this._shapeBuilderConfig.webGLContextLostHandler.onWebGLContextLost()}async handleContextRestored(){this._webGLContextRestoredStartTime=performance.now();const e=this._webGLContextRestoredStartTime-this._webGLContextLostStartTime;(0,u.PN)(0,2503,`webgl context is being restored. ${e}MS`),await this.setupWebGLContext(),void 0===this._webGLContext?(0,u.H)(0,2503,"unable to restore webGLContext"):this._shapeBuilderConfig.webGLContextLostHandler.onWebGLContextRestored();const t=performance.now();(0,u.PN)(0,2503,`webglcontext restored successfully. ${t-this._webGLContextRestoredStartTime}MS`)}getScenePerformanceSummaryAsMap(){var e;const t=(null===(e=this.renderer)||void 0===e?void 0:e.getPerformanceSummary()).perfInfoCurrentFrame;return new Map(Object.entries(null!=t?t:{}))}async preloadShaders(e){void 0===e&&(0,u.H)(0,2503,"webglcontext is undefined");const t=new d("ShapeBuilderContext.preloadShaders"),r=performance.now();try{await this._renderer.initializeAsync(e),this._isRendererReady=!0}catch(e){(0,u.H)(0,2503,`exception in preloadshaders: ${e.message}`)}finally{t.setProp("shaderCompilationDurationMilliseconds",performance.now()-r),t.complete()}}get shapeBuilderConfig(){return this._shapeBuilderConfig}get renderer(){return this._renderer}get isRendererReady(){return this._isRendererReady}get activeMultiplexRenderTarget(){return this._activeMultiplexRenderTarget}set activeMultiplexRenderTarget(e){if(void 0===e)throw new Error("Cannot set an undefined render target");this._activeMultiplexRenderTarget=e}}class Yi{constructor(){this.extendedProperties=new Map}}let $i={logKpiUsage(){},logKpiSuccess(){},logKpiFailure(){}};function Zi(e){$i=e}function Ji(e,t=new Map,r="gc2kpi"){$i.logKpiUsage(e,0,t,r)}let Qi={logVeto(){}};class en{constructor(e){this.pptLogger=e}logKpiUsage(e,t,r,i){this.pptLogger.recordKpiUsage(e,t,i,r)}logKpiSuccess(e,t){this.pptLogger.recordKpiSuccess(e,t)}logKpiFailure(e,t,r,i,n){this.pptLogger.recordKpiFailure(e,t,r,i,n)}}var tn=n(4591);class rn{constructor(e){this.pptLogger=e}logOperation(e){this.pptLogger.logTrace(0,2,2,function(e){const t={name:e.name,durationMs:e.durationMs.toString()};if(void 0!==e.props)for(const r of e.props)t[r[0]]=r[1];return JSON.stringify(t)}(e))}logTrace(e){this.pptLogger.logTrace(e.id,function(e){switch(e){case 55002:default:return 0;case 55e3:return 1;case 55001:return 2}}(e.category),function(e){switch(e){case 0:return 0;case 1:return 1;case 2:return 2;case 3:return 3;default:(0,tn.t)(e)}}(e.level),e.message)}}var nn=n(9946);class on{}class sn{constructor(e=[],t=[],r=[]){this.type=on,this.added=e,this.removed=t,this.changed=r}}class an{}class ln{constructor(e){this.type=an,this.modelUpdated=new nn.p,this.graphics=[],this.minIndex=0,this.idToGraphic=new Map,this.hostContext=e}get length(){return this.graphics.length}getGraphic(e){return this.idToGraphic.get(e)}getGraphicAt(e){return this.graphics[e]}setMinIndex(e){this.minIndex=e}addGraphicsAt(e){const t=[];for(const[r,i]of e)this.idToGraphic.has(r.id)||(this.graphics.splice(i,0,r),this.idToGraphic.set(r.id,r),t.push(r));this.modelUpdated.emit(new sn(t))}addGraphics(e){const t=e.filter((e=>!this.idToGraphic.has(e.id)));if(!(t.length<=0)){for(const e of t)this.graphics.push(e),this.idToGraphic.set(e.id,e);this.modelUpdated.emit(new sn(t))}}removeGraphics(e){const t=e.filter((e=>this.idToGraphic.delete(e.id)));if(t.length<=0)return;const r=new Set(t);this.graphics=this.graphics.filter((e=>!r.has(e))),this.modelUpdated.emit(new sn([],t))}setGraphics(e){const t=this.graphics;this.graphics=[],this.idToGraphic.clear();for(const t of e)this.graphics.push(t),this.idToGraphic.set(t.id,t);return(t.length>0||e.length>0)&&this.modelUpdated.emit(new sn([...e],t)),t}changeGraphicOrder(e,t){const r=this.getGraphicOrder(e);if(void 0===r)return;let i;switch(t){case 0:i=Math.min(r+1,this.graphics.length-1);break;case 1:i=this.graphics.length-1;break;case 2:i=Math.max(r-1,this.minIndex);break;case 3:i=this.minIndex;break;default:(0,tn.t)(t)}return r!==i&&(this.graphics.splice(r,1),this.graphics.splice(i,0,e),this.modelUpdated.emit(new sn([],[],[e]))),r}getGraphicOrder(e){if(this.idToGraphic.has(e.id))return this.graphics.indexOf(e)}setGraphicOrder(e,t){const r=this.getGraphicOrder(e);if(void 0!==r)return r!==t&&(this.graphics.splice(r,1),this.graphics.splice(t,0,e),this.modelUpdated.emit(new sn([],[],[e]))),r}[Symbol.iterator](){return this.graphics[Symbol.iterator]()}clone(e=(e=>e.id)){const t=new ln(this.hostContext);return t.graphics=this.graphics.map((t=>t.clone(e(t)))),t.minIndex=this.minIndex,t.graphics.forEach((e=>{t.idToGraphic.set(e.id,e)})),t}}class hn{get themeInfo(){return this._themeInfo}set themeInfo(e){this._themeInfo=e,this.modelHostContextUpdated.emit([0])}constructor(e){this.modelHostContextUpdated=new nn.p,this.themeInfo=e}}class cn{}class un{constructor(e=new a.A){this.type=cn,this.anchorUpdated=new nn.p,this._transform=e}get transform(){return this._transform}set transform(e){this._transform=e,this.anchorUpdated.emit()}setTransform(e,t){this._transform=e,this.anchorUpdated.emit(t)}clone(){const e=new un(this._transform.clone());return e.locks=void 0!==this.locks?Object.assign({},this.locks):void 0,e}}class dn{constructor(){this.combinedScaleChanged=new nn.p,this.viewTransformChanged=new nn.p,this._zoomFactor=1,this._lastCombinedScale=1,this._lastViewTransform=new a.A}set zoomFactor(e){const t=e*this.deviceScaleFactor;this._zoomFactor=e,this._lastCombinedScale!==t&&(this._lastCombinedScale=t,this.combinedScaleChanged.emit())}get zoomFactor(){return this._zoomFactor}get combinedScale(){return this.zoomFactor*this.deviceScaleFactor}get deviceScaleFactor(){return 1/window.devicePixelRatio}get viewTransform(){return this._lastViewTransform}set viewTransform(e){this._lastViewTransform.equals(e)||(this._lastViewTransform=e.clone(),this.viewTransformChanged.emit())}}var pn=n(2661);class fn extends pn.B{createRenderDataPresenter(e,t,r){void 0===e.model.fallbackRenderData&&(0,l._)(3,"Trying to create RenderDataPresenter without fallback RenderData.");const i=this.get(e.model.fallbackRenderData.type);return void 0===i&&(0,l._)(3,`No RenderDataPresenterCreator for render data type: ${e.model.fallbackRenderData.type}`),i(e,t,r)}}class gn{constructor(){this.viewReady=new nn.p,this.pendingPresenters=new Set}addPending(e){const t=0===this.pendingPresenters.size;this.pendingPresenters.add(e),t&&this.viewReady.emit(!1)}removePending(e){this.pendingPresenters.delete(e),0===this.pendingPresenters.size&&this.viewReady.emit(!0)}teardown(){this.pendingPresenters.clear()}}class mn extends pn.B{createPresenter(e,t,r){const i=this.get(e.model.type);return void 0===i&&(0,l._)(3,`No PresenterCreator for modeltype: ${e.model.type}`),i(e,t,r)}}class vn extends pn.B{createAnchorPresenter(e){const t=this.get(e.anchor.type);return void 0===t&&(0,l._)(3,`No AnchorPresenterCreator for AnchorType: ${e.anchor.type}`),t(e)}}class yn extends pn.o{beginRender(){for(const e of this)e.beginRender()}endRender(){for(const e of this)e.endRender()}addViewModel(e,t){var r;if(null===(r=this.filter)||void 0===r?void 0:r.filter(e))return;const i=this.get(e.type);void 0===i&&(0,l._)(3,`No registered RenderTarget for ViewModel type: ${e.type}`),i.addViewModel(e,t)}beginGroup(e){for(const t of this)t.beginGroup(e)}endGroup(){for(const e of this)e.endGroup()}hitTest(e){for(const t of this){const r=t.hitTest(e);if(void 0!==r)return r}}}class _n extends pn.B{createSelection(e){const t=this.get(e.model.type);if(void 0===t)throw new Error(`Can't create selection for graphic: ${e.model.type}`);return t(e)}registerForType(e,t){this.register(e,t)}}class bn extends pn.B{createSelectionPresenter(e,t,r){const i=this.get(e.type);if(void 0===i)throw new Error(`Can't create presenter for selection: ${e.type}`);return i(e,t,r)}}class Tn{constructor(e,t=[]){this.performed=e,this.editOps=t}}class wn extends pn.B{processKeyboardEvent(e,t,r){const i=this.get(t.type);return void 0===i?{isHandled:!1}:i.keyboardEventProcessor(e,t,r)}performAction(e,t,r){const i=this.get(t.type);return void 0===i?new Tn(!1):i.actionPerformer(e,t,r)}}class xn extends pn.B{createAriaLabel(e){const t=this.get(e.model.type);if(void 0!==t)return t(e)}}class Cn{constructor(e,t,r){this.id=e,this.model=t,this.anchor=r}clone(e){return new Cn(e,this.model.clone(),this.anchor.clone())}}function Sn(e){const t=[];for(const r of e)t.push(r.perform().undoOp);return t.reverse()}class Pn{}class En{constructor(){this.type=Pn}}class Mn{constructor(e,t,r,i,n,o){this.onKeyboardEvent=(e,t)=>{let r=this.editContext.editorRegistry.processKeyboardEvent(e,this.selection,this.editContext).isHandled;r||void 0===this.keyboardEventProcessor||(r=this.keyboardEventProcessor(e,this.selection,this.editContext).isHandled),t.isHandled=r,t.isHandled&&(e.preventDefault(),e.stopPropagation())},this.graphic=e,this.keyboardEventProcessor=o,this.keyboardEventNotifiers=i,this.editContext={editorRegistry:t,actionInvoker:r,previewInfo:n},this.keyboardEventNotifiers.keydown.on(this.onKeyboardEvent),this.keyboardEventNotifiers.keyup.on(this.onKeyboardEvent)}teardown(){this.selection.teardown(),this.keyboardEventNotifiers.keydown.off(this.onKeyboardEvent),this.keyboardEventNotifiers.keyup.off(this.onKeyboardEvent)}performAction(e){return function(e,t,r,i){var n;const o=t.save();Ji("GC2ActionPerformed",new Map([["ActionName",e.actionType]]));const s=function(e){return"acLst"===e.actionType}(e)?e.actions:[e],a=[];for(const e of s)a.push(...i(e,t,r).editOps);const l=Sn(a),h=t.save();return{editOps:l,savedSelectionBefore:null!=o?o:new En,savedSelectionAfter:null!=h?h:new En,mergePolicy:null===(n=a[0])||void 0===n?void 0:n.mergePolicy}}(e,this.selection,this.editContext,this.editContext.editorRegistry.performAction.bind(this.editContext.editorRegistry))}performUndoEntry(e){const t={editOps:Sn(e.editOps),savedSelectionBefore:e.savedSelectionAfter,savedSelectionAfter:e.savedSelectionBefore};return this.selection.restore(e.savedSelectionBefore),t}resetGraphicAndSelection(e,t){this.graphic=e,this.selection=t}}function Rn(e,t){e.forEach((e=>{e.addTimePoint(t)}))}class An{constructor(e,t){this.startTimeMs=0,this.causation=e,this.trackers=t,this.startTimeMs=performance.now()}complete(){const e=Math.max(performance.now()-this.startTimeMs,0);this.trackers.forEach((t=>{t.addEventContext(this.causation,e)}))}}const In="View.Render";class Fn{constructor(){this.looping=!1,this.loopingId=-1,this.onceId=-1}start(e){const t=()=>{e(),this.looping?this.loopingId=window.requestAnimationFrame(t):this.loopingId=-1};this.looping=!0,-1!==this.loopingId&&window.cancelAnimationFrame(this.loopingId),this.loopingId=window.requestAnimationFrame(t)}stop(){this.looping=!1}runOnce(e){-1!==this.onceId||this.looping||(this.onceId=window.requestAnimationFrame((()=>{e(),this.onceId=-1})))}stopOnce(){-1!==this.onceId&&(window.cancelAnimationFrame(this.onceId),this.onceId=-1)}}class Bn{constructor(e,t,r,i,n,o,s,a,l,h,c={createAriaLabel:()=>{}},u){this.renderLoop=new Fn,this.eventChainTrackersList=[],this.viewScale=new dn,this.onViewModelUpdated=e=>{null==e||e.addTimePoint("ViewModelUpdatedEventReceivedTime"),this.invalidate((()=>{this.render()}),e)},this.renderTargetRegistry=n,this.viewScale=o,this.viewReadyTracker=s,this.frameRendered=a,this.registerViewModelUpdatedListener=l,this.graphic=e,this.anchorPresenter=i.createAnchorPresenter(this.graphic),this.presenterContext={anchorPresenter:this.anchorPresenter,viewScale:this.viewScale,viewReadyTracker:this.viewReadyTracker,renderDataPresenterCreator:r,ariaLabelCreator:c,highContrastModeInfo:u},this.presenterCreator=t,this.editContext=h,this.presenter=this.presenterCreator.createPresenter(this.graphic,this.presenterContext,this.editContext),this.registerViewModelUpdatedListener&&this.presenter.viewModelUpdated.on(this.onViewModelUpdated)}start(){this.renderLoop.runOnce((()=>{this.render()}))}teardown(){this.renderLoop.stopOnce(),this.registerViewModelUpdatedListener&&this.presenter.viewModelUpdated.off(this.onViewModelUpdated),this.presenter.teardown(),this.anchorPresenter.teardown(),this.clear()}render(e){void 0!==e&&(this.eventChainTrackersList.push(e),e.addTimePoint("ViewControllerRenderStartTime")),this.renderViewModels((()=>{const e=this.presenter.viewModel;this.renderTargetRegistry.addViewModel(e)})),null==e||e.addTimePoint("ViewControllerRenderEndTime")}clear(){this.renderViewModels((()=>{}))}invalidate(e,t){this.renderLoop.runOnce(e),void 0!==t&&this.eventChainTrackersList.push(t)}recreatePresenter(e){this.graphic=e,this.presenter=this.presenterCreator.createPresenter(this.graphic,this.presenterContext,this.editContext)}resetPresenter(e,t){this.graphic=e,this.presenter=t}renderViewModels(e){Rn(this.eventChainTrackersList,"ViewControllerRenderViewModelsStartTime");const t=new d(In);try{const r=new An("ViewController_Render",this.eventChainTrackersList);try{this.renderTargetRegistry.beginRender(),e(),this.renderTargetRegistry.endRender()}catch(e){throw(0,u.H)(0,5e4,`Exception: ${e.message}`),e}finally{r.complete()}Rn(this.eventChainTrackersList,"FrameRenderedEventEmittedTime"),this.frameRendered.emit(this.eventChainTrackersList.slice()),Rn(this.eventChainTrackersList,"ViewControllerRenderViewModelsEndTime"),this.eventChainTrackersList.splice(0)}finally{t.complete()}}}class Ln{constructor(){this.viewModels=[]}filter(e){return-1!==this.viewModels.indexOf(e)}}class Dn{constructor(e,t,r,i,n,o,s,a,l,h,c,u,d,p){this.viewDirty=!0,this.onViewModelUpdated=e=>{null==e||e.addTimePoint("ViewModelUpdatedEventReceivedTime"),this.invalidate(e)},this.onEditPreviewEvent=e=>{0===e?(this.editPreviewFilter.viewModels.push(this.selectionPresenter.viewModel),this.viewController.renderLoop.start((()=>{this.render()}))):(this.editPreviewFilter.viewModels.splice(0),this.viewController.renderLoop.stop())},this.frameRendered=l,this.viewController=new Bn(e,t,r,i,n,o,s,l,!1,a.editContext,u,d),this.viewController.presenter.viewModelUpdated.on(this.onViewModelUpdated),this.editController=a,this.renderOnlyWhenDirty=!0===p,this.editPreviewFilter=new Ln,this.viewController.renderTargetRegistry.filter=this.editPreviewFilter,this.editController.selection=h.createSelection(e),this.selectionPresenter=c.createSelectionPresenter(this.editController.selection,{anchorPresenter:this.viewController.anchorPresenter,viewScale:this.viewController.viewScale,viewReadyTracker:this.viewController.viewReadyTracker,renderDataPresenterCreator:r,ariaLabelCreator:u,modelPresenter:this.viewController.presenter,selectionPresenterCreator:c},this.editController.editContext),this.selectionPresenter.viewModelUpdated.on(this.onViewModelUpdated),void 0!==this.editController.editContext.previewInfo?(this.editController.editContext.previewInfo.presenter.notifier.on(this.onEditPreviewEvent),this.renderOnlyWhenDirty&&this.editController.editContext.previewInfo.presenter.viewModelUpdated.on(this.onViewModelUpdated),this.editPreviewRenderTargetRegistry=this.editController.editContext.previewInfo.renderTargetRegistry):this.editPreviewRenderTargetRegistry=new yn([])}start(){this.viewController.renderLoop.runOnce((()=>{this.render()}))}teardown(){this.viewController.presenter.viewModelUpdated.off(this.onViewModelUpdated),this.selectionPresenter.viewModelUpdated.off(this.onViewModelUpdated),this.selectionPresenter.teardown(),void 0!==this.editController.editContext.previewInfo&&(this.renderOnlyWhenDirty&&this.editController.editContext.previewInfo.presenter.viewModelUpdated.off(this.onViewModelUpdated),this.editController.editContext.previewInfo.presenter.notifier.off(this.onEditPreviewEvent)),this.viewController.renderTargetRegistry.filter=void 0,this.viewController.teardown(),this.clear(),this.editController.teardown()}render(e){this.renderOnlyWhenDirty&&!this.viewDirty||(void 0!==e&&(this.viewController.eventChainTrackersList.push(e),e.addTimePoint("EditViewControllerRenderStartTime")),this.renderViewModels((()=>{const e=this.viewController.presenter.viewModel;if(this.viewController.renderTargetRegistry.addViewModel(e,1),!this.editController.editContext.isInLivePreview){const e=this.selectionPresenter.viewModel;this.viewController.renderTargetRegistry.addViewModel(e,0);const t=this.editController.editContext.previewInfo;void 0!==t&&this.editPreviewRenderTargetRegistry.addViewModel(t.presenter.viewModel,2)}})),void 0!==e&&e.addTimePoint("EditViewControllerRenderEndTime"),this.viewDirty=!1)}invalidate(e){this.viewDirty=!0,this.viewController.invalidate((()=>{this.render()}),e)}prepareForLivePreview(){this.savedRootInfo={rootGraphic:this.editController.graphic,rootPresenter:this.viewController.presenter,rootSelection:this.editController.selection};const e=this.savedRootInfo.rootGraphic.clone(this.savedRootInfo.rootGraphic.id);this.editController.resetGraphicAndSelection(e,this.editController.selection.clone(e)),this.viewController.recreatePresenter(e),this.viewController.presenter.viewModelUpdated.on(this.onViewModelUpdated),this.invalidate()}restoreFromLivePreview(){var e,t,r,i;this.viewController.presenter.viewModelUpdated.off(this.onViewModelUpdated),this.viewController.presenter.teardown(),this.editController.selection.teardown(),this.editController.resetGraphicAndSelection(null===(e=this.savedRootInfo)||void 0===e?void 0:e.rootGraphic,null===(t=this.savedRootInfo)||void 0===t?void 0:t.rootSelection),this.viewController.resetPresenter(null===(r=this.savedRootInfo)||void 0===r?void 0:r.rootGraphic,null===(i=this.savedRootInfo)||void 0===i?void 0:i.rootPresenter),this.invalidate()}renderViewModels(e){const t=new d(In);try{Rn(this.viewController.eventChainTrackersList,"EditViewControllerRenderViewModelsStartTime");const r=new An("EditViewController_Render",this.viewController.eventChainTrackersList);try{this.viewController.renderTargetRegistry.beginRender(),this.editPreviewRenderTargetRegistry.beginRender(),e(),this.viewController.renderTargetRegistry.endRender(),this.editPreviewRenderTargetRegistry.endRender()}catch(e){throw(0,u.H)(0,5e4,`Exception: ${e.message}`),e}finally{r.complete()}Rn(this.viewController.eventChainTrackersList,"FrameRenderedEventEmittedTime"),this.frameRendered.emit(this.viewController.eventChainTrackersList.slice()),Rn(this.viewController.eventChainTrackersList,"EditViewControllerRenderViewModelsEndTime"),this.viewController.eventChainTrackersList.splice(0)}finally{t.complete()}}clear(){this.renderViewModels((()=>{}))}}class kn{get presenter(){return this.editViewController.viewController.presenter}get editContext(){return this.editController.editContext}get selection(){return this.editController.selection}get selectionPresenter(){return this.editViewController.selectionPresenter}constructor(e){var t;this.frameRendered=new nn.p,this.viewScale=new dn,this.renderDataPresenterCreatorRegistry=new fn([]),this.viewReadyTracker=new gn,this.presenterCreatorRegistry=new mn(e.presenterCreatorEntries),this.anchorPresenterCreatorRegistry=new vn(e.anchorPresenterCreatorEntries),this.renderTargetRegistry=new yn(e.renderTargetEntries),this.editPreviewInfo=e.editPreviewInfo,this.actionInvoker=e.actionInvoker,this.selectionCreatorRegistry=new _n([]),e.selectionCreatorRegistrars.forEach((e=>{e(this.selectionCreatorRegistry)})),this.selectionPresenterCreatorRegistry=new bn(e.selectionPresenterCreatorEntries),this.editorRegistry=new wn(e.editorRegistryEntries),this.keyboardEventNotifiers=e.keyboardEventNotifiers,this.keyboardEventProcessor=e.keyboardEventProcessor,this.ariaLabelCreatorRegistry=new xn(null!==(t=e.ariaLabelCreatorRegistryEntries)&&void 0!==t?t:[]),this.highContrastModeInfo=e.highContrastModeInfo,this.renderOnlyWhenDirty=e.renderOnlyWhenDirty}start(e,t){const r=new Cn("root",e,t);this.editController=new Mn(r,this.editorRegistry,this.actionInvoker,this.keyboardEventNotifiers,this.editPreviewInfo,this.keyboardEventProcessor),this.editViewController=new Dn(r,this.presenterCreatorRegistry,this.renderDataPresenterCreatorRegistry,this.anchorPresenterCreatorRegistry,this.renderTargetRegistry,this.viewScale,this.viewReadyTracker,this.editController,this.frameRendered,this.selectionCreatorRegistry,this.selectionPresenterCreatorRegistry,this.ariaLabelCreatorRegistry,this.highContrastModeInfo,this.renderOnlyWhenDirty),this.editViewController.start()}teardown(){void 0!==this.editViewController&&this.editViewController.teardown()}performAction(e){return this.editController.performAction(e)}performUndoEntry(e){return this.editController.performUndoEntry(e)}invalidate(e){this.editViewController.invalidate(e)}startLivePreview(){}endLivePreview(){}}class On{constructor(e){this.endTimeMs=0,this.startTimeMs=0,this.durationMs=0,this.eventContextHistoryMap=new Map,this.timePoints=[],this.name=e}start(){this.startTimeMs=performance.now()}end(){this.endTimeMs=performance.now(),this.durationMs=Math.max(this.endTimeMs-this.startTimeMs,0)}addEventContext(e,t){this.eventContextHistoryMap.set(e,t)}addTimePoint(e){this.timePoints.push({name:e,timestamp:performance.now()})}addEventToContextHistoryMap(e,t){void 0!==t?this.eventContextHistoryMap.set(e,t):this.eventContextHistoryMap.set(e,NaN)}getEventDurationStringsMap(e){const t=new Map;return this.eventContextHistoryMap.set(`${this.name}DurationMs`,this.durationMs),this.eventContextHistoryMap.forEach(((r,i)=>{t.set(i,r.toFixed(e))})),t}getTimePointCollectionString(e){if(this.timePoints.length>0){const t=this.timePoints[0].timestamp;this.timePoints.forEach((r=>{r.timestamp-=t,r.timestamp=parseFloat(r.timestamp.toFixed(e))}))}return JSON.stringify(this.timePoints)}}class Un{constructor(e,t){this.canvasElement=e,this.renderer=t;const r=this.canvasElement.getContext("2d");null===r&&(0,l._)(4,"No 2D context"),this.renderingContext=r}beginRender(){this.renderingContext.clearRect(0,0,this.canvasElement.width,this.canvasElement.height)}addViewModel(e){this.displayCanvasElement(),this.renderer.renderViewModel(e,this)}endRender(){}hitTest(e){}beginGroup(e){}endGroup(){}displayCanvasElement(){this.canvasElement.style.display=""}}function Nn(e,t,r,i,n){const o=r.size.width/e.width(),a=r.size.height/e.height(),l=t.width()*o*i,h=t.height()*a*i,c=(t.left-e.left)*o,u=(t.top-e.top)*a,d=(c+r.pos.x)*i,p=(u+r.pos.y)*i;return void 0!==n&&(n.setProp("left",d),n.setProp("top",p),n.setProp("width",l),n.setProp("height",h),n.setProp("scaleFactor",i),n.setProp("scaleX",o),n.setProp("scaleY",a)),new s.U(d,p,d+l,p+h)}function Vn(e,t,r){const i=t.getContext("2d");null===i&&(0,l._)(4,"No 2D context"),t.width=Gn(e.width),t.height=Gn(e.height),t.style.position="relative";let n="",o="",s="",a="";if(void 0!==r)n=`${r.width()}px`,o=`${r.height()}px`,s=`${r.left}px`,a=`${r.top}px`;else{const t=e;n=t.style.width,o=t.style.height,s=t.style.left,a=t.style.top}t.style.width=n,t.style.height=o,t.style.left=s,t.style.top=a,0!==t.width&&0!==t.height&&(i.drawImage(e,0,0),(0,u._v)(0,4,"drawCanvasImageSourceToCanvas: Image drawn"))}function Gn(e){if("number"==typeof e)return e;(0,l._)(4,"SVGAnimatedLength not supported")}var zn=n(1459);function Wn(e,t,r,i,n,o){let s=e.transform.size.width/e.sourceAnchorBounds.width();s=isNaN(s)?1:s;let a=e.transform.size.height/e.sourceAnchorBounds.height();a=isNaN(a)?1:a;const l=new g(s,a).scale(e.scaleFactor*window.devicePixelRatio),h=t.size.multiply(l),c=new g(Math.min(h.x,r),Math.min(h.y,r)),u=l.multiply(new g(c.x/h.x,c.y/h.y));i.width=Math.ceil(c.x),i.height=Math.ceil(c.y);const d=new y(t.center.negate(),u,void 0,c.divide(new g(2,2))),p=window.screen.width*devicePixelRatio*window.screen.height*devicePixelRatio;return function(e,t=2073600,r=2){Ot(function(e,t=2073600,r=2){if(0===e)return 1;let i=Math.sqrt(t/e);return e>t&&(i=Math.sqrt(i)),i=Math.min(i,r),0!==window.devicePixelRatio&&(i*=window.devicePixelRatio),i}(e,t,r))}(p),f=e.emuToSourceScale,B(function(e){const t=0===e.x?1:1/e.x,r=0===e.y?1:1/e.y;return Math.max(t,r)}(u),function(e){return 2*zn.AF*e}(f)),n.render(e.scene,ne.Transparent,{transform:d}),function(e,t,r,i,n,o,s,a,l,h,c,u){void 0!==u&&(u.setProp("anchorScaleX",e),u.setProp("anchorScaleY",t),u.setProp("scaleFactor",r),u.setProp("devicePixelRatio",window.devicePixelRatio),u.setProp("sceneWidth",n.x),u.setProp("sceneHeight",n.y),u.setProp("maxCanvasDimensionPhyPx",i),u.setProp("cappedSceneWidth",o.x),u.setProp("cappedSceneHeight",o.y),u.setProp("combinedScaleX",s.x),u.setProp("combinedScaleY",s.y),u.setProp("cappedCombinedScaleX",a.x),u.setProp("cappedCombinedScaleY",a.y),u.setProp("totalPhysicalPixels",l),u.setProp("emuToSourceScale",h),u.setProp("renderTransformPreTranslationX",c.preTranslation.x),u.setProp("renderTransformPreTranslationY",c.preTranslation.y),u.setProp("renderTransformRotation",c.rotation),u.setProp("renderTransformScaleX",c.scale.x),u.setProp("renderTransformScaleY",c.scale.y),u.setProp("renderTransformTranslationX",c.translation.x),u.setProp("renderTransformTranslationY",c.translation.y))}(s,a,e.scaleFactor,r,h,c,l,u,p,e.emuToSourceScale,d,o),new g(Math.ceil(h.x)/window.devicePixelRatio,Math.ceil(h.y)/window.devicePixelRatio);var f}class Hn{constructor(){this.elementToViewModel=new Map}setViewModel(e,t){this.elementToViewModel.set(e,t)}getViewModel(e){return this.elementToViewModel.get(e)}clear(){this.elementToViewModel.clear()}}function jn(e,t){e.target.style.cursor=t}class qn{constructor(e,t){this.onPointerDown=(e,t)=>{if(void 0!==this.inDrag)return;const r=this.viewModelHitTester.hitTest(e);void 0!==r?(this.inDrag={viewModel:r},r.pointerEventNotifiers.pointerdown.value.emit(e,t)):(this.inDrag={},jn(e,"auto"),this.unHitPointerEventNotifiers.pointerdown.value.emit(e,t))},this.onPointerMove=(e,t)=>{const r=void 0!==this.inDrag?this.inDrag.viewModel:this.viewModelHitTester.hitTest(e);this.generateOverOutEvent(e,r),void 0!==r?r.pointerEventNotifiers.pointermove.value.emit(e,t):(jn(e,"auto"),this.unHitPointerEventNotifiers.pointermove.value.emit(e,t))},this.onPointerUp=(e,t)=>{const r=void 0!==this.inDrag?this.inDrag.viewModel:this.viewModelHitTester.hitTest(e);void 0!==r?r.pointerEventNotifiers.pointerup.value.emit(e,t):(jn(e,"auto"),this.unHitPointerEventNotifiers.pointerup.value.emit(e,t)),this.inDrag=void 0},this.onPointerCancel=(e,t)=>{const r=void 0!==this.inDrag?this.inDrag.viewModel:this.viewModelHitTester.hitTest(e);void 0!==r?r.pointerEventNotifiers.pointercancel.value.emit(e,t):(jn(e,"auto"),this.unHitPointerEventNotifiers.pointercancel.value.emit(e,t)),this.inDrag=void 0},this.viewModelHitTester=e,this.unHitPointerEventNotifiers=t}addEventListeners(e){e.pointerdown.value.on(this.onPointerDown),e.pointermove.value.on(this.onPointerMove),e.pointerup.value.on(this.onPointerUp),e.pointercancel.value.on(this.onPointerCancel)}removeEventListeners(e){e.pointerdown.value.off(this.onPointerDown),e.pointermove.value.off(this.onPointerMove),e.pointerup.value.off(this.onPointerUp),e.pointercancel.value.off(this.onPointerCancel)}generateOverOutEvent(e,t){var r,i,n;if(this.lastPointerMoveViewModel===t)return;const o=null!==(i=null===(r=this.lastPointerMoveViewModel)||void 0===r?void 0:r.pointerEventNotifiers)&&void 0!==i?i:this.unHitPointerEventNotifiers;o.pointerout.valid&&o.pointerout.value.emit(e,{isHandled:!1});const s=null!==(n=null==t?void 0:t.pointerEventNotifiers)&&void 0!==n?n:this.unHitPointerEventNotifiers;s.pointerover.valid&&s.pointerover.value.emit(e,{isHandled:!1}),this.lastPointerMoveViewModel=t}}var Xn=n(5069),Kn=n(5965);class Yn{constructor(e,t,r,i,n){this.hitTestMap=new Hn,this.shapeBuilderVM=new De,this.renderers=new pn.B([]),this.renderScope=0,this.groupRenderers=new pn.B([]),this.groupScope=[],this.animations=[],this.animateLoopId=-1,this.animationLoop=()=>{if(this.animateLoopId=-1,0!==this.animations.length){for(const e of this.animations)e();this.shapeBuilderRenderer.renderViewModel(this.shapeBuilderVM,this),this.animateLoopId=window.requestAnimationFrame(this.animationLoop)}},this.hitTestViewModel=e=>this.shapeBuilderRenderer.hitTest(e,this,this.shapeBuilderVM.scaleFactor),this.canvas=e,this.shapeBuilderRenderer=t,this.webglRenderingContext=function(e){let t=e.getContext("webgl2");if(null!==t)return t;if(t=e.getContext("webgl"),null===t)throw new Error("No WebGL Rendering Context");return t}(e),this.scene=new Se,this.graphicsScene=new Se,this.selectionScene=new Se,this.previewScene=new Se,this.rootScene=new Se([this.graphicsScene,this.selectionScene,this.previewScene]),this.pointerEventNotifiers=r,this.separateSelectionSceneFromGraphic=n,t.setWebGLContext(this.webglRenderingContext),new qn({hitTest:this.hitTestViewModel},i).addEventListeners(this.pointerEventNotifiers)}registerRenderer(e,t){return this.renderers.register(e,t),this}registerGroupRenderer(e,t){return this.groupRenderers.register(e,t),this}beginRender(){0===this.renderScope&&(this.shapeBuilderVM.clear(),this.hitTestMap.clear(),this.selectionScene.items.removeAll(),this.previewScene.items.removeAll(),this.animations=[]),this.renderScope+=1}addViewModel(e,t=1){const n=this.renderers.get(e.type);void 0!==n?n(e,this,t):function(e){return e.type===class{}}(e)?this.addShapeBuilderShapeViewModel(e,t):ke(e)?this.addShapeBuilderViewModel(e,t):function(e){return e.type===class{}}(e)?this.addShapeBuilderGeometryViewModel(e):e instanceof class{constructor(e){this.pointerEventNotifiers=(0,r.n)(),this.imageViewModelUpdated=new nn.p,this.hitTestSlop=i.Hr,this.bounds=new s.U(0,0,0,0),this.sourceAnchorBounds=new s.U(0,0,0,0),this.scaleFactor=1/window.devicePixelRatio,this.transform=new a.A,this.topLeftOffset=new Xn.S(0,0),this.scaleVector=new Xn.S(1,1),this.inCropMode=!1,this._data=e}get imageData(){return this._data}async setImageData(e){this._data=e}get opacity(){return this._opacity}set opacity(e){this._opacity=void 0===e?e:function(e,t,r){return Math.min(Math.max(e,0),100)}(e)}}&&this.addImageViewModel(e)}endRender(){if(this.renderScope-=1,0===this.renderScope){const e=new d("ShapeBuilderRenderTarget.Render");try{this.shapeBuilderRenderer.renderViewModel(this.shapeBuilderVM,this),this.animations.length>0&&-1===this.animateLoopId&&(this.animateLoopId=window.requestAnimationFrame(this.animationLoop))}finally{e.complete()}}}hitTestText(e){return this.shapeBuilderRenderer.hitTestText(e,this,this.shapeBuilderVM.scaleFactor)}hitTest(e){return this.shapeBuilderRenderer.hitTest(e,this,this.shapeBuilderVM.scaleFactor)}beginGroup(e){const t=this.groupRenderers.get(e.type);if(void 0===t)throw new Error("Failed to find GroupRenderer to render group");const r=t(e,this);this.groupScope.length>0&&this.groupScope[this.groupScope.length-1].items.push(r),this.groupScope.push(r)}endGroup(){const e=this.groupScope.pop();if(void 0===e)throw new Error("Mismatched begin/end group");0===this.groupScope.length&&this.addItemToShapeBuilder(e)}getScene(){return this.separateSelectionSceneFromGraphic?this.rootScene:this.scene}getGraphicsScene(){return this.graphicsScene}getSelectionScene(){return this.selectionScene}getPreviewScene(){return this.previewScene}getWebGLContext(){return this.webglRenderingContext}addAnimation(e){this.animations.push(e)}addShapeBuilderShapeViewModel(e,t){if(this.shapeBuilderRenderer.registerItem(e,e.shape),this.hitTestMap.setViewModel(e.shape,e),this.separateSelectionSceneFromGraphic)switch(t){case 1:this.addItemToShapeBuilder(e.shape);break;case 0:this.selectionScene.items.push(e.shape);break;case 2:this.previewScene.items.push(e.shape);break;default:(0,tn.t)(t)}else this.addItemToShapeBuilder(e.shape),0===t?this.selectionScene.items.push(e.shape):2===t&&this.previewScene.items.push(e.shape)}addShapeBuilderViewModel(e,t){const r=new Se;if(e.isHitTestOnly)e.scene.items.elements.forEach((t=>{this.shapeBuilderRenderer.registerItem(e,t),this.hitTestMap.setViewModel(t,e)}));else{if(e.scene.items.elements.forEach((t=>{this.shapeBuilderRenderer.registerItem(e,t),this.hitTestMap.setViewModel(t,e),r.items.push(t)})),r.transform=function(e){const t=e.sourceAnchorBounds.center(),r=new g(-t.x,-t.y);let i=1,n=0;0!==e.sourceAnchorBounds.width()&&(i=e.transform.size.width/e.sourceAnchorBounds.width(),n=e.transform.size.width/2);let o=1,s=0;return 0!==e.sourceAnchorBounds.height()&&(o=e.transform.size.height/e.sourceAnchorBounds.height(),s=e.transform.size.height/2),new y(r,new g(i,o),void 0,new g(n,s))}(e),this.separateSelectionSceneFromGraphic)switch(t){case 1:this.addItemToShapeBuilder(r),this.shapeBuilderVM.addTeardown((()=>{Be(r)}));break;case 0:this.selectionScene.items.push(e.scene);break;case 2:this.previewScene.items.push(e.scene);break;default:(0,tn.t)(t)}else this.addItemToShapeBuilder(r),this.shapeBuilderVM.addTeardown((()=>{Be(r)})),0===t?this.selectionScene.items.push(e.scene):2===t&&this.previewScene.items.push(e.scene);this.shapeBuilderVM.transform=e.transform,this.shapeBuilderVM.sourceAnchorBounds=new s.U(0,0,e.transform.size.width,e.transform.size.height),this.shapeBuilderVM.scaleFactor=e.scaleFactor,0!==e.emuToSourceScale&&(this.shapeBuilderVM.emuToSourceScale=e.emuToSourceScale)}this.shapeBuilderRenderer.registerItem(e,r)}addShapeBuilderGeometryViewModel(e){var t;this.shapeBuilderRenderer.registerItem(e,e.shape),this.hitTestMap.setViewModel(e.shape,e),this.addItemToShapeBuilder(e.shape);for(const{pictureDataViewModel:r,imageBrush:i}of e.pictureFillImageData){const e=null!==(t=r.imageData)&&void 0!==t?t:"";this.shapeBuilderRenderer.getOrGenerateImageTexture(e,(e=>{i.image=e}))}}addImageViewModel(e){const t=(0,Kn.m)(e.transform),r=Ce.CreateRectangle(new _(t.left,t.top,t.right,t.bottom));this.shapeBuilderRenderer.registerItem(e,r),this.shapeBuilderRenderer.attachImageViewModelTextureToItem(e,r),this.hitTestMap.setViewModel(r,e),this.addItemToShapeBuilder(r),this.shapeBuilderVM.addTeardown((()=>{r.clearCache()}))}addItemToShapeBuilder(e){0===this.groupScope.length?this.shapeBuilderVM.addItem(e):this.groupScope[this.groupScope.length-1].items.push(e)}}class $n{get webGLCanvas(){return this.shapeBuilderContext.shapeBuilderConfig.webGLCanvas}constructor(e){this.shapeBuilderContext=e}renderViewModel(e,t){var r;const i=new d("ShapeBuilderCanvas2DRenderer.renderViewModel");try{if(i.setProp("isRendererReady",`${this.shapeBuilderContext.isRendererReady}`),!this.shapeBuilderContext.isRendererReady)return;!function(e){if(!ke(e))throw new Error(`Expected ShapeBuilderViewModel but received type:${e.type}`)}(e);const n=e.scene.getBounds();if(void 0===n||n.isEmpty())return;t instanceof Yn&&(t.separateSelectionSceneFromGraphic?t.getGraphicsScene().setItems(e.scene.items):t.getScene().setItems(e.scene.items));const o=Wn(e,n,null!==(r=this.shapeBuilderContext.shapeBuilderConfig.maxWebGLCanvasDimensionPhyPx)&&void 0!==r?r:4096,this.webGLCanvas,this.shapeBuilderContext.renderer,i),a=function(e,t,r){const i=Nn(e.sourceAnchorBounds,void 0===(n=e.scene.getBounds())?new s.U(0,0,0,0):new s.U(n.left,n.top,n.right,n.bottom),e.transform,e.scaleFactor,r);var n;return i.right=i.left+t.width/window.devicePixelRatio,i.bottom=i.top+t.height/window.devicePixelRatio,i}(e,this.webGLCanvas,i);a.right=a.left+o.x,a.bottom=a.top+o.y,this.webGLCanvas.style.position="relative",this.webGLCanvas.style.width=`${a.width()}px`,this.webGLCanvas.style.height=`${a.height()}px`,this.webGLCanvas.style.left=`${a.left}px`,this.webGLCanvas.style.top=`${a.top}px`,t instanceof Un&&Vn(this.webGLCanvas,t.canvasElement,a)}finally{i.complete()}}hitTestText(e,t,r){}hitTest(e,t,r){if(t instanceof Yn){const i=new g(e.offsetX,e.offsetY);let n;void 0!==r&&(n=new y(void 0,new g(r,r)));const o=this.shapeBuilderContext.renderer.hitTestScene(t.getScene(),i,n);if(void 0===o.itemHit)return;let s=t.hitTestMap.getViewModel(o.itemHit);if(void 0===s&&void 0!==o.itemStack)for(const e of o.itemStack.reverse())if(s=t.hitTestMap.getViewModel(e),void 0!==s)break;return s}}registerItem(){}attachImageViewModelTextureToItem(){}getOrGenerateImageTexture(){}setWebGLContext(e){this.shapeBuilderContext.renderer.setWebGLContext(e)}updateTextureFromHTMLElement(){}}class Zn{constructor(e,t,r,i,n,o,s){this._renderTargetMode=0,this._skipPrepareWebGLCanvas=!0,this.shouldInvokeRenderTargetChangedCallback=!0,this.modeToRenderTargetMap=new Map,this.shapeBuilderContext=e,this.viewCanvas2D=i,this.pointerEventNotifiers=n,this.viewDiv=t,this.editDiv=r,this.shapeBuilderCanvas2DRenderer=new $n(e),this.modeToRenderTargetMap.set(0,new Un(this.viewCanvas2D,this.shapeBuilderCanvas2DRenderer)),this.modeToRenderTargetMap.set(1,new Yn(this.shapeBuilderContext.shapeBuilderConfig.webGLCanvas,this.shapeBuilderCanvas2DRenderer,this.pointerEventNotifiers,o,s))}get renderTargetMode(){return this._renderTargetMode}set renderTargetMode(e){this._renderTargetMode!==e&&(this._renderTargetMode=e,this.shouldInvokeRenderTargetChangedCallback=!0)}get skipPrepareWebGLCanvas(){return this._skipPrepareWebGLCanvas}set skipPrepareWebGLCanvas(e){this._skipPrepareWebGLCanvas!==e&&(this._skipPrepareWebGLCanvas=e)}beginRender(){this.prepareWebGLCanvas();const e=this.modeToRenderTargetMap.get(this.renderTargetMode);void 0!==e&&e.beginRender()}addViewModel(e){if(!ke(e))return;const t=this.modeToRenderTargetMap.get(this.renderTargetMode);void 0!==t&&t.addViewModel(e)}endRender(){const e=this.modeToRenderTargetMap.get(this.renderTargetMode);void 0!==e&&e.endRender(),this.renderTargetChangedCallback()}hitTest(e){}beginGroup(e){}endGroup(){}renderTargetChangedCallback(){var e;this.shouldInvokeRenderTargetChangedCallback&&(0===this.renderTargetMode?this.showViewDivOnly():1===this.renderTargetMode&&(this.editDiv.appendChild(null===(e=this.shapeBuilderContext)||void 0===e?void 0:e.shapeBuilderConfig.webGLCanvas),this.showEditDivOnly(),this.shapeBuilderContext.activeMultiplexRenderTarget=this),this.shouldInvokeRenderTargetChangedCallback=!1)}getEditDivGraphicIdAttribute(){return this.editDiv.getAttribute("graphicId")}prepareWebGLCanvas(){if(this.skipPrepareWebGLCanvas)return;this.renderTargetMode=1;const e=this.shapeBuilderContext.activeMultiplexRenderTarget;void 0!==e&&e!==this&&e.tryChangeToCanvas2DRenderTargetMode(this.getEditDivGraphicIdAttribute())}tryChangeToCanvas2DRenderTargetMode(e){if(0===this.renderTargetMode)return;const t=new d("ShapeBuilderMultiplexRenderTarget.tryChangeToCanvas2DRenderTargetMode");try{null!==e&&t.setProp("pendingEditDivGraphicId",e);const r=this.getEditDivGraphicIdAttribute();null!==r&&t.setProp("editDivGraphicId",r);const i=this.modeToRenderTargetMap.get(1),n=this.modeToRenderTargetMap.get(0);i instanceof Yn&&n instanceof Un&&(this.renderTargetMode=0,Vn(i.canvas,n.canvasElement),this.renderTargetChangedCallback())}finally{t.complete()}}showViewDivOnly(){this.viewDiv.style.display="inherit",this.editDiv.style.display="none"}showEditDivOnly(){this.editDiv.style.display="inherit",this.viewDiv.style.display="none"}}class Jn{get length(){return this.idCollection.length}constructor(e,t){this.idCollection=e,this.readOnlyItemCollection=t}addItems(e){return this.idCollection.addIds(this.getIds(e))}removeItems(e){return this.idCollection.removeIds(e.map((e=>e.id)))}removeItemIds(e){return this.idCollection.removeIds(e)}setItems(e){return this.idCollection.setIds(this.getIds(e))}clear(){return this.idCollection.clear()}getItemById(e){if(this.idCollection.has(e))return this.readOnlyItemCollection.getItemById(e)}getItemByIndex(e){if(e>=this.idCollection.length)return;const t=this.idCollection.getIdByIndex(e);return this.readOnlyItemCollection.getItemById(t)}[Symbol.iterator](){const e=this.idCollection[Symbol.iterator]();return{next:()=>{const t=e.next();if(void 0!==t.done&&!t.done){const e=this.getItemById(t.value);if(void 0!==e)return{done:!1,value:e}}return{done:!0,value:void 0}}}}getIds(e){return e.map((e=>e.id)).filter((e=>this.readOnlyItemCollection.getIndexById(e)>-1))}}class Qn{constructor(e){this.elementList=e}get length(){return this.elementList.elementCount}getItemById(e){return this.elementList.getElementById(e)}getIndexById(e){return this.elementList.getIndexById(e)}getItemByIndex(e){return this.elementList.getElementByIndex(e)}[Symbol.iterator](){return this.elementList[Symbol.iterator]()}}function eo(e){return new Qn(e)}class to{constructor(){this.ids=[]}addId(e){return!this.has(e)&&(this.ids.push(e),!0)}addIds(e){return e.reduce(((e,t)=>this.addId(t)||e),!1)}removeId(e){const t=this.getIndexById(e);return t>-1&&(this.ids.splice(t,1),!0)}removeIds(e){return e.reduce(((e,t)=>this.removeId(t)||e),!1)}setIds(e){return!this.sameIds(e)&&(this.ids=e,!0)}clone(){const e=new to;return e.ids=[...this.ids],e}clear(){return 0!==this.ids.length&&(this.ids.length=0,!0)}has(e){return this.getIndexById(e)>-1}hasAll(e){return!e.some((e=>!this.has(e)))}sameIds(e){return this.ids.length===e.length&&!e.some(((e,t)=>e!==this.getIdByIndex(t)))}get length(){return this.ids.length}getIdByIndex(e){if(e>=this.ids.length)throw new RangeError(`Invalid index: ${e}, len: ${this.ids.length}`);return this.ids[e]}getIndexById(e){return this.ids.findIndex((t=>e===t))}[Symbol.iterator](){let e=0;const t=this.ids;return{next(){if(e<t.length){const r={done:!1,value:t[e]};return e+=1,r}return{done:!0,value:void 0}}}}}class ro{}function io(e,t){return t.reduce(((e,t,r)=>e.replace(`{${r}}`,t)),e)}class no{}class oo{constructor(e,t){this.type=no,this.selectionUpdated=new nn.p,this.graphic=e,this.filteredElementCollection=t}addElements(e){this.filteredElementCollection.addItems(e)&&this.onSelectionChanged()}removeElements(e){this.filteredElementCollection.removeItems(e)&&this.onSelectionChanged()}setElements(e){this.filteredElementCollection.setItems(e)&&this.onSelectionChanged()}clear(){this.filteredElementCollection.clear()&&this.onSelectionChanged()}hasSubSelection(){return this.length>0}get length(){return this.filteredElementCollection.length}getElementById(e){return this.filteredElementCollection.getItemById(e)}getElementByIndex(e){return this.filteredElementCollection.getItemByIndex(e)}[Symbol.iterator](){return this.filteredElementCollection[Symbol.iterator]()}teardown(){}save(){}restore(e){}clone(e){throw new Error("SmartArtSelection clone not implemented")}getAriaMessageForSelection(e){let t="";const r=this.filteredElementCollection.length;let i;return 1===r?i=this.filteredElementCollection.getItemByIndex(0):r>1&&(i=this.filteredElementCollection.getItemByIndex(r-1)),void 0!==i&&(t=this.constructFullAriaMessage(i,e)),t}constructFullAriaMessage(e,t){let r=e.shapeTypeString;return""===r&&(r=t.defaultShapeType),""!==e.alt?io(e.hasText?t.shapeHasTextAltTemplate:t.shapeWithNoTextAltTemplate,[r,e.altTitle,e.alt]):io(e.hasText?t.shapeHasTextTemplate:t.shapeNoTextTemplate,[r,e.altTitle])}onSelectionChanged(){this.selectionUpdated.emit()}}function so(e){return e.type===no}class ao{constructor(e){this.selection=e}}class lo extends pn.B{createAction(e,t,r){const i=this.get(e);if(void 0!==i&&void 0!==i[0])return i[0](t,r)}query(e,t){const r=this.get(e);if(void 0!==r&&void 0!==r[1])return r[1](t)}}const ho="DeleteSelectionAction";class co{constructor(){this.actionType=ho}}const uo="SetFillColorAction";class po{constructor(e){this.actionType=uo,this.color=e}}function fo(e){const t=e.selection.selections[0];return 1!==e.selection.selections.length||void 0===t?{enabled:!1}:{enabled:so(t)&&t.hasSubSelection()}}const go=new lo([["ApplyShapeFillColor",[function(e){const t=e.color;if(void 0!==t)return new po(t)},fo]],["ClearPlaceholders",[()=>new co,fo]]]);class mo{}class vo{set fallbackRenderData(e){this._fallbackRenderData=e,this.modelUpdated.emit()}get fallbackRenderData(){return this._fallbackRenderData}constructor(e){this.type=mo,this.modelUpdated=new nn.p,this.hostContext=e}clone(){throw Error("Not implemented")}}var yo=n(5942),_o=n(4193),bo=n(5848);class To{}class wo{constructor(e){this.anchorUpdated=new nn.p,this.type=To,this.graphicElement=e}get transform(){return this.getTransformInformation()}clone(){(0,l._)(55e3,"Not implemented")}getTransformInformation(){const e=new yo.i(this.graphicElement.get_xPersisted(),this.graphicElement.get_yPersisted()),t=new _o.N(this.graphicElement.get_widthPersisted(),this.graphicElement.get_heightPersisted()),r=new bo.d(this.graphicElement.get_isHorizontallyFlipped(),this.graphicElement.get_isVerticallyFlipped());return new a.A(e,t,r,this.graphicElement.get_shapeRotation())}}class xo{constructor(e,t,r){this.type=ro,this.layoutUpdated=new nn.p,this.onModelUpdated=()=>{this.updateLayout().catch((()=>{}))},this.hostContext=e,this.smartArtData=t,this.smartArtLayoutCreator=r,this.modelUpdated=this.smartArtData.modelUpdated,this.updateLayout().catch((()=>{})),this.modelUpdated.on(this.onModelUpdated)}teardown(){this.modelUpdated.off(this.onModelUpdated)}get layout(){return this.smartArtLayout}deleteSubShapes(e){return this.smartArtData.deleteSubShapes(e)}setSubShapeFillColor(e,t){return this.smartArtData.setSubShapeFillColor(e,t)}clone(){throw Error("Not implemented")}setLayout(e){this.smartArtLayout=e,this.layoutUpdated.emit()}async updateLayout(){return this.smartArtLayoutCreator(this.smartArtData).then((e=>{this.setLayout(e)}))}}class Co{constructor(){this.diagramType="",this.diagramCategory="",this.styleType="",this.styleCategory="",this.colorTransformType="",this.colorTransformCategory="",this.typographicalEmphasis="",this.isPlaceholder=!1}}class So{constructor(e){this.text="",this.elementType=2,this.elementProps=new Co,this._modelId=e}get modelId(){return this._modelId}get id(){return this._modelId}get hasText(){return!1}get alt(){return""}get altTitle(){return""}get shapeTypeString(){return""}}class Po{constructor(){this.itemsMap=new Map,this.idArray=[]}addItem(e,t){this.itemsMap.has(e.id)||(this.itemsMap.set(e.id,e),this.idArray.splice(null!=t?t:this.idArray.length,0,e.id))}addItems(e){for(const t of e)this.addItem(t)}removeItem(e){this.removeItemById(e.id)}removeItems(e){for(const t of e)this.removeItem(t)}removeItemById(e){this.itemsMap.delete(e);const t=this.getIndexById(e);-1!==t&&this.idArray.splice(t,1)}removeItemsByIds(e){for(const t of e)this.removeItemById(t)}get length(){return this.itemsMap.size}getItemById(e){return this.itemsMap.get(e)}getItemByIndex(e){if(!(e<0||e>=this.idArray.length))return this.itemsMap.get(this.idArray[e])}getItemByCondition(e){for(const[,t]of this.itemsMap)if(e(t))return t}getIndexById(e){return this.idArray.indexOf(e)}changeItemIndex(e,t){if(t>=this.idArray.length||t<0)return;const r=this.getIndexById(e);return-1!==r&&r!==t?(this.idArray.splice(r,1),this.idArray.splice(t,0,e),r):void 0}[Symbol.iterator](){let e=0;return{next:()=>{if(e>=this.idArray.length)return{done:!0,value:void 0};const t=this.idArray[e];e+=1;const r=this.getItemById(t);if(void 0===r)throw new Error(`Invalid item ID ${t}`);return{done:!1,value:r}}}}}var Eo,Mo=n(943);class Ro{constructor(e){this._elementProps=new Co,this._text="",this._smartArtElement=e}get modelId(){return(0,Mo.n)(this._smartArtElement.get_smartArtModelId())}get id(){return this.modelId}get elementType(){return this._smartArtElement.get_smartArtElementType()}get elementProps(){return this._elementProps}get text(){return this._text}get hasText(){return 3!==this._smartArtElement.get_smartArtElementType()||this._smartArtElement.get_associatedIds().length>0}get alt(){return this._smartArtElement.get_alt()}get altTitle(){return this._smartArtElement.get_altTitle()}get shapeTypeString(){return 3===this._smartArtElement.get_smartArtElementType()&&null!==this._smartArtElement.get_shapeTypeString?this._smartArtElement.get_shapeTypeString():""}}class Ao{constructor(e){this.documentElement=new So(""),this._elementCollection=e}get elements(){const e=new Po;return this._elementCollection.get_items().map((t=>{t.get_isSVGBlipFilled()||e.addItem(new Ro(t))})),e}get elementCount(){return this.elements.length}getElements(e,t){const r=[];for(let i=e;i<(null!=t?t:this.elementCount);i+=1)r.push(this.getElementByIndex(i));return r}getElementById(e){return this.elements.getItemById(e)}getElementByIndex(e){return this.elements.getItemByIndex(e)}getIndexById(e){return this.elements.getIndexById(e)}[Symbol.iterator](){return this.elements[Symbol.iterator]()}addElement(e){return new So("")}addElementWithModelId(e,t){return new So(t)}deleteElement(e){}}class Io{constructor(e){this.modelUpdated=new nn.p,this._pptSmartArtData=e,this._elementList=new Ao(this._pptSmartArtData.get_elementCollection())}get elementList(){return this._elementList}deleteSubShapes(e){return this._pptSmartArtData.deleteSubShapes(e)}setSubShapeFillColor(e,t){return this._pptSmartArtData.setSubShapeFillColor(e,t)}}class Fo{constructor(e){this._transform=e}get transform(){return this._transform}set transform(e){this._transform=e}}class Bo{constructor(e,t){this._pptSmartArtElement=e,this._parentSmartArt=t}get modelId(){return(0,Mo.n)(this._pptSmartArtElement.get_smartArtModelId())}get shapeProps(){return new Fo(this.createSmartArtShapeTransform())}get semanticModelId(){return this._semanticModelId}createSmartArtShapeTransform(){const e=this._pptSmartArtElement.get_xPersisted()-this._parentSmartArt.get_xPersisted(),t=this._pptSmartArtElement.get_yPersisted()-this._parentSmartArt.get_yPersisted(),r=new yo.i(e,t),i=new _o.N(this._pptSmartArtElement.get_widthPersisted(),this._pptSmartArtElement.get_heightPersisted()),n=new bo.d(this._pptSmartArtElement.get_isHorizontallyFlipped(),this._pptSmartArtElement.get_isVerticallyFlipped());return new a.A(r,i,n,this._pptSmartArtElement.get_shapeRotation())}}class Lo{constructor(e){this._parentSmartArt=e}get shapes(){return this._parentSmartArt.ensureModelData().get_elementCollection().get_items().map((e=>new Bo(e,this._parentSmartArt)))}}class Do{}class ko{constructor(e,t,r,i,n=!1,o=""){this.type=Do,this.modelUpdated=new nn.p,this.hostContext=e,this._source=t,this._imageSource=r,this._geometry=i,this._looping=n,this._altText=o}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.modelUpdated.emit()}get source(){return this._source}set source(e){this._source=e,this.modelUpdated.emit()}get imageSource(){return this._imageSource}set imageSource(e){this._imageSource=e,this.modelUpdated.emit()}get fallbackRenderData(){return this._fallbackRenderData}set fallbackRenderData(e){this._fallbackRenderData=e,this.modelUpdated.emit()}get looping(){return this._looping}set looping(e){this._looping=e,this.modelUpdated.emit()}get altText(){return this._altText}set altText(e){this._altText=e,this.modelUpdated.emit()}clone(){throw Error("Not implemented")}}function Oo(e,t){switch(e.getGraphicType()){case 0:return function(e,t){const r=e.getGraphicElement();(0,u.PN)(0,55e3,`PptGraphicElement info: sid=${r.get_sid()}, cid=${r.get_cid()}, shapeId=${r.get_shapeId()}}`);const i=r,n=new Io(i.ensureModelData()),o=new xo(t,n,(s=i,async e=>Promise.resolve(new Lo(s))));var s;return new Cn(e.getId(),o,new wo(r))}(e,t);case 1:return function(e,t){return new Cn(e.getId(),new vo(t),new wo(e.getGraphicElement()))}(e,t);case 2:return function(e,t){const r=e.getVideoData();if(null===r)throw new Error("Missing video data");const i=new ko(t,{isNative:r.getIsNative(),url:r.getSource()},void 0,void 0,void 0!==r.getIsDesignerVideo&&r.getIsDesignerVideo(),void 0!==r.getAltText?r.getAltText():""),o=r.getShapeType();return null!==o&&function(e,t){n.e(835).then(n.bind(n,2478)).then((r=>{(0,u.PN)(0,55e3,"Loaded GC2Video.js"),r.ensureGeometriesRegistered(),r.setGeometry(e,t)})).catch((()=>{(0,u.H)(0,55e3,"Failed to load GC2Video.js")}))}(i,o),new Cn(e.getId(),i,new wo(e.getGraphicElement()))}(e,t);default:throw new Error("Cannot create Graphic for given IGraphicData")}}function Uo(e,t){return e.getEntry(t.key,function(e){let t=Eo.None;return e.altKey&&(t|=Eo.Alt),(window.navigator.userAgent.indexOf("Macintosh")>=0?e.metaKey:e.ctrlKey)&&(t|=Eo.Ctrl),e.shiftKey&&(t|=Eo.Shift),t}(t))}!function(e){e[e.None=0]="None",e[e.Alt=1]="Alt",e[e.Ctrl=2]="Ctrl",e[e.Shift=4]="Shift",e[e.CtrlAlt=3]="CtrlAlt",e[e.CtrlShift=6]="CtrlShift",e[e.CtrlAltShift=7]="CtrlAltShift"}(Eo||(Eo={}));class No{constructor(e){this.type=Vo,this.graphics=[],this.selections=[];for(const t of e)this.graphics.push(t);for(const t of e.selections)this.selections.push(t.save())}restore(e){e.setGraphics(this.graphics);for(let t=0;t<this.selections.length;t+=1){const r=this.selections[t];void 0!==r&&e.selections[t].restore(r)}}}class Vo{}class Go{get selections(){return this._selections}constructor(e,t){this.type=Vo,this.selectionUpdated=new nn.p,this.childSelectionUpdated=new nn.p,this._selections=[],this.graphics=[],this.idsToSelections=new Map,this.onGraphicCollectionChanged=e=>{(function(e){return void 0!==e&&e.type===on})(e)&&this.removeGraphics(e.removed)},this.onChildSelectionUpdated=()=>{this.childSelectionUpdated.emit()},this.graphic=e,this.selectionCreator=t,this.graphic.model.modelUpdated.on(this.onGraphicCollectionChanged)}teardown(){this.graphic.model.modelUpdated.off(this.onGraphicCollectionChanged),this.clear()}hasGraphic(e){return void 0!==this.idsToSelections.get(e.id)}addGraphics(e){for(const t of e){if(this.idsToSelections.has(t.id))continue;const e=this.graphic.model.getGraphic(t.id);if(void 0===e)continue;const r=this.createSelection(e);this.graphics.push(e),this._selections.push(r),this.idsToSelections.set(e.id,r)}this.selectionUpdated.emit()}removeGraphics(e){const[t,r]=[new Set,new Set];for(const i of e){const e=i.id,n=this.idsToSelections.get(e);void 0!==n&&(t.add(e),r.add(n),this.idsToSelections.delete(e))}if(!(t.size<=0)){for(const e of r)this.removeSelection(e);this.graphics=this.graphics.filter((e=>!t.has(e.id))),this._selections=this._selections.filter((e=>!r.has(e))),this.selectionUpdated.emit()}}setGraphics(e){if(0===e.length)return void this.clear();const t=[],r=[];for(const i of e){const e=i.id,n=this.graphic.model.getGraphic(e);if(void 0===n)continue;const o=this.idsToSelections.get(e);void 0!==o?(this.idsToSelections.delete(e),t.push(o)):t.push(this.createSelection(n)),r.push(n)}this.idsToSelections.forEach((e=>{this.removeSelection(e)})),this._selections=t,this.graphics=r,this.idsToSelections.clear();for(const e of this._selections)this.idsToSelections.set(e.graphic.id,e);this.selectionUpdated.emit()}clear(){this.selections.length<=0||(this._selections.forEach((e=>{this.removeSelection(e)})),this._selections=[],this.graphics=[],this.idsToSelections.clear(),this.selectionUpdated.emit())}get length(){return this.graphics.length}[Symbol.iterator](){return this.graphics[Symbol.iterator]()}save(){return new No(this)}restore(e){(function(e){return e.type===Vo})(e)&&e.restore(this)}clone(e){const t=new Go(e,this.selectionCreator);for(const[r,i]of this.idsToSelections){const n=e.model.getGraphic(r);if(void 0!==n){const e=i.clone(n);t.graphics.push(n),t._selections.push(e),t.idsToSelections.set(n.id,e)}}return t}createSelection(e){const t=this.selectionCreator.createSelection(e);return t.selectionUpdated.on(this.onChildSelectionUpdated),t}removeSelection(e){var t;null===(t=e.deselected)||void 0===t||t.emit(),e.selectionUpdated.off(this.onChildSelectionUpdated),e.teardown()}}class zo extends pn.B{performAction(e,t,r){const i=this.get(e.actionType);return void 0===i?new Tn(!1):i(e,t,r)}}const Wo="toggleGraphicSel";class Ho{constructor(e){this.actionType=Wo,this.graphic=e}}function jo(e){return(t,r,i)=>new Tn(e(t,r,i))}function qo(e){return(t,r,i)=>new Tn(!0,e(t,r,i))}const Xo="clrSel";class Ko{constructor(){this.actionType=Xo}}var Yo=n(9495);const $o="removeGraphics";class Zo{constructor(){this.actionType=$o}}class Jo{perform(){return{undoOp:new Jo}}}class Qo{constructor(e,t,r){this.graphicCollection=e,this.graphic=t,this.index=r}perform(){const e=this.graphicCollection.setGraphicOrder(this.graphic,this.index);return void 0===e?{undoOp:new Jo}:{undoOp:new Qo(this.graphicCollection,this.graphic,e)}}}class es{constructor(e,t,r){this.graphicCollection=e,this.graphic=t,this.changeOrderType=r}perform(){const e=this.graphicCollection.changeGraphicOrder(this.graphic,this.changeOrderType);return void 0===e?{undoOp:new Jo}:{undoOp:new Qo(this.graphicCollection,this.graphic,e)}}}var ts=n(9764),rs=n(6487);function is(e){const{pos:t,size:r,flip:i,rot:n}=e;if(0===n&&!i.x&&!i.y)return new s.U(t.x,t.y,t.x+r.width,t.y+r.height);const o=new Xn.S(t.x,t.y),a=new Xn.S(t.x+r.width,t.y),l=new Xn.S(t.x,t.y+r.height),h=new Xn.S(t.x+r.width,t.y+r.height),c=e.getCenter(),u=(0,ts.Iu)(-c.x,-c.y).scale(i.x?-1:1,i.y?-1:1).rotate((0,rs.Yr)(n)).translate(c.x,c.y);o.multiply(u),a.multiply(u),l.multiply(u),h.multiply(u);const d=Math.min(o.x,a.x,l.x,h.x),p=Math.min(o.y,a.y,l.y,h.y),f=Math.max(o.x,a.x,l.x,h.x),g=Math.max(o.y,a.y,l.y,h.y);return new s.U(d,p,f,g)}class ns{constructor(e,t){this.anchor=e,this.transform=t}perform(){const e=new ns(this.anchor,this.anchor.transform);return this.anchor.transform=this.transform,{undoOp:e}}}function os(e,t,r,i){const n=e.clone();switch(t.type){case 0:(null==i?void 0:i.move)||(n.pos.x+=t.x,n.pos.y+=t.y);break;case 1:(null==i?void 0:i.resize)||function(e,t,r){const{width:i,height:n}=e.size;let{scaleX:o,scaleY:s}=t;const{originX:a,originY:l}=t;if((r||t.lockAspectRatio)&&0!==a&&0!==l){const e=Math.max(Math.abs(o),Math.abs(s));o=Math.sign(o)*e,s=Math.sign(s)*e}const h=o*i,c=s*n;e.size.width=Math.abs(h),e.size.height=Math.abs(c);const u=new Xn.S((h-i)*a/2,(c-n)*l/2);u.rotate(e.rot),e.pos.x+=i/2+u.x-h/2,e.pos.y+=n/2+u.y-c/2,h<0&&(e.pos.x+=h,e.flip.x=!e.flip.x),c<0&&(e.pos.y+=c,e.flip.y=!e.flip.y)}(n,t,r||!0===(null==i?void 0:i.aspectRatio));break;case 2:(null==i?void 0:i.rotate)||(n.rot+=t.rotation);break;case 3:t.x&&(n.flip.x=!n.flip.x),t.y&&(n.flip.y=!n.flip.y),t.mirrorRotation&&(n.rot=(0,rs.LW)(-n.rot));break;case 4:void 0!==t.offset&&n.pos.add(t.offset),void 0!==t.scale&&n.size.scale(t.scale.width,t.scale.height),void 0!==t.flip&&(t.flip.x&&(n.flip.x=!n.flip.x),t.flip.y&&(n.flip.y=!n.flip.y)),void 0!==t.rotation&&(n.rot+=t.rotation);break;default:(0,tn.t)(t)}return n}class ss{constructor(e,t){this.type=0,this.x=e,this.y=t}}class as{constructor(e,t,r,i,n=!1){this.type=1,this.scaleX=e,this.scaleY=t,this.originX=r,this.originY=i,this.lockAspectRatio=n}}class ls{constructor(e){this.type=2,this.rotation=e}}function hs(e,t){return e.bounds.left+e.bounds.width()/2-(t.bounds.left+t.bounds.width()/2)}function cs(e,t){return e.bounds.top+e.bounds.height()/2-(t.bounds.top+t.bounds.height()/2)}class us{constructor(e,t){this.collection=e,this.graphics=t}perform(){const e=this.graphics.map((e=>[e,this.collection.getGraphicOrder(e)])).filter((e=>void 0!==e[1]));return this.collection.removeGraphics(this.graphics),{undoOp:new ds(this.collection,e)}}}class ds{constructor(e,t){this.collection=e,this.graphics=t}perform(){return this.collection.addGraphicsAt(this.graphics.sort(((e,t)=>e[1]-t[1]))),{undoOp:new us(this.collection,this.graphics.map((([e])=>e)))}}}class ps{constructor(e,t,r){this.collection=e,this.source=t,this.target=r}perform(){const e=this.collection.getGraphicOrder(this.source);return void 0===e?{undoOp:new Jo}:(this.collection.removeGraphics([this.source]),this.collection.addGraphicsAt([[this.target,e]]),{undoOp:new ps(this.collection,this.target,this.source)})}}const fs=new zo([[Wo,jo((function(e,t){return t.hasGraphic(e.graphic)?t.removeGraphics([e.graphic]):t.addGraphics([e.graphic]),!0}))],[Xo,jo((function(e,t){return t.clear(),!0}))],["selectAllGraphics",jo((function(e,t){const r=[];for(const e of t.graphic.model)r.push(e);return t.setGraphics(r),!0}))],[Yo.Wn,jo((function(e,t,r){let i=e.clearExisting;return e.graphics.forEach((e=>{i=i||!t.hasGraphic(e)})),i&&(t.setGraphics(e.graphics),e.isFirstTimeSelect=!0,r.actionInvoker.invoke(e)),!0}))],[$o,qo((function(e,t){return[new us(t.graphic.model,[...t])]}))],["replaceGraphic",qo((function(e,t){return[new ps(t.graphic.model,e.source,e.target)]}))],["changeZOrder",qo((function(e,t){const r=[],i=e.changeOrderType,n=[];for(const e of t)n.push(e);switch(i){case 0:case 3:n.reverse().forEach((e=>{r.push(new es(t.graphic.model,e,i))}));break;case 1:case 2:n.forEach((e=>{r.push(new es(t.graphic.model,e,i))}));break;default:(0,tn.t)(i)}return r}))],["alignAction",qo((function(e,t){const r=[...t],i=r.map((e=>is(e.anchor.transform)));let n;return n=void 0!==e.alignToBounds?e.alignToBounds:i.reduce(((e,t)=>new s.U(Math.min(e.left,t.left),Math.min(e.top,t.top),Math.max(e.right,t.right),Math.max(e.bottom,t.bottom))),new s.U(Number.MAX_VALUE,Number.MAX_VALUE,Number.MIN_VALUE,Number.MIN_VALUE)),Ji("GC2Align",new Map([["AlignType",e.alignType.toString()]])),r.map(((t,r)=>new ns(t.anchor,os(t.anchor.transform,function(e,t,r){switch(e){case 0:return new ss(t.left-r.left,0);case 1:return new ss(t.center().x-r.center().x,0);case 2:return new ss(t.right-r.right,0);case 3:return new ss(0,t.top-r.top);case 4:return new ss(0,t.center().y-r.center().y);case 5:return new ss(0,t.bottom-r.bottom);default:(0,tn.t)(e)}}(e.alignType,n,i[r]),!0))))}))],["distributeAction",qo((function(e,t){const r=[];for(const e of t)r.push({graphic:e,bounds:is(e.anchor.transform)});if(r.length<3)return[];const{closestGraphicToBounds:i,furthestGraphicToBounds:n,closestBoundToOrigin:o,furthestBoundToOrigin:s}=function(e,t){let r,i,n=Number.MIN_VALUE,o=Number.MAX_VALUE;if(void 0!==t.distributeToBounds)o=0===t.distributeType?t.distributeToBounds.left:t.distributeToBounds.top,n=0===t.distributeType?t.distributeToBounds.right:t.distributeToBounds.bottom;else for(const s of e){const e=s.bounds,a=0===t.distributeType?e.right:e.bottom,l=0===t.distributeType?e.left:e.top;a<o&&(r=s.graphic,o=a),l>n&&(i=s.graphic,n=l)}return{closestGraphicToBounds:r,furthestGraphicToBounds:i,closestBoundToOrigin:o,furthestBoundToOrigin:n}}(r,e),a=r.filter((({graphic:e})=>e!==i&&e!==n)),l=function(e,t){let r=0;if(0===t)for(const t of e)r+=t.bounds.width();else for(const t of e)r+=t.bounds.height();return r}(a,e.distributeType);0===e.distributeType?a.sort(hs):a.sort(cs);const h=void 0===e.distributeToBounds?r.length-1:r.length+1;let c=o;const u=(s-o-l)/h;return a.map((t=>{const r=c+u;return c=0===e.distributeType?r+t.bounds.width():r+t.bounds.height(),new ns(t.graphic.anchor,os(t.graphic.anchor.transform,function(e,t,r){switch(e){case 0:return new ss(t-r.left,0);case 1:return new ss(0,t-r.top);default:(0,tn.t)(e)}}(e.distributeType,r,t.bounds),!0))}))}))]]);class gs{constructor(e){this.keyMapEntries=new Map,this.registerEntries(e)}registerEntries(e){e.forEach((e=>{this.registerEntry(e)}))}registerEntry(e){const t=this.keyMapEntries.get(e.key);void 0!==t?t[e.modifiers]=e.entry:this.keyMapEntries.set(e.key,{[e.modifiers]:e.entry})}getEntry(e,t){const r=this.keyMapEntries.get(e);if(void 0!==r)return r[t]}}class ms{constructor(e){this.actionType="modXfrmAct",this.transform=e}}function vs(e,t){return bs(new ss(e,t))}function ys(e,t){return bs(new as(e,t,0,0))}function _s(e){return bs(new ls(e))}function bs(e){return(t,r,i)=>(i.actionInvoker.invoke(new ms(e)),{isHandled:!0})}function Ts(e,t,r){return r.actionInvoker.invoke(new Zo),{isHandled:!0}}function ws(e,t){return function(e,t){const r=e.graphic.model,i=r.length;if(0===i)return!1;let n;if(0===e.length)n=0===t?0:i-1;else{const o=e.selections[e.length-1],s=r.getGraphicOrder(o.graphic);if(void 0===s)return!1;n=(s+(1===t?-1:1))%i}const o=r.getGraphicAt(n);void 0!==o&&e.setGraphics([o])}(t,e.shiftKey?1:0),{isHandled:!0}}new gs([{key:"Delete",modifiers:Eo.None,entry:Ts},{key:"Backspace",modifiers:Eo.None,entry:Ts},{key:"Escape",modifiers:Eo.None,entry:function(e,t,r){return t.length>0?(r.actionInvoker.invoke(new Ko),{isHandled:!0}):{isHandled:!1}}},{key:"Arrow",modifiers:Eo.None,entry:vs(0,0)},{key:"Tab",modifiers:Eo.None,entry:ws},{key:"Tab",modifiers:Eo.Shift,entry:ws},{key:"ArrowUp",modifiers:Eo.None,entry:vs(0,-1)},{key:"ArrowDown",modifiers:Eo.None,entry:vs(0,1)},{key:"ArrowLeft",modifiers:Eo.None,entry:vs(-1,0)},{key:"ArrowRight",modifiers:Eo.None,entry:vs(1,0)},{key:"ArrowUp",modifiers:Eo.Shift,entry:ys(1,1.1)},{key:"ArrowDown",modifiers:Eo.Shift,entry:ys(1,.9090909090909091)},{key:"ArrowLeft",modifiers:Eo.Shift,entry:ys(.9090909090909091,1)},{key:"ArrowRight",modifiers:Eo.Shift,entry:ys(1.1,1)},{key:"ArrowUp",modifiers:Eo.CtrlShift,entry:ys(1,1.01)},{key:"ArrowDown",modifiers:Eo.CtrlShift,entry:ys(1,.9900990099009901)},{key:"ArrowLeft",modifiers:Eo.CtrlShift,entry:ys(.9900990099009901,1)},{key:"ArrowRight",modifiers:Eo.CtrlShift,entry:ys(1.01,1)},{key:"ArrowLeft",modifiers:Eo.Alt,entry:_s(-15)},{key:"ArrowRight",modifiers:Eo.Alt,entry:_s(15)},{key:"ArrowLeft",modifiers:Eo.CtrlAlt,entry:_s(-1)},{key:"ArrowRight",modifiers:Eo.CtrlAlt,entry:_s(1)}]);const xs="tabSel";class Cs{constructor(e=0){this.actionType=xs,this.tabOrder=0,this.tabOrder=e}}const Ss="selectAllElements";class Ps{constructor(){this.actionType=Ss}}const Es="setElementsToSel";class Ms{constructor(e){this.actionType=Es,this.elementIds=e}}const Rs="toggleElementsInSel";class As{constructor(e){this.actionType=Rs,this.elementIds=e}}const Is=new zo([[Xo,jo((function(e,t){return t.clear(),!0}))],[Ss,jo((function(e,t){const r=t.graphic.model.smartArtData.elementList,i=[];for(const e of r)i.push(e);return t.setElements(i),!0}))],[Es,jo((function(e,t){const r=[];return e.elementIds.forEach((e=>{const i=t.graphic.model.smartArtData.elementList.getElementById(e);void 0!==i&&r.push(i)})),t.setElements(r),!0}))],[ho,jo((function(e,t){const r=[];for(const e of t)r.push(e.modelId);return t.graphic.model.deleteSubShapes(r)}))],[uo,jo((function(e,t){const r=[];for(const e of t)r.push(e.modelId);return t.graphic.model.setSubShapeFillColor(r,e.color)}))],[xs,jo((function(e,t){return function(e,t,r){if(0===e.length)return!1;const i=function(e,t,r){if(0===t.length)return-1;const i=0===r?0:t.length-1;if(0===e.length)return i;const n=e.getElementByIndex(e.length-1);if(void 0===n)return i;let o=t.getIndexById(n.id);return-1===o?i:(0===r?(o+=1,o>=t.length&&(o=0)):(o-=1,o<0&&(o=t.length-1)),o)}(e,t,r);if(-1===i)return!1;const n=t.getItemByIndex(i);return void 0!==n&&(e.setElements([n]),!0)}(t,eo(t.graphic.model.smartArtData.elementList),e.tabOrder)}))],[Rs,jo((function(e,t){const r=[],i=[];return e.elementIds.forEach((e=>{const n=t.graphic.model.smartArtData.elementList.getElementById(e);void 0!==n&&(void 0!==t.getElementById(e)?i.push(n):r.push(n))})),i.length>0&&t.removeElements(i),r.length>0&&t.addElements(r),!0}))]]);function Fs(e,t,r){return t.hasSubSelection()?{isHandled:r.editorRegistry.performAction(new Cs(e.shiftKey?1:0),t,r).performed}:{isHandled:!1}}const Bs=new gs([{key:"Enter",modifiers:Eo.None,entry:function(e,t,r){let i=!1;if(0===t.length){const e=t.graphic.model.smartArtData.elementList.getElementByIndex(0);void 0!==e&&(t.setElements([e]),i=!0)}return{isHandled:i}}},{key:"Escape",modifiers:Eo.None,entry:function(e,t,r){return t.hasSubSelection()?{isHandled:r.editorRegistry.performAction(new Ko,t,r).performed}:{isHandled:!1}}},{key:"Tab",modifiers:Eo.None,entry:Fs},{key:"Tab",modifiers:Eo.Shift,entry:Fs},{key:"a",modifiers:Eo.Ctrl,entry:function(e,t,r){return{isHandled:r.editorRegistry.performAction(new Ps,t,r).performed}}}]),Ls=[no,{keyboardEventProcessor:(e,t,r)=>{if("keydown"===e.type){const i=Uo(Bs,e);if(void 0!==i)return i(e,t,r)}return{isHandled:!1}},actionPerformer:(e,t,r)=>Is.performAction(e,t,r)}],Ds="playVideo";class ks{constructor(){this.actionType=Ds}}class Os{}class Us{constructor(e){this.type=Os,this.selectionUpdated=new nn.p,this.graphic=e}teardown(){}save(){}restore(e){}clone(e){return new Us(e)}}const Ns=new zo([[Ds,function(e,t){return t.selectionUpdated.emit(0),new Tn(!0)}]]),Vs=[Os,{keyboardEventProcessor:function(e,t,r){return" "===e.key?(r.actionInvoker.invoke(new ks),{isHandled:!0}):{isHandled:!1}},actionPerformer:function(e,t,r){return Ns.performAction(e,t,r)}}],Gs=new gs([]),zs=[[Vo,{keyboardEventProcessor:(e,t,r)=>function(e,t,r,i){if(1===t.selections.length){const i=r.editorRegistry.processKeyboardEvent(e,t.selections[0],r);if(i.isHandled)return i}if("keydown"===e.type){const n=void 0!==i?Uo(i,e):void 0;if(void 0!==n)return n(e,t,r)}return{isHandled:!1}}(e,t,r,Gs),actionPerformer:(e,t,r)=>{let i=!1;const n=[];for(const o of t.selections){const t=r.editorRegistry.performAction(e,o,r);t.performed&&(i=!0,t.editOps.length>0&&n.push(...t.editOps))}return i?new Tn(!0,n):void 0!==fs.get(e.actionType)?fs.performAction(e,t,r):new Tn(!1)}}],Ls,Vs];var Ws=n(9354);class Hs{}class js{constructor(e,t,r){this.type=Hs,this.sceneGraphJson=e,this.interactivityJson=t,this.targetBounds=r}}class qs{}class Xs{constructor(e,t,r,i){this.type=qs,this.shapeBuilderRenderData=e,this.sourceAnchorBounds=t,this.targetBounds=r,this.embeddedImageList=i}}function Ks(e){return e.type===qs}function Ys(e){return new s.U(e.pos.x,e.pos.y,e.pos.x+e.size.width,e.pos.y+e.size.height)}function $s(e,t){const r=e;switch(r.renderDataType){case 0:return function(e,t){return new Ws.l9(e.base64Data,Ys(t),Ys(e.targetBounds))}(r,t);case 2:return function(e,t){const{x:r,y:i}=t.pos,{width:n,height:o}=t.size;return new js(e.sceneGraphJson,e.interactivityJson,new s.U(r+n,i+o,n,o))}(r,t);case 1:return function(e,t){const r=function(e){let t=e;const r=t.indexOf("{");return r>0&&(t=t.substring(r)),JSON.parse(t)}(e.shapeBuilderJson);return function(e){return void 0!==e.shapeRenderData}(r)?new Xs(r.shapeRenderData,Ys(t),Ys(e.targetBounds),r.imageList):new Xs(r,Ys(t),Ys(e.targetBounds),void 0)}(r,t);default:return}}class Zs{constructor(e){this._isHandled=e}get_isHandled(){return this._isHandled}}class Js{constructor(e){this._eventProcessResult=e}get_isHandled(){return this._eventProcessResult.isHandled}}function Qs(e){switch(e){case 0:return"SmartArt";case 1:return"Chart";case 2:return"Video";default:return"Unknown"}}const ea="GC2RenderVeto";class ta{constructor(e,t,r){this.trackerToAppInfo=new Map,this.brsConfig=e,this.shapeBuilderContext=t,this.ownerAlias="gc2smartart"}logSetRenderData(e,t){const r=ra(t,this.brsConfig);!function(e,t=new Map,r="gc2kpi"){$i.logKpiUsage(e,1,t,r)}(e.name,r,this.ownerAlias),Ji(ea,r,this.ownerAlias),this.trackerToAppInfo.set(e,t)}logSetTransform(e,t){this.trackerToAppInfo.set(e,t)}logFrameRendered(e){const t=this.brsConfig.gc2FidelityResponsivenessRenderVetoMs;e.forEach((e=>{var r;const i=this.trackerToAppInfo.get(e);if(void 0!==i&&i.size>0){this.trackerToAppInfo.delete(e),e.end(),i.forEach(((t,r)=>{if(r.toLowerCase().indexOf("starttime")>0){const n=r.replace(/starttime.*/gi,"DurationMs"),o=parseFloat(t),s=!isNaN(o)&&o>=0?(e.endTimeMs-o).toFixed(3):"";""!==s&&i.set(n,s),i.delete(r)}}));const n=null===(r=this.shapeBuilderContext)||void 0===r?void 0:r.getScenePerformanceSummaryAsMap();null==n||n.forEach(((t,r)=>{e.addEventToContextHistoryMap(r,t)}));const o=new Map([...i.entries(),...e.getEventDurationStringsMap(3).entries()]),s=new Yi;s.extendedProperties=ra(o,this.brsConfig);const a=function(e,t){const r=new Set;return e.forEach(((e,i)=>{if(i.toLowerCase().indexOf("actionname")>-1&&parseFloat(e)>t){const e=i.match(/ActionName_([a-zA-Z0-9]+)_ActionId_([a-zA-Z0-9\-]+)_([a-zA-Z]+)/),t=null!==e&&4===e.length?e[1]:"";r.add(t)}})),[...r]}(i,t);if(a.length>0){const e=new Yi;e.extendedProperties=s.extendedProperties,e.extendedProperties.set("ActionsVetoed",a.toString()),e.extendedProperties.set("VetoCategory","Responsiveness"),function(e,t,r=!1,i=!0,n=new Yi){$i.logKpiFailure(e,t,r,i,n)}(ea,"FidelityResp",!1,!1,e)}e.addTimePoint("OnFrameRenderedEndTime"),s.extendedProperties.set("TimePoints",e.getTimePointCollectionString(3)),function(e,t=new Yi){$i.logKpiSuccess(e,t)}(e.name,s),(0,u.PN)(0,55e3,`${ia(o)}`)}}))}}function ra(e,t){const r=new Map,i=[];let n="";try{e.set("isGC2WebGLRenderTargetEnabled",t.isGC2WebGLRenderTargetEnabled.toString()),e.forEach(((e,t)=>{if(t.toLowerCase().indexOf("actionname")>-1){const r=t.match(/ActionName_([a-zA-Z0-9]+)_ActionId_([a-zA-Z0-9\-]+)_([a-zA-Z]+)/);if(null!==r&&4===r.length){const t=new Map;t.set("ActionName",r[1]),t.set("ActionId",r[2]),n=r[3],t.set(n,e),i.push(ia(t))}}else r.set(t,e)})),r.set(`ActionMetadataWith${n}`,i.toString())}catch(e){(0,u.PN)(0,55e3,`Exception: ${e.message}`)}return r}function ia(e){const t={};return e.forEach(((e,r)=>{t[r]=e})),JSON.stringify(t)}class na{get viewModel(){return void 0===this.currentPresenter&&(0,l._)(0,"CurrentPresenter not resolved."),this.currentPresenter.viewModel}constructor(e,t,r,i){this.viewModelUpdated=new nn.p,this.isFallbackRenderDataPresenter=!1,this.onModelUpdated=(e,t)=>{this.updateViewModel(t,!1)},this.onViewModelUpdated=e=>{this.updateViewModel(e,!0)},this.graphic=e,this.context=t,this.editContext=i,this.modelPresenterCreator=r,this.graphic.model.modelUpdated.on(this.onModelUpdated),this.updateViewModel()}teardown(){this.graphic.model.modelUpdated.off(this.onModelUpdated),this.teardownCurrentPresenter()}teardownCurrentPresenter(){void 0!==this.currentPresenter&&(this.currentPresenter.viewModelUpdated.off(this.onViewModelUpdated),this.currentPresenter.teardown())}updateViewModel(e,t){this.ensureCurrentPresenter(e),this.viewModelUpdated.emit(t?e:void 0)}ensureCurrentPresenter(e){(void 0===this.currentPresenter||void 0===this.graphic.model.fallbackRenderData&&this.isFallbackRenderDataPresenter||void 0!==this.graphic.model.fallbackRenderData&&!this.isFallbackRenderDataPresenter||void 0!==this.graphic.model.fallbackRenderData&&this.isFallbackRenderDataPresenter&&this.currentPresenter.renderDataType!==this.graphic.model.fallbackRenderData.type)&&this.recreatePresenter(e)}recreatePresenter(e){if(this.teardownCurrentPresenter(),void 0!==this.graphic.model.fallbackRenderData){void 0===this.context.renderDataPresenterCreator&&(0,l._)(0,"RenderDataPresenterCreator not provided");const t=this.context.renderDataPresenterCreator.createRenderDataPresenter(this.graphic,this.context,this.editContext);this.currentPresenter=t,this.isFallbackRenderDataPresenter=!0,t.init(this.onViewModelUpdated,e)}else this.currentPresenter=this.modelPresenterCreator(this.graphic,this.context,this.editContext),this.isFallbackRenderDataPresenter=!1,this.currentPresenter.viewModelUpdated.on(this.onViewModelUpdated)}}var oa,sa,aa=n(9140),la=function(){function e(){}return e.prototype.sendTraceTag=function(){},e.prototype.shipAssertTag=function(){},e.prototype.debugAssertTag=function(){},e}(),ha=new(function(){function e(){this.externalLogger=new la}return e.prototype.setLogger=function(e){this.externalLogger=e},e.prototype.sendTraceTag=function(e,t,r,i){this.externalLogger.sendTraceTag(e,t,r,i)},e.prototype.debugAssertTag=function(e,t,r,i){this.externalLogger.debugAssertTag(e,t,r,i)},e.prototype.shipAssertTag=function(e,t,r,i){this.externalLogger.shipAssertTag(e,t,r,i)},e}());!function(e){e[e.msoulscat_ES_EWAJS=0]="msoulscat_ES_EWAJS",e[e.msoulscat_ES_EWAJSGrid=1]="msoulscat_ES_EWAJSGrid",e[e.msoulscat_ES_EWAJSChart=6]="msoulscat_ES_EWAJSChart",e[e.msoulscat_MSOSP_FileMenuCommands=202]="msoulscat_MSOSP_FileMenuCommands",e[e.msoulscat_MSOSP_OTelJS=225]="msoulscat_MSOSP_OTelJS",e[e.msoulscat_MSOSP_OTelJSInWebWoker=227]="msoulscat_MSOSP_OTelJSInWebWoker",e[e.msoulscat_MSOSP_OTelJSWebWorkerPrototype=228]="msoulscat_MSOSP_OTelJSWebWorkerPrototype",e[e.msoulscat_Wac_WordViewer=301]="msoulscat_Wac_WordViewer",e[e.msoulscat_Wac_BrowserGeneral=306]="msoulscat_Wac_BrowserGeneral",e[e.msoulscat_Wac_TaskPane=320]="msoulscat_Wac_TaskPane",e[e.msoulscat_Wac_OneNoteGeneral=339]="msoulscat_Wac_OneNoteGeneral",e[e.msoulscat_Wac_Ribbon=340]="msoulscat_Wac_Ribbon",e[e.msoulscat_Wac_WopiPendingApplication=379]="msoulscat_Wac_WopiPendingApplication",e[e.msoulscat_Wac_Telemetry=383]="msoulscat_Wac_Telemetry",e[e.msoulscat_Wac_WacCatchUpActivities=391]="msoulscat_Wac_WacCatchUpActivities",e[e.msoulscat_Wac_Dictation=394]="msoulscat_Wac_Dictation",e[e.msoulscat_Wac_OneNoteSync=395]="msoulscat_Wac_OneNoteSync",e[e.msoulscat_Wac_VisioApp=700]="msoulscat_Wac_VisioApp",e[e.msoulscat_OneNoteOnline_EditableCache=1601]="msoulscat_OneNoteOnline_EditableCache",e[e.msoulscat_Wac_PptAnimation=800]="msoulscat_Wac_PptAnimation",e[e.msoulscat_Wac_PptLive=833]="msoulscat_Wac_PptLive",e[e.msoulscat_Wac_PptMWeb=834]="msoulscat_Wac_PptMWeb",e[e.msoulscat_Wac_PptShape=815]="msoulscat_Wac_PptShape",e[e.msoulscat_Wac_PptSession=817]="msoulscat_Wac_PptSession",e[e.msoulscat_Wac_PptSlideshow=830]="msoulscat_Wac_PptSlideshow",e[e.msoulscat_Wac_PptView=822]="msoulscat_Wac_PptView",e[e.msoulscat_Wac_VersionHistory=2300]="msoulscat_Wac_VersionHistory",e[e.msoulscat_Wac_WordPresence=302]="msoulscat_Wac_WordPresence",e[e.msoulscat_Wac_WordVersionHistory=3005]="msoulscat_Wac_WordVersionHistory",e[e.msoulscat_Wac_LivePersonaCard=3006]="msoulscat_Wac_LivePersonaCard",e[e.msoulscat_Wac_CatchUpFlyout=3012]="msoulscat_Wac_CatchUpFlyout",e[e.msoulscat_Wac_WordDesigner=3016]="msoulscat_Wac_WordDesigner",e[e.msoulscat_Wac_ModernFontPicker=3021]="msoulscat_Wac_ModernFontPicker",e[e.msoulscat_Wac_UnifiedUiHost=3027]="msoulscat_Wac_UnifiedUiHost"}(oa||(oa={})),function(e){e[e.Error=10]="Error",e[e.Warning=15]="Warning",e[e.Info=50]="Info",e[e.Verbose=100]="Verbose",e[e.Spam=200]="Spam"}(sa||(sa={}));var ca={Abadi:"23643452060",Aldhabi:"35299853273","Book Antiqua":"37426579782",Aparajita:"34426069361","Arabic Typesetting":"27140849423",Arial:"44117086606","Arial Nova":"31875808322","Baskerville Old Face":"29618310377","Bell MT":"33966854762",Bembo:"20740564562","Bodoni MT":"29556528177","Bradley Hand ITC":"25733548319","Berlin Sans FB":"33676382891",Broadway:"27289878557","Bookshelf Symbol 7":"30039797956",Calibri:"44327025345","Californian FB":"29110430052","Calisto MT":"30111742330",Candara:"38835860617",Castellar:"28249279615","Century Schoolbook":"39048582419",Centaur:"41679335390",Century:"38027012730","Colonna MT":"30027433166","Comic Sans MS":"34621977852",Consolas:"33167468773",Constantia:"31448377222",Corbel:"35115404204","Courier New":"39673202522",Dante:"33833536951",DaunPenh:"29920401905",David:"28736817646",DengXian:"53665963276",DokChampa:"40540473796",Dubai:"32761028732",Ebrima:"37668183528","Eras ITC":"30212826222",Euphemia:"47320991779","Felix Titling":"30189168463",Forte:"28669186030","Franklin Gothic Book":"35148505830","Franklin Gothic":"43557860315",FrankRuehl:"32836168823","Freestyle Script":"29733748199",Gabriola:"34438341383",Gadugi:"56434144182",Garamond:"36480320667",Gautami:"39643252760",Georgia:"35602463917","Georgia Pro":"22657516329",Gigi:"34660959760","Gill Sans MT":"31805007993",Gisha:"33374253261","Century Gothic":"35046754488",Grotesque:"30685830985","Hadassah Friedlaender":"24086370297",Harrington:"22558053376",HGMaruGothicMPRO:"27788582244","Microsoft Himalaya":"29604316660","High Tower Text":"33278643157","Imprint MT Shadow":"22676891790","Ink Free":"20542252197","Iskoola Pota":"38011673001","Blackadder ITC":"35330309812","Javanese Text":"25397689379",Jokerman:"33080106939","Juice ITC":"36384807514",Kalinga:"41956811750",Kartika:"41343400187","Khmer UI":"29171977002",Kokila:"40302860138","Kunstler Script":"23730354380","Lucida Sans Unicode":"35821919345","Lao UI":"40164261239",Latha:"33890753080","Lucida Bright":"35187686457","Leelawadee UI":"31932804840",Leelawadee:"46240451791","Lucida Fax":"28107311451","Lucida Sans":"32760138905","Levenim MT":"27898460535","Maiandra GD":"28277029587","Sakkal Majalla":"33893302280","Malgun Gothic":"41226677490",Mangal:"41732083461","Matura MT Script Capitals":"29406417122","Microsoft Sans Serif":"40086055104",Mistral:"28668461660","Myanmar Text":"27700417454","Modern No. 20":"30301309713","Mongolian Baiti":"33245419878",MoolBoran:"24909662691",Miriam:"28685692097","Miriam Fixed":"25290634525","Microsoft GothicNeo":"31766265843","Microsoft Uighur":"38231195238","Microsoft Yi Baiti":"28270850659","MT Extra":"11953716540","MV Boli":"29162370688","News Gothic MT":"21498099258","Neue Haas Grotesk Text Pro":"31862445252","Nirmala UI":"32551979382",Narkisim:"33025118934","Microsoft New Tai Lue":"23961355090",Nyala:"43161688999",Onyx:"42004410731","MS Outlook":"28536695775","Palatino Linotype":"38312838300",Papyrus:"30541236361",Perpetua:"32262981054","Microsoft PhagsPa":"35191080581","Plantagenet Cherokee":"42807393920",Pristina:"35921879813",Raavi:"33085177893","MS Reference Sans Serif":"34439023310",Rockwell:"34805489950","Rockwell Nova":"20395950770",Rod:"29067043464","Sanskrit Text":"32723779410","Segoe Print":"37891634245","Segoe Script":"27513503573","Segoe UI Emoji":"37786275516","Segoe UI Historic":"42513575706","Segoe UI Symbol":"48871381854",Selawik:"22470592074","Shonar Bangla":"33615082001",Shruti:"38794912506",FangSong:"29400494812",SimHei:"32980441079",KaiTi:"28214366148","Simplified Arabic":"38146384601","Simplified Arabic Fixed":"36112958963","SimSun-ExtB":"27824684633","Snap ITC":"37617127837","Source Sans Pro":"35021733747",STCaiyun:"32670116116",STFangsong:"32515377567",STHupo:"35991369992",STKaiti:"34202148807",STXihei:"27891586950",STXingkai:"32439372444",STXinwei:"32879433410",STZhongsong:"28692380284",Sylfaen:"45112038400",Symbol:"26522609597",Tahoma:"50941620409","Microsoft Tai Le":"35423324637","Tw Cen MT":"35523432091","Tempus Sans ITC":"22990956528","TH SarabunPSK":"40796829544","Times New Roman":"39238612322","Traditional Arabic":"41360408994","Trebuchet MS":"34633337668",Tunga:"35419190202",Univers:"25504584715",DilleniaUPC:"34702376310",EucrosiaUPC:"30852963300",FreesiaUPC:"32772486316",IrisUPC:"35393526279",JasmineUPC:"32534838392",KodchiangUPC:"32774023165",LilyUPC:"34962827580","Urdu Typesetting":"26145919835",Utsaah:"42140102901",Vani:"31070026496",Verdana:"31984381249","Verdana Pro":"29856001200",Vijaya:"31573029587","Viner Hand ITC":"26032089504","Vladimir Script":"25940660647",Vrinda:"34712615977",Webdings:"33805005358",Wingdings:"37798520877","Wingdings 2":"36638629124","Wingdings 3":"32314200193","Yu Mincho":"31515951246"},ua=function(){function e(e){this.element=e}return e.create=function(){var t,r=document.createElement("style");return r.type="text/css",document.head||ha.sendTraceTag(594343712,oa.msoulscat_ES_EWAJSChart,sa.Error,"Unable to mount font service"),null===(t=document.head)||void 0===t||t.appendChild(r),new e(r)},e.prototype.load=function(e){var t=ca.hasOwnProperty(e);if(ha.sendTraceTag(595620998,oa.msoulscat_ES_EWAJSChart,sa.Info,"font available on service: "+t),t){var r=ca[e];this.element.textContent+='@font-face { font-family:"'+e+'_MSFontService"; src:url("https://fs-edog.microsoft.com/fs/4.7/rawguids/'+r+'"); } \n'}return t},e}(),da=function(){function e(){}return e.ensureFont=function(t){if(e.fontService||(e.fontService=ua.create()),this.installedFonts.hasOwnProperty(t))return this.installedFonts[t];0===this.defaultFontSizes.length&&this.measureDefaultFonts();for(var r=!0,i=0;i<this.defaultFonts.length;i+=1)if(this.measure(t+","+this.defaultFonts[i])!==this.defaultFontSizes[i]){r=!1;break}return this.installedFonts[t]=!r,ha.sendTraceTag(595620999,oa.msoulscat_ES_EWAJSChart,sa.Info,"font available: "+this.installedFonts[t]),r&&this.fontService&&(this.installedFonts[t]=this.fontService.load(t)),this.installedFonts[t]},e.measureDefaultFonts=function(){var e=this;this.defaultFontSizes=this.defaultFonts.map((function(t){return e.measure(t)}))},e.measure=function(e){var t=this.createContentDiv(e);document.body.appendChild(t);var r=t.clientWidth+","+t.clientHeight;return document.body.removeChild(t),r},e.createContentDiv=function(e){var t=document.createElement("div");return t.style.position="absolute",t.style.display="inline",t.style.visibility="hidden",t.style.fontSize="100px",t.style.letterSpacing="normal",t.style.lineHeight="normal",t.style.whiteSpace="nowrap",t.style.fontFamily=e,t.textContent=this.testString,t},e.defaultFontSizes=[],e.defaultFonts=["monospace","sans-serif","serif"],e.testString="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ01234567890~!@#$%^&*()-+",e.installedFonts={},e}(),pa=function(){function e(e,t,r){var i,n,o=this;this.element=e,this.seenError=!1;var s=new aa.OfficeRenderHost;try{for(var a=(0,p.XA)(t),l=a.next();!l.done;l=a.next()){var h=l.value;s.setFeatureIsEnabled(h.name,h.isEnabled)}}catch(e){i={error:e}}finally{try{l&&!l.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}this.chartPlayer=new aa.ChartPlayer({renderer:aa.IvyRenderer.Svg,disableChartElementResize:!1},this.element,s),this.chartPlayer.on("error",(function(e,t){return o.handleChartPlayerError(t)})),this.chartPlayer.on("log",(function(e,t){return o.handleChartPlayerLog(t)})),r&&(this.chartPlayer.on("select",(function(e,t,i){"select"===e&&r.onSelectionChange(t||null,i)})),this.chartPlayer.on("dblclick",(function(e,t){"dblclick"===e&&r.onDoubleClick(t||null)})))}return e.prototype.select=function(e){this.chartPlayer.select(e||void 0)},e.prototype.navigateNextSibling=function(e){e?this.chartPlayer.selectNextSibling():this.chartPlayer.selectPreviousSibling()},e.prototype.selectParent=function(){this.chartPlayer.selectParent()},e.prototype.selectFirstChild=function(){this.chartPlayer.selectFirstChild()},e.prototype.setInteractivityEnabled=function(e){this.chartPlayer.isInteractivityEnabled=e},e.prototype.getSelectionDescription=function(){return this.chartPlayer.getDescription()||""},e.prototype.renderImage=function(e){if(!e)return ha.sendTraceTag(593512201,oa.msoulscat_ES_EWAJSChart,sa.Error,"Data URI must be valid"),!1;this.seenError=!1;var t={data:e,mimeType:""};try{return this.chartPlayer.setRenderer(aa.IvyRenderer.Image),this.chartPlayer.render(t),!this.seenError}catch(e){return ha.sendTraceTag(593515406,oa.msoulscat_ES_EWAJSChart,sa.Error,e.message),!1}},e.prototype.renderChart=function(e,t){if(!e)return ha.sendTraceTag(595912482,oa.msoulscat_ES_EWAJSChart,sa.Error,"Scenegraph string must be valid"),!1;this.seenError=!1;try{this.chartPlayer.setRenderer(aa.IvyRenderer.Svg);var r=JSON.parse(e),i=t?JSON.parse(t):void 0;return this.chartPlayer.render(r,i),!this.seenError}catch(e){return ha.sendTraceTag(595912483,oa.msoulscat_ES_EWAJSChart,sa.Error,e.message),!1}},e.prototype.ensureFont=function(e){return!!e&&da.ensureFont(e)},e.prototype.handleChartPlayerError=function(e){ha.sendTraceTag(595711620,oa.msoulscat_ES_EWAJSChart,sa.Error,e),this.seenError=!0},e.prototype.handleChartPlayerLog=function(e){ha.sendTraceTag(593883464,oa.msoulscat_ES_EWAJSChart,sa.Info,e)},e}(),fa=n(1380),ga=function(){function e(){this.uoMirror=new fa.VisualsMirror}return e.prototype.updateModel=function(e){try{e&&this.uoMirror.updateModel(e)}catch(e){ha.sendTraceTag(555798675,oa.msoulscat_ES_EWAJSChart,sa.Error,e.message)}},e.prototype.isUOElementPathValid=function(e,t){if(e&&t)try{return void 0!==this.uoMirror.getVisualMirror(e).getRootProperty().getProperty(t)}catch(e){return!1}return!1},e.prototype.isUORibbonCommandSupported=function(e,t,r){if(!e||!t)return!1;try{var i=this.uoMirror.getVisualMirror(e).getRootProperty().getProperty(t);if(void 0===i)return!1;if(!(0,fa.isObjectProperty)(i))return!1;var n=this.getUOPropPathForUORibbonCommand(r);return null!=n&&void 0!==i.getProperty(n)}catch(e){return ha.sendTraceTag(554558563,oa.msoulscat_ES_EWAJSChart,sa.Error,e.message),!1}},e.prototype.getUORibbonCommandVal=function(e,t,r){if(!e||!t)return null;try{var i=this.uoMirror.getVisualMirror(e).getRootProperty().getProperty(t);if(void 0===i)return null;if(!(0,fa.isObjectProperty)(i))return null;var n=this.getUOPropPathForUORibbonCommand(r);if(null==n)return null;var o,s=i.getProperty(n);return void 0===s?null:(0,fa.isBoolProperty)(s)||(0,fa.isIntProperty)(s)||(0,fa.isDoubleProperty)(s)?void 0===(o=s.getValueAttribute(fa.ValuePropAttributeName.Value))?null:{isValid:!0,returnVal:o.toString()}:(0,fa.isStringProperty)(s)?void 0===(o=s.getValueAttribute(fa.ValuePropAttributeName.Value))?null:{isValid:!0,returnVal:o}:(0,fa.isEnumProperty)(s)?3!==r||void 0===(o=s.getValueAttribute(fa.ValuePropAttributeName.Value))?null:{isValid:!0,returnVal:0===o?"false":"true"}:null}catch(e){return ha.sendTraceTag(554709532,oa.msoulscat_ES_EWAJSChart,sa.Error,e.message),null}},e.prototype.handleUORibbonCommand=function(e,t,r,i){if(!e||!t)return null;try{var n=this.uoMirror.getVisualMirror(e).getRootProperty().getProperty(t);if(void 0===n)return null;if(!(0,fa.isObjectProperty)(n))return null;var o=this.getUOPropPathForUORibbonCommand(r);if(null==o)return null;if(void 0===n.getProperty(o))return null;var s=t+"_"+o,a=this.parseUORibbonCommandVal(r,i);return null===a?null:{propPath:s,propVal:a}}catch(e){return ha.sendTraceTag(554709533,oa.msoulscat_ES_EWAJSChart,sa.Error,e.message),null}},e.prototype.getUOPropPathForUORibbonCommand=function(e){switch(e){case 0:return"FillFormat_Color";case 1:return"FontFormat_Bold";case 2:return"FontFormat_Italic";case 3:return"FontFormat_UnderlineStyle";case 4:return"FontFormat_Color";case 5:return"FontFormat_Name";case 6:return"FontFormat_Size";default:return null}},e.prototype.parseUORibbonCommandVal=function(e,t){if(!t)return null;switch(e){case 0:case 4:var r=t.substring(1,t.length);return parseInt(r,16).toString();case 1:case 2:case 6:return t;case 3:return"true"===t?'"Single"':'"None"';case 5:return'"'+t+'"';default:return null}},e}(),ma=function(){function e(){this.enabledFeatures=[]}return e.prototype.getChartPlayerWrapper=function(e,t){return e?(ha.sendTraceTag(595912512,oa.msoulscat_ES_EWAJSChart,sa.Info,"New Chart Player created"),new pa(e,this.enabledFeatures,t)):(ha.sendTraceTag(595912513,oa.msoulscat_ES_EWAJSChart,sa.Error,"HTMLElement must be valid"),null)},e.prototype.getUOMirrorWrapper=function(){return new ga},e.prototype.initializeLogger=function(e){e&&function(e){if(!e)throw new Error("The 'logger' argument is missing");ha.setLogger(e)}(e)},e.prototype.enableFeatures=function(e){var t=this;e&&0!==e.length&&e.forEach((function(e){e&&t.enabledFeatures.push({name:e,isEnabled:!0})}))},e}();new ma;class va{}class ya{get scaleFactor(){return this._scaleFactor}set scaleFactor(e){this._scaleFactor=e,this.fixSVGElementTransform()}get position(){return this._position}set position(e){this._position=e,this.fixSVGElementTransform()}get size(){return this._size}set size(e){this._size=e,this.fixSVGElementTransform()}constructor(e,t){this.type=va,this.pointerEventNotifiers=(0,r.n)(),this.hitTestSlop=i.Hr,this._scaleFactor=1/window.devicePixelRatio,this._position=new yo.i,this._size=new _o.N,this.position=e,this.size=t,this.htmlDiv=document.createElement("div"),this.chartPlayerWrapper=(new ma).getChartPlayerWrapper(this.htmlDiv,void 0)}setLayout(e){void 0!==this.chartPlayerWrapper&&null!==this.chartPlayerWrapper&&(this.chartPlayerWrapper.renderChart(e.sceneGraphJson,e.interactivityJson),this.element=this.htmlDiv.firstChild,this.fixSVGElementTransform())}teardown(){}fixSVGElementTransform(){if(void 0===this.element||null===this.element)return;const e=`position: absolute; display: inherit; z-index: 1;left:${this.position.x*this.scaleFactor}px;top:${this.position.y*this.scaleFactor}px;width:${this.size.width*this.scaleFactor}px;height:${this.size.height*this.scaleFactor}px;`;this.element.setAttribute("style",`${e}`)}}class _a{get viewModel(){return this.chartRenderDataPresenter.viewModel}get viewModelUpdated(){return this.chartRenderDataPresenter.viewModelUpdated}constructor(e,t){this.chartModelPresenterCreator=(e,t,r)=>this.chartInnerPresenter,this.graphic=e,this.chartInnerPresenter=new ba(this.graphic,t),this.chartRenderDataPresenter=new na(this.graphic,t,this.chartModelPresenterCreator,void 0)}teardown(){this.chartRenderDataPresenter.teardown(),this.chartInnerPresenter.teardown()}}class ba{constructor(e,t){this.viewModelUpdated=new nn.p,this.onAnchorTransformUpdated=async()=>{this.chart.modelUpdated.emit()},this.onViewTransformChanged=async()=>{this.chart.modelUpdated.emit()},this.onCombinedScaleChanged=async()=>{this.chart.modelUpdated.emit()},this.chart=e.model,this.context=t,this.chartPlayerViewModel=new ya(t.anchorPresenter.transform.pos,t.anchorPresenter.transform.size),this.layout(),this.context.anchorPresenter.transformUpdated.on(this.onAnchorTransformUpdated),this.context.viewScale.viewTransformChanged.on(this.onViewTransformChanged),this.context.viewScale.combinedScaleChanged.on(this.onCombinedScaleChanged)}get viewModel(){return this.chartPlayerViewModel}teardown(){this.context.anchorPresenter.transformUpdated.off(this.onAnchorTransformUpdated),this.context.viewScale.viewTransformChanged.off(this.onViewTransformChanged),this.context.viewScale.combinedScaleChanged.off(this.onCombinedScaleChanged)}async layout(){this.viewModelUpdated.emit()}}class Ta{constructor(e,t,r){this.renderDataType=Hs,this.viewModelUpdated=new nn.p,this.onModelUpdated=async(e,t)=>{null==t||t.addTimePoint("ModelUpdatedEventReceivedTime"),await this.layout(1,t)},this.onAnchorTransformUpdated=async()=>{await this.layout(2)},this.onViewTransformChanged=async()=>{await this.layout(8)},this.onCombinedScaleChanged=async()=>{await this.layout(4)},this.chart=e.model,this.context=t,this.layoutProvider=r,this.chartPlayerViewModel=new ya(t.anchorPresenter.transform.pos,t.anchorPresenter.transform.size),this.layout(15),this.chart.modelUpdated.on(this.onModelUpdated),this.context.anchorPresenter.transformUpdated.on(this.onAnchorTransformUpdated),this.context.viewScale.viewTransformChanged.on(this.onViewTransformChanged),this.context.viewScale.combinedScaleChanged.on(this.onCombinedScaleChanged)}init(e,t){void 0!==e&&this.viewModelUpdated.on(e),this.updateViewModelProperties(15,t).catch((e=>{(0,u.H)(0,14001,`${e}`)}))}get viewModel(){return this.chartPlayerViewModel}teardown(){this.chart.modelUpdated.off(this.onModelUpdated),this.context.anchorPresenter.transformUpdated.off(this.onAnchorTransformUpdated),this.context.viewScale.viewTransformChanged.off(this.onViewTransformChanged),this.context.viewScale.combinedScaleChanged.off(this.onCombinedScaleChanged)}async layout(e,t){let r;null==t||t.addTimePoint("ChartPlayerRenderDataPresenterStartTime"),r=new An("ChartPlayerRenderDataPresenter_Layout",void 0!==t?[t]:[]);let i=!1;try{0!=(2&e)&&(i=this.updateViewModelAnchorTransform()||i),0!=(4&e)&&(i=this.updateViewModelScaleFactor()||i),0!=(1&e)&&(i=await this.updateViewModelRenderData()||i),0!=(8&e)&&(i=this.updateViewModelViewTransform()||i)}finally{null==r||r.complete()}i&&(null==t||t.addTimePoint("ViewModelUpdatedEventEmittedTime"),this.viewModelUpdated.emit(t)),null==t||t.addTimePoint("ChartPlayerRenderDataPresenterEndTime")}async updateViewModelProperties(e,t){let r=!1;const i=new An("ChartPlayerRenderDataPresenter_UpdateViewModel",void 0!==t?[t]:[]);try{0!=(8&e)&&(r=this.updateViewModelViewTransform()||r),0!=(2&e)&&(r=this.updateViewModelAnchorTransform()||r),0!=(4&e)&&(r=this.updateViewModelScaleFactor()||r),0!=(1&e)&&(r=await this.updateViewModelRenderData()||r)}catch(e){throw(0,u.H)(0,14001,`Exception: ${e.message}`),e}finally{i.complete()}}async updateViewModelRenderData(){const e=this.context.anchorPresenter.transform;if(void 0!==this.chart.fallbackRenderData){const e=this.chart.fallbackRenderData;try{this.chartPlayerViewModel.setLayout({sceneGraphJson:e.sceneGraphJson,interactivityJson:e.interactivityJson})}catch(e){throw(0,u.H)(0,14001,`Exception: ${e.message}`),e}}else{const t=await this.layoutProvider.getLayout(this.chart,e);this.chartPlayerViewModel.setLayout(t)}return!0}updateViewModelAnchorTransform(){let e=!1;const t=this.context.anchorPresenter.transform;return this.chartPlayerViewModel.position.equals(t.pos)||(this.chartPlayerViewModel.position=t.pos.clone(),e=!0),this.chartPlayerViewModel.size.equals(t.size)||(this.chartPlayerViewModel.size=t.size.clone(),e=!0),e}updateViewModelViewTransform(){let e=!1;const t=this.context.viewScale.viewTransform;return this.chartPlayerViewModel.position.equals(t.pos)||(this.chartPlayerViewModel.position=t.pos.clone(),e=!0),this.chartPlayerViewModel.size.equals(t.size)||(this.chartPlayerViewModel.size=t.size.clone(),e=!0),e}updateViewModelScaleFactor(){return this.chartPlayerViewModel.scaleFactor!==this.context.viewScale.zoomFactor&&(this.chartPlayerViewModel.scaleFactor=this.context.viewScale.zoomFactor,!0)}}function wa(...e){return()=>{for(let t=e.pop();void 0!==t;t=e.pop())t()}}class xa{get transform(){var e;return null!==(e=this.previewTransform)&&void 0!==e?e:this.presenter.transform}constructor(e,t){this.transformUpdated=new nn.p,this.onTransformUpdated=(...e)=>{this.previewTransform=void 0,this.transformUpdated.emit(...e)},this.anchor=e.anchor,this.presenter=t,this.teardown=wa(this.presenter.transformUpdated.use(this.onTransformUpdated))}applyTransform(e){this.previewTransform=os(this.presenter.transform,e,!1,this.anchor.locks),this.transformUpdated.emit()}}class Ca{}class Sa{constructor(e=[],t){this.type=Ca,this.pointerEventNotifiers=(0,r.n)(),this.hitTestSlop=i.Hr,this.children=e,this.nodeId=t}teardown(){}}function Pa(e){return e.type===Ca}class Ea{constructor(e,t,r,i,n,o){this.viewModelUpdated=new nn.p,this.childPresenters=new Map,this.updateViewModel=(e,t)=>{const r=this.childPresenters;this.childPresenters=new Map;const i=[];for(const e of this.graphicCollection){const t=r.get(e);if(void 0!==t){r.delete(e),this.childPresenters.set(e,t),t.update(),i.push(t.container);continue}const n=this.createChildPresenter(e);this.childPresenters.set(e,n),i.push(n.container)}for(const[e,t]of r)t.teardown();this.viewModel.children=i,this.viewModelUpdated.emit(t)},this.graphicCollection=e.model,this.presenterCreator=t,this.anchorPresenterCreator=void 0!==(null==o?void 0:o.previewInfo)?function(e){return{createAnchorPresenter:t=>{const r=e.createAnchorPresenter(t);return new xa(t,r)}}}(r):r,this.site=i,this.presenterContext=n,this.editContext=o,this.viewModel=new Sa([],{nodeType:this.site.rootNodeType}),this.updateViewModel(),this.graphicCollection.modelUpdated.on(this.updateViewModel)}getPresenters(e){const t=this.childPresenters.get(e);return void 0===t&&(0,l._)(5e3,`Child presenters not found for graphic: ${e.id}`),[t.presenter,t.anchorPresenter]}reset(){this.clearChildPresenters(),this.updateViewModel()}teardown(){this.graphicCollection.modelUpdated.off(this.updateViewModel),this.clearChildPresenters()}clearChildPresenters(){for(const[e,t]of this.childPresenters)t.teardown();this.childPresenters.clear()}createChildPresenter(e){const t=this.anchorPresenterCreator.createAnchorPresenter(e),r=this.presenterCreator.createPresenter(e,Object.assign(Object.assign({},this.presenterContext),{anchorPresenter:t}),this.editContext);return new Ma(r,t,this.site.graphicNodeType,e.id,this)}}class Ma{constructor(e,t,r,i,n){this.onViewModelUpdated=(...e)=>{this.update(),this.parent.viewModelUpdated.emit(...e)},this.presenter=e,this.anchorPresenter=t,this.container=new Sa([e.viewModel],{nodeType:r,nodeKey:i}),this.parent=n,this.presenter.viewModelUpdated.on(this.onViewModelUpdated)}update(){this.container.children=[this.presenter.viewModel]}teardown(){this.presenter.viewModelUpdated.off(this.onViewModelUpdated),this.presenter.teardown(),this.anchorPresenter.teardown()}}class Ra{constructor(){this.rootNodeType="grCollR",this.graphicNodeType="grCollCh"}}class Aa{constructor(e){this.transformUpdated=new nn.p,this.onAnchorUpdated=e=>{this.transformUpdated.emit(e)},this.anchor=e,this.anchor.anchorUpdated.on(this.onAnchorUpdated)}get transform(){return this.anchor.transform}teardown(){this.anchor.anchorUpdated.off(this.onAnchorUpdated)}}function Ia(e){return new Aa(e.anchor)}class Fa extends class{constructor(e,t,r,i,n){this.viewModelUpdated=new nn.p,this.onModelUpdated=(e,t)=>{this.refreshViewModel(1,t).catch((e=>{this.logCatchReason(e)}))},this.onAnchorTransformUpdated=e=>{this.refreshViewModel(2,e).catch((e=>{this.logCatchReason(e)}))},this.onViewTransformUpdated=e=>{this.refreshViewModel(8,e).catch((e=>{this.logCatchReason(e)}))},this.onCombinedScaleChanged=()=>{this.refreshViewModel(4).catch((e=>{this.logCatchReason(e)}))},this.graphic=e,this.context=t,this.viewModel=r(),this.imageTypeChecker=i,this.presenterTraceCategory=n,this.teardown=wa(this.graphic.model.modelUpdated.use(this.onModelUpdated),this.context.anchorPresenter.transformUpdated.use(this.onAnchorTransformUpdated),this.context.viewScale.viewTransformChanged.use(this.onViewTransformUpdated),this.context.viewScale.combinedScaleChanged.use(this.onCombinedScaleChanged))}init(e,t){void 0!==e&&this.viewModelUpdated.on(e),this.updateViewModelProperties(15,t).catch((e=>{this.logCatchReason(e)}))}async updateViewModelProperties(e,t){let r=!1;const i=new An(`${this.presenterClassName}_UpdateViewModel`,void 0!==t?[t]:[]);try{0!=(8&e)&&(r=this.updateViewModelViewTransform()||r),0!=(2&e)&&(r=this.updateViewModelAnchorTransform()||r),0!=(4&e)&&(r=this.updateViewModelScaleFactor()||r),0!=(1&e)&&(r=await this.updateViewModelRenderData()||r)}catch(e){throw(0,u.H)(0,this.presenterTraceCategory,`Exception: ${e.message}`),e}finally{i.complete()}r&&(this.viewModelUpdated.emit(t),this.viewModel.imageViewModelUpdated.emit(function(e){const t=[];return 0!=(1&e)&&t.push(0),0!=(6&e)&&t.push(1),t}(e)))}async updateViewModelRenderData(){const e=this.graphic.model.fallbackRenderData;return void 0!==e&&(this.imageTypeChecker(e),this.viewModel.sourceAnchorBounds=e.sourceAnchorBounds.clone(),this.viewModel.bounds=e.targetBounds.clone(),await this.viewModel.setImageData(e.data),!0)}updateViewModelAnchorTransform(){return 0!==this.context.viewScale.viewTransform.size.width||0!==this.context.viewScale.viewTransform.size.height?this.updateViewModelViewTransform():!this.viewModel.transform.equals(this.context.anchorPresenter.transform)&&(this.viewModel.transform=this.context.anchorPresenter.transform.clone(),!0)}updateViewModelViewTransform(){return!this.viewModel.transform.equals(this.context.viewScale.viewTransform)&&(this.viewModel.transform=this.context.viewScale.viewTransform.clone(),!0)}updateViewModelScaleFactor(){return this.viewModel.scaleFactor!==this.context.viewScale.zoomFactor&&(this.viewModel.scaleFactor=this.context.viewScale.zoomFactor,!0)}logCatchReason(e){(0,u.H)(0,this.presenterTraceCategory,`${e}`)}async refreshViewModel(e,t){return this.updateViewModelProperties(e,t)}}{constructor(e,t,r){super(e,t,r,Ws.Ev,1),this.renderDataType=Ws.qp,this.presenterClassName="Base64ImagePresenter"}}async function Ba(e,t){return new Promise(((r,i)=>{e.onload=r,e.onerror=()=>{i("image.onerror")},e.src=t}))}class La{}class Da{get imageData(){return this._imageData}constructor(e){this.type=La,this.imageViewModelUpdated=new nn.p,this.pointerEventNotifiers=(0,r.n)(),this.sourceAnchorBounds=new s.U(0,0,0,0),this.bounds=new s.U(0,0,0,0),this.scaleFactor=1/window.devicePixelRatio,this.transform=new a.A,this.hitTestSlop=i.Hr,this.inCropMode=!1,this._imageData="",this.canvasImageSource=e}async setImageData(e){if(this._imageData=e,this.canvasImageSource instanceof HTMLImageElement)return Ba(this.canvasImageSource,e);(0,l._)(4,"Not yet supported")}teardown(){}}const ka="data:",Oa="text/plain",Ua="image/svg+xml";var Na,Va=function(e,t,r,i,n,o){this.color=e,this.direction=t,this.wrapScale=r,this.wrapOffset=i,this.diffuse=n,this.specular=o},Ga=function(e,t){this.ambientColor=e,this.lights=t},za=function(e,t){this.profile=e,this.size=t},Wa=function(e,t,r,i,n,o,s,a,l){this.materialType=e,this.diffuseColor=t,this.specularColor=r,this.ambientColor=i,this.emissiveColor=n,this.specularPower=o,this.useBlinnHighlight=s,this.diffuseFresnel=a,this.alphaFresnel=l},Ha=function(){function e(e,t,r,i,n,o,s,a){this.topBevel=e,this.bottomBevel=t,this.material=r,this.extrusionColor=i,this.extrusionHeight=n,this.contourColor=o,this.contourWidth=s,this.zPosition=a}return Object.defineProperty(e.prototype,"adjustedContourWidth",{get:function(){return Math.max(R,this.contourWidth)},enumerable:!1,configurable:!0}),e}();!function(e){function t(t,n){if(!t)return y.Identity;var o=t.pt?r(t.pt).scale(n):void 0,s=t.s?i(t.s):new g(1,1),a=t.rSpecified?t.r*e.c_internalAngleToRadianFactor:void 0,l=t.t?r(t.t).scale(n):void 0;return new y(o,s,a,l)}function r(e){return new g(e.x,e.y)}function i(e,t){return void 0===t&&(t=0),new g(e.x||t,e.y||t)}function n(e){return new ne(e[0]/255,e[1]/255,e[2]/255,e[3]/255)}function o(e,t){return void 0===t&&(t=1),new _(e.l*t,e.t*t,e.r*t,e.b*t)}function s(e){for(var t=[],r=0,i=e;r<i.length;r++){var o=i[r],s=o.pos,a=n(o.clr);t.push(new le(s,a))}return t.sort((function(e,t){return e.position-t.position})),t}function a(e,t){if(e.gradientStops=t,e.isGammaCorrected=!1,2==t.length||3==t.length){var r=t[0],i=t[t.length-1];if(0==Math.min(r.position,i.position)&&1==Math.max(r.position,i.position))if(2==t.length)e.isGammaCorrected=!0,e.blendBellShape=g.One;else if(3==t.length&&r.color.equals(i.color)){var n=t[1];e.gradientStops=[new le(0,r.color),new le(1,n.color)],e.isGammaCorrected=!0,e.blendBellShape=new g(n.position,1)}}}function l(t,r,i){switch(t.bt){case 0:return new ae(ne.Transparent);case 1:var l=n(t.Item.clr);return new ae(l);case 2:var c=t.Item;return(p=new he(2)).isStretched=c.isStretched,p.rotateWithShape=c.rtSp,p.angle=c.ang*e.c_internalAngleToRadianFactor,c.ftrct&&(p.fillToRect=o(c.ftrct)),c.ffrct&&(p.fillFromRect=o(c.ffrct)),c.stops&&a(p,s(c.stops)),p;case 3:var u=t.Item;return(p=new he(3)).isStretched=u.isStretched,p.rotateWithShape=u.rtSp,p.angle=u.ang*e.c_internalAngleToRadianFactor,u.ftrct&&(p.fillToRect=o(u.ftrct)),u.ffrct&&(p.fillFromRect=o(u.ffrct)),u.stops&&a(p,s(u.stops)),p;case 4:var d=t.Item;return(p=new he(4)).isStretched=d.isStretched,p.rotateWithShape=d.rtSp,p.angle=d.ang*e.c_internalAngleToRadianFactor,d.ftrct&&(p.fillToRect=o(d.ftrct)),d.ffrct&&(p.fillFromRect=o(d.ffrct)),d.stops&&a(p,s(d.stops)),p;case 5:var p,f=t.Item;return(p=new he(5)).isStretched=f.isStretched,p.rotateWithShape=f.rtSp,p.angle=f.ang*e.c_internalAngleToRadianFactor,f.ftrct&&(p.fillToRect=o(f.ftrct)),f.ffrct&&(p.fillFromRect=o(f.ffrct)),f.stops&&a(p,s(f.stops)),p;case 7:var g=t.Item;return new ue(g.type,n(g.clrFg),n(g.clrBg));case 6:return h(t.Item,r);case 8:case 9:i.Message(39084627,"unsupported Brush "+JSON.stringify(t))}return new ae(ne.Transparent)}function h(e,t){if(e.id){var r=new oe;r.id=e.id;var i=new ce(r);return i.wrapMode=e.wrpmd,i.alignment=e.algn,i.isStretched=e.isStretched,i.offset=new g(e.off.x,e.off.y),i.scale=new g(e.scale.x,e.scale.y),i.opacity=e.opcty,i.rotateWithShape=e.rotWShp,i.isStretched||(i.scale=i.scale.divide(new g(e.dpi.x,e.dpi.y)).scale(t.fromInch),i.offset=i.offset.scale(t.fromHighPrecisionUnit)),i}}function c(e){return{cap:e.capType,end:e.type,length:e.len,width:e.width,widthMin:e.widthMin}}function u(e,t,r){if(!e)return new fe;var i,n;e.fillBrsh&&(i=l(e.fillBrsh,t,r)),e.outlnBrsh&&(n=l(e.outlnBrsh,t,r));var o=function(e,t,r,i){var n=new pe(t*i);return n.lineHeight=r*i,e?(e.dtSpecified&&(n.dashType=e.dt),e.jtSpecified&&(n.lineJoin=e.jt),e.mlSpecified&&(n.miterLimit=e.ml),e.ctSpecified&&(n.compoundType=e.ct),e.atSpecified&&(n.alignment=e.at),e.doffSpecified&&(n.dashOffset=e.doff),e.dctSpecified&&(n.useRoundDash=1==e.dct),e.headEnd&&(n.headEnd=c(e.headEnd)),e.tailEnd&&(n.tailEnd=c(e.tailEnd)),e.tip&&(n.tipType=e.tip),n):n}(e.pen,e.lnWdth,e.lnHgth,t.fromHighPrecisionUnit),s=new fe(i,n,o);return e.pctBrush&&(s.pictureBrush=h(e.pctBrush,t)),e.blend&&(s.blendingMode=e.blend),s}function d(t,r,i){var o,s,a,l,h;if(t.glw){var c=t.glw.blrRd*r,u=n(t.glw.clr);o=new ve(u,c)}if(t.otrSdw){var d=t.otrSdw;(s=new ye(n(d.clr),d.blrRd*r,d.ang*e.c_internalAngleToRadianFactor,d.dst*r,new g(d.sx*i,d.sy*i),new g(d.kx,d.ky))).alignment=d.algn,s.shadowType=d.tp}if(t.inrSdw){var p=t.inrSdw;a=new _e(n(p.clr),p.blrRd*r,p.ang*e.c_internalAngleToRadianFactor,p.dst*r)}if(t.rflctn){var f=t.rflctn;l=new be(f.blrRd*r,f.sAlph,f.sPos,f.eAlph,f.ePos,f.dst*r)}return t.sftEdg&&(h=new Te(t.sftEdg.blrRd*r)),new we(o,s,a,l,h)}function f(e,r,i){var n=e.pts;if(n){var o,s,a=null==(o=e.f)?1:0==o?0:2==o?2:3==o?3:4==o?4:5==o?5:1;if(e.h>0){var l=JSON.parse("["+n+"]");s={figures:[new z(l,!1,e.h)]}}else s={figures:H(n)};return s.fillMode=a,s.lineEnabled=e.s,e.xfrm?s.transform=t(e.xfrm,i):s.transform=y.Identity,s.transform=s.transform.applyScaleAndTranslationBefore(new g(r,r),g.Zero),s.extrusionEnabled=e.e,s}}function v(e,r,n){for(var o=[],s=e.xfrm?t(e.xfrm,r.fromHighPrecisionUnit):y.Identity,a=e.fontInfo,l=0,h=e.glyphInstance;l<h.length;l++){var c=h[l];if(c.glyph&&n){var u=n.getGlyph(a,c.glyph);if(!u)continue;if(!u.clientData){var d=f(u.p,1,1);d&&(d.lineEnabled=!0,d.fillMode=1,d.glyphCacheId={fontId:a,glyphId:c.glyph},u.clientData=new N(d))}if(!u.clientData)continue;var p=i(c.scale,1).scale(r.fromHighPrecisionUnit);p=p.scale(.000244140625);var g=i(c.off).scale(r.fromHighPrecisionUnit),m=new N(u.clientData,s.applyScaleAndTranslationBefore(p,g));o.push(m)}}return o}function T(e){return new Ne(e.cp,e.len)}function w(e,t){var r=f(e,1,1);if(r){var i=r.figures.length?r.figures[0]:void 0;if(i){var n=i instanceof z?i:i.createFigure();if(1==t)return n;for(var o=n.points.slice(0),s=0;s<n.getPointCount();s++)o[s*n.pointDataSize]*=t,o[s*n.pointDataSize+1]*=t;return new z(o,n.isClosed,n.format)}}}function x(e,t){if(!e)return 0;switch(e){case 0:return 0;case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;case 5:return 5;case 6:return 6;case 7:return 7;case 8:return 8;case 9:return 9;case 10:return 10;case 11:return 11;case 12:return 12;case 13:return 13;case 14:return 14;case 15:return 15;case 16:return 16}return t.Error(595637021,"Incorrect ShapeBuilder.TextStrokeType"),1}function C(e,t,r){for(var i=new k,n=0,o=e;n<o.length;n++){var s=o[n],a=u(s.style,t,r);i.push(new ze(x(s.type,r),s.verticalCenter*t.fromLowPrecisionUnit,s.thickness*t.fromLowPrecisionUnit,a))}return i}function S(e,t,r,i,n,o){var s=o.getGlyph(n,e);if(s){if(!s.clientData){var a=f(s.p,1,1);a&&(a.lineEnabled=!0,a.fillMode=1,a.glyphCacheId={fontId:n,glyphId:e},s.clientData=new N(a))}if(s.clientData)return new N(s.clientData,new y(g.Zero,t,i,r))}}function P(t,r,n,o,s,a){for(var l=[],h=t.fi?t.fi.v:r,c=0,u=t.gi||[];c<u.length;c++){var d=u[c];if(d.g&&s){var p=d.s?i(d.s,1).scale(o.fromHighPrecisionUnit/4096):n||g.Zero;p.equals(g.Zero)&&a.Error(0,"No glyph scale");var f=i(d.o).scale(o.fromHighPrecisionUnit),m=d.r?d.r.v*e.c_internalAngleToRadianFactor:0,v=S(d.g,p,f,m,h,s);v&&l.push(v)}}return l}function E(e,t,r,i,n,s,a){for(var l=[],c=0,u=e.g||[];c<u.length;c++){var d=u[c];l=l.concat(P(d,t,r,i,n,a))}for(var p=0,g=e.p||[];p<g.length;p++){var m=f(g[p],i.fromHighPrecisionUnit,i.fromHighPrecisionUnit);m&&l.push(new N(m))}var v,y=o(e.lb,i.fromLowPrecisionUnit);if(e.i){var _=h(e.i.i,i),b=o(e.i.b,i.fromLowPrecisionUnit);(null==_?void 0:_.image)&&b&&(v=new Ke(_.image,b,s))}return new Ye(y,l,e.f?e.f.v:void 0,e.w?e.w.v:void 0,v)}function M(e,t,r,i,n,s,a){var l,h=T(e.rng),c=o(e.lbnd,i.fromLowPrecisionUnit),u=new Je(h,c),d=[];if(e.c)for(var p=0;p<e.c.length;p++){var f=E(e.c[p],t.getAt(u.localRange.start+p),r.getAt(u.localRange.start+p),i,n,s,a);f&&d.push(f)}else(null===(l=e.s)||void 0===l?void 0:l.v)&&(d=function(e,t,r,i,n,o,s,a){for(var l=[],h=e.split(";"),c=0;c<h.length;c++){for(var u=h[c].split(/([A-VXYZ])/),d=u.length>0?u[0]:void 0,p=void 0,f=void 0,m=1;m<u.length-1;m+=2){var v=u[m];"L"==v&&(p=u[m+1]),"R"==v&&(f=u[m+1])}if(d&&p&&f){var y=parseFloat(p)*s.fromLowPrecisionUnit,b=parseFloat(f)*s.fromLowPrecisionUnit,T="W"==d,w=void 0;if(!T){var x=S(parseInt(d),n.getAt(o+c),new g(y,0),0,i.getAt(o+c),r);x&&(w=[x])}var C=new _(y,t.top,b,t.bottom);l.push(new Ye(C,w,!1,T))}else a.Error(0,"Wrong SimplifiedCharacterString: 0:"+d+", L:"+p+", R:"+f)}return l}(e.s.v,c,n,t,r,u.localRange.start,i,a));return u.characters=d,e.b&&(u.bender=function(e,t){return e.wenv?function(e,t){var r=w(e.tpp,t.fromLowPrecisionUnit),i=w(e.btp,t.fromLowPrecisionUnit);if(r&&i)return new Xe(o(e.rct,t.fromLowPrecisionUnit),r,i,e.vrt)}(e.wenv,t):e.plin?function(e,t){var r=w(e.pth,t.fromLowPrecisionUnit);if(r){var i=0==e.algn?0:2==e.algn?1:.5;return new je(o(e.rct,t.fromLowPrecisionUnit),r,i,e.s,e.pvt,e.vrt)}}(e.plin,t):void 0}(e.b,i)),e.o&&(u.offset=new g(e.o.x*i.fromLowPrecisionUnit,e.o.y*i.fromLowPrecisionUnit)),u.fillBounds=o(e.fb,i.fromLowPrecisionUnit),u.textEffectMetrics=new Ze(e.ea*i.fromLowPrecisionUnit,e.ed*i.fromLowPrecisionUnit,e.eh*i.fromLowPrecisionUnit),u}function R(e,t,r,n,o){var s=new Qe(T(e.gr),new fe(new ue(27,ne.Blue,ne.Yellow)));e.o&&(s.offset=new g(e.o.x*r.fromLowPrecisionUnit,e.o.y*r.fromLowPrecisionUnit));for(var a=new Ve(""),l=0,h=e.fipr||[];l<h.length;l++){var c=h[l];a.set(c.fontInfo,T(c.range))}for(var p=new Ve(g.Zero),f=0,m=e.gspr||[];f<m.length;f++){var v=m[f];p.set(i(v.s,1).scale(r.fromHighPrecisionUnit/4096),T(v.rng))}e.blt&&(s.bullet=function(e,t,r,i,n,o){var s;if(e.c){var a=E(e.c,t,void 0,r,i,n,o),l=u(e.style,r,o),h=e.fx?d(e.fx,r.fromHighPrecisionUnit,1):void 0,c=(null===(s=e.stks)||void 0===s?void 0:s.length)>0?C(e.stks,r,o):void 0;return new $e(a,l,h,c)}}(e.blt,e.blt.fi,r,t,n,o));for(var y=new Array,_=0,b=e.l||[];_<b.length;_++){var w=M(b[_],a,p,r,t,n,o);w&&y.push(w)}for(var x=0,S=e.spr||[];x<S.length;x++){var P=S[x],R=u(P.style,r,o);s.stylePerLocalRange.set(R,T(P.range))}for(var A=0,I=e.stkspr||[];A<I.length;A++){var F=I[A],B=C(F.textStrokeList,r,o);B?s.strokesPerLocalRange.set(B,T(F.range)):o.Error(39084627,"Unable to convert stroke")}for(var L=0,D=e.lwrng||[];L<D.length;L++){var k=D[L];s.addLocalWordRange(T(k))}for(var O=0,U=e.fxpr||[];O<U.length;O++){var N=U[O];s.effectsPerLocalRange.set(d(N.fx,r.fromHighPrecisionUnit,1),T(N.range))}return s.lines=y,s}e.c_internalAngleToRadianFactor=2*Math.PI/216e5,e.getPresWidthAndHeightJson=function(e){return new g(e.w,e.h)};var A=[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0];function I(e){var t=A[e];if(t)return t;var r=new W;switch(r.moveTo(0,0),e){case 0:r.cubicBezierTo(0,.367,.124605,.82,.507899,1),r.cubicBezierTo(.724115,.737,.790455,.64,1,.64);break;case 1:r.cubicBezierTo(0,.55627,.44373,1,1,1);break;case 2:r.quadBezierTo(0,.125,.025,.25),r.lineTo(.125,.75),r.cubicBezierTo(.175,1,.25,1,.375,1),r.lineTo(.5,1),r.cubicBezierTo(.625,1,.7,1,.75,.75),r.lineTo(.875,.125),r.cubicBezierTo(.9,.01,.98,.01,1,.01);break;case 3:r.cubicBezierTo(0,.05563,.04437,.1,.1,.1),r.lineTo(.4,.1),r.cubicBezierTo(.45563,.1,.5,.14437,.5,.2),r.lineTo(.5,.9),r.cubicBezierTo(.5,.95563,.54437,1,.6,1);break;case 4:r.lineTo(1,1);break;case 5:r.cubicBezierTo(0,.4775,.0968736,1,.156301,1),r.cubicBezierTo(.264179,1,.376919,.33333,1,.33333);break;case 6:r.cubicBezierTo(0,.07082,.0297458,.1,.101416,.1),r.cubicBezierTo(.501416,.1,.9,.7,.901416,.899999),r.cubicBezierTo(.9,.97167,.93343,1,1,1);break;case 7:r.cubicBezierTo(0,.138122,0,.2,.271356,.775535),r.cubicBezierTo(.377654,1,.519455,1,.583589,1);break;case 8:r.cubicBezierTo(0,.236604,.119276,.607024,.263046,.760235),r.cubicBezierTo(.361098,.864726,.457934,.909567,.537806,.925082),r.cubicBezierTo(.559245,.929246,.567625,.89793,.542066,.845567),r.cubicBezierTo(.484073,.726757,.477103,.393693,.551651,.393693),r.lineTo(.899894,.393693),r.cubicBezierTo(.99148,.393693,.958466,.746659,.907348,.779629),r.lineTo(.879394,.797658),r.cubicBezierTo(.845545,.819489,.848775,.954172,.874334,.971627),r.quadBezierTo(.915883,1,1,1);break;case 9:r.cubicBezierTo(0,.238519,.132047,.500741,.357567,.731852),r.cubicBezierTo(.513167,.891311,.563798,.912593,.735905,.912593),r.lineTo(.873887,.912593),r.cubicBezierTo(.956973,.912593,.878338,1,1,1);break;case 10:r.quadBezierTo(0,.092437,.042353,.305322),r.lineTo(.170124,.947558),r.cubicBezierTo(.177203,.983142,.2,1,.268235,.998599),r.lineTo(.614118,.998599),r.cubicBezierTo(.647059,.998599,.656471,.987395,.663529,.969188),r.cubicBezierTo(.687006,.908633,.802353,.822129,1,.822129);break;case 11:r.cubicBezierTo(0,.184095,.149238,.333333,.333333,.333333),r.cubicBezierTo(.333333,.701523,.63181,1,1,1);break;default:r.lineTo(1,0)}return t=r.createFigure(),A[e]=t,t}function F(e,r,i,n,o){var s,a,l=new et,h=new y(n.translation.negate(),g.One,-n.rotation,g.Zero);return l.paragraphs=function(e,t,r,i,n){for(var o=[],s=0,a=e||[];s<a.length;s++){var l=a[s];o.push(R(l,t,r,i,n))}return o}(e.p,r,i,h,o),l.layoutToFrame=t(e.ltfxfrm,i.fromHighPrecisionUnit),l.frameToShape=t(e.ftsxfrm,i.fromHighPrecisionUnit),l.clipBounds=(s=e.c,a=i.fromLowPrecisionUnit,s?new b(s.l?s.l.v*a:void 0,s.t?s.t.v*a:void 0,s.r?s.r.v*a:void 0,s.b?s.b.v*a:void 0):void 0),l.applyEffectsPerCharacter=!!e.s&&e.s.v,l}function B(e){return e.clientData||(e.clientData={}),e.clientData}function L(e,r,i,o,s){var a;if(e){var l,h=(null===(a=e.bapi)||void 0===a?void 0:a.v)||"";if(e.Items){for(var c=[],y=0,_=e.Items;y<_.length;y++){var b=L(_[y],r,i,o,s);b&&c.push(b)}var T=e.fx?d(e.fx,i.fromHighPrecisionUnit,.01):void 0;l=new Se(c,T)}else l=function(e,r,i,o,s){try{if(!e)return;var a=[],l=t(e.xfrm,o.fromHighPrecisionUnit),h=new Array;if(r)for(var c=0,m=r;c<m.length;c++){var y=m[c];if(y){var _=f(y,o.fromHighPrecisionUnit,o.fromHighPrecisionUnit);_&&h.push(new N(_))}}e.tx&&function(e,r,i,n,o,s){for(var a,l=0,h=e;l<h.length;l++){var c=h[l];if(c.primitives){for(var d=new Array,p=0,g=c.primitives;p<g.length;p++){var m=g[p];if(null===(a=null==m?void 0:m.p)||void 0===a?void 0:a.pts.length){var y=f(m.p,n.fromHighPrecisionUnit,n.fromHighPrecisionUnit);if(!y)continue;y.lineEnabled=!0,y.fillMode=1,d.push(new N(y))}else if(m.r){var _=v(m.r,n,i);d.push.apply(d,_)}}var b={fromLowPrecisionUnit:n.fromLowPrecisionUnit,fromHighPrecisionUnit:n.fromLowPrecisionUnit,fromInch:n.fromInch},T=u(c.style,b,s),w=t(c.xfrm,n.fromHighPrecisionUnit),x=new Ce(d,T,void 0,w);x.overlapMode=1,x.mergeMode=c.union?1:0,x.role=3,o.push(x)}}}(e.tx,0,i,o,a,s);var b=u(e.style,o,s),T=e.fx?d(e.fx,o.fromHighPrecisionUnit,.01):void 0;if(e.tx){var w=T?new we(void 0,void 0,T.innerShadow,void 0,T.softEdges):void 0,x=T?new we(T.glow,T.shadow,void 0,T.reflection,void 0):void 0,C=new Ce(h,b,w,l);return e.tl&&(C.text=F(e.tl,i,o,l,s)),new Se((0,p.ev)([C],a),x)}var S=new Ce(h,b,T,l);if(e.tl&&(S.text=F(e.tl,i,o,l,s)),void 0!==e.ioff){for(var P=[],E=0,M=e.ioff;E<M.length;E++){var R=M[E],A=new g(R.x*o.fromHighPrecisionUnit,R.y*o.fromHighPrecisionUnit);P.push(A)}P.length>0&&(S.instanceOffsets=P)}if(e.s3d){var B=e.s3d.tb?new za(I(e.s3d.tb.p),new g(e.s3d.tb.w*o.fromLowPrecisionUnit,e.s3d.tb.h*o.fromLowPrecisionUnit)):void 0,L=e.s3d.bb?new za(I(e.s3d.bb.p),new g(e.s3d.bb.w*o.fromLowPrecisionUnit,e.s3d.bb.h*o.fromLowPrecisionUnit)):void 0,D=function(e,t,r,i){var n=t,o=0,s=ne.Black,a=ne.Black,l=ne.Black,h=0,c=!1,u=0,d=0;switch(e){case 0:a=t,c=!0;break;case 1:s=ne.White,a=t,h=32,c=!0;break;case 2:var p=ne.InterpolateLinear(t,ne.Black,1/3);n=p,s=t,a=p,h=32,c=!0,o=2;break;case 3:o=1;break;case 4:a=t;break;case 5:s=ne.Gray(.6),a=t,h=12;break;case 6:var f=ne.InterpolateLinear(t,ne.White,.2);s=f=ne.InterpolateLinear(f,ne.White,1.4),a=t,h=12,u=4,o=2;break;case 7:s=ne.Gray(.3),a=t,h=8;break;case 8:n=g=new ne(t.r,t.g,t.b,.7),s=ne.Gray(.3),a=g,h=10,c=!0,u=2,d=-1;break;case 9:n=ne.InterpolateLinear(t,ne.White,.5),s=ne.Gray(.3),a=ne.InterpolateLinear(t,ne.White,.5),h=10,c=!0,u=2;break;case 10:s=ne.White,a=t,h=35,u=-2;break;case 11:s=ne.White,a=t,h=35,u=4,d=-10;break;case 12:var g;n=g=new ne(t.r,t.g,t.b,.1),s=ne.Gray(.6),a=g,h=20,u=-8,d=1;break;case 13:n=new ne(0,0,0,t.a),s=ne.Gray(.8),l=t,h=50,u=-4,d=1;break;case 14:n=ne.InterpolateLinear(t,ne.White,.5),a=t,h=8,o=2;break;default:s=ne.White,a=t,h=40}return r||0!=e&&1!=e&&2!=e||(n=new ne(0,0,0,t.a),s=ne.Gray(.8),a=ne.Black,l=t,h=50,c=!1,u=-4,d=0),new Wa(o,n,s,a,l,h,c,u,d)}(e.s3d.mt,ne.White,b.fillBrush instanceof ae&&b.lineBrush instanceof ae),k=e.s3d.cc?n(e.s3d.cc.v):1==D.materialType?ne.Black:void 0,O=e.s3d.cc?e.s3d.cw*o.fromLowPrecisionUnit:0,U=e.s3d.xc?n(e.s3d.xc.v):void 0,V=new Ha(B,L,D,U,e.s3d.h*o.fromLowPrecisionUnit,k,O,e.s3d.z*o.fromLowPrecisionUnit);S.shape3D=V}return S}catch(e){s.Error(595637020,"Unexpected exception parsing shape")}}(e,e.pthLst||[],r,i,o);return l&&(l.scene3D=e.scn?function(e){for(var t=[],r=0,i=e.l||[];r<i.length;r++){var o=i[r];t.push(new Va(new ne(o.cr,o.cg,o.cb,1),new m(o.dx,o.dy,o.dz),o.ws,o.wo,o.d,o.s))}return new Ga(n(e.a),t)}(e.scn):void 0,B(l).partId=h,B(l).renderDataId=e.id,(null==s?void 0:s.defaultClientData)&&function(e,t){for(var r=B(e),i=0,n=Object.keys(t);i<n.length;i++){var o=n[i];r[o]=t[o]}}(l,s.defaultClientData)),l}}e.convertDocShapeOrGroup=function(e,t,r,i,n){if(e){var o=12700*r;return L(e,t,{fromLowPrecisionUnit:e.lpu?e.lpu.v*o:1,fromHighPrecisionUnit:e.hpu?e.hpu.v*o:r,fromInch:914400*r},i,n)}},e.convertShapeOrGroupRenderData=L}(Na||(Na={}));const ja=new class{Error(e,t){(0,u.H)(e,2504,t)}Message(e,t){(0,u.PN)(e,2504,t)}};function qa(e,t){let r=0;return 0!==t&&(r=e/t),r}class Xa{constructor(e,t,r,i){this.renderDataType=qs,this.viewModel=new Sa,this.childViewModels=new Map,this.viewModelUpdated=new nn.p,this.sbViewModel=new De,this.onModelUpdated=(e,t)=>{null==t||t.addTimePoint("ModelUpdatedEventReceivedTime"),this.refreshViewModel(1,t).catch((e=>{this.logCatchReason("onModelUpdated",e)}))},this.onAnchorTransformUpdated=e=>{this.refreshViewModel(2,e).catch((e=>{this.logCatchReason("onAnchorTransformUpdated",e)}))},this.onViewTransformUpdated=e=>{this.refreshViewModel(8,e).catch((e=>{this.logCatchReason("onViewTransformUpdated",e)}))},this.onCombinedScaleChanged=()=>{this.refreshViewModel(4).catch((e=>{this.logCatchReason("onCombinedScaleChanged",e)}))},this.graphic=e,this.glyphStore=t,this.context=r,this.shapeBuilderContext=i,this.viewModel.children=[this.sbViewModel],this.viewModel.model=this.graphic.model,this.graphic.model.modelUpdated.on(this.onModelUpdated),this.context.anchorPresenter.transformUpdated.on(this.onAnchorTransformUpdated),this.context.viewScale.viewTransformChanged.on(this.onViewTransformUpdated),this.context.viewScale.combinedScaleChanged.on(this.onCombinedScaleChanged)}init(e,t){void 0!==e&&this.viewModelUpdated.on(e),this.updateViewModelProperties(15,t).catch((e=>{this.logCatchReason("constructor",e)}))}teardown(){this.context.anchorPresenter.transformUpdated.off(this.onAnchorTransformUpdated),this.context.viewScale.viewTransformChanged.off(this.onViewTransformUpdated),this.graphic.model.modelUpdated.off(this.onModelUpdated)}async updateViewModelProperties(e,t){null==t||t.addTimePoint("ShapeBuilderRenderDataPresenterStartTime");let r=!1;const i=new An("ShapeBuilderRenderDataPresenter_UpdateViewModel",void 0!==t?[t]:[]);try{0!=(8&e)&&(r=this.updateViewModelViewTransform()||r),0!=(2&e)&&(r=this.updateViewModelAnchorTransform()||r),0!=(4&e)&&(r=this.updateViewModelZoomFactor()||r),0!=(1&e)&&(r=await this.updateViewModelRenderData(t)||r)}catch(e){throw(0,u.H)(0,2505,`Exception: ${e.message}`),e}finally{i.complete()}r&&(null==t||t.addTimePoint("ViewModelUpdatedEventEmittedTime"),this.viewModelUpdated.emit(t)),null==t||t.addTimePoint("ShapeBuilderRenderDataPresenterEndTime")}async updateViewModelRenderData(e){const t=this.graphic.model.fallbackRenderData;if(void 0===t)return!1;!function(e){if(!Ks(e))throw new Error(`Invalid renderData type: ${e.type}`)}(t);let r=1,i=1;r=0!==this.context.viewScale.viewTransform.size.width?qa(this.context.viewScale.viewTransform.size.width,t.sourceAnchorBounds.width()):qa(this.context.anchorPresenter.transform.size.width,t.sourceAnchorBounds.width()),i=0!==this.context.viewScale.viewTransform.size.height?qa(this.context.viewScale.viewTransform.size.height,t.sourceAnchorBounds.height()):qa(this.context.anchorPresenter.transform.size.height,t.sourceAnchorBounds.height());const n=Math.max(r,i),o=t.sourceAnchorBounds.clone();if(o.scale(n,n),o.isEmpty())return this.sbViewModel.setItems([]),!0;const s=Na.convertDocShapeOrGroup(t.shapeBuilderRenderData,this.glyphStore,n,ja,{});if(void 0===s)this.sbViewModel.setItems([]);else{this.createViewModelsForChild(s,o,n);const r=new An("ShapeBuilderRenderDataPresenter_SetImageList",void 0!==e?[e]:[]);try{await this.setImageListIntoShapeBuilderDataAsync(t.embeddedImageList,s)}finally{r.complete()}this.sbViewModel.setItems([s])}return this.sbViewModel.sourceAnchorBounds=o,this.sbViewModel.emuToSourceScale=n,!0}createViewModelsForChild(e,t,r){if(this.childViewModels.clear(),2===e.getType()){const i=e;if(void 0!==i.clientData.renderDataId){const e=i.items;e.length>0&&2===e.elements[0].getType()&&(e.elements[0].items.elements.forEach((e=>{const i=new De;i.setItems([e]),i.isHitTestOnly=!0,i.sourceAnchorBounds=t,i.emuToSourceScale=r;const n=e.clientData.renderDataId,o=this.getRenderDataIdForItemWithKey(n,"creation"),s=this.getRenderDataIdForItemWithKey(n,"type");this.childViewModels.set(o,new Sa([i],{nodeType:s,nodeKey:o}))})),this.viewModel.children.push(...this.childViewModels.values()))}}}getRenderDataIdForItemWithKey(e,t){let r="";return e.forEach((e=>{e.k===t&&(r=e.v)})),r}async setImageListIntoShapeBuilderDataAsync(e,t){if(void 0===e||0===e.length)return;const r=this.attachTexturesForImagesAsync(e,t);0===this.sbViewModel.scene.items.length?r.then((()=>{this.viewModelUpdated.emit()})).catch((e=>{this.logCatchReason("attachTexturesForImagesAsync continuation",e)})):await r}async attachTexturesForImagesAsync(e,t){const r=t.getBrushImages(),i=[];for(const t of e)for(const e of r)t.imageIdField.toString()===e.id&&i.push(this.attachTextureForImageAsync(t.imageDataField,e));await Promise.all(i)}async attachTextureForImageAsync(e,t){const r=new window.Image;await Ba(r,e),function(e){if(0!==e.width||0!==e.height)return;const t=function(e){try{const t=function(e){if(!e.startsWith(ka))return;const t=e.indexOf(",",ka.length);if(-1===t)return;const r=e.substring(ka.length,t);if(r.length<=0)return Oa;const i=r.indexOf(";"),n=-1===i?r:r.substring(0,i);return n.length<=0?Oa:n.toLowerCase()}(e);if(t!==Ua)return;const r=e.indexOf(",",ka.length);if(-1===r)return;const i=e.substring(r+1);if(0===i.length)return;const n=decodeURIComponent(i),o=(new DOMParser).parseFromString(n,Ua).documentElement,s=function(e,t){if(e.unitType===t.unitType)return e.value/t.value}(o.width.baseVal,o.height.baseVal);return void 0===s?new _o.N(300,150):isFinite(s)?new _o.N(150*s,150):new _o.N(300,0)}catch(e){return}}(e.src);void 0!==t&&(e.width=t.width,e.height=t.height)}(r);const i=this.shapeBuilderContext.renderer,n=Gt.CreateFromHTMLImageElement("ShapeBuilderRenderDataPresenter",i,r);i.attachTextureToImage(t,n)}updateViewModelAnchorTransform(){return 0!==this.context.viewScale.viewTransform.size.width||0!==this.context.viewScale.viewTransform.size.height?this.updateViewModelViewTransform():!this.sbViewModel.transform.equals(this.context.anchorPresenter.transform)&&(this.sbViewModel.transform=this.context.anchorPresenter.transform.clone(),!0)}updateViewModelViewTransform(){return!this.sbViewModel.transform.equals(this.context.viewScale.viewTransform)&&(this.sbViewModel.transform=this.context.viewScale.viewTransform.clone(),!0)}updateViewModelZoomFactor(){return this.sbViewModel.scaleFactor!==this.context.viewScale.zoomFactor&&(this.sbViewModel.scaleFactor=this.context.viewScale.zoomFactor,!0)}logCatchReason(e,t){(0,u.H)(0,2505,`ShapeBuilderRenderDataPresenter.${e}: ${t}`)}async refreshViewModel(e,t){return this.updateViewModelProperties(e,t)}}function Ka(e,t){try{e.setPointerCapture(t.pointerId)}catch(e){}}class Ya{constructor(){this.zoomPanUpdated=new nn.p,this._zoom=1,this._pan=new Xn.S(0,0)}static getInstance(){return void 0===Ya.instance&&(Ya.instance=new Ya),Ya.instance}set zoom(e){this._zoom!==e&&(this._zoom=e,this.zoomPanUpdated.emit())}get zoom(){return this._zoom}set pan(e){this._pan.x===e.x&&this._pan.y===e.y||(this._pan=new Xn.S(e.x,e.y),this.zoomPanUpdated.emit())}get pan(){return new Xn.S(this._pan.x,this._pan.y)}setZoomAndPan(e,t){this._zoom===e&&this._pan.x===t.x&&this._pan.y===t.y||(this._zoom=e,this._pan=new Xn.S(t.x,t.y),this.zoomPanUpdated.emit())}getRelativePosition(e){return new Xn.S((e.x-this._pan.x)/this._zoom,(e.y-this._pan.y)/this._zoom)}getRelativeSize(e){return new _o.N(e.width/this._zoom,e.height/this._zoom)}getAbsolutePosition(e){return new Xn.S(e.x*this._zoom+this._pan.x,e.y*this._zoom+this._pan.y)}getAbsoluteSize(e){return new _o.N(e.width*this._zoom,e.height*this._zoom)}}function $a(e){if(null!==e.currentTarget){const t=e.currentTarget.getBoundingClientRect();return Ya.getInstance().getRelativePosition(new Xn.S(e.clientX-t.left,e.clientY-t.top))}return new Xn.S(0,0)}class Za{}class Ja{constructor(e,t,r){this.type=Za,this.onPointerDown=(e,t)=>{Ka(e.currentTarget,e),this.dragStartPosition=$a(e),e.ctrlKey||e.shiftKey?this.editContext.actionInvoker.invoke(new As([this.elementModelId])):(this.editContext.actionInvoker.invoke(new Yo.rZ([this.graphic])),this.editContext.actionInvoker.invoke(new Ms([this.elementModelId]))),t.isHandled=!0},this.onPointerMove=(e,t)=>{void 0!==this.dragStartPosition?t.isHandled=!0:t.isHandled=!1},this.onPointerUp=(e,t)=>{void 0!==this.dragStartPosition?(this.dragStartPosition=void 0,t.isHandled=!0):t.isHandled=!1},this.onPointerCancel=(e,t)=>{void 0!==this.dragStartPosition?(this.dragStartPosition=void 0,t.isHandled=!0):t.isHandled=!1},this.graphic=e,this.elementModelId=t,this.editContext=r}addEventListeners(e){e.pointerEventNotifiers.pointerdown.value.on(this.onPointerDown),e.pointerEventNotifiers.pointermove.value.on(this.onPointerMove),e.pointerEventNotifiers.pointerup.value.on(this.onPointerUp),e.pointerEventNotifiers.pointercancel.value.on(this.onPointerCancel)}removeEventListeners(e){e.pointerEventNotifiers.pointerdown.value.off(this.onPointerDown),e.pointerEventNotifiers.pointermove.value.off(this.onPointerMove),e.pointerEventNotifiers.pointerup.value.off(this.onPointerUp),e.pointerEventNotifiers.pointercancel.value.off(this.onPointerCancel)}}class Qa{constructor(e,t,r){this.elements=new Map,this.updateElements=()=>{const e=this.elements;this.elements=new Map;const t=this.presenter.viewModel;Pa(t)&&t.children.forEach((t=>{var r;if(Pa(t)&&void 0!==(null===(r=t.nodeId)||void 0===r?void 0:r.nodeKey)&&1===t.children.length){const r=t.nodeId.nodeKey,i=e.get(r);void 0!==i?(e.delete(r),this.elements.set(r,i),i.setViewModel(t.children[0])):this.elements.set(r,new el(new Ja(this.graphic,r,this.editContext),t.children[0]))}}));for(const[t,r]of e)r.teardown()},this.graphic=e,this.presenter=t,this.editContext=r,this.updateElements(),this.presenter.viewModelUpdated.on(this.updateElements)}teardown(){this.presenter.viewModelUpdated.off(this.updateElements);for(const[e,t]of this.elements)t.teardown()}}class el{constructor(e,t){this.element=e,this.viewModel=t,this.element.addEventListeners(this.viewModel)}teardown(){this.element.removeEventListeners(this.viewModel)}setViewModel(e){this.viewModel!==e&&(this.element.removeEventListeners(this.viewModel),this.viewModel=e,this.element.addEventListeners(this.viewModel))}}const tl={nodeType:"root"};class rl{get viewModel(){return this.smartArtRenderDataPresenter.viewModel}get viewModelUpdated(){return this.smartArtRenderDataPresenter.viewModelUpdated}constructor(e,t,r,i){this.smartArtModelPresenterCreator=(e,t,r)=>this.smartArtInnerPresenter,this.graphic=e,this.smartArtInnerPresenter=new il(this.graphic,t,r),this.smartArtRenderDataPresenter=new na(this.graphic,t,this.smartArtModelPresenterCreator,i),void 0!==i&&(this.editElements=new Qa(this.graphic,this,i))}teardown(){var e;null===(e=this.editElements)||void 0===e||e.teardown(),this.smartArtRenderDataPresenter.teardown(),this.smartArtInnerPresenter.teardown()}}class il{constructor(e,t,r){this.viewModel=new Sa([],tl),this.viewModelUpdated=new nn.p,this.onLayoutUpdated=()=>{this.updateViewModel().catch((()=>{}))},this.onAnchorTransformUpdated=()=>{this.smartArt.modelUpdated.emit()},this.graphic=e,this.smartArt=this.graphic.model,this.anchorPresenter=t.anchorPresenter,this.presenterSite=r,this.smartArt.layoutUpdated.on(this.onLayoutUpdated),this.anchorPresenter.transformUpdated.on(this.onAnchorTransformUpdated)}teardown(){this.anchorPresenter.transformUpdated.off(this.onAnchorTransformUpdated),this.smartArt.layoutUpdated.off(this.onLayoutUpdated)}async updateViewModel(){const e=await this.presenterSite.getViewModel();this.viewModel.children=e.children,this.viewModelUpdated.emit()}}class nl{constructor(e){this.transformUpdated=new nn.p,this.onAnchorUpdated=e=>{this.transformUpdated.emit(e)},this.anchor=e,this.anchor.anchorUpdated.on(this.onAnchorUpdated)}get transform(){return this.anchor.transform}teardown(){this.anchor.anchorUpdated.off(this.onAnchorUpdated)}}function ol(e){return new nl(e.anchor)}class sl{constructor(){this.containerViewModel=new Sa}async getViewModel(){return this.containerViewModel}}function al(){return new sl}var ll=n(1093);var hl=n(7721);class cl{constructor(e,t){this.container=e,this.canvas2D=t}beginRender(){(0,hl.o)(this.container)}endRender(){}hitTest(e){}addViewModel(e){if(function(e){return e.type===va}(e)){if(void 0===e.element||null===e.element)return;e.element.setAttribute("x",`${e.position.x}`),e.element.setAttribute("y",`${e.position.y}`),this.container.appendChild(e.element),void 0!==this.canvas2D&&(this.canvas2D.style.display="none")}}beginGroup(e){}endGroup(){}}class ul{constructor(e){this.renderScope=0,this.inBeginRender=!1,this.inEndRender=!1,this.renderTargetRegistry=e}beginRender(){if(!this.inBeginRender)try{this.inBeginRender=!0,0===this.renderScope&&this.renderTargetRegistry.beginRender(),this.renderScope+=1}finally{this.inBeginRender=!1}}endRender(){if(!this.inEndRender)try{this.inEndRender=!0,this.renderScope-=1,0===this.renderScope&&this.renderTargetRegistry.endRender()}finally{this.inEndRender=!1}}hitTest(e){}addViewModel(e,t){Pa(e)&&e.children.forEach((e=>{this.renderTargetRegistry.addViewModel(e,t)}))}beginGroup(e){}endGroup(){}}function dl(e){e.register(Ca,new ul(e))}class pl{constructor(e){this.hitTestMap=new Hn,this.renderers=new pn.B([]),this.renderScope=0,this.root=e}registerRenderer(e,t){return this.renderers.register(e,t),this}beginRender(){0===this.renderScope&&((0,hl.o)(this.root),this.hitTestMap.clear()),this.renderScope+=1}addViewModel(e){const t=this.renderers.get(e.type);void 0===t&&(0,l._)(4,`Unregistered VM type: ${e.type}`),t(e,this)}endRender(){this.renderScope-=1}hitTest(e){if(void 0!==e.target&&null!==e.target)return this.hitTestMap.getViewModel(e.target)}beginGroup(){}endGroup(){}}class fl{renderViewModel(e,t){const r=new d("ImageCanvas2DRenderer.renderViewModel");try{!function(e){e.type!==La&&(0,l._)(4,`Invalid viewModel type ${e.type}`)}(e);const i=Nn(e.sourceAnchorBounds,e.bounds,e.transform,e.scaleFactor,r);Vn(e.canvasImageSource,t.canvasElement,i)}finally{r.complete()}}hitTest(e,t){}}var gl=n(2485);function ml(e,t){const r=new fl,i=new Un(e,r);t.register(La,i)}function vl(e,t,i,n,o,s,a,l){1===e?function(e,t){if(void 0===t.viewDiv)throw new Error("No viewDiv");const r=document.createElement("canvas");t.viewDiv.appendChild(r),ml(r,e);const i=document.createElement("div");i.id="ChartPlayerViewDiv",t.viewDiv.appendChild(i);const n=new cl(i,r);e.register(va,n),dl(e)}(t,i):2===e?function(e,t){if(void 0===t.viewDiv||null===t.viewDiv.parentElement)throw new Error("No viewDiv");t.viewDiv.parentElement.style.zIndex="2";const r=document.createElement("div");r.style.overflow="visible",r.style.pointerEvents="none",t.viewDiv.appendChild(r);const i=new pl(r);i.registerRenderer(gl.P,gl.AU),e.register(gl.P,i),dl(e)}(t,i):function(e,t,i,n,o,s,a){if(void 0===t.viewDiv)throw new Error("No viewDiv");const l=document.createElement("canvas");l.height=0,l.width=0,t.viewDiv.appendChild(l),ml(l,e),void 0!==i&&(o?function(e,t,i,n,o,s,a){if(void 0===n.viewDiv)throw new Error("No viewDiv");if(void 0===n.editDiv)throw new Error("No editDiv");const l=(0,r.n)();l.pointerdown.value.on(s);const h=new Zn(i,n.viewDiv,n.editDiv,e,o,l,a);t.register(Le,h)}(l,e,i,t,n,s,a):function(e,t,r){const i=new $n(t),n=new Un(e,i);r.register(Le,n)}(l,i,e)),dl(e)}(t,i,n,o,s,a,l)}function yl(){}class _l{constructor(e,t,r,i,n,o){this.onPointerDown=e=>{Ka(e.currentTarget,e),jn(e,this.cursor.drag),this.dragStartPos=$a(e),this.dragStart(e)},this.onPointerMove=e=>{if(void 0===this.dragStartPos)return jn(e,this.cursor.hover),void this.hover(e);jn(e,this.cursor.drag),this.dragMove(...bl(e,this.dragStartPos))},this.onPointerUp=e=>{jn(e,this.cursor.hover),void 0!==this.dragStartPos&&(this.dragEnd(...bl(e,this.dragStartPos)),this.dragStartPos=void 0)},this.onPointerCancel=e=>{void 0!==this.dragStartPos&&(this.dragCancel(e),this.dragStartPos=void 0)},this.cursor=e,this.hover=t,this.dragStart=r,this.dragMove=i,this.dragEnd=n,this.dragCancel=o}attach(e){e.pointerdown.value.on(this.onPointerDown),e.pointermove.value.on(this.onPointerMove),e.pointerup.value.on(this.onPointerUp),e.pointercancel.value.on(this.onPointerCancel)}detach(e){e.pointerdown.value.off(this.onPointerDown),e.pointermove.value.off(this.onPointerMove),e.pointerup.value.off(this.onPointerUp),e.pointercancel.value.off(this.onPointerCancel)}}function bl(e,t){const r=$a(e);return[new Xn.S(r.x-t.x,r.y-t.y),e,r]}class Tl{}class wl{constructor(e,t,r={}){this.type=Tl,this.move={allowed:!0,started:!1,previewed:!1,dragging:!1},this.cleanups=[],this.onDragStart=e=>{var t,r;this.move.dragging=!0;const i=!0!==(null===(t=this.graphic.anchor.locks)||void 0===t?void 0:t.select);this.move.allowed=i&&!0!==(null===(r=this.graphic.anchor.locks)||void 0===r?void 0:r.move)&&0===e.button,i&&(e.ctrlKey||e.shiftKey?this.editContext.actionInvoker.invoke(new Ho(this.graphic)):this.editContext.actionInvoker.invoke(new Yo.rZ([this.graphic]))),this.move.started=!1,this.move.previewed=!1},this.onDragMove=e=>{var t;if(this.move.dragging&&this.move.allowed){if(!this.move.started){const r=null!==(t=this.options.dragSlop)&&void 0!==t?t:.5;(Math.abs(e.x)>r||Math.abs(e.y)>r)&&(this.move.started=!0,void 0!==this.editContext.previewInfo&&(this.editContext.previewInfo.dragEditor.beginEdit(this.editContext.previewInfo,this),this.move.previewed=!0,void 0!==this.previews&&this.editContext.previewInfo.presenter.addPreviewPresenter(...this.previews)))}this.move.previewed&&void 0!==this.editContext.previewInfo&&this.editContext.previewInfo.dragEditor.applyTransform(new ss(e.x,e.y))}},this.onDragEnd=e=>{if(!this.move.dragging)return;if(this.move.dragging=!1,this.cleanup(),!this.move.started)return void(void 0!==this.options.onPointerUpMoveNotStarted&&this.options.onPointerUpMoveNotStarted(this.context));let t=new ss(e.x,e.y);this.move.previewed&&void 0!==this.editContext.previewInfo&&(t=this.editContext.previewInfo.dragEditor.applyTransform(t),this.editContext.previewInfo.dragEditor.endEdit(this.editContext.previewInfo,this)),this.editContext.actionInvoker.invoke(new ms(t))},this.onDragCancel=()=>{this.move.dragging&&(this.move.dragging=!1,this.cleanup(),this.move.started&&this.move.previewed&&void 0!==this.editContext.previewInfo&&this.editContext.previewInfo.dragEditor.endEdit(this.editContext.previewInfo))},this.context=e,this.graphic=e.graphic,this.editContext=e.editContext,this.tracker=new _l(t,yl,this.onDragStart,this.onDragMove,this.onDragEnd,this.onDragCancel),this.options=r}addEventListeners(e){this.tracker.attach(e.pointerEventNotifiers)}removeEventListeners(e){this.cleanups.push((()=>{this.tracker.detach(e.pointerEventNotifiers)})),this.move.dragging||this.cleanup()}setCursor(e){this.tracker.cursor=e}cleanup(){this.cleanups.forEach((e=>{e()})),this.cleanups=[]}}class xl{constructor(e,t,r,i){this.elements=new Map,this.updateElements=()=>{const e=this.elements;this.elements=new Map;for(const t of this.selection.graphic.model){if(this.selection.hasGraphic(t))continue;const[r,i]=this.presenter.getPresenters(t),n=e.get(t);void 0===n||n.presenter!==r?this.elements.set(t,new Cl(this.createEditElement({graphic:t,presenter:r,anchorPresenter:i,editContext:this.editContext}),r)):(e.delete(t),this.elements.set(t,n),n.update())}for(const[t,r]of e)r.teardown()},this.selection=e,this.presenter=t,this.editContext=r,this.createEditElement=i,this.updateElements(),this.presenter.viewModelUpdated.on(this.updateElements),this.selection.selectionUpdated.on(this.updateElements)}teardown(){this.selection.selectionUpdated.off(this.updateElements),this.presenter.viewModelUpdated.off(this.updateElements);for(const[e,t]of this.elements)t.teardown()}}class Cl{constructor(e,t){this.update=()=>{this.viewModel!==this.presenter.viewModel&&(this.element.removeEventListeners(this.viewModel),this.viewModel=this.presenter.viewModel,this.element.addEventListeners(this.viewModel))},this.element=e,this.presenter=t,this.viewModel=t.viewModel,this.element.addEventListeners(this.viewModel),this.presenter.viewModelUpdated.on(this.update)}teardown(){this.presenter.viewModelUpdated.off(this.update),this.element.removeEventListeners(this.viewModel)}}class Sl{constructor(e,t,r,i){this.viewModel=new Sa([],{nodeType:"grCollSelR"}),this.viewModelUpdated=new nn.p,this.underlayPresenters=[],this.childPresenters=new Map,this.updateViewModel=()=>{const e=this.childPresenters;this.childPresenters=new Map;const t=[];for(const r of this.selection.selections){if(void 0===this.selection.graphic.model.getGraphic(r.graphic.id))continue;const i=e.get(r),[n]=this.modelPresenter.getPresenters(r.graphic);if(void 0!==i&&i.modelPresenter===n){e.delete(r),this.childPresenters.set(r,i),i.update(),t.push(i.container);continue}const o=this.createChildSelectionPresenter(r);this.childPresenters.set(r,o),t.push(o.container)}for(const[t,r]of e)r.teardown();this.viewModel.children=[...this.underlayPresenters.map((e=>e.viewModel)),...t],this.viewModelUpdated.emit()},this.selection=e,this.modelPresenter=t.modelPresenter,this.selectionPresenterCreator=t.selectionPresenterCreator,this.context=t,this.editContext=r,this.editElements=new xl(e,this.modelPresenter,r,i),this.updateViewModel(),this.selection.selectionUpdated.on(this.updateViewModel),this.modelPresenter.viewModelUpdated.on(this.updateViewModel)}teardown(){this.editElements.teardown(),this.selection.selectionUpdated.off(this.updateViewModel),this.modelPresenter.viewModelUpdated.off(this.updateViewModel);for(const[e,t]of this.childPresenters)t.teardown();this.childPresenters.clear();for(const e of this.underlayPresenters)e.viewModelUpdated.off(this.updateViewModel),e.teardown()}addUnderlayPresenter(e){this.underlayPresenters.push(e),e.viewModelUpdated.on(this.updateViewModel),this.updateViewModel()}createChildSelectionPresenter(e){const[t,r]=this.modelPresenter.getPresenters(e.graphic),i=Object.assign(Object.assign({},this.context),{anchorPresenter:r,modelPresenter:t}),n=this.selectionPresenterCreator.createSelectionPresenter(e,i,this.editContext);return new Pl(t,n,this)}}class Pl{constructor(e,t,r){this.onViewModelUpdated=()=>{this.update(),this.parent.viewModelUpdated.emit()},this.modelPresenter=e,this.presenter=t,this.container=new Sa([t.viewModel]),this.parent=r,this.presenter.viewModelUpdated.on(this.onViewModelUpdated)}update(){this.container.children=[this.presenter.viewModel]}teardown(){this.presenter.viewModelUpdated.off(this.onViewModelUpdated),this.presenter.teardown()}}function El(e){return new wl(e,{hover:"move",drag:"move"})}function Ml(e=El){return(t,r,i)=>new Sl(t,r,i,e)}var Rl=n(4136),Al=n(1703);function Il(e){return e/255}function Fl(e){return ne.FromRGBA({r:Il(e.r),g:Il(e.g),b:Il(e.b),a:e.a})}function Bl(e,t,r){return new Ce([N.CreateFromRect(new _(0,0,t,e))],new fe(r))}function Ll(e,t,r){return new Ce([N.CreateFromRect(new _(0,0,e,t))],new fe(r))}const Dl=new ae(Fl(new Rl.kl(255,255,255,1))),kl=new ae(Fl(new Rl.kl(128,128,128,1))),Ol=100,Ul=new Al.o((()=>Bl(2,Ol,kl))),Nl=new Al.o((()=>Ll(2,Ol,kl))),Vl=new Al.o((()=>Bl(2,Ol,Dl))),Gl=new Al.o((()=>Ll(2,Ol,Dl)));function zl(e,t,r,i,n,o,s,a){return[new Se([i],void 0,new y(new g(-50,-e.size.height/2-s),new g((e.size.width+o)/Ol,1),t,r)),new Se([i],void 0,new y(new g(-50,e.size.height/2-a),new g((e.size.width+o)/Ol,1),t,r)),new Se([n],void 0,new y(new g(-e.size.width/2-s,-50),new g(1,(e.size.height+o)/Ol),t,r)),new Se([n],void 0,new y(new g(e.size.width/2-a,-50),new g(1,(e.size.height+o)/Ol),t,r))]}function Wl(e){const t=new De;return t.addItem(function(e){const t=function(e){return new g(e.pos.x+e.size.width/2,e.pos.y+e.size.height/2)}(e),r=(0,rs.Yr)(e.rot),i=function(e,t,r){return zl(e,t,r,Ul.value,Nl.value,4,2,0)}(e,r,t),n=function(e,t,r){return zl(e,t,r,Vl.value,Gl.value,0,0,2)}(e,r,t);return new Se(i.concat(n))}(e)),t.hitTestSlop=i.GJ,t}class Hl{constructor(e,t){this.viewModelUpdated=new nn.p,this.refreshSelectionViewModel=()=>{try{this.viewModel=this.createSelectionViewModel(),this.viewModelUpdated.emit()}catch(e){const t=e;void 0!==t&&(0,u.KE)(0,8e3,`Exception: ${t.message}, Stack Trace: ${t.stack}`)}},this.selection=e,this.context=t,this.refreshSelectionViewModel(),this.selection.selectionUpdated.on(this.refreshSelectionViewModel),this.context.modelPresenter.viewModelUpdated.on(this.refreshSelectionViewModel)}teardown(){this.context.modelPresenter.viewModelUpdated.off(this.refreshSelectionViewModel),this.selection.selectionUpdated.off(this.refreshSelectionViewModel)}createSelectionViewModel(){const e=this.context.anchorPresenter.transform,t=this.context.viewScale.viewTransform;let r=1,i=1;0!==t.size.width&&(r=t.size.width/e.size.width),0!==t.size.height&&(i=t.size.height/e.size.height);const n=[],o=this.selection.graphic.model.fallbackRenderData;if(void 0!==this.selection.graphic.model.layout&&void 0!==o&&Ks(o))for(const t of this.selection){const s=this.selection.graphic.model.layout.shapes.find((e=>e.modelId===t.modelId));if(void 0!==s){const t=s.shapeProps.transform.clone();t.size.width*=r,t.size.height*=i,t.pos.x=(t.pos.x+e.pos.x-o.sourceAnchorBounds.left)*r,t.pos.y=(t.pos.y+e.pos.y-o.sourceAnchorBounds.top)*i,n.push(t)}}return new Sa(n.map(((e,r)=>{const i=function(e,t){return new Sa([Wl(e)],{nodeType:"selGraphic",nodeKey:t})}(e,`${r}`);return i.children.forEach((e=>{ke(e)&&(e.emuToSourceScale=0,e.scaleFactor=this.context.viewScale.zoomFactor,e.transform=t,e.sourceAnchorBounds=new s.U(0,0,t.size.width,t.size.height))})),i})))}}function jl(e,t){return new Hl(e,t)}class ql{constructor(e,t){this.viewModel=new Sa,this.viewModelUpdated=new nn.p,this.onSelectionUpdated=e=>{0===e&&this.modelPresenter.play()},this.selection=e,this.modelPresenter=t.modelPresenter,this.modelPresenter.isSelected=!0,this.selection.selectionUpdated.on(this.onSelectionUpdated)}teardown(){this.modelPresenter.isSelected=!1,this.selection.selectionUpdated.off(this.onSelectionUpdated)}}const Xl="graphicType";class Kl{constructor(e,t){if(this.keyboardEventNotifierMap={keyup:new nn.p,keydown:new nn.p},this.pointerEventNotifierMap=(0,r.n)(),this.hostContext=new hn,this.isSelected=!1,this.onSelectionViewModelUpdated=()=>{this.selection.selections.forEach((e=>{if(so(e)&&void 0!==this.accessibilityDiv){const t=e.getAriaMessageForSelection(this.ariaStrings);this.accessibilityDiv.innerHTML===t?this.accessibilityDiv.innerText+=" ":this.accessibilityDiv.innerText=t}}))},this.onFrameRendered=e=>{if(void 0!==e&&0!==e.length){Rn(e,"OnFrameRenderedStartTime");try{this.kpiLogger.logFrameRendered(e)}catch(e){(0,u.KE)(0,55e3,`Exception: ${e.message}`)}}},this.defaultHitTestPointerDownEventHandler=()=>{this.clearChildSelection()},this.invokeActionCallback=e=>{this.host.performAction(e)},this.onSelectionUpdated=()=>{if(!this.isSelected&&this.selection.length>0){const e=this.config.graphicData.getVideoData();null!==e?e.select():(0,u.H)(0,55e3,"Unable to select host")}},this.config=e,void 0===this.config.domRenderTarget.viewDiv)throw new Error("No viewDiv to render to");this.graphic=Oo(e.graphicData,this.hostContext),this.pptGraphicType=e.graphicData.getGraphicType(),this.kpiLogger=new ta(e.brsConfig,t,this.pptGraphicType),void 0!==this.config.domRenderTarget.editDiv&&(this.editDiv=this.config.domRenderTarget.editDiv,this.editDiv.setAttribute("graphicID",this.graphic.id)),void 0!==this.config.domRenderTarget.accessibilityDiv&&null!==this.config.domRenderTarget.accessibilityDiv&&(this.accessibilityDiv=this.config.domRenderTarget.accessibilityDiv,this.accessibilityDiv.style.width="0",this.accessibilityDiv.style.height="0",this.accessibilityDiv.style.overflow="hidden",this.accessibilityDiv.style.zIndex="-1",this.accessibilityDiv.setAttribute("aria-role","marquee"),this.accessibilityDiv.setAttribute("aria-live","assertive"),this.accessibilityDiv.setAttribute("aria-atomic","true"),this.accessibilityDiv.innerHTML+=""),this.ariaStrings=this.config.ariaStrings,this.graphicCollectionModel=new ln(this.hostContext),this.graphicCollectionModel.addGraphics([this.graphic]),this.host=this.createHost(this.config,t,this.keyboardEventNotifierMap,this.pointerEventNotifierMap,this.config.brsConfig.isGC2WebGLRenderTargetEnabled,e.brsConfig.separateSelectionSceneFromGraphic);const i=this.host.renderTargetRegistry.get(Le);i instanceof Zn&&(this.shapeBuilderMultiplexRenderTarget=i),this.host.frameRendered.on(this.onFrameRendered),this.host.start(this.graphicCollectionModel,new un),this.host.selectionPresenter.viewModelUpdated.on(this.onSelectionViewModelUpdated),this.selection=this.host.selection,this.commandContext=new ao(this.selection),this.selection.selectionUpdated.on(this.onSelectionUpdated),(0,u.PN)(0,55e3,"The Gc2 host is enabled.")}dispose(){this.graphicCollectionModel.removeGraphics([this.graphic]),this.selection.selectionUpdated.off(this.onSelectionUpdated),this.host.selectionPresenter.viewModelUpdated.off(this.onSelectionViewModelUpdated),this.host.frameRendered.off(this.onFrameRendered),this.host.teardown()}setRenderData(e,t,r){const i=new d("PowerPointGraphicHost.setRenderData");try{const n=new On("GC2SetRenderDataPerf");n.start(),n.addTimePoint("SetRenderDataStartTime"),r.set(Xl,Qs(this.pptGraphicType)),this.kpiLogger.logSetRenderData(n,r),i.setProp("x",t.pos.x),i.setProp("y",t.pos.y),i.setProp("width",t.size.width),i.setProp("height",t.size.height),this.graphic.model.fallbackRenderData=$s(e,t),void 0!==this.shapeBuilderMultiplexRenderTarget&&(1!==e.renderDataType?(this.shapeBuilderMultiplexRenderTarget.skipPrepareWebGLCanvas=!0,this.shapeBuilderMultiplexRenderTarget.renderTargetMode=0):this.shapeBuilderMultiplexRenderTarget.skipPrepareWebGLCanvas=!1),n.addTimePoint("ModelUpdatedEventEmittedTime"),this.graphic.model.modelUpdated.emit(void 0,n),n.addTimePoint("SetRenderDataEndTime")}finally{i.complete()}}setPosition(e,t){}setZoomFactor(e){const t=new d("PowerPointGraphicHost.setZoomFactor");try{t.setProp("zoomFactor",e),this.host.viewScale.zoomFactor=e*window.devicePixelRatio}finally{t.complete()}}setTransform(e,t){const r=new d("PowerPointGraphicHost.setTransform");try{const i=new On("GC2SetTransformPerf");null!==t&&(t.set(Xl,Qs(this.pptGraphicType)),void 0!==this.shapeBuilderMultiplexRenderTarget&&t.set("ShapeBuilderRenderTargetMode",0===this.shapeBuilderMultiplexRenderTarget.renderTargetMode?Un.name:Yn.name),i.start(),this.kpiLogger.logSetTransform(i,t)),r.setProp("x",e.pos.x),r.setProp("y",e.pos.y),r.setProp("width",e.size.width),r.setProp("height",e.size.height);const n=function(e){return new a.A(new yo.i(e.pos.x,e.pos.y),new _o.N(e.size.width,e.size.height),new bo.d(e.flip.x,e.flip.y),e.rot)}(e);if(0!==window.devicePixelRatio){const e=1/window.devicePixelRatio;n.size.width*=e,n.size.height*=e,n.pos.x*=e,n.pos.y*=e}this.host.viewScale.viewTransform=n}finally{r.complete()}}setSelected(e){this.isSelected=e,e?this.selection.addGraphics([this.graphic]):this.selection.removeGraphics([this.graphic])}clearChildSelection(){this.selection.selections.forEach((e=>{so(e)?e.clear():(0,u.H)(0,55e3,"Selection is not of type SmartArtSelection")}))}handleCommand(e,t){const r=t,i=go.createAction(e,r,this.commandContext);if(void 0!==i){const r=this.handleQueryCommand(e,t);if(void 0!==r&&r.enabled)return this.host.performAction(i),new Zs(!0)}return new Zs(!1)}handleQueryCommand(e,t){const r=go.query(e,this.commandContext);return{enabled:void 0!==r&&r.enabled}}processKeyboardEvent(e){const t={isHandled:!1};return"keyup"===e.type?this.keyboardEventNotifierMap.keyup.emit(e,t):"keydown"===e.type&&this.keyboardEventNotifierMap.keydown.emit(e,t),new Js(t)}processPointerEvent(e){const t={isHandled:!1};return"pointerdown"===e.type?this.pointerEventNotifierMap.pointerdown.value.emit(e,t):"pointerup"===e.type?this.pointerEventNotifierMap.pointerup.value.emit(e,t):"pointermove"===e.type&&this.pointerEventNotifierMap.pointermove.value.emit(e,t),new Js(t)}createHost(e,t,r,i,n,o){const s=new kn(this.getHostConfig(r));return function(e,t,r){var i,n,o,s,a;(function(e){e.register(cn,Ia)})(i=e.anchorPresenterCreatorRegistry),function(e){e.register(To,ol)}(i),e.presenterCreatorRegistry.register(ro,(a=al,(e,t,r)=>{const i=e.model;return new rl(e,t,a(i,t.anchorPresenter),r)})).register(mo,((e,t)=>new _a(e,t))).register(Do,(0,ll.Z)(t)).register(an,(n=new Ra,o=e.presenterCreatorRegistry,s=e.anchorPresenterCreatorRegistry,(e,t,r)=>new Ea(e,o,s,n,t,r))),function(e,t){(function(e,t){e.register(Ws.qp,((e,r)=>new Fa(e,r,t)))})(e,(()=>new Da(document.createElement("img")))),void 0!==t&&void 0!==t.shapeBuilderConfig.glyphStore&&function(e,t,r){e.register(qs,((e,i)=>new Xa(e,t,i,r)))}(e,t.shapeBuilderConfig.glyphStore,t),function(e,t){e.register(Hs,((e,r)=>new Ta(e,r,t)))}(e,{getLayout:async()=>Promise.reject(void 0)})}(e.renderDataPresenterCreatorRegistry,r)}(s,e.graphicData,t),vl(e.graphicData.getGraphicType(),s.renderTargetRegistry,e.domRenderTarget,t,i,n,this.defaultHitTestPointerDownEventHandler,o),function(e){var t;(function(e){e.registerForType(an,(t=>new Go(t,e)))})(t=e.selectionCreatorRegistry),function(e){e.registerForType(ro,(e=>new oo(e,new Jn(new to,eo(e.model.smartArtData.elementList)))))}(t),function(e){e.registerForType(Do,(e=>new Us(e)))}(t),function(e){e.register(Vo,Ml()).register(no,jl).register(Os,((e,t)=>new ql(e,t)))}(e.selectionPresenterCreatorRegistry)}(s),s}getHostConfig(e){return{renderTargetEntries:[],anchorPresenterCreatorEntries:[],presenterCreatorEntries:[],selectionCreatorRegistrars:[],selectionPresenterCreatorEntries:[],editorRegistryEntries:zs,keyboardEventNotifiers:e,actionInvoker:{invoke:this.invokeActionCallback}}}}const Yl=new class{constructor(){this._initStatus=0,De.setDefaultScaleFactor(1/window.devicePixelRatio)}createGraphicHost(e){if(0===this._initStatus)throw new Error("Factory isn't initialized");return new Kl(e,this.sbContext)}async init(r){if(2!==this._initStatus){var i;if(this._initStatus=1,(0,u.WD)(new rn(r.logger)),!0!==r.setGC2KpiLogger?Zi(new en(r.logger)):void 0!==r.health&&Zi(new e(r.health)),void 0!==r.health&&(i=new t(r.health),Qi=i),(0,u.PN)(0,55002,"PowerPointGraphicFactory - init started"),void 0!==r.shapeBuilderConfig&&null!==r.shapeBuilderConfig){if(this.sbContext=function(e){return new Ki(e)}(r.shapeBuilderConfig),void 0===this.sbContext)return(0,u.KE)(0,55002,"PowerPointGraphicFactory - undefined sbContext"),void(this._initStatus=3);if(await this.sbContext.setupWebGLContext(),(0,u.PN)(0,55002,`PowerPointGraphicFactory - isRendererReady:${this.sbContext.isRendererReady}`),!this.sbContext.isRendererReady)return void(this._initStatus=3)}this._initStatus=2,(0,u.PN)(0,55002,`PowerPointGraphicFactory - init ended; initStatus:${this._initStatus}`)}}handleContextLost(){if(0===this._initStatus)throw new Error("Factory isn't initialized");void 0!==this.sbContext?this.sbContext.handleContextLost():(0,u.PN)(0,55002,"undefined sbContext")}async handleContextRestored(){if(0===this._initStatus)throw new Error("Factory isn't initialized");void 0!==this.sbContext?await this.sbContext.handleContextRestored():(0,u.PN)(0,55002,"undefined sbContext")}getInitStatus(){return this._initStatus}isShapeBuilderRendererReady(){return void 0!==this.sbContext&&this.sbContext.isRendererReady}}})(),Gc2HostPpt=o})();
//# sourceMappingURL=Gc2HostPpt.js.map