"use strict";function getLogger(n,t){var i=new bUlsCache(n,t);return{ULS:{trace:function(n,t,r){return traceTagImpl(i,0,n,t,r)},traceTag:function(n,t,r,u){return traceTagImpl(i,n,t,r,u)},flush:i.flush,flushOnClose:i.flushOnClose}}}function getExperimentLogger(n,t,i,r){var u=new bUlsCache(n,t);return u.configure(i,r),{ULS:{trace:function(n,t,i){return traceTagImpl(u,0,n,t,i)},traceTag:function(n,t,i,r){return traceTagImpl(u,n,t,i,r)},flush:u.flush,flushOnClose:u.flushOnClose}}}function traceTagImpl(n,t,i,r,u){if(!(r>currentLevel)){var f={timestamp:Date.now(),category:i,tag:t,level:r,type:logType.Trace,message:u};n.handleTrace(f)}}function formatForUpload(n,t,i,r){var u=n.map(function(n){return getLogEntryInWireFormat(n,r)}),f=getLogBatchInWireFormat(r,u,t,i);return JSON.stringify(f)}function getLogEntryInWireFormat(n,t){var i={},r;return i.G=n.tag,i.T=n.timestamp-t,i.M=n.message,i.C=n.category,r=n.type*shiftFactory+n.level,i.D=r,i}function getLogBatchInWireFormat(n,t,i,r){var u={};return u.T=n,u.L=t,u.S=i,u.I=r,u.V=1,u}function uploadLogs(n,t,i){if(t!==""){var r=new XMLHttpRequest;(r.readyState===XMLHttpRequest.UNSENT||r.readyState===XMLHttpRequest.DONE)&&(r.open("POST",t,i),r.send(n))}}var logLevel,ULS,currentLevel,bUlsCache,shiftFactory,logCategory,logType,PowerPointOnline;(function(n){n[n.Spam=200]="Spam";n[n.Verbose=100]="Verbose";n[n.Info=50]="Info";n[n.Warning=15]="Warning";n[n.Error=10]="Error"})(logLevel||(logLevel={}));ULS={getLogger:getLogger,getExperimentLogger:getExperimentLogger};currentLevel=logLevel.Info;bUlsCache=function(){function n(n,t){var i=this;this.uploadCadenceInMsSec=3e4;this.uploadTriggerSize=30;this.uploadId=0;this.logCache=[];this.timestampBase=Date.now();this.userSessionId="00000000-0000-0000-0000-000000000000";this.flushOnClose=function(){i.triggerUpload(!1,!1)};this.flush=function(){i.triggerUploadAsync()};this.triggerUploadAsync=function(){window.setTimeout(function(){return i.triggerUpload(!0,!0)},0)};this.triggerUpload=function(n,t){if(window.clearTimeout(i.timeoutId),i.logCache.length>0){i.uploadId+=1;var r=formatForUpload(i.logCache,i.userSessionId,i.uploadId,i.timestampBase);uploadLogs(r,i.remoteUrlEndpoint,t);i.logCache=[];i.timestampBase=Date.now()}n&&(i.timeoutId=window.setTimeout(i.triggerUploadAsync,i.uploadCadenceInMsSec))};this.userSessionId=n;this.remoteUrlEndpoint=t+"?usid="+n;window.setTimeout(function(){return i.triggerUpload(!0,!0)},0)}return n.prototype.configure=function(n,t){this.uploadCadenceInMsSec=n;this.uploadTriggerSize=t},n.prototype.handleTrace=function(t){t.message.length>n.messageMaxChars&&(t.message=t.message.substr(0,n.messageMaxChars-n.trimedMessage.length)+n.trimedMessage);this.logCache.push(t);(this.logCache.length>this.uploadTriggerSize||t.level===logLevel.Error)&&this.triggerUploadAsync()},n.messageMaxChars=3072,n.trimedMessage="... [Trimmed]",n}();shiftFactory=1e3,function(n){n[n.WordViewer=301]="WordViewer";n[n.WopiPendingApplication=379]="WopiPendingApplication";n[n.VisioApp=700]="VisioApp";n[n.PptNavigation=810]="PptNavigation";n[n.PptSession=817]="PptSession";n[n.PptVersionHistory=832]="PptVersionHistory";n[n.PptLive=833]="PptLive"}(logCategory||(logCategory={})),function(n){n[n.Trace=0]="Trace";n[n.Assert=1]="Assert"}(logType||(logType={})),function(n){var t;(function(n){var r=function(){function n(){}return n.prototype.trace=function(n,t,i){this.traceTag(0,n,t,i)},n.prototype.traceTag=function(n,t,i,r){var u=null;switch(i){case logLevel.Verbose:u=console.debug;break;case logLevel.Info:u=console.log;break;case logLevel.Warning:case logLevel.Error:u=console.error;break;default:u=console.error}u(r)},n}(),t,i;n.ConsoleSessionLogger=r;t=function(){function n(n,t){try{this.logger=ULS.getLogger(n,t+"RemoteUls.ashx")}catch(i){}}return n.prototype.trace=function(n,t,i){this.logger!=null&&this.logger.ULS.trace(n,t,i)},n.prototype.traceTag=function(n,t,i,r){this.logger!=null&&this.logger.ULS.traceTag(n,t,i,r)},n.prototype.flush=function(){this.logger!=null&&this.logger.ULS.flush()},n.prototype.flushOnClose=function(){this.logger!=null&&this.logger.ULS.flushOnClose()},n}();n.UlsSessionLogger=t;i=function(){function n(){}return n.init=function(n){this.logger=n},n.trace=function(n,t,i){this.logger!=null&&this.logger.trace(n,t,i)},n.traceTag=function(n,t,i,r){this.logger!=null&&this.logger.traceTag(n,t,i,r)},n}();n.SessionLogger=i})(t=n.Telemetry||(n.Telemetry={}))}(PowerPointOnline||(PowerPointOnline={}));"use strict";var TranscriberBrowserUtils=function(){function a(){}a.IsChrome=function(){return window.navigator.userAgent.indexOf("Chrome/")>=0&&!a.IsInternetExplorerEdge()};a.IsInternetExplorerEdge=function(){return window.navigator.userAgent.indexOf("Edge/")>=0};return a}(),RehearsalErrorReason;(function(a){a[a.NoMicrophone=0]="NoMicrophone"})(RehearsalErrorReason||(RehearsalErrorReason={}));var RehearsalTemplate;(function(a){a[a.DetectedValueWithMessage=0]="DetectedValueWithMessage";a[a.SingleMessage=1]="SingleMessage";a[a.GaugeWithMessage=2]="GaugeWithMessage";a[a.IconWithMessage=3]="IconWithMessage";a[a.TemperaturePillWithMessage=4]="TemperaturePillWithMessage"})(RehearsalTemplate||(RehearsalTemplate={}));var RehearsalState;(function(a){a[a.NotStarted=0]="NotStarted";a[a.Started=1]="Started";a[a.Paused=2]="Paused";a[a.Stopped=3]="Stopped";a[a.ErrorStarting=4]="ErrorStarting"})(RehearsalState||(RehearsalState={}));var RehearsalSettings=function(){function a(){}a.ColorRed="#b30921";a.ColorOrange="#f8a728";a.ColorGreen="#75d770";a.ColorWhite="#ffffff";a.ColdTemperatureCode=0;a.JustRightTemperatureCode=1;a.HotTemperatureCode=2;a.UpdateTimerIntervalInMS=1e3;a.FillerWordsKey="fillerWords";a.OriginalityKey="originality";a.WordsPerMinuteKey="wordsPerMinute";a.SensitivePhrasesKey="sensitivePhrases";a.CorrectedSensitivePhrasesKey="correctedSensitivePhrases";a.PositivityKey="positivity";a.GrammarKey="grammar";a.MonotoneKey="monotone";a.PriorityKey="priority";a.TimeoutInMSKey="timeoutInMS";a.RealtimeLabelKey="realtimeLabel";a.MessageKey="message";a.ImageFilenameKey="imageFilename";a.GaugeRotationKey="gaugeRotation";a.FEnsureDisplayGaugeKey="fEnsureDisplayGauge";a.TemperatureCodeKey="temperatureCode";a.TemperatureColdLabelKey="coldLabel";a.TemperatureHotLabelKey="hotLabel";a.ResetRehearsalIntervalInMS=5e3;a.RehearsalDashboardResizingWaitTimeInMS=500;a.RehearsalDashboardWidth="206px";a.RehearsalDashboardMinimizedHeight="38px";a.RehearsalDashboardMaximizedHeight="176px";a.RehearsalDashboardTrackerHeight="118px";a.RehearsalDashboardFirstRunMaximizedHeight="384px";a.RehearsalDashboardGenericWelcomeDivHeight="134px";a.RehearsalDashboardFirstRunWelcomeDivHeight="364px";a.RehearsalDashboardMinimizeTransition="all .5s linear";a.RehearsalDashboardMaximizeTransition="all .35s linear";a.RehearsalDashboardNoTransition="0ms";a.RehearsalInteractivePanelHeight="38px";a.RehearsalListeningIconHeight="16px";a.RehearsalListeningIconMarginTop="8px";a.RehearsalListeningButtonHeight="30px";a.ListeningStateAriaLabel="Microphone - Listening";a.PausedStateAriaLabel="Microphone - Paused";a.MaxedTimer="59:59";a.GenericRealtimeLabel="Rehearsal Coach";a.RehearsalWelcomeScreenTitle="Welcome to PowerPoint Presenter Coach (Preview)";a.RehearsalFirstRunWelcomeScreenText="As you rehearse, we'll give you feedback about how you're presenting. At the end, you'll see a numerical summary and our suggestions.";a.RehearsalGenericWelcomeScreenText="Practice helps you better understand your content.";a.RehearsalGetStartedButtonLabel="Start Rehearsing";a.RehearsalOnboardingLabel="Feedback";a.FRehearsalAlreadyTriggeredDuringSession=false;a.RehearsalKeyboardFocusTabIndex=3;a.RehearsalResourcesRootFilePath="pptscripts/";a.RehearsalAlertSoundFilePath="pptscripts/rehearsalAlert.wav";a.RehearsalMicListeningFilePath="pptscripts/micListening.png";a.RehearsalPauseButtonFilePath="pptscripts/pauseButton.png";a.RehearsalPlayButtonFilePath="pptscripts/playButton.png";a.RehearsalWelcomeScreenGraphicFilePath="pptscripts/welcomeGraphic.png";a.RehearsalFillerIconFilePath="pptscripts/fillerIcon.png";a.RehearsalColdTemperaturePillFilePath="pptscripts/temperaturePill_Cold.png";a.RehearsalJustRightTemperaturePillFilePath="pptscripts/temperaturePill_JustRight.png";a.RehearsalHotTemperaturePillFilePath="pptscripts/temperaturePill_Hot.png";a.OnboardingMessage="Start talking and we'll show feedback for your speech here.";a.OnboardingFeatureName="Onboarding";return a}(),RehearsalTemplateName=function(){function a(){}a.DetectedValueWithMessage="detectedvaluewithmessage";a.GaugeWithMessage="gaugewithmessage";a.SingleMessage="singlemessage";a.IconWithMessage="iconwithmessage";a.TemperaturePillWithMessage="temperaturepillwithmessage";return a}(),RehearsalSessionTelemetry=function(){function a(){this.CreateDashboardTimeInMS=0;this.FDidSeeSuggestions=false;this.FRehearsalDidStart=false;this.FRehearsalIdProvidedOnInitialization=false;this.NumberOfPauses=0;this.NumberOfSlidesWithOriginalitySuggestion=0;this.NumberOfSlidesRehearsed=0;this.NumberOfSuggestionsShown=0;this.RehearsalDurationInSeconds=0;this.RehearsalEndTime=0;this.RehearsalId="";this.RehearsalStartTime=0;this.MeanMonotone=0;this.SuggestionCountsByName={}}return a}();function formatTimerNumber(a){return a<10?"0"+a:a}function updateTimer(){var a=Rehearsal.s_instance;if(a&&a.m_rehearsalState==RehearsalState.Started&&a.m_rehearsalPresentationTimerDiv!=null){++a.m_presentationTimeInSeconds;var b=Math.floor(a.m_presentationTimeInSeconds/60),c=a.m_presentationTimeInSeconds-b*60;if(b>59)a.m_rehearsalPresentationTimerDiv.innerText=RehearsalSettings.MaxedTimer;else a.m_rehearsalPresentationTimerDiv.innerText=formatTimerNumber(b)+":"+formatTimerNumber(c)}}function listeningButtonMouseEnter(){var a=Rehearsal.s_instance;if(a)if(a.m_rehearsalState==RehearsalState.Started)if(a.m_rehearsalListeningButtonDiv!=null&&a.m_rehearsalPauseButtonDiv!=null){a.m_rehearsalPauseButtonDiv.style.display="inline-block";a.m_rehearsalListeningButtonDiv.style.display="none"}}function listeningButtonMouseLeave(){var a=Rehearsal.s_instance;if(a)if(a.m_rehearsalState==RehearsalState.Started)if(a.m_rehearsalListeningButtonDiv!=null&&a.m_rehearsalPauseButtonDiv!=null){a.m_rehearsalPauseButtonDiv.style.display="none";a.m_rehearsalListeningButtonDiv.style.display="inline-block"}}function togglePause(){var a=Rehearsal.s_instance;if(a){if(a.m_rehearsalState==RehearsalState.Paused){a.m_rehearsalState=RehearsalState.Started;if(a.m_rehearsalListeningButtonDiv!=null&&a.m_rehearsalPausedButtonDiv!=null&&a.m_rehearsalPauseButtonDiv!=null&&a.m_rehearsalRealtimeLabelSpan!=null&&a.m_rehearsalListeningButton!=null){a.m_rehearsalPausedButtonDiv.style.display="none";a.m_rehearsalPauseButtonDiv.style.display="none";a.m_rehearsalListeningButtonDiv.style.display="inline-block";a.m_rehearsalRealtimeLabelSpan.innerText="Go ahead";a.RestartTimerForClearingRehearsalDashboard();a.m_rehearsalListeningButton.classList.remove("pausedButtonState");a.m_rehearsalListeningButton.classList.add("pulse");a.m_rehearsalListeningButton.classList.add("listeningButtonState");a.m_rehearsalListeningButton.setAttribute("aria-label",RehearsalSettings.ListeningStateAriaLabel);Transcriber.FireAriaAlert(a.m_rehearsalListeningButton);var b=Transcriber.s_instance;b&&b.resetOnMessageTelemetry()}}else{a.m_rehearsalState=RehearsalState.Paused;a.m_sessionTelemetry.NumberOfPauses++;if(a.m_rehearsalListeningButtonDiv!=null&&a.m_rehearsalPausedButtonDiv!=null&&a.m_rehearsalPauseButtonDiv!=null&&a.m_rehearsalRealtimeLabelSpan!=null&&a.m_rehearsalListeningButton!=null){a.m_rehearsalPausedButtonDiv.style.display="inline-block";a.m_rehearsalListeningButtonDiv.style.display="none";a.m_rehearsalPauseButtonDiv.style.display="none";a.m_rehearsalRealtimeLabelSpan.innerText="Paused";a.m_rehearsalListeningButton.classList.remove("listeningButtonState");a.m_rehearsalListeningButton.classList.remove("pulse");a.m_rehearsalListeningButton.classList.add("pausedButtonState");a.m_rehearsalListeningButton.setAttribute("aria-label",RehearsalSettings.PausedStateAriaLabel);Transcriber.FireAriaAlert(a.m_rehearsalListeningButton)}}resetFocus()}}function handleKeyDownEvent(a){var b=a.keyCode||a.which;switch(b){case 37:case 38:api&&typeof api.Prev==="function"&&api.Prev();break;case 39:case 40:api&&typeof api.Next==="function"&&api.Next()}}function onMouseDownClickedGetStarted(a){a.preventDefault();return false}function resetFocus(){var a=document.getElementById("focusTrap1");a&&a.focus()}function userClickedGetStarted(b){var a=Rehearsal.s_instance;if(a&&a.GetRehearsalState()!=RehearsalState.Started){a.StartRehearsal();a.m_sessionTelemetry.RehearsalStartTime=Date.now();a.m_sessionTelemetry.FRehearsalDidStart=true;if(a.m_rehearsalId)SessionLogger.traceTag(42014670,logCategory.PptSession,logLevel.Info,"Rehearsal::userClickedGetStarted Get Started button clicked. RehearsalID: "+a.m_rehearsalId);else SessionLogger.traceTag(42014671,logCategory.PptSession,logLevel.Error,"Rehearsal::userClickedGetStarted Get Started button clicked without RehearsalID set.")}resetFocus();b.stopPropagation();return false}function disableContextMenu(a){a.preventDefault();return false}function resetRehearsalDashboard(){var a=Rehearsal.s_instance;if(a&&a.m_rehearsalDiv!=null&&a.m_rehearsalState==RehearsalState.Started&&a.m_rehearsalActiveTrackerDiv!=null&&a.m_rehearsalTopBarDiv!=null){a.m_rehearsalTopBarDiv.style.display="none";a.m_rehearsalActiveTrackerDiv.style.display="none";a.m_rehearsalActiveTrackerDiv=null;a.m_rehearsalDiv.style.transition=RehearsalSettings.RehearsalDashboardMinimizeTransition;a.m_rehearsalDiv.style.height=RehearsalSettings.RehearsalDashboardMinimizedHeight;a.m_timerForClearingRehearsalDashboard=null;if(a.m_currentlyShownFeatureName!=null)a.m_currentlyShownFeatureName=""}}function showActiveRehearsalTracker(){var a=Rehearsal.s_instance;if(a&&a.m_rehearsalActiveTrackerDiv!=null&&a.m_rehearsalTopBarDiv!=null){a.m_rehearsalTopBarDiv.style.display="initial";a.m_rehearsalActiveTrackerDiv.style.display="initial"}if(a)a.m_timerForShowActiveRehearsalTracker=null}var DragDropPositionTracker=function(){function a(d,c,a,b){this.isDragging=false;this.initialX=0;this.initialY=0;this.offsetX=0;this.offsetY=0;this.dragDiv=d;this.prevTransition=c;this.dragDropContainer=a;this.elementsToAvoid=b}a.prototype.handleEvent=function(a){switch(a.type){case"keydown":handleKeyDownEvent(a);break;case"mousedown":case"touchstart":this.dragStart(a);break;case"mouseup":case"touchend":this.dragEnd(a);break;case"mousemove":case"touchmove":this.dragging(a)}};a.prototype.dragStart=function(a){for(var b=0;b<this.elementsToAvoid.length;b++){var c=this.elementsToAvoid[b];if(c&&c.contains(a.target))return}if(this.dragDiv.contains(a.target)){a.preventDefault();a.stopPropagation();this.isDragging=true;if(a.type=="mousedown"){this.initialX=a.clientX-this.offsetX;this.initialY=a.clientY-this.offsetY}else if(a.type=="touchstart"){this.initialX=a.touches[0].clientX-this.offsetX;this.initialY=a.touches[0].clientY-this.offsetY}this.dragDropContainer.style.display="block"}};a.prototype.dragging=function(a){if(this.isDragging){a.preventDefault();a.stopPropagation();if(a.type=="mousemove"){this.offsetX=a.clientX-this.initialX;this.offsetY=a.clientY-this.initialY}else if(a.type=="touchmove"){this.offsetX=a.touches[0].clientX-this.initialX;this.offsetY=a.touches[0].clientY-this.initialY}this.dragDiv.style.transition=RehearsalSettings.RehearsalDashboardNoTransition;this.dragDiv.style.transform="translate("+this.offsetX+"px, "+this.offsetY+"px)"}};a.prototype.dragEnd=function(a){if(this.isDragging){a.preventDefault();a.stopPropagation();this.isDragging=false;this.dragDiv.style.transition=this.prevTransition;this.dragDropContainer.style.display="none"}};a.prototype.addEventHandlers=function(){document.addEventListener("mousedown",this,true);document.addEventListener("mouseup",this,true);document.addEventListener("mousemove",this,true);document.addEventListener("touchstart",this,true);document.addEventListener("touchend",this,true);document.addEventListener("touchmove",this,true);document.addEventListener("keydown",this,true)};a.prototype.removeEventHandlers=function(){document.removeEventListener("mousedown",this,true);document.removeEventListener("mouseup",this,true);document.removeEventListener("mousemove",this,true);document.removeEventListener("touchstart",this,true);document.removeEventListener("touchend",this,true);document.removeEventListener("touchmove",this,true);document.removeEventListener("keydown",this,true)};return a}(),Rehearsal=function(){function a(){this.m_sessionTelemetry=new RehearsalSessionTelemetry;this.m_rehearsalId="";this.m_rehearsalPresentationTimerId=0;this.m_presentationTimeInSeconds=0;this.m_slideCount=0;this.m_rehearsalState=RehearsalState.NotStarted;this.m_currentlyShownFeatureName="";this.m_disabledRealtimeFeatures={};this.m_rehearsalDiv=null;this.m_rehearsalActiveTrackerDiv=null;this.m_rehearsalRealtimeLabelSpan=null;this.m_rehearsalDetectedValueWithMessageDiv=null;this.m_rehearsalDetectedValueWithMessageValueSpan=null;this.m_rehearsalDetectedValueWithMessageMessageSpan=null;this.m_rehearsalSingleMessageDiv=null;this.m_rehearsalSingleMessageSpan=null;this.m_rehearsalGaugeWithMessageDiv=null;this.m_rehearsalGaugeWithMessageLabel=null;this.m_rehearsalGaugeWithMessageTicker=null;this.m_rehearsalIconWithMessageDiv=null;this.m_rehearsalIconWithMessageMessageSpan=null;this.m_rehearsalIconWithMessageIcon=null;this.m_rehearsalTemperaturePillWithMessageDiv=null;this.m_rehearsalTemperaturePillWithMessageMessageSpan=null;this.m_rehearsalTemperaturePillWithMessageColdLabel=null;this.m_rehearsalTemperaturePillWithMessageHotLabel=null;this.m_rehearsalTemperaturePillWithMessageIcon=null;this.m_rehearsalWelcomeDiv=null;this.m_rehearsalGetStartedButton=null;this.m_rehearsalPausedButtonDiv=null;this.m_rehearsalPauseButtonDiv=null;this.m_rehearsalPlayButtonDiv=null;this.m_rehearsalInteractivePanelDiv=null;this.m_rehearsalPresentationTimerDiv=null;this.m_rehearsalSlideTrackerDiv=null;this.m_rehearsalListeningButtonDiv=null;this.m_rehearsalListeningButton=null;this.m_rehearsalAlertAudio=null;this.m_rehearsalTopBarDiv=null;this.m_timerForClearingRehearsalDashboard=null;this.m_timerForShowActiveRehearsalTracker=null;this.m_rehearsalDragDropPositionTracker=null;this.m_rehearsalDragDropContainer=null}a.GetInstance=function(){return this.s_instance||(this.s_instance=new this)};a.GetSupportedRehearsalTemplates=function(){var b="";for(var a in RehearsalTemplateName)if(a!=null&&a.length>0)b+=b.length==0?a:","+a;return b};a.GetRequestedRehearsalFeatures=function(b){var a=RehearsalSettings.WordsPerMinuteKey+","+RehearsalSettings.FillerWordsKey+","+RehearsalSettings.SensitivePhrasesKey+","+RehearsalSettings.CorrectedSensitivePhrasesKey+","+RehearsalSettings.OriginalityKey+","+RehearsalSettings.PositivityKey+(b?","+RehearsalSettings.GrammarKey:"");if(TranscriberSettings.PodRehearsalMonotoneEnabled)a=a+","+RehearsalSettings.MonotoneKey;return a};a.GetRehearsalMetadataJSON=function(b){return JSON.stringify({requestedRehearsalFeatures:a.GetRequestedRehearsalFeatures(b),supportedRehearsalTemplates:a.GetSupportedRehearsalTemplates()})};a.FSupportsRehearsalTemplate=function(a){if(a==null)return false;switch(a.toLowerCase()){case RehearsalTemplateName.DetectedValueWithMessage:case RehearsalTemplateName.GaugeWithMessage:case RehearsalTemplateName.SingleMessage:case RehearsalTemplateName.IconWithMessage:case RehearsalTemplateName.TemperaturePillWithMessage:return true;default:return false}};a.DisposeInstance=function(){var b=a.s_instance;b&&b.EndRehearsal()};a.prototype.Initialize=function(d,b,c,a){this.DisposeRehearsalInternal();this.InitializeRehearsalInternal(d,b,c,a)};a.prototype.InitializeError=function(a){this.DisposeRehearsalInternal();this.InitializeRehearsalErrorInternal(a)};a.prototype.StartRehearsal=function(){this.StartRealTimeTrackers();this.m_rehearsalGetStartedButton&&this.m_rehearsalGetStartedButton.blur();if(this.m_rehearsalDiv){this.m_rehearsalDiv.removeAttribute("role");this.m_rehearsalDiv.removeAttribute("aria-role");this.m_rehearsalDiv.removeAttribute("aria-live")}var b=RehearsalSummaryCollector.GetRehearsalSummaryControlInstance();b!=null&&b.StartRehearsal();RehearsalSettings.FRehearsalAlreadyTriggeredDuringSession=true;var a=Transcriber.s_instance;if(a){a.SetTranscriptionDetectionText(TranscriberResourceString.DetectionString_SoundReminder,TranscriberDetectionDivStyle.Listening);a.m_timerForShowSoundReminderDetectionMessage&&clearTimeout(a.m_timerForShowSoundReminderDetectionMessage);a.m_timerForShowSoundReminderDetectionMessage=setTimeout(function(){Transcriber.s_instance.SetIdleStateTranscriptionDetectionText()},TranscriberSettings.ShowSoundReminderTimeoutMS)}};a.prototype.EndRehearsal=function(){var a=RehearsalSummaryCollector.GetRehearsalSummaryControlInstance();a!=null&&a.StopRehearsal(this.m_presentationTimeInSeconds*1e3);this.LogEndOfRehearsalSessionTelemetry();this.DisposeRehearsalInternal()};a.prototype.UpdateSlideTracker=function(b){if(this.m_rehearsalSlideTrackerDiv)this.m_rehearsalSlideTrackerDiv.innerText=String(++b)+" of "+String(this.m_slideCount);var a=RehearsalSummaryCollector.GetRehearsalSummaryControlInstance();if(this.m_rehearsalState!=RehearsalState.Started||!a)return;a.AddSlideRehearsed(b)};a.prototype.RestartTimerForClearingRehearsalDashboard=function(){this.m_timerForClearingRehearsalDashboard&&clearTimeout(this.m_timerForClearingRehearsalDashboard);this.m_timerForClearingRehearsalDashboard=setTimeout(resetRehearsalDashboard,RehearsalSettings.ResetRehearsalIntervalInMS)};a.prototype.OnFirstMessageReceived=function(){resetRehearsalDashboard()};a.prototype.InitializeRehearsalSessionTelemetry=function(){this.m_sessionTelemetry=new RehearsalSessionTelemetry;this.m_sessionTelemetry.FRehearsalDidStart=false;this.m_sessionTelemetry.SuggestionCountsByName={};this.m_sessionTelemetry.NumberOfPauses=0;this.m_sessionTelemetry.RehearsalStartTime=0;this.m_sessionTelemetry.RehearsalEndTime=0};a.prototype.LogEndOfRehearsalSessionTelemetry=function(){var a=RehearsalSummaryCollector.GetRehearsalSummaryStateInstance();if(a!=null){this.m_sessionTelemetry.NumberOfSlidesRehearsed=a.GetNumSlidesRehearsed();this.m_sessionTelemetry.RehearsalDurationInSeconds=this.m_presentationTimeInSeconds;this.m_sessionTelemetry.NumberOfSlidesWithOriginalitySuggestion=a.GetOriginalityProblemSlides().length;var b=a.GetMonotoneOverTime();if(b!=null&&b.length>0)this.m_sessionTelemetry.MeanMonotone=b.map(function(a){Number(a.pvq)}).reduce(function(a,b){return Number(a)+Number(b)},0)/b.length}this.m_sessionTelemetry.RehearsalEndTime=Date.now();this.m_sessionTelemetry.FDidSeeSuggestions=Object.keys(this.m_sessionTelemetry.SuggestionCountsByName).length>0;SessionLogger.traceTag(42014672,logCategory.PptSession,logLevel.Info,JSON.stringify(this.m_sessionTelemetry))};a.prototype.DisplayActiveRehearsalTracker=function(d,a,c){if(this.m_rehearsalDiv==null)return;var b=this.m_currentlyShownFeatureName==null||this.m_currentlyShownFeatureName!=a;if(this.m_rehearsalActiveTrackerDiv!=null){if(b){this.m_rehearsalActiveTrackerDiv.removeAttribute("aria-live");this.m_rehearsalActiveTrackerDiv.removeAttribute("aria-role");this.m_rehearsalActiveTrackerDiv.removeAttribute("role")}this.m_rehearsalActiveTrackerDiv.style.display="none"}this.m_rehearsalActiveTrackerDiv=d;this.m_rehearsalDiv.style.transition=RehearsalSettings.RehearsalDashboardMaximizeTransition;this.m_rehearsalDiv.style.height=RehearsalSettings.RehearsalDashboardMaximizedHeight;if(this.FRehearsalDashboardIsMinimized()){this.m_timerForShowActiveRehearsalTracker&&clearTimeout(this.m_timerForShowActiveRehearsalTracker);this.m_timerForShowActiveRehearsalTracker=setTimeout(showActiveRehearsalTracker,RehearsalSettings.RehearsalDashboardResizingWaitTimeInMS);this.PlayRehearsalAlertSound()}else if(this.m_rehearsalTopBarDiv!=null&&this.m_rehearsalActiveTrackerDiv!=null&&this.m_timerForShowActiveRehearsalTracker==null){this.m_rehearsalTopBarDiv.style.display="initial";this.m_rehearsalActiveTrackerDiv.style.display="initial"}if(!c){this.RestartTimerForClearingRehearsalDashboard();if(b&&this.m_rehearsalActiveTrackerDiv!=null){Transcriber.FireAriaAlert(this.m_rehearsalActiveTrackerDiv);this.UpdateSuggestionShownCountInTelemetry(a)}}this.m_currentlyShownFeatureName=a};a.prototype.FRehearsalDashboardIsMinimized=function(){return this.m_rehearsalTopBarDiv!=null&&this.m_rehearsalTopBarDiv.style.display=="none"&&this.m_timerForShowActiveRehearsalTracker==null};a.prototype.UpdateSuggestionShownCountInTelemetry=function(a){if(a.toLowerCase()in this.m_sessionTelemetry.SuggestionCountsByName)this.m_sessionTelemetry.SuggestionCountsByName[a.toLowerCase()]++;else this.m_sessionTelemetry.SuggestionCountsByName[a.toLowerCase()]=1};a.prototype.ParseRehearsalTemplateMessage=function(b){var a=(new DOMParser).parseFromString(b,"text/html");return document.createTextNode(a.body.textContent?a.body.textContent:"")};a.prototype.ShowDetectedValueWithMessage=function(c,b,a){if(b!=null&&b.length>0&&a.has(RehearsalSettings.MessageKey)&&this.m_rehearsalDetectedValueWithMessageDiv!=null&&this.m_rehearsalDetectedValueWithMessageValueSpan!=null&&this.m_rehearsalDetectedValueWithMessageMessageSpan!=null&&this.m_rehearsalRealtimeLabelSpan!=null){var d=String(a.get(RehearsalSettings.MessageKey));this.m_rehearsalDetectedValueWithMessageValueSpan.innerText='"'+b+'"';this.m_rehearsalDetectedValueWithMessageMessageSpan.appendChild(this.ParseRehearsalTemplateMessage(d));this.m_rehearsalRealtimeLabelSpan.innerText=a.has(RehearsalSettings.RealtimeLabelKey)?a.get(RehearsalSettings.RealtimeLabelKey):RehearsalSettings.GenericRealtimeLabel;this.DisplayActiveRehearsalTracker(this.m_rehearsalDetectedValueWithMessageDiv,c)}};a.prototype.ShowIconWithMessage=function(c,b,a){if(b!=null&&b.length>0&&a.has(RehearsalSettings.MessageKey)&&a.has(RehearsalSettings.ImageFilenameKey)&&this.m_rehearsalIconWithMessageDiv!=null&&this.m_rehearsalIconWithMessageMessageSpan!=null&&this.m_rehearsalIconWithMessageIcon!=null&&this.m_rehearsalRealtimeLabelSpan!=null){var e=String(a.get(RehearsalSettings.MessageKey)),d=String(a.get(RehearsalSettings.ImageFilenameKey));this.m_rehearsalIconWithMessageMessageSpan.appendChild(this.ParseRehearsalTemplateMessage(e));this.m_rehearsalIconWithMessageIcon.src=RehearsalSettings.RehearsalResourcesRootFilePath+d;this.m_rehearsalRealtimeLabelSpan.innerText=a.has(RehearsalSettings.RealtimeLabelKey)?a.get(RehearsalSettings.RealtimeLabelKey):RehearsalSettings.GenericRealtimeLabel;this.DisplayActiveRehearsalTracker(this.m_rehearsalIconWithMessageDiv,c)}};a.prototype.ShowGaugeWithMessage=function(e,c,a){if(c!=null&&c.length>0&&a.has(RehearsalSettings.MessageKey)&&a.has(RehearsalSettings.GaugeRotationKey)&&a.has(RehearsalSettings.FEnsureDisplayGaugeKey)&&this.m_rehearsalGaugeWithMessageLabel!=null&&this.m_rehearsalGaugeWithMessageTicker!=null&&this.m_rehearsalGaugeWithMessageDiv!=null&&this.m_rehearsalRealtimeLabelSpan!=null){var b=Number(a.get(RehearsalSettings.GaugeRotationKey));if(b>=0&&b<=1){var g=Number(c),f=String(a.get(RehearsalSettings.MessageKey)),d=-90+180*b;this.m_rehearsalGaugeWithMessageTicker.style.transform="rotate("+String(d)+"deg)";this.m_rehearsalGaugeWithMessageLabel.innerText=f;if(String(a.get(RehearsalSettings.FEnsureDisplayGaugeKey)).toLowerCase()=="true"){this.m_rehearsalRealtimeLabelSpan.innerText=a.has(RehearsalSettings.RealtimeLabelKey)?a.get(RehearsalSettings.RealtimeLabelKey):RehearsalSettings.GenericRealtimeLabel;this.DisplayActiveRehearsalTracker(this.m_rehearsalGaugeWithMessageDiv,e)}}}};a.prototype.ShowTemperaturePillWithMessage=function(f,c,a){if(c!=null&&c.length>0&&a.has(RehearsalSettings.MessageKey)&&a.has(RehearsalSettings.TemperatureCodeKey)&&a.has(RehearsalSettings.TemperatureColdLabelKey)&&a.has(RehearsalSettings.TemperatureHotLabelKey)&&a.has(RehearsalSettings.FEnsureDisplayGaugeKey)&&this.m_rehearsalTemperaturePillWithMessageDiv!=null&&this.m_rehearsalTemperaturePillWithMessageMessageSpan!=null&&this.m_rehearsalTemperaturePillWithMessageColdLabel!=null&&this.m_rehearsalTemperaturePillWithMessageHotLabel!=null&&this.m_rehearsalTemperaturePillWithMessageIcon!=null&&this.m_rehearsalRealtimeLabelSpan!=null){var b=Number(a.get(RehearsalSettings.TemperatureCodeKey)),d=String(a.get(RehearsalSettings.TemperatureColdLabelKey)),e=String(a.get(RehearsalSettings.TemperatureHotLabelKey)),g=String(a.get(RehearsalSettings.MessageKey));this.m_rehearsalTemperaturePillWithMessageColdLabel.innerText=d;this.m_rehearsalTemperaturePillWithMessageHotLabel.innerText=e;this.m_rehearsalTemperaturePillWithMessageMessageSpan.innerText=g;switch(b){case RehearsalSettings.ColdTemperatureCode:this.m_rehearsalTemperaturePillWithMessageIcon.src=RehearsalSettings.RehearsalColdTemperaturePillFilePath;break;case RehearsalSettings.JustRightTemperatureCode:this.m_rehearsalTemperaturePillWithMessageIcon.src=RehearsalSettings.RehearsalJustRightTemperaturePillFilePath;break;case RehearsalSettings.HotTemperatureCode:this.m_rehearsalTemperaturePillWithMessageIcon.src=RehearsalSettings.RehearsalHotTemperaturePillFilePath;break;default:SessionLogger.traceTag(50685711,logCategory.PptSession,logLevel.Error,"Rehearsal::ShowTemperaturePillWithMessage Unhandled code: "+b);return}if(String(a.get(RehearsalSettings.FEnsureDisplayGaugeKey)).toLowerCase()=="true"){this.m_rehearsalRealtimeLabelSpan.innerText=a.has(RehearsalSettings.RealtimeLabelKey)?a.get(RehearsalSettings.RealtimeLabelKey):RehearsalSettings.GenericRealtimeLabel;this.DisplayActiveRehearsalTracker(this.m_rehearsalTemperaturePillWithMessageDiv,f)}}};a.prototype.ShowSingleMessage=function(c,b,a){if(b!=null&&b.length>0&&a.has(RehearsalSettings.MessageKey)&&this.m_rehearsalSingleMessageDiv!=null&&this.m_rehearsalSingleMessageSpan!=null&&this.m_rehearsalRealtimeLabelSpan!=null){this.m_rehearsalSingleMessageSpan.appendChild(this.ParseRehearsalTemplateMessage(String(a.get(RehearsalSettings.MessageKey))));this.m_rehearsalRealtimeLabelSpan.innerText=a.has(RehearsalSettings.RealtimeLabelKey)?a.get(RehearsalSettings.RealtimeLabelKey):RehearsalSettings.GenericRealtimeLabel;this.DisplayActiveRehearsalTracker(this.m_rehearsalSingleMessageDiv,c)}};a.prototype.GenerateRealtimeNotification=function(b,d){var e=d.getFeaturetemplate(),c=d.getFeaturevalue(),a=d.getTemplateinfoMap();switch(e.toLowerCase()){case RehearsalTemplateName.DetectedValueWithMessage:this.ShowDetectedValueWithMessage(b,c,a);break;case RehearsalTemplateName.GaugeWithMessage:this.ShowGaugeWithMessage(b,c,a);break;case RehearsalTemplateName.SingleMessage:this.ShowSingleMessage(b,c,a);break;case RehearsalTemplateName.IconWithMessage:this.ShowIconWithMessage(b,c,a);break;case RehearsalTemplateName.TemperaturePillWithMessage:this.ShowTemperaturePillWithMessage(b,c,a);break;default:SessionLogger.traceTag(42259011,logCategory.PptSession,logLevel.Error,"Rehearsal::GenerateRealtimeNotification Unhandled Template: "+e);return}};a.prototype.UpdateRehearsalDashboard=function(i){var m=this;if(this.m_rehearsalState!=RehearsalState.Started)return;var b=i.getFeaturesMap(),f="",g=-1;b.forEach(function(b,d){var c=d.toLowerCase();if(!(c in m.m_disabledRealtimeFeatures&&m.m_disabledRealtimeFeatures[c])&&a.FSupportsRehearsalTemplate(b.getFeaturetemplate())&&b.getTemplateinfoMap().has(RehearsalSettings.PriorityKey)&&Number(b.getTemplateinfoMap().has(RehearsalSettings.PriorityKey))>g){g=Number(b.getTemplateinfoMap().get(RehearsalSettings.PriorityKey));f=d}});if(g>=0){var n=b.get(f);this.GenerateRealtimeNotification(f,n)}var d=RehearsalSummaryCollector.GetRehearsalSummaryControlInstance();if(d==null)return;var e=Number(i.getCurrentslideindex());d.AddSlideRehearsed(e);if(b.has(RehearsalSettings.FillerWordsKey)){var l=[];l.push(String(b.get(RehearsalSettings.FillerWordsKey).getFeaturevalue()));d.AddFillers(l)}b.has(RehearsalSettings.WordsPerMinuteKey)&&d.AddPace(Number(b.get(RehearsalSettings.WordsPerMinuteKey).getFeaturevalue()),this.m_presentationTimeInSeconds*1e3);if(b.has(RehearsalSettings.SensitivePhrasesKey)){var j=[];j.push(String(b.get(RehearsalSettings.SensitivePhrasesKey).getFeaturevalue()));var h=[];b.has(RehearsalSettings.CorrectedSensitivePhrasesKey)&&h.push(String(b.get(RehearsalSettings.CorrectedSensitivePhrasesKey).getFeaturevalue()));d.AddSensitivePhrases(j,h)}b.has(RehearsalSettings.OriginalityKey)&&d.AddProblematicOriginalitySlide(e);b.has(RehearsalSettings.MonotoneKey)&&d.AddMonotone(Number(b.get(RehearsalSettings.MonotoneKey).getFeaturevalue()),e,this.m_presentationTimeInSeconds*1e3);if(b.has(RehearsalSettings.GrammarKey)){var k=b.get(RehearsalSettings.GrammarKey);if(k){var c=k.getTemplateinfoMap();c&&d.AddGrammarCritique(e,c.has("GrammarExplanation")?c.get("GrammarExplanation"):"",c.has("GrammarCategoryTitle")?c.get("GrammarCategoryTitle"):"",c.has("GrammarContext")?c.get("GrammarContext"):"",c.has("GrammarCharStartInContext")?c.get("GrammarCharStartInContext"):0,c.has("GrammarCharErrorLength")?c.get("GrammarCharErrorLength"):0,c.has("GrammarSuggestion")?c.get("GrammarSuggestion"):"")}}};a.prototype.GetRehearsalState=function(){return this.m_rehearsalState};a.prototype.PlayRehearsalAlertSound=function(){this.m_rehearsalAlertAudio!=null&&this.m_rehearsalAlertAudio.play()};a.prototype.DisposeRehearsalInternal=function(){this.RemoveRehearsalDiv();this.RemoveRehearsalDragDropContainer();this.m_rehearsalPresentationTimerId!==0&&clearInterval(this.m_rehearsalPresentationTimerId);if(this.m_timerForClearingRehearsalDashboard){clearTimeout(this.m_timerForClearingRehearsalDashboard);this.m_timerForClearingRehearsalDashboard=null}this.m_rehearsalDragDropPositionTracker&&this.m_rehearsalDragDropPositionTracker.removeEventHandlers()};a.prototype.ShowOnboardingExperience=function(){if(this.m_rehearsalIconWithMessageDiv!=null&&this.m_rehearsalIconWithMessageMessageSpan!=null&&this.m_rehearsalIconWithMessageIcon!=null&&this.m_rehearsalRealtimeLabelSpan!=null){this.m_rehearsalIconWithMessageMessageSpan.innerText=RehearsalSettings.OnboardingMessage;this.m_rehearsalIconWithMessageIcon.src=RehearsalSettings.RehearsalFillerIconFilePath;this.m_rehearsalRealtimeLabelSpan.innerText=RehearsalSettings.RehearsalOnboardingLabel;this.DisplayActiveRehearsalTracker(this.m_rehearsalIconWithMessageDiv,RehearsalSettings.OnboardingFeatureName,true);Transcriber.FireAriaAlert(this.m_rehearsalIconWithMessageDiv)}};a.prototype.StartRealTimeTrackers=function(){if(this.m_rehearsalDiv!=null&&this.m_rehearsalWelcomeDiv!=null&&this.m_rehearsalInteractivePanelDiv!=null&&this.m_rehearsalRealtimeLabelSpan!=null&&this.m_rehearsalTopBarDiv!=null){this.m_rehearsalWelcomeDiv.style.display="none";this.m_rehearsalTopBarDiv.style.display="none";this.m_rehearsalInteractivePanelDiv.style.display="inline-block";this.m_rehearsalDiv.style.transition=RehearsalSettings.RehearsalDashboardMinimizeTransition;if(RehearsalSettings.FRehearsalAlreadyTriggeredDuringSession)this.m_rehearsalDiv.style.height=RehearsalSettings.RehearsalDashboardMinimizedHeight;else this.ShowOnboardingExperience();this.m_rehearsalPresentationTimerId!==0&&clearInterval(this.m_rehearsalPresentationTimerId);this.m_rehearsalPresentationTimerId=setInterval(updateTimer,RehearsalSettings.UpdateTimerIntervalInMS);this.m_presentationTimeInSeconds=0;this.m_rehearsalState=RehearsalState.Started}};a.prototype.RemoveRehearsalDiv=function(){if(this.m_rehearsalDiv&&this.m_rehearsalDiv.parentNode){this.m_rehearsalDiv.parentNode.removeChild(this.m_rehearsalDiv);this.m_rehearsalDiv=null}};a.prototype.RemoveRehearsalDragDropContainer=function(){if(this.m_rehearsalDragDropContainer&&this.m_rehearsalDragDropContainer.parentNode){this.m_rehearsalDragDropContainer.parentNode.removeChild(this.m_rehearsalDragDropContainer);this.m_rehearsalDragDropContainer=null}};a.GenerateId=function(){var a="xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",b=a.replace(/[xy]/g,function(b){var a=Math.random()*16|0,c=b==="x"?a:a&3|8;return c.toString(16)});return b};a.prototype.GetDisabledRealtimeFeatureSet=function(c){var d=this,b=JSON.parse(c),a=b.DisabledRehearsalRealtimeFeaturesStr;this.m_disabledRealtimeFeatures={};a.split(",").forEach(function(a){if(a.length>0)d.m_disabledRealtimeFeatures[a.toLowerCase()]=true})};a.prototype.GetElementsToAvoidDraggingOn=function(){var a=[];this.m_rehearsalGetStartedButton&&a.push(this.m_rehearsalGetStartedButton);this.m_rehearsalPausedButtonDiv&&a.push(this.m_rehearsalPausedButtonDiv);this.m_rehearsalListeningButtonDiv&&a.push(this.m_rehearsalListeningButtonDiv);return a};a.prototype.InitializeRehearsalInternal=function(b,e,g,d){this.InitializeRehearsalSessionTelemetry();this.m_rehearsalState=RehearsalState.NotStarted;a.CreateRehearsalDashboard(RehearsalState.NotStarted);this.m_currentlyShownFeatureName="";this.GetDisabledRealtimeFeatureSet(d);this.m_sessionTelemetry.FRehearsalIdProvidedOnInitialization=b!="";this.m_rehearsalId=!b?a.GenerateId():b;this.m_sessionTelemetry.RehearsalId=this.m_rehearsalId;SessionLogger.traceTag(41726050,logCategory.PptSession,logLevel.Info,"Rehearsal::InitializeRehearsalInternal Rehearsal session initialized. RehearsalID: "+this.m_rehearsalId);this.m_rehearsalRealtimeLabelSpan=document.getElementById("ppt-RehearsalTrackerLabel-realtime");this.m_rehearsalDetectedValueWithMessageDiv=document.getElementById("ppt-RehearsalTrackerDiv-detectedValueWithMessage");this.m_rehearsalDetectedValueWithMessageValueSpan=document.getElementById("ppt-RehearsalTrackerValue-detectedValueWithMessage-value");this.m_rehearsalDetectedValueWithMessageMessageSpan=document.getElementById("ppt-RehearsalTrackerValue-detectedValueWithMessage-message");this.m_rehearsalSingleMessageDiv=document.getElementById("ppt-RehearsalTrackerDiv-singleMessage");this.m_rehearsalSingleMessageSpan=document.getElementById("ppt-RehearsalTrackerValue-singleMessage-message");this.m_rehearsalGaugeWithMessageDiv=document.getElementById("ppt-RehearsalTrackerDiv-gaugeWithMessage");this.m_rehearsalGaugeWithMessageLabel=document.getElementById("ppt-RehearsalTrackerValue-gaugeWithMessage-message");this.m_rehearsalGaugeWithMessageTicker=document.getElementById("ppt-Rehearsal-gaugeTicker");this.m_rehearsalIconWithMessageDiv=document.getElementById("ppt-RehearsalTrackerDiv-iconWithMessage");this.m_rehearsalIconWithMessageMessageSpan=document.getElementById("ppt-RehearsalTrackerValue-iconWithMessage-message");this.m_rehearsalIconWithMessageIcon=document.getElementById("ppt-Rehearsal-iconWithMessageIcon");this.m_rehearsalTemperaturePillWithMessageDiv=document.getElementById("ppt-RehearsalTrackerDiv-temperaturePillWithMessage");this.m_rehearsalTemperaturePillWithMessageMessageSpan=document.getElementById("ppt-RehearsalTrackerValue-temperaturePillWithMessage-message");this.m_rehearsalTemperaturePillWithMessageColdLabel=document.getElementById("ppt-Rehearsal-temperaturePillColdLabel");this.m_rehearsalTemperaturePillWithMessageHotLabel=document.getElementById("ppt-Rehearsal-temperaturePillHotLabel");this.m_rehearsalTemperaturePillWithMessageIcon=document.getElementById("ppt-Rehearsal-temperaturePillWithMessageIcon");this.m_rehearsalWelcomeDiv=document.getElementById("ppt-RehearsalTrackerDiv-welcome");this.m_rehearsalInteractivePanelDiv=document.getElementById("ppt-RehearsalTrackerDiv-interactivePanel");this.m_rehearsalDiv=document.getElementById("ppt-RehearsalDiv");this.m_rehearsalActiveTrackerDiv=null;this.m_rehearsalGetStartedButton=document.getElementById("ppt-RehearsalTrackerDiv-welcome-getStartedButton");this.m_rehearsalListeningButtonDiv=document.getElementById("ppt-Rehearsal-listeningButtonState");this.m_rehearsalPausedButtonDiv=document.getElementById("ppt-Rehearsal-pausedButtonState");this.m_rehearsalPauseButtonDiv=document.getElementById("ppt-Rehearsal-pauseButtonState");this.m_rehearsalPresentationTimerDiv=document.getElementById("ppt-RehearsalTrackerDiv-presentationTimer");this.m_rehearsalSlideTrackerDiv=document.getElementById("ppt-RehearsalTrackerDiv-slideCountTracker");this.m_rehearsalListeningButton=document.getElementById("ppt-Rehearsal-listeningButton");this.m_slideCount=g;this.UpdateSlideTracker(e);this.m_rehearsalTopBarDiv=document.getElementById("ppt-RehearsalDiv-topBar");this.m_timerForClearingRehearsalDashboard=null;this.m_timerForShowActiveRehearsalTracker=null;this.m_rehearsalAlertAudio=new Audio;this.m_rehearsalAlertAudio.src=RehearsalSettings.RehearsalAlertSoundFilePath;this.m_rehearsalDiv!=null&&this.m_rehearsalDiv.appendChild(this.m_rehearsalAlertAudio);this.m_rehearsalDragDropContainer=document.getElementById("ppt-RehearsalDiv-dragDropContainer");if(this.m_rehearsalDiv&&this.m_rehearsalDragDropContainer){var c=this.m_rehearsalDiv.style.transition,f=this.GetElementsToAvoidDraggingOn();this.m_rehearsalDragDropPositionTracker=new DragDropPositionTracker(this.m_rehearsalDiv,c?c:"",this.m_rehearsalDragDropContainer,f);this.m_rehearsalDragDropPositionTracker.addEventHandlers()}if(this.m_rehearsalDiv!=null)this.m_rehearsalDiv.style.display="initial"};a.prototype.InitializeRehearsalErrorInternal=function(c){this.InitializeRehearsalSessionTelemetry();this.m_rehearsalState=RehearsalState.ErrorStarting;a.CreateRehearsalDashboard(RehearsalState.ErrorStarting);this.m_sessionTelemetry.FRehearsalIdProvidedOnInitialization=false;this.m_rehearsalId=a.GenerateId();this.m_sessionTelemetry.RehearsalId=this.m_rehearsalId;SessionLogger.traceTag(50705882,logCategory.PptSession,logLevel.Info,"Rehearsal::InitializeRehearsalErrorInternal Rehearsal error screen showing. RehearsalID: "+this.m_rehearsalId+"Error Reason: "+String(c));this.m_rehearsalRealtimeLabelSpan=document.getElementById("ppt-RehearsalTrackerLabel-realtime");this.m_rehearsalWelcomeDiv=document.getElementById("ppt-RehearsalTrackerDiv-welcome");this.m_rehearsalInteractivePanelDiv=document.getElementById("ppt-RehearsalTrackerDiv-interactivePanel");this.m_rehearsalDiv=document.getElementById("ppt-RehearsalDiv");this.m_rehearsalActiveTrackerDiv=null;this.m_rehearsalGetStartedButton=document.getElementById("ppt-RehearsalTrackerDiv-welcome-getStartedButton");this.m_rehearsalTopBarDiv=document.getElementById("ppt-RehearsalDiv-topBar");this.m_timerForClearingRehearsalDashboard=null;this.m_timerForShowActiveRehearsalTracker=null;this.m_rehearsalDragDropContainer=document.getElementById("ppt-RehearsalDiv-dragDropContainer");if(this.m_rehearsalDiv&&this.m_rehearsalDragDropContainer){var b=this.m_rehearsalDiv.style.transition;this.m_rehearsalDragDropPositionTracker=new DragDropPositionTracker(this.m_rehearsalDiv,b?b:"",this.m_rehearsalDragDropContainer,[]);this.m_rehearsalDragDropPositionTracker.addEventHandlers()}if(this.m_rehearsalDiv!=null)this.m_rehearsalDiv.style.display="initial"};a.GenerateRealTimeLabel=function(b,c){var a=document.createElement("div");a.id=c;a.style.fontSize="14px";a.style.fontWeight="600";a.style.lineHeight="1.43";a.style.color=RehearsalSettings.ColorWhite;a.style.position="relative";a.style.fontFamily="Segoe UI, sans-serif, mono-serif, proportional-serif, 'mono sans serif', casual, cursive, 'small caps'";a.style.width="95%";a.style.height="20px";a.style.display="inline-block";a.innerText=b;return a};a.GeneratePauseButton=function(){var a=document.createElement("img");a.id="ppt-Rehearsal-pauseButtonState";a.src=RehearsalSettings.RehearsalPauseButtonFilePath;a.style.display="none";a.style.height="13px";a.style.width="auto";a.style.textAlign="center";a.style.marginTop="8.5px";a.tabIndex=RehearsalSettings.RehearsalKeyboardFocusTabIndex;return a};a.GeneratePlayButton=function(){var a=document.createElement("img");a.id="ppt-Rehearsal-pausedButtonState";a.src=RehearsalSettings.RehearsalPlayButtonFilePath;a.style.display="inline-block";a.style.height="12px";a.style.width="10px";a.style.textAlign="center";a.style.marginTop="9px";a.style.marginLeft="2px";a.tabIndex=RehearsalSettings.RehearsalKeyboardFocusTabIndex;return a};a.GenerateListeningButton=function(){var a=document.createElement("img");a.id="ppt-Rehearsal-listeningButtonState";a.src=RehearsalSettings.RehearsalMicListeningFilePath;a.style.width="auto";a.style.height=RehearsalSettings.RehearsalListeningIconHeight;a.style.display="inline-block";a.style.textAlign="center";a.style.marginTop=RehearsalSettings.RehearsalListeningIconMarginTop;a.tabIndex=RehearsalSettings.RehearsalKeyboardFocusTabIndex;return a};a.GeneratePlayPauseButton=function(){var c=document.createElement("div");c.id="ppt-RehearsalTrackerDiv-playPauseContainer";c.style.height="100%";c.style.width="86px";c.style.display="inline-block";c.style.textAlign="center";c.style.verticalAlign="top";var b=document.createElement("div");b.id="ppt-Rehearsal-listeningButton";b.style.height=RehearsalSettings.RehearsalListeningButtonHeight;b.style.width=RehearsalSettings.RehearsalListeningButtonHeight;b.style.borderRadius="50%";b.style.margin="auto";b.style.marginTop="4px";b.setAttribute("focusable","true");b.setAttribute("aria-label",RehearsalSettings.ListeningStateAriaLabel);b.setAttribute("role","button");b.onclick=togglePause;b.onkeypress=togglePause;b.onmouseenter=listeningButtonMouseEnter;b.onmouseleave=listeningButtonMouseLeave;b.classList.add("pulse");b.classList.add("listeningButtonState");var f=a.GenerateListeningButton(),d=a.GeneratePauseButton(),e=a.GeneratePlayButton();e.style.display="none";d.style.display="none";b.appendChild(f);b.appendChild(e);b.appendChild(d);c.appendChild(b);return c};a.GeneratePresentationTimer=function(){var a=document.createElement("div");a.id="ppt-RehearsalTrackerDiv-presentationTimer";a.style.height="100%";a.style.width="60px";a.style.fontSize="14px";a.style.display="inline-block";a.style.fontFamily="Segoe UI, sans-serif, mono-serif, proportional-serif, 'mono sans serif', casual, cursive, 'small caps'";a.style.color=RehearsalSettings.ColorWhite;a.style.lineHeight=RehearsalSettings.RehearsalInteractivePanelHeight;a.innerText="00:00";return a};a.GenerateSlideCountTracker=function(){var a=document.createElement("div");a.id="ppt-RehearsalTrackerDiv-slideCountTracker";a.style.height="100%";a.style.width="60px";a.style.fontSize="14px";a.style.display="inline-block";a.style.textAlign="right";a.style.fontFamily="Segoe UI, sans-serif, mono-serif, proportional-serif, 'mono sans serif', casual, cursive, 'small caps'";a.style.color=RehearsalSettings.ColorWhite;a.style.lineHeight=RehearsalSettings.RehearsalInteractivePanelHeight;a.innerText="";a.setAttribute("aria-label","Slide number");return a};a.GenerateRehearsalInteractivePanel=function(){var b=document.createElement("div");b.id="ppt-RehearsalTrackerDiv-interactivePanel";b.style.position="absolute";b.style.bottom="8px";b.style.width=RehearsalSettings.RehearsalDashboardWidth;b.style.height=RehearsalSettings.RehearsalDashboardMinimizedHeight;b.style.display="none";var c=a.GeneratePresentationTimer(),e=a.GeneratePlayPauseButton(),d=a.GenerateSlideCountTracker();b.appendChild(c);b.appendChild(e);b.appendChild(d);return b};a.GenerateDetectedValueParentDiv=function(b){var a=document.createElement("div");a.id=b+"-parent";a.style.display="inline-block";a.style.textAlign="center";a.style.width="100%";a.style.height=RehearsalSettings.RehearsalDashboardTrackerHeight;a.style.position="relative";return a};a.GenerateMessageDiv=function(b){var a=document.createElement("div");a.id=b;a.style.height="auto";a.style.width="100%";a.style.textAlign="center";a.style.color=RehearsalSettings.ColorWhite;a.style.fontFamily="Segoe UI, sans-serif, mono-serif, proportional-serif, 'mono sans serif', casual, cursive, 'small caps'";a.style.fontSize="14px";a.innerText="";return a};a.GenerateTrackerValueDiv=function(){var a=document.createElement("div");a.style.height="auto";a.style.width="100%";a.style.position="absolute";a.style.textAlign="center";a.style.top="50%";a.style.transform="translateY(-50%)";return a};a.GenerateFirstRunWelcomeValueDiv=function(){var a=document.createElement("div");a.style.height="auto";a.style.width="100%";a.style.position="absolute";a.style.textAlign="center";return a};a.GenerateWelcomeImage=function(){var a=document.createElement("img");a.src=RehearsalSettings.RehearsalWelcomeScreenGraphicFilePath;a.style.height="auto";a.style.width="100%";a.style.textAlign="center";a.style.marginTop="19px";a.alt="Laptop running Presenter Coach";return a};a.GenerateDetectedValueDiv=function(b){var a=document.createElement("div");a.id=b;a.innerText="";a.style.height="auto";a.style.width="100%";a.style.fontFamily="Segoe UI, sans-serif, mono-serif, proportional-serif, 'mono sans serif', casual, cursive, 'small caps'";a.style.fontSize="20px";a.style.fontWeight="600";a.style.lineHeight="1.2";a.style.marginBottom="4px";a.style.color=RehearsalSettings.ColorWhite;a.style.textAlign="center";return a};a.GenerateIconDiv=function(c,b){var a=document.createElement("img");a.id=c;a.src=b;a.style.height="auto";a.style.textAlign="center";return a};a.GenerateDetectedValueWithMessageTemplateDiv=function(){var b=a.GenerateTrackerValueDiv(),c=a.GenerateDetectedValueDiv("ppt-RehearsalTrackerValue-detectedValueWithMessage-value"),d=a.GenerateMessageDiv("ppt-RehearsalTrackerValue-detectedValueWithMessage-message");b.appendChild(c);b.appendChild(d);return b};a.GenerateIconWithMessageTemplateDiv=function(){var b=a.GenerateTrackerValueDiv();b.style.height="100%";var c=a.GenerateIconDiv("ppt-Rehearsal-iconWithMessageIcon",RehearsalSettings.RehearsalFillerIconFilePath);c.style.width="70px";c.style.marginTop="8px";c.style.marginBottom="12px";var d=a.GenerateMessageDiv("ppt-RehearsalTrackerValue-iconWithMessage-message");b.appendChild(c);b.appendChild(d);return b};a.GenerateTemperaturePillColdLabel=function(){var a=document.createElement("div");a.id="ppt-Rehearsal-temperaturePillColdLabel";a.style.height="100%";a.style.width="77px";a.style.fontSize="10px";a.style.textAlign="left";a.style.display="inline-block";a.style.fontFamily="Segoe UI, sans-serif, mono-serif, proportional-serif, 'mono sans serif', casual, cursive, 'small caps'";a.style.color=RehearsalSettings.ColorWhite;a.innerText="slow";return a};a.GenerateTemperaturePillHotLabel=function(){var a=document.createElement("div");a.id="ppt-Rehearsal-temperaturePillHotLabel";a.style.height="100%";a.style.width="77px";a.style.fontSize="10px";a.style.display="inline-block";a.style.textAlign="right";a.style.fontFamily="Segoe UI, sans-serif, mono-serif, proportional-serif, 'mono sans serif', casual, cursive, 'small caps'";a.style.color=RehearsalSettings.ColorWhite;a.innerText="fast";return a};a.GenerateTemperaturePillLabels=function(){var b=document.createElement("div");b.style.width="100%";b.style.height="auto";b.style.position="absolute";var c=a.GenerateTemperaturePillColdLabel(),d=a.GenerateTemperaturePillHotLabel();b.appendChild(c);b.appendChild(d);return b};a.GenerateTemperaturePill=function(){var b=document.createElement("div");b.style.height="auto";b.style.width="100%";b.style.position="absolute";b.style.textAlign="center";var c=a.GenerateIconDiv("ppt-Rehearsal-temperaturePillWithMessageIcon",RehearsalSettings.RehearsalJustRightTemperaturePillFilePath);c.style.width="154px";c.style.marginTop="30px";c.style.marginBottom="6px";var d=a.GenerateTemperaturePillLabels();b.appendChild(c);b.appendChild(d);return b};a.GenerateTemperaturePillWithMessageDiv=function(){var b=a.GenerateTrackerValueDiv();b.style.height="100%";var d=a.GenerateTemperaturePill(),c=a.GenerateMessageDiv("ppt-RehearsalTrackerValue-temperaturePillWithMessage-message");c.style.position="absolute";c.style.bottom="20px";b.appendChild(d);b.appendChild(c);return b};a.GenerateSingleMessageTemplateDiv=function(){var b=a.GenerateTrackerValueDiv(),c=a.GenerateMessageDiv("ppt-RehearsalTrackerValue-singleMessage-message");b.appendChild(c);return b};a.GenerateGaugeWithMessageTemplateDiv=function(){var c=a.GenerateTrackerValueDiv(),d=a.GenerateGauge(),b=document.createElement("div");b.id="ppt-RehearsalTrackerValue-gaugeWithMessage-message";b.innerText="";b.style.height="28px";b.style.width="100%";b.style.fontFamily="Segoe UI, sans-serif, mono-serif, proportional-serif, 'mono sans serif', casual, cursive, 'small caps'";b.style.fontSize="14px";b.style.color=RehearsalSettings.ColorWhite;b.style.textAlign="center";c.appendChild(d);c.appendChild(b);return c};a.GenerateGaugeTicker=function(){var c=document.createElement("div");c.className="gaugeTicker";var a=document.createElement("div");a.id="ppt-Rehearsal-gaugeTicker";a.className="gaugePointer";a.style.width="0";a.style.height="0";a.style.borderLeft="4px solid transparent";a.style.borderRight="4px solid transparent";a.style.borderBottom="30px solid #ffffff";a.style.transformOrigin="center 100% 0px";a.style.transform="rotate(-90deg)";a.style.transition="all .75s linear";var b=document.createElement("div");b.className="gaugePivot";b.style.width="8px";b.style.height="8px";b.style.borderRadius="50%";b.style.backgroundColor=RehearsalSettings.ColorWhite;c.appendChild(a);c.appendChild(b);return c};a.GenerateGauge=function(){var f=document.createElement("div");f.style.width="100%";f.setAttribute("aria-hidden","true");var d=document.createElement("div");d.className="gaugeContainer";var g=document.createElement("canvas");g.className="gaugeOuter";var c=g.getContext("2d");if(c!=null){c.lineWidth=12;c.strokeStyle="#ffffff";c.beginPath();c.arc(150,150,75,Math.PI,0);c.stroke()}var e=document.createElement("canvas");e.className="gaugeOuter";var b=e.getContext("2d");if(b!=null){b.lineWidth=12;b.strokeStyle="rgba( 140, 189, 24, 1)";b.beginPath();b.arc(150,150,75,-.7*Math.PI,-.3*Math.PI);b.stroke()}e.style.zIndex="1";var h=a.GenerateGaugeTicker();d.appendChild(g);d.appendChild(e);d.appendChild(h);f.appendChild(d);return f};a.GenerateTrackerDiv=function(b){var a=document.createElement("div");a.id=b;a.style.width="100%";a.style.display="none";a.style.height=RehearsalSettings.RehearsalDashboardTrackerHeight;a.style.textAlign="center";a.style.position="relative";return a};a.GenerateRehearsalTrackerDiv=function(b){if(b==RehearsalTemplate.DetectedValueWithMessage){var i=a.GenerateTrackerDiv("ppt-RehearsalTrackerDiv-detectedValueWithMessage"),f=a.GenerateDetectedValueParentDiv("ppt-RehearsalTrackerValue-detectedValueWithMessage"),o=a.GenerateDetectedValueWithMessageTemplateDiv();f.appendChild(o);i.appendChild(f);return i}else if(b==RehearsalTemplate.GaugeWithMessage){var l=a.GenerateTrackerDiv("ppt-RehearsalTrackerDiv-gaugeWithMessage"),k=a.GenerateDetectedValueParentDiv("ppt-RehearsalTrackerValue-gaugeWithMessage"),q=a.GenerateGaugeWithMessageTemplateDiv();k.appendChild(q);l.appendChild(k);return l}else if(b==RehearsalTemplate.SingleMessage){var j=a.GenerateTrackerDiv("ppt-RehearsalTrackerDiv-singleMessage"),g=a.GenerateDetectedValueParentDiv("ppt-RehearsalTrackerValue-singleMessage"),p=a.GenerateSingleMessageTemplateDiv();g.appendChild(p);j.appendChild(g);return j}else if(b==RehearsalTemplate.IconWithMessage){var h=a.GenerateTrackerDiv("ppt-RehearsalTrackerDiv-iconWithMessage"),e=a.GenerateDetectedValueParentDiv("ppt-RehearsalTrackerValue-iconWithMessage"),n=a.GenerateIconWithMessageTemplateDiv();e.appendChild(n);h.appendChild(e);return h}else if(b==RehearsalTemplate.TemperaturePillWithMessage){var d=a.GenerateTrackerDiv("ppt-RehearsalTrackerDiv-temperaturePillWithMessage"),c=a.GenerateDetectedValueParentDiv("ppt-RehearsalTrackerValue-temperaturePillWithMessage"),m=a.GenerateTemperaturePillWithMessageDiv();c.appendChild(m);d.appendChild(c);return d}else{SessionLogger.traceTag(42259012,logCategory.PptSession,logLevel.Error,"Rehearsal::GenerateRehearsalTrackerDiv Unhandled RehearsalTracker: "+b);return a.GenerateTrackerDiv("ppt-RehearsalTrackerDiv-unknownDiv")}};a.GenerateWelcomeText=function(){var a=document.createElement("div");a.style.display="inline-block";a.style.textAlign="center";a.style.width="100%";a.style.height="auto";a.style.position="relative";a.style.fontFamily="Segoe UI, sans-serif, mono-serif, proportional-serif, 'mono sans serif', casual, cursive, 'small caps'";a.style.color=RehearsalSettings.ColorWhite;a.style.lineHeight="1.43";a.style.fontSize="14px";a.setAttribute("focusable","true");a.tabIndex=0;var b=RehearsalSettings.RehearsalFirstRunWelcomeScreenText;a.innerText=b;a.setAttribute("aria-label",b);a.setAttribute("role","text");a.setAttribute("aria-role","text");return a};a.GenerateWelcomeTitle=function(){var a=document.createElement("div");a.style.display="inline-block";a.style.textAlign="center";a.style.width="100%";a.style.height="40px";a.style.position="relative";a.style.fontFamily="Segoe UI, sans-serif, mono-serif, proportional-serif, 'mono sans serif', casual, cursive, 'small caps'";a.style.fontWeight="600";a.style.color=RehearsalSettings.ColorWhite;a.style.lineHeight="1.43";a.style.fontSize="14px";a.style.marginTop="27px";a.style.marginBottom="9px";a.setAttribute("focusable","true");a.tabIndex=0;a.innerText=RehearsalSettings.RehearsalWelcomeScreenTitle;a.setAttribute("aria-label",RehearsalSettings.RehearsalWelcomeScreenTitle);a.setAttribute("role","heading");a.setAttribute("aria-role","heading");return a};a.GenerateGetStartedButton=function(){var a=document.createElement("button");a.id="ppt-RehearsalTrackerDiv-welcome-getStartedButton";a.className="getStartedButton";a.onmousedown=onMouseDownClickedGetStarted;a.onclick=userClickedGetStarted;a.addEventListener("touchend",userClickedGetStarted,true);a.setAttribute("focusable","true");a.tabIndex=RehearsalSettings.RehearsalKeyboardFocusTabIndex;a.textContent=RehearsalSettings.RehearsalGetStartedButtonLabel;a.style.fontSize="14px";a.style.fontWeight="600";a.style.fontFamily="Segoe UI, sans-serif, mono-serif, proportional-serif, 'mono sans serif', casual, cursive, 'small caps'";return a};a.GenerateWelcomeScreen=function(h){var b=document.createElement("div");b.id="ppt-RehearsalTrackerDiv-welcome";b.style.width="100%";b.style.display="inline-block";b.style.height=RehearsalSettings.RehearsalDashboardFirstRunWelcomeDivHeight;b.style.textAlign="center";b.style.position="relative";var c=a.GenerateFirstRunWelcomeValueDiv(),e=a.GenerateWelcomeImage(),f=a.GenerateWelcomeTitle();c.appendChild(e);c.appendChild(f);var g=a.GenerateWelcomeText(),d=a.GenerateGetStartedButton();if(h==RehearsalState.ErrorStarting)d.disabled=true;c.appendChild(g);c.appendChild(d);b.appendChild(c);return b};a.GenerateRehearsalTopBar=function(){var b=document.createElement("div");b.id="ppt-RehearsalDiv-topBar";b.style.lineHeight="1.43";b.style.position="relative";b.style.width="100%";b.style.height="20px";b.style.display="inline-block";var c=a.GenerateRealTimeLabel("Welcome","ppt-RehearsalTrackerLabel-realtime");b.appendChild(c);return b};a.GenerateRehearsalDragDropContainer=function(){var a=document.createElement("div");a.id="ppt-RehearsalDiv-dragDropContainer";a.style.position="absolute";a.style.top="0";a.style.left="0";a.style.width="100vw";a.style.height="100vh";a.style.display="none";return a};a.CreateRehearsalDashboard=function(e){var p=document.getElementById("ppt-RehearsalDiv");if(p){SessionLogger.traceTag(41726051,logCategory.PptSession,logLevel.Error,"Rehearsal::CreateRehearsalDashboard already created.");return}var g=Date.now(),b=document.createElement("div");b.id="ppt-RehearsalDiv";b.style.width=RehearsalSettings.RehearsalDashboardWidth;b.style.height=RehearsalSettings.RehearsalDashboardFirstRunMaximizedHeight;b.style.background="rgba( 32, 31, 30, 0.92 )";b.style.borderRadius="4px";b.style.right="14px";b.style.bottom="38px";b.style.position="absolute";b.style.userSelect="none";b.style.paddingTop="8px";b.style.paddingBottom="8px";b.style.paddingLeft="13px";b.style.paddingRight="13px";b.style.transition=RehearsalSettings.RehearsalDashboardMaximizeTransition;b.setAttribute("role","alert");b.setAttribute("aria-role","alert");b.setAttribute("aria-live","assertive");b.setAttribute("aria-label","Rehearse with Coach Dashboard");var c=document.createElement("div");c.id="ppt-RehearsalDiv-container";c.style.width="100%";c.style.height="auto";var n=a.GenerateRehearsalTopBar();c.appendChild(n);var o=a.GenerateWelcomeScreen(e);c.appendChild(o);if(e!=RehearsalState.ErrorStarting){var h=a.GenerateRehearsalTrackerDiv(RehearsalTemplate.DetectedValueWithMessage),j=a.GenerateRehearsalTrackerDiv(RehearsalTemplate.GaugeWithMessage),l=a.GenerateRehearsalTrackerDiv(RehearsalTemplate.SingleMessage),k=a.GenerateRehearsalTrackerDiv(RehearsalTemplate.IconWithMessage),f=a.GenerateRehearsalTrackerDiv(RehearsalTemplate.TemperaturePillWithMessage);c.appendChild(h);c.appendChild(j);c.appendChild(l);c.appendChild(k);c.appendChild(f);var m=a.GenerateRehearsalInteractivePanel();b.appendChild(c);b.appendChild(m)}else b.appendChild(c);var i=a.GenerateRehearsalDragDropContainer();document.body.appendChild(i);document.body.appendChild(b);var d=a.GetInstance();if(d!=null)d.m_sessionTelemetry.CreateDashboardTimeInMS=Date.now()-g;b.addEventListener("contextmenu",disableContextMenu)};a.s_instance=null;return a}(),CorrectedSensitivePhrasesData=function(){function a(){this.phraseData={};this.correction=""}return a}(),FillerData=function(){function a(){this.word="";this.count=0}return a}(),PaceData=function(){function a(){this.pace=0;this.timePoint=0}return a}(),MonotoneData=function(){function a(){this.pvq=0;this.slide=0;this.timePoint=0}return a}(),RehearsalSummaryData=function(){function a(){this.fillers=[];this.sensitivePhrases=[];this.sensitivePhrasesCorrected=[];this.originalityProblemSlides=[];this.timeSpent=0;this.averagePace=0;this.paceOverTime=[];this.monotoneOverTime=[];this.slidesRehearsed=0;this.grammarInfos=[];this.thumbIndices=[]}return a}(),RehearsalSummaryCollector=function(){function a(){this.m_startTime=-1;this.m_stopTime=-1;this.m_presentationTimeInMS=-1;this.m_paceSamplingInverseRate=1;this.m_paceSamplingPortion=0;this.m_paceOverTime=[];this.m_monotoneOverTime=[];this.m_fillers={};this.m_sensitivePhrases={};this.m_originalityScores={};this.m_slidesRehearsed={};this.m_grammarCritiques=[]}a.GetInstance=function(){if(!this.s_instance)this.s_instance=new a;return this.s_instance};a.GetRehearsalSummaryStateInstance=function(){return this.GetInstance()};a.GetRehearsalSummaryControlInstance=function(){return this.GetInstance()};a.prototype.GetThumbIndicesForSummary=function(){var b=[],a={};Object.keys(this.m_originalityScores).forEach(function(b){return a[Number(b)]=true});this.m_grammarCritiques.forEach(function(b){return a[b.slideIndex]=true});Object.keys(a).forEach(function(a){return b.push(Number(a))});return b};a.prototype.GetGrammar=function(){return this.m_grammarCritiques};a.DisposeInstance=function(){this.s_instance=null};a.prototype.Reset=function(){this.m_startTime=this.m_stopTime=this.m_presentationTimeInMS=-1;this.m_paceSamplingInverseRate=1;this.m_paceSamplingPortion=0;this.m_paceOverTime=[];this.m_monotoneOverTime=[];this.m_fillers={};this.m_sensitivePhrases={};this.m_slidesRehearsed={}};a.prototype.EnsureIsStarted=function(){this.m_startTime==-1&&this.StartRehearsal()};a.prototype.StartRehearsal=function(){this.m_stopTime!=-1&&this.Reset();this.m_startTime=Date.now().valueOf()};a.prototype.StopRehearsal=function(a){if(this.m_stopTime==-1)this.m_stopTime=Date.now().valueOf();this.m_presentationTimeInMS=a};a.prototype.AddPace=function(e,d){this.EnsureIsStarted();this.m_paceSamplingPortion%this.m_paceSamplingInverseRate==0&&this.m_paceOverTime.push({pace:e,timePoint:d});this.m_paceSamplingPortion++;if(this.m_paceOverTime.length>=a.MaxPaceTimePoints){for(var c=[],b=0;b<this.m_paceOverTime.length;b++)b%2==0&&c.push(this.m_paceOverTime[b]);this.m_paceOverTime=c;this.m_paceSamplingInverseRate*=2;this.m_paceSamplingPortion=0}};a.prototype.AddMonotone=function(d,c,b){this.EnsureIsStarted();this.m_monotoneOverTime.length<a.MaxMonotoneTimePoints&&this.m_monotoneOverTime.push({pvq:d,slide:c,timePoint:b})};a.prototype.AddGrammarCritique=function(e,g,f,c,d,b,a){this.EnsureIsStarted();this.m_grammarCritiques.push({slideIndex:e,helpText:g,category:f,originalText:c,triggerStart:d,triggerLength:b,suggestionText:a})};a.AddCountsToHashMap=function(a,b){if(b.length==0)return;b.forEach(function(b){if(b.length==0)return;if(a[b]==undefined)a[b]=0;a[b]++})};a.prototype.AddFillers=function(b){this.EnsureIsStarted();a.AddCountsToHashMap(this.m_fillers,b)};a.prototype.AddSensitivePhrases=function(d,a){var b=this;this.EnsureIsStarted();var c=a!=undefined&&a.length>0;if(c&&a.length!=d.length){c=false;SessionLogger.traceTag(42329820,logCategory.PptSession,logLevel.Error,"RehearsalSummary::AddSensitivePhrases Length of corrected phrases does not match length of phrases")}d.forEach(function(d,e){if(d.length==0)return;if(b.m_sensitivePhrases[d]==undefined)b.m_sensitivePhrases[d]={count:0,correction:""};b.m_sensitivePhrases[d].count++;b.m_sensitivePhrases[d].correction=c?a[e]:""})};a.prototype.AddProblematicOriginalitySlide=function(a){this.EnsureIsStarted();this.m_originalityScores[a]=true};a.prototype.AddSlideRehearsed=function(a){this.EnsureIsStarted();this.m_slidesRehearsed[a]=true};a.prototype.GetTimeSpent=function(){if(this.m_presentationTimeInMS>=0)return Math.round(this.m_presentationTimeInMS/1e3);var c=Date.now().valueOf(),a=this.m_startTime==-1?c:this.m_startTime,b=this.m_stopTime==-1?c:this.m_stopTime;if(a>b)a=b;return Math.round((b-a)/1e3)};a.prototype.GetNumSlidesRehearsed=function(){return Object.keys(this.m_slidesRehearsed).length};a.prototype.GetAveragePace=function(){if(this.m_paceOverTime.length>0){var a=0;this.m_paceOverTime.forEach(function(b){a+=b.pace});return Math.round(a/this.m_paceOverTime.length)}return 0};a.prototype.GetPaceOverTime=function(){var a=[];this.m_paceOverTime.forEach(function(b){a.push({pace:Math.round(b.pace),timePoint:Math.round(b.timePoint/1e3)})});return a};a.prototype.GetMonotoneOverTime=function(){var a=[];this.m_monotoneOverTime.sort(function(a,b){return a.timePoint-b.timePoint}).forEach(function(b){a.push({pvq:Math.round(b.pvq*1e3),timePoint:Math.round(b.timePoint/1e3),slide:b.slide})});return a};a.prototype.GetFillers=function(){var b=this,a=[];Object.keys(this.m_fillers).forEach(function(c){a.push({word:c,count:Number(b.m_fillers[c])})});a.sort(function(b,a){return a.count-b.count});return a};a.prototype.GetSortedSensitivePhrases=function(a){var c=this;if(a===void 0)a=false;var b=[];Object.keys(this.m_sensitivePhrases).forEach(function(d){b.push({phraseData:{phrase:d,count:Number(c.m_sensitivePhrases[d].count)},correction:a?c.m_sensitivePhrases[d].correction||"":""})});b.sort(function(b,a){return a.phraseData.count-b.phraseData.count});return b};a.prototype.GetOriginalityProblemSlides=function(){var a=[];Object.keys(this.m_originalityScores).forEach(function(b){return a.push(Number(b))});return a};a.prototype.GetRehearsalSummary=function(){if(this.m_startTime==-1){SessionLogger.traceTag(41760841,logCategory.PptSession,logLevel.Error,"RehearsalSummary::GetRehearsalSummary returning null as Rehearsal was not started");return null}var a=this.GetSortedSensitivePhrases(true),b={fillers:this.GetFillers(),sensitivePhrases:a.map(function(a){return a.phraseData}),sensitivePhrasesCorrected:a.map(function(a){return a.correction}),originalityProblemSlides:this.GetOriginalityProblemSlides(),timeSpent:this.GetTimeSpent(),averagePace:this.GetAveragePace(),paceOverTime:this.GetPaceOverTime(),monotoneOverTime:this.GetMonotoneOverTime(),slidesRehearsed:this.GetNumSlidesRehearsed(),grammarInfos:this.GetGrammar(),thumbIndices:this.GetThumbIndicesForSummary()};return b};a.s_instance=null;a.MaxPaceTimePoints=64;a.MaxMonotoneTimePoints=1e4;return a}(),SessionLogger=PowerPointOnline.Telemetry.SessionLogger,UlsSessionLogger=PowerPointOnline.Telemetry.UlsSessionLogger;function TranscriberPostMessageUpward(c){if(TranscriberSettings.WebServiceBase!=undefined&&TranscriberSettings.WebServiceBase!=null){var a=new URL(TranscriberSettings.WebServiceBase),b=a.protocol+"//"+a.hostname;window.parent.postMessage(JSON.stringify(c),b)}else SessionLogger.traceTag(521175365,logCategory.PptSession,logLevel.Error,"Transcriber::TranscriberPostMessageUpward TranscriberSettings.WebServiceBase is undefined or null")}var OnGetUserMediaSuccessEntryPoint;(function(a){a[a.None=0]="None";a[a.OnLoadCustomEndpointRequest=1]="OnLoadCustomEndpointRequest";a[a.OnErrorCustomEndpointRequest=2]="OnErrorCustomEndpointRequest";a[a.OnTimeoutCustomEndpointRequest=3]="OnTimeoutCustomEndpointRequest";a[a.CustomEndpointNotEnabled=4]="CustomEndpointNotEnabled";a[a.InvalidDocId=5]="InvalidDocId"})(OnGetUserMediaSuccessEntryPoint||(OnGetUserMediaSuccessEntryPoint={}));var TranscriptionEntryPoint;(function(a){a[a.None=0]="None";a[a.SingleLineRibbon=1]="SingleLineRibbon";a[a.MultipleLineRibbon=2]="MultipleLineRibbon";a[a.SlideShowToolbar=3]="SlideShowToolbar";a[a.SlideShowKeyboardShortcut=4]="SlideShowKeyboardShortcut";a[a.LiveBroadcast=5]="LiveBroadcast"})(TranscriptionEntryPoint||(TranscriptionEntryPoint={}));var TranscriberDetectionDivStyle;(function(a){a[a.None=0]="None";a[a.Warning=1]="Warning";a[a.Error=2]="Error";a[a.Listening=3]="Listening";a[a.NoMicAccess=4]="NoMicAccess";a[a.MicReady=5]="MicReady"})(TranscriberDetectionDivStyle||(TranscriberDetectionDivStyle={}));var TelemetryFieldNames=function(){function a(){}a.AudioFactorCalculationDurationMS="AudioFactorCalculationDurationMS";a.BufferSize="BufferSize";a.CreateTranscribeContainerEndTimeMS="CreateTranscribeContainerEndTimeMS";a.CreateTranscribeContainerStartTimeMS="CreateTranscribeContainerStartTimeMS";a.CustomEndpointEnabled="CustomEndpointEnabled";a.CustomEndpointRequestCorrelationID="CustomEndpointRequestCorrelationID";a.CurrentTimestampMS="CurrentTimestampMS";a.DataLoggingTimeInterval="DataLoggingTimeInterval";a.Endpoint="Endpoint";a.FatalErrors="FatalErrors";a.FirstMessageLatencyMS="FirstMessageLatencyMS";a.InitializeWebSocketEndTimeMS="InitializeWebSocketEndTimeMS";a.InitializeWebSocketStartTimeMS="InitializeWebSocketStartTimeMS";a.LatencyTableDeletedCount="LatencyTableDeletedCount";a.MaxFinalMessageLatencyMS="MaxFinalMessageLatencyMS";a.MaxPartialMessageLatencyMS="MaxPartialMessageLatencyMS";a.MessageLatencyCalculationTimeMS="MessageLatencyCalculationTimeMS";a.MinFinalMessageLatencyMS="MinFinalMessageLatencyMS";a.MinPartialMessageLatencyMS="MinPartialMessageLatencyMS";a.NonFatalErrors="NonFatalErrors";a.OnGetUserMediaSuccessEntryPoint="OnGetUserMediaSuccessEntryPoint";a.RealTimeFactorLowerThreshold="RealTimeFactorLowerThreshold";a.RealTimeFactorUpperThreshold="RealTimeFactorUpperThreshold";a.RequestCustomEndpointEndTimeMS="RequestCustomEndpointEndTimeMS";a.RequestCustomEndpointFailedEndTimeMS="RequestCustomEndpointFailedEndTimeMS";a.RequestCustomEndpointStartTimeMS="RequestCustomEndpointStartTimeMS";a.RequestCustomEndpointTimedOutEndTimeMS="RequestCustomEndpointTimedOutEndTimeMS";a.SendFirstMessageTime="SendFirstMessageTime";a.ServiceRequestTranslationLanguages="ServiceRequestTranslationLanguages";a.SpeechLanguage="SpeechLanguage";a.TotalAudioFactorOutsideOfThresholdCount="TotalAudioFactorOutsideOfThresholdCount";a.TotalEntriesInLatencyTable="TotalEntriesInLatencyTable";a.TotalFinalMessagesCount="TotalFinalMessagesCount";a.TotalFinalMessageLatency="TotalFinalMessageLatency";a.TotalHighLatencyPartialMessagesCount="TotalHighLatencyPartialMessagesCount";a.TotalHighLatencyFinalMessagesCount="TotalHighLatencyFinalMessagesCount";a.TotalMessageCorrelationIDNotFoundCount="TotalMessageCorrelationIDNotFoundCount";a.TotalPartialMessageLatency="TotalPartialMessageLatency";a.TotalPartialMessagesCount="TotalPartialMessagesCount";a.TotalTranscriptOutsideOfThresholdCount="TotalTranscriptOutsideOfThresholdCount";a.TranscriberID="TranscriberID";a.TranscriptionEntryPoint="TranscriptionEntryPoint";a.TranscriptionEntryPointCalled="TranscriptionEntryPointCalled";a.TranscriptionStartTime="TranscriptionStartTime";a.TranscriptionEndTime="TranscriptionEndTime";a.TranslationLanguage="TranslationLanguage";a.WebSocketClosedTimestamp="WebSocketClosedTimestamp";a.WebSocketConnectionDurationMS="WebSocketConnectionDurationMS";a.WebSocketCreateTimestamp="WebSocketCreateTimestamp";a.WebSocketCustomEndpoint="WebSocketCustomEndpoint";a.WebSocketOpenedTimestamp="WebSocketOpenedTimestamp";a.WebSocketRetryAttempts="WebSocketRetryAttempts";a.WebSocketRetryReason="WebSocketRetryReason";a.FEnableContentlogging="FEnableContentlogging";a.SpeechMode="SpeechMode";a.TranscriberPosition="TranscriberPosition";a.TranscriberDisposeDuration="TranscriberDisposeDuration";a.TotalNetworkErrorMessageCount="TotalNetworkErrorMessageCount";a.TotalNetworkWarningMessageCount="TotalNetworkWarningMessageCount";a.TotalQualityErrorMessageCount="TotalQualityErrorMessageCount";a.TotalQualityWarningMessageCount="TotalQualityWarningMessageCount";return a}(),TelemetryErrorFieldNames=function(){function a(){}a.CustomEndpointClientError="CustomEndpointClientError";a.CustomEndpointClientFailureReason="CustomEndpointClientFailureReason";a.CustomEndpointServerError="CustomEndpointServerError";a.CustomEndpointServerErrorCode="CustomEndpointServerErrorCode";a.CustomEndpointServerFailureReason="CustomEndpointServerFailureReason";a.ErrorNoAudioSend="ErrorNoAudioSend";a.ErrorStatus="ErrorStatus";a.InvalidDocId="InvalidDocId";a.MessageErrorCode="MessageErrorCode";a.TranscriptErrorCode="TranscriptErrorCode";a.WebSocketDisconnected="WebSocketDisconnected";a.WebSocketErrorCode="WebSocketErrorCode";a.WebSocketRetryConnectionFailed="WebSocketRetryConnectionFailed";a.InitializeAudioContextFailed="InitializeAudioContextFailed";a.InitializeTranscriberSessionFailed="InitializeTranscriberSessionFailed";a.GetUserMediaFailed="GetUserMediaFailed";a.ReadSettingsFailed="ReadSettingsFailed";a.QualityMessageShortcodeInvalid="QualityMessageShortcodeInvalid";a.DisplayQualityStatusException="DisplayQualityStatusException";a.TemporaryDisableSubtitleDueNetworkError="TemporaryDisableSubtitleDueNetworkError";a.LossInternetConnection="LossInternetConnection";return a}(),TranscriberSettings=function(){function a(){}a.WacUserSessionId="";a.WacUserDatacenterCluster="";a.UserId="";a.TenantId="";a.AudienceGroup="";a.BuildVersion="";a.IdentityProvider="";a.Locale="";a.WacHost="";a.WacDatacenter="";a.EntryPoint=TranscriptionEntryPoint.None;a.StartTime=0;a.MaxAllowedFragmentLatencyMS=5e3;a.MaxAllowedFinalFragmentLatencyMS=2e4;a.DynamicBufferEnabled=false;a.DefaultBufferSize=8192;a.ResetTranscriptionTextIntervalMS=1e4;a.ResetQualityDetectionIntervalMS=3e4;a.DataLoggingIntervalMS=3e4;a.RealTimeFactorLowerThreshold=0;a.RealTimeFactorUpperThreshold=999;a.IsLogEachTranscriptMessage=false;a.MaxAllowedRetryCountPerSession=15;a.FragmentLatencyWarnWindow=6;a.FragmentLatencyErrorWindow=3;a.TranscriberPosition="BelowSlide";a.CustomEndpointRequestTimeoutInMs=1e4;a.RTLLanguages="ar,he,fa,ur";a.fSupportSpeechResponseMessage=false;a.NoInternetConnectionInMs=12e4;a.TranslationLanguagesForLive="";a.LivePraugueSessionInfo="";a.BroadcastSubtitlesFromSpeechFrontDoorForLive=false;a.HeartbeatInterval=3e3;a.RoundtripLatencyWarnThreshold=100;a.RoundtripLatencyErrorThreshold=500;a.FragmentLatencyWarnThreshold=5e3;a.FragmentLatencyErrorThreshold=1e4;a.AudioSendingCountIntervalMS=6e5;a.TranscriberShowListeningDetectionTextInMS=12e4;a.AudioContextSampleRate=0;a.IsStartRehearsal=false;a.SlideCount=0;a.StartingSlideIndex=0;a.ShowSoundReminderTimeoutMS=3e3;a.PodRehearsalMonotoneEnabled=false;return a}(),TranscriberResourceString=function(){function a(){}a.AccessibilityContentString="";a.AccessibilityWindowString="";a.ErrorAudioDevice="";a.GenericRetryErrorMessage="";a.GenericNetworkErrorMessage="";a.QualityStatusStringDict={};return a}(),TranscriberDetectionSettings=function(){function a(){}a.ColorBlack="rgba( 32, 31, 30, 0.92 )";a.ColorWhite="#ffffff";a.ColorYellow="#F8E71C";a.ColorRed="#A80000";a.WarningSign="&#9888 ";return a}(),TranscriberElementIds=function(){function a(){}a.TranscriberId="ppt-Transcriber";a.ResultSpanId="ppt-TranscriberResultSpan";a.DetectionSpanId="ppt-TranscriberDetectionSpan";a.DetectionDivId="ppt-TranscriberDetectionDiv";a.AccessibilityContentSpan="ppt-TranscriberAccessibilityContentSpan";return a}(),Transcriber=function(){function a(){this.m_webSocket=null;this.m_sessionTelemetry={};this.m_messageLatencyTable={};this.m_transcriberResultSpan=null;this.m_transcriberDetectionSpan=null;this.m_transcriberDetectionDiv=null;this.m_transcriberAccessibilityContentSpan=null;this.m_wsUri="";this.m_translationLanguages="";this.m_webSocketConnectionRetryAttempts=0;this.c_maxWebSocketRetryAttempts=5;this.c_websocketRetryInterval=5e3;this.m_webSocketTotalRetryCountInSession=0;this.c_maxEntriesInLatencyTable=1200;this.c_maxBufferSize=16384;this.m_wsTimer=0;this.m_fatalErrors=[];this.m_nonFatalErrors=[];this.m_transcriberId="";this.m_isFirstWebSocketConnection=true;this.m_countFragmentLatencyInWarnWindow=0;this.m_countFragmentLatencyInErrorWindow=0;this.m_inNetworkQualityWarnStatus=false;this.m_inNetworkQualityErrorStatus=false;this.m_inListeningStatus=false;this.m_countRoundtripLatencyInWarnWindow=0;this.m_countRoundtripLatencyInErrorWindow=0;this.m_inRoundtripLatencyWarnStatus=false;this.m_inRoundtripLatencyErrorStatus=false;this.m_currentHeartbeatLatency=0;this.m_currentHeartbeatSendInterval=0;this.m_maxPartialMessageLatency=Number.MIN_VALUE;this.m_minPartialMessageLatency=Number.MAX_VALUE;this.m_totalPartialMessagesCount=0;this.m_totalHighLatencyPartialMessagesCount=0;this.m_totalPartialMessageLatency=0;this.m_maxFinalMessageLatency=Number.MIN_VALUE;this.m_minFinalMessageLatency=Number.MAX_VALUE;this.m_totalFinalMessagesCount=0;this.m_totalHighLatencyFinalMessagesCount=0;this.m_totalFinalMessageLatency=0;this.m_totalMessageCorrelationIDNotFoundCount=0;this.m_latencyTableDeletedCount=0;this.m_totalEntriesInLatencyTable=0;this.m_resultSpanPaddingValue="";this.m_messageLatencyCalculationTime=0;this.m_audioFactorCalculationDuration=0;this.m_totalAudioFactorOutsideOfThresholdCount=0;this.m_totalAudioMessageCountInPreviousTimeInterval=0;this.m_totalAudioMessageCountInCurrentTimeInterval=0;this.m_totalAudioMessageCountInMins=0;this.m_lastSentAudioTimeUTC=Number.MAX_VALUE;this.m_currentSentAudioTimeUTC=Number.MAX_VALUE;this.m_lastAudioLogUTC=Number.MIN_VALUE;this.m_realTimeSendDataFactorCount=0;this.m_realTimeSendDataFactorSum=0;this.m_minRealTimeSendDataFactor=Number.MAX_VALUE;this.m_maxRealTimeSendDataFactor=Number.MIN_VALUE;this.m_realTimeSendDataFactorCountInTimeInterval=0;this.m_realTimeSendDataFactorSumInTimeInterval=0;this.m_minRealTimeSendDataFactorInTimeInterval=Number.MAX_VALUE;this.m_maxRealTimeSendDataFactorInTimeInterval=Number.MIN_VALUE;this.m_totalTranscriptFactorOutsideOfThresholdCount=0;this.m_totalTranscriptMessageCountInPreviousTimeInterval=0;this.m_totalTranscriptMessageCountInCurrentTimeInterval=0;this.m_lastReceivedTranscriptTimeUTC=Number.MAX_VALUE;this.m_lastTranscriptLogUTC=Number.MIN_VALUE;this.m_realTimeReceiveDataFactorCount=0;this.m_realTimeReceiveDataFactorSum=0;this.m_minRealTimeReceiveDataFactor=Number.MAX_VALUE;this.m_maxRealTimeReceiveDataFactor=Number.MIN_VALUE;this.m_realTimeReceiveDataFactorCountInTimeInterval=0;this.m_realTimeReceiveDataFactorSumInTimeInterval=0;this.m_minRealTimeReceiveDataFactorInTimeInterval=Number.MAX_VALUE;this.m_maxRealTimeReceiveDataFactorInTimeInterval=Number.MIN_VALUE;this.m_startLogIntervalTranscript=Number.MAX_VALUE;this.m_startLogIntervalAudio=Number.MAX_VALUE;this.m_intervalTranscript=Number.MAX_VALUE;this.m_intervalAudio=Number.MAX_VALUE;this.m_isMuted=false;this.m_transcriptDisplay1="";this.m_transcriptDisplay2="";this.m_fPreviousTranscriptResultFinal=false;this.m_roundLatencyTimerId=0;this.m_audioSendingCountIntervalTimerId=0;this.m_sendPingMessageFlag=false;this.m_heartbeatSendTime=0;this.m_timerForClearTranscriptionText=0;this.m_gapNumberBetweenPingPongMessage=0;this.m_timerForShowListeningDetectionMessage=0;this.m_timerForShowSoundReminderDetectionMessage=0;this.m_fSendClientMetadata=true;this.m_currentSlideIndex=0;this.m_currentSpeechModes=[];this.m_fIsLiveAgent=false;this.m_fIsRehearsal=false;this.m_fIsTranscribe=false;this.m_podsUrl="";this.m_podsId="";this.m_slideCount=0;this.m_fRehearsalGrammarIsEnabled=false;this.m_translationLanguagesForLive="";this.m_fInLiveBroadcastingMode=false;this.m_prepAudioCount=0;this.m_prepAudioSum=0;this.m_minPrepAudio=Number.MAX_VALUE;this.m_maxPrepAudio=Number.MIN_VALUE;this.m_totalNetworkErrorMessageCount=0;this.m_totalNetworkWarningMessageCount=0;this.m_totalQualityErrorMessageCount=0;this.m_totalQualityWarningMessageCount=0;var b=a.s_instance;b&&SessionLogger.traceTag(40952843,logCategory.PptSession,logLevel.Warning,"Transcriber::Constructor Transcriber instance already exists. TranscriberID: "+b.m_transcriberId)}a.prototype.initialTranscriberSession=function(f,b,e,d,g){this.m_audioCtx=a.initializeAudioContext();if(!this.m_audioCtx){this.SetTranscriptionErrorText(TranscriberResourceString.GenericErrorMessage);RecordError(TelemetryErrorFieldNames.InitializeAudioContextFailed,"Failed to initialize audio context",Date.now(),true);return false}try{this.m_audioStream=f;this.m_streamSource=this.m_audioCtx.createMediaStreamSource(this.m_audioStream);if(TranscriberSettings.DynamicBufferEnabled){var c=Math.pow(2,Math.floor(Math.log(this.m_audioCtx.sampleRate*.2)/Math.log(2)));b=c<=this.c_maxBufferSize?c:this.c_maxBufferSize}this.m_sessionTelemetry[TelemetryFieldNames.BufferSize]=b;this.m_scriptNode=this.m_audioCtx.createScriptProcessor(b,e,d);this.m_wsUri=g;OpenWebSocketConnection();this.m_transcriberAccessibilityContentSpan=document.getElementById(TranscriberElementIds.AccessibilityContentSpan);this.m_transcriberResultSpan=document.getElementById(TranscriberElementIds.ResultSpanId);if(this.m_transcriberResultSpan)this.m_resultSpanPaddingValue=window.getComputedStyle(this.m_transcriberResultSpan).getPropertyValue("padding");this.m_transcriptDisplay1="";this.m_transcriptDisplay2="";this.m_fPreviousTranscriptResultFinal=false;this.m_currentSlideIndex=this.m_currentSlideIndex||0;this.m_slideCount=this.m_slideCount||0;this.m_roundLatencyTimerId=0;this.m_audioSendingCountIntervalTimerId=0;this.m_sendPingMessageFlag=false;this.m_gapNumberBetweenPingPongMessage=0;return true}catch(h){this.SetTranscriptionErrorText(TranscriberResourceString.GenericErrorMessage);RecordError(TelemetryErrorFieldNames.InitializeTranscriberSessionFailed,"Failed to initialize transcriber session",Date.now(),true);return false}};a.prototype.muteMicrophone=function(){var a=this;if(!this.m_audioStream){SessionLogger.traceTag(595358547,logCategory.PptSession,logLevel.Error,"Transcriber::muteMicrophone Tried to mute with null audio stream");return}try{this.m_audioStream.getTracks().forEach(function(b){b.enabled=false;a.m_isMuted=true;SessionLogger.traceTag(595358546,logCategory.PptSession,logLevel.Info,"Transcriber::muteMicrophone Muted microphone track")});resetTransciptionTextToEmpty();this.SetIdleStateTranscriptionDetectionText();this.m_fPreviousTranscriptResultFinal=true}catch(b){SessionLogger.traceTag(595358545,logCategory.PptSession,logLevel.Error,"Transcriber::muteMicrophone Error trying to mute microphone. Exception: "+b)}};a.prototype.unmuteMicrophone=function(){var a=this;if(!this.m_audioStream){SessionLogger.traceTag(595358544,logCategory.PptSession,logLevel.Error,"Transcriber::unmuteMicrophone Tried to unmute with null audio stream");return}try{this.m_audioStream.getTracks().forEach(function(b){b.enabled=true;a.m_isMuted=false;SessionLogger.traceTag(595358543,logCategory.PptSession,logLevel.Info,"Transcriber::unmuteMicrophone Unmuted microphone track")})}catch(b){SessionLogger.traceTag(595358542,logCategory.PptSession,logLevel.Error,"Transcriber::unmuteMicrophone Error trying to unmute microphone. Exception: "+b)}};a.prototype.SetMicrophoneState=function(a){a?this.muteMicrophone():this.unmuteMicrophone()};a.initializeAudioContext=function(){var d=a.s_instance;if(!d){SessionLogger.traceTag(41227851,logCategory.PptSession,logLevel.Error,"Transcriber::initializeAudioContext Transcriber instance is null");return}var c,b=[];try{if(TranscriberSettings.AudioContextSampleRate>0&&TranscriberBrowserUtils.IsChrome()){var f={sampleRate:TranscriberSettings.AudioContextSampleRate};b.push(function(){return new AudioContext(f)});b.push(function(){return new window.webkitAudioContext(f)})}}catch(g){SessionLogger.traceTag(51245385,logCategory.PptSession,logLevel.Error,"Exception initialising audio context with options TranscriberID: "+d.m_transcriberId+"Exception: "+g)}b.push(function(){return new AudioContext});b.push(function(){return new window.webkitAudioContext});for(var e=0;e<b.length;e++)try{c=b[e]();if(c)break}catch(g){SessionLogger.traceTag(50952223,logCategory.PptSession,logLevel.Error,"Exception initialising audio context TranscriberID: "+d.m_transcriberId+"Exception: "+g)}return c};a.SanitizeDocID=function(a,c){if(TranscriberSettings.DocId.length===0)return"";var b=a.indexOf("access_token");if(b===-1)SessionLogger.traceTag(50906640,logCategory.PptSession,logLevel.Warning,"Transcriber::SanitizeDocID access_token was not found in docID. TranscriberID: "+c);else a=a.substring(0,b);return a};a.generateId=function(){var a="xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",b=a.replace(/[xy]/g,function(b){var a=Math.random()*16|0,c=b==="x"?a:a&3|8;return c.toString(16)});return b.toLowerCase()};a.DisposeInstance=function(){var b=a.s_instance;if(!b){SessionLogger.traceTag(40461344,logCategory.PptSession,logLevel.Warning,"Transcriber::DisposeInstance s_instance is null");return false}try{if(!b.m_sessionTelemetry[TelemetryFieldNames.SpeechMode])b.m_sessionTelemetry[TelemetryFieldNames.SpeechMode]=getSpeechMode(b);if(!b.m_sessionTelemetry[TelemetryFieldNames.WebSocketOpenedTimestamp])SessionLogger.traceTag(40759820,logCategory.PptSession,logLevel.Warning,"Transcriber::DisposeInstance WebSocketOpenedTimestamp is null. TranscriberID: "+b.m_transcriberId);else{var c=Date.now(),d=c-b.m_sessionTelemetry[TelemetryFieldNames.WebSocketOpenedTimestamp];b.m_sessionTelemetry[TelemetryFieldNames.WebSocketClosedTimestamp]=c;b.m_sessionTelemetry[TelemetryFieldNames.WebSocketConnectionDurationMS]=d}b.m_sessionTelemetry[TelemetryFieldNames.FatalErrors]=b.m_fatalErrors;b.m_sessionTelemetry[TelemetryFieldNames.NonFatalErrors]=b.m_nonFatalErrors;b.m_sessionTelemetry[TelemetryFieldNames.MaxPartialMessageLatencyMS]=b.m_maxPartialMessageLatency;b.m_sessionTelemetry[TelemetryFieldNames.MinPartialMessageLatencyMS]=b.m_minPartialMessageLatency;b.m_sessionTelemetry[TelemetryFieldNames.TotalPartialMessagesCount]=b.m_totalPartialMessagesCount;b.m_sessionTelemetry[TelemetryFieldNames.TotalHighLatencyPartialMessagesCount]=b.m_totalHighLatencyPartialMessagesCount;b.m_sessionTelemetry[TelemetryFieldNames.TotalPartialMessageLatency]=b.m_totalPartialMessageLatency;b.m_sessionTelemetry[TelemetryFieldNames.MaxFinalMessageLatencyMS]=b.m_maxFinalMessageLatency;b.m_sessionTelemetry[TelemetryFieldNames.MinFinalMessageLatencyMS]=b.m_minFinalMessageLatency;b.m_sessionTelemetry[TelemetryFieldNames.TotalFinalMessagesCount]=b.m_totalFinalMessagesCount;b.m_sessionTelemetry[TelemetryFieldNames.TotalHighLatencyFinalMessagesCount]=b.m_totalHighLatencyFinalMessagesCount;b.m_sessionTelemetry[TelemetryFieldNames.TotalFinalMessageLatency]=b.m_totalFinalMessageLatency;b.m_sessionTelemetry[TelemetryFieldNames.TotalMessageCorrelationIDNotFoundCount]=b.m_totalMessageCorrelationIDNotFoundCount;b.m_sessionTelemetry[TelemetryFieldNames.LatencyTableDeletedCount]=b.m_latencyTableDeletedCount;b.m_sessionTelemetry[TelemetryFieldNames.TotalEntriesInLatencyTable]=b.m_totalEntriesInLatencyTable;b.m_sessionTelemetry[TelemetryFieldNames.DataLoggingTimeInterval]=TranscriberSettings.DataLoggingIntervalMS;b.m_sessionTelemetry[TelemetryFieldNames.RealTimeFactorLowerThreshold]=TranscriberSettings.RealTimeFactorLowerThreshold;b.m_sessionTelemetry[TelemetryFieldNames.RealTimeFactorUpperThreshold]=TranscriberSettings.RealTimeFactorUpperThreshold;b.m_sessionTelemetry[TelemetryFieldNames.TotalAudioFactorOutsideOfThresholdCount]=b.m_totalAudioFactorOutsideOfThresholdCount;b.m_sessionTelemetry[TelemetryFieldNames.TotalTranscriptOutsideOfThresholdCount]=b.m_totalTranscriptFactorOutsideOfThresholdCount;b.m_sessionTelemetry[TelemetryFieldNames.MessageLatencyCalculationTimeMS]=b.m_messageLatencyCalculationTime;b.m_sessionTelemetry[TelemetryFieldNames.AudioFactorCalculationDurationMS]=b.m_audioFactorCalculationDuration;b.m_sessionTelemetry[TelemetryFieldNames.WebSocketRetryAttempts]=b.m_webSocketTotalRetryCountInSession;b.m_sessionTelemetry[TelemetryFieldNames.TotalNetworkErrorMessageCount]=b.m_totalNetworkErrorMessageCount;b.m_sessionTelemetry[TelemetryFieldNames.TotalNetworkWarningMessageCount]=b.m_totalNetworkWarningMessageCount;b.m_sessionTelemetry[TelemetryFieldNames.TranscriptionEndTime]=Date.now();b.m_sessionTelemetry[TelemetryFieldNames.TotalQualityErrorMessageCount]=b.m_totalQualityErrorMessageCount;b.m_sessionTelemetry[TelemetryFieldNames.TotalQualityWarningMessageCount]=b.m_totalQualityWarningMessageCount;b.LogEndOfTranscriptionSessionTelemetry();TranscriberPostMessageUpward({EventType:29,SessionTelemetry:b.m_sessionTelemetry})}catch(e){SessionLogger.traceTag(40477772,logCategory.PptSession,logLevel.Error,"Transcriber::DisposeInstance threw an exception: "+e+" TranscriberID: "+b.m_transcriberId)}b.Dispose();a.s_instance=null;SessionLogger.traceTag(40461345,logCategory.PptSession,logLevel.Info,"Transcriber::DisposeInstance finish dispose transcriber instance");return true};a.prototype.Dispose=function(){SessionLogger.traceTag(42285009,logCategory.PptSession,logLevel.Info,"Transcriber::Dispose start disposing transcriber related resources");var d=Date.now();try{if(this.m_streamSource){if(this.m_scriptNode)this.m_streamSource.disconnect(this.m_scriptNode);else SessionLogger.traceTag(40461346,logCategory.PptSession,logLevel.Warning,"Transcriber::Dispose m_scriptNode null");this.m_streamSource=null}if(this.m_scriptNode){this.m_scriptNode.onaudioprocess=null;this.m_scriptNode.disconnect(this.m_audioCtx.destination);this.m_scriptNode=null}if(this.m_audioStream)this.m_audioStream.getTracks().forEach(function(a){a.stop()});else SessionLogger.traceTag(40461347,logCategory.PptSession,logLevel.Warning,"Transcriber::Dispose m_audioStream null");this.m_webSocket&&this.m_webSocket.close();var c=document.getElementById(TranscriberElementIds.TranscriberId);c&&document.body.removeChild(c);if(this.m_transcriberResultSpan)this.m_transcriberResultSpan=null;var a=document.getElementById(TranscriberElementIds.DetectionDivId);a&&document.body.removeChild(a);if(this.m_transcriberDetectionDiv)this.m_transcriberDetectionDiv=null;if(this.m_transcriberDetectionSpan)this.m_transcriberDetectionSpan=null;if(this.m_fIsRehearsal){var b=Rehearsal.GetInstance();b!=null&&b.EndRehearsal()}this.m_sessionTelemetry[TelemetryFieldNames.TranscriberDisposeDuration]=Date.now()-d}catch(f){var e=!this.m_transcriberId?"":this.m_transcriberId;SessionLogger.traceTag(42285010,logCategory.PptSession,logLevel.Error,"Transcriber::Dispose threw an exception: "+f+" TranscriberID: "+e)}SessionLogger.traceTag(42285011,logCategory.PptSession,logLevel.Info,"Transcriber::Dispose finish disposing transcriber related resources")};a.CreateTranscribeContainer=function(f,l,m){var n=document.getElementById(TranscriberElementIds.TranscriberId);if(n)return;var c=document.createElement("div");c.id=TranscriberElementIds.TranscriberId;c.style.position="fixed";c.style.width="100%";if(f=="BottomOverlay")c.style.bottom="5%";else if(f=="TopOverlay")c.style.top="5%";else if(f=="BelowSlide")c.style.bottom="3%";else if(f=="AboveSlide")c.style.top="3%";c.style.overflow="hidden";c.style.height="11%";var b=document.createElement("div");b.id="ppt-TranscriberResultDiv";b.style.width="70%";b.style.display="inline-block";b.style.marginLeft="15%";b.style.marginRight="15%";b.style.bottom="0";b.style.position="absolute";b.style.userSelect="none";if(l)b.style.direction="rtl";var d=document.createElement("span");d.id=TranscriberElementIds.ResultSpanId;SessionLogger.traceTag(41302227,logCategory.PptSession,logLevel.Info,"Transcriber::CreateTranscribeContainer adding accessibility attributes.");d.setAttribute("aria-hidden","true");d.style.fontFamily="sans-serif, mono-serif, proportional-serif, 'mono sans serif', casual, cursive, 'small caps'";d.style.backgroundColor="rgba( 0, 0, 0, 0.5 )";d.style.borderColor="rgba( 0, 0, 0, 0 )";d.style.color="rgba( 255, 255, 0, 1 )";d.style.wordWrap="break-word";d.style.display="inline-block";var a=document.createElement("span");a.id=TranscriberElementIds.AccessibilityContentSpan;a.style.position="absolute";a.style.width="1px";a.style.height="1px";a.style.padding="0";a.style.margin="-1px";a.style.overflow="hidden";a.style.clip="rect(0, 0, 0, 0)";a.style.border="0";a.innerText="";a.setAttribute("lang",m);a.setAttribute("aria-live","assertive");a.setAttribute("aria-label",TranscriberResourceString.AccessibilityWindowString);a.setAttribute("aria-atomic","true");b.appendChild(a);b.appendChild(d);c.appendChild(b);document.body.appendChild(c);var e=document.getElementById(TranscriberElementIds.ResultSpanId),g=document.getElementById(TranscriberElementIds.TranscriberId);if(e&&g){var h=Math.floor(g.clientHeight/2),o=Math.floor(h/1.5);e.style.fontSize=o.toString()+"px";e.textContent="["+TranscriberResourceString.InitialMessage+"]";var j=e.clientHeight,k=Math.floor((h-j)/2),i=j+2*k;e.style.lineHeight=(i-1).toString()+"px";g.style.height=(i*2-2).toString()+"px";e.style.padding=k.toString()+"px";e.style.display="inline";g.oncontextmenu=function(){return false}}};a.CreateTranscribeDetectionContainer=function(){var d=document.getElementById(TranscriberElementIds.DetectionDivId);if(d){SessionLogger.traceTag(41457248,logCategory.PptSession,logLevel.Error,"Transcriber::CreateTranscribeDetectionContainer_fails TranscriberID "+a.s_instance.m_transcriberId);return}var c=document.createElement("div");c.id=TranscriberElementIds.DetectionDivId;c.style.position="fixed";c.style.minWidth="50px";c.style.height="20px";c.style.right="14px";c.style.bottom="10px";c.style.overflow="hidden";c.style.borderRadius="20px";var b=document.createElement("span");b.id=TranscriberElementIds.DetectionSpanId;b.style.fontFamily="Segoe UI, sans-serif, mono-serif, proportional-serif, 'mono sans serif', casual, cursive, 'small caps'";b.style.fontSize="12px";b.style.backgroundColor=TranscriberDetectionSettings.ColorYellow;b.style.color=TranscriberDetectionSettings.ColorBlack;b.style.display="inline-block";b.style.borderRadius="20px";b.setAttribute("focusable","true");b.setAttribute("role","text");b.setAttribute("aria-role","text");c.appendChild(b);document.body.appendChild(c)};a.prototype.SetIdleStateTranscriptionDetectionText=function(){this.SetTranscriptionDetectionText("",TranscriberDetectionDivStyle.None)};a.prototype.SetTranscriptionDetectionText=function(g,e,d){if(this.m_isMuted)return;if(this.m_transcriberDetectionDiv!=null&&this.m_transcriberDetectionSpan!=null){if(this.m_fIsRehearsal){var h=Rehearsal.GetInstance();if(h!=null){var f=h.GetRehearsalState(),i=f==RehearsalState.Started||f==RehearsalState.ErrorStarting||f==RehearsalState.NotStarted&&g==TranscriberResourceString.DetectionString_MicReady;if(!i)return}}if((d===undefined||d==null||!d)&&(this.m_inNetworkQualityErrorStatus||this.m_inNetworkQualityWarnStatus))return;this.m_transcriberDetectionDiv.setAttribute("aria-live","off");var k=this.m_transcriberDetectionSpan.innerText;this.m_transcriberDetectionSpan.innerText=g;var j=k!=this.m_transcriberDetectionSpan.innerText,c=TranscriberDetectionSettings.ColorBlack,b=TranscriberDetectionSettings.ColorYellow;switch(e){case TranscriberDetectionDivStyle.Listening:case TranscriberDetectionDivStyle.NoMicAccess:case TranscriberDetectionDivStyle.MicReady:c=TranscriberDetectionSettings.ColorWhite;b=TranscriberDetectionSettings.ColorRed;break;case TranscriberDetectionDivStyle.Warning:c=TranscriberDetectionSettings.ColorBlack;b=TranscriberDetectionSettings.ColorYellow;break;case TranscriberDetectionDivStyle.Error:c=TranscriberDetectionSettings.ColorYellow;b=TranscriberDetectionSettings.ColorBlack;break;case TranscriberDetectionDivStyle.None:c=TranscriberDetectionSettings.ColorWhite;b=TranscriberDetectionSettings.ColorWhite;break;default:SessionLogger.traceTag(50705883,logCategory.PptSession,logLevel.Info,"Unhandled TranscriberDetectionDivStyle: "+e)}this.m_transcriberDetectionSpan.style.color=c;this.m_transcriberDetectionSpan.style.backgroundColor=b;this.m_transcriberDetectionSpan.style.padding=g==""?"0px":"2px 12px 4px 12px";j&&a.FireAriaAlert(this.m_transcriberDetectionDiv,e==TranscriberDetectionDivStyle.Listening?"polite":"assertive")}};a.FireAriaAlert=function(a,b){if(b===void 0)b="assertive";var c=a.style.display;a.style.display="none";a.removeAttribute("role");a.removeAttribute("aria-role");a.removeAttribute("aria-live");a.setAttribute("role","alert");a.setAttribute("aria-role","alert");a.setAttribute("aria-live",b);a.style.display=c};a.prototype.EncodeWAVWithoutHeader=function(a){var c=new ArrayBuffer(a.length*2),b=new DataView(c);this.FloatTo16BitPCM(b,0,a);return b};a.prototype.FloatTo16BitPCM=function(e,c,d){for(var a=0;a<d.length;a++,c+=2){var b=Math.max(-1,Math.min(1,d[a]));e.setInt16(c,b<0?b*32768:b*32767,true)}};a.prototype.LogTranscriberInitializationTelemetry=function(){SessionLogger.traceTag(39981782,logCategory.PptSession,logLevel.Info,JSON.stringify(this.m_sessionTelemetry))};a.prototype.LogTranscriberErrorTelemetry=function(b){b[TelemetryFieldNames.TranscriberID]=a.s_instance.m_transcriberId;b[TelemetryFieldNames.CurrentTimestampMS]=Date.now();SessionLogger.traceTag(39981783,logCategory.PptSession,logLevel.Error,JSON.stringify(b))};a.prototype.LogEndOfTranscriptionSessionTelemetry=function(){SessionLogger.traceTag(39981784,logCategory.PptSession,logLevel.Info,JSON.stringify(this.m_sessionTelemetry))};a.prototype.GetTranscriptionRender=function(){var a="";if(this.m_transcriptDisplay1!==""&&this.m_transcriptDisplay2!=="")a=this.m_transcriptDisplay1+" "+this.m_transcriptDisplay2;else if(this.m_transcriptDisplay1==="")a=this.m_transcriptDisplay2;else a=this.m_transcriptDisplay1;return a};a.prototype.resetOnMessageTelemetry=function(){this.m_messageLatencyTable={}};a.prototype.GetTranscriptionText=function(c,e){var b=this.m_transcriptDisplay1,a=this.m_transcriptDisplay2,d=this.m_fPreviousTranscriptResultFinal;if(!e)if(d){d=false;b=a===""?b:a;a=c}else if(b===""||a==="")b=c;else a=c;else if(d){b=a===""?b:a;a=c}else{d=true;if(b===""||a==="")b=c;else a=c}this.m_transcriptDisplay1=b;this.m_transcriptDisplay2=a;this.m_fPreviousTranscriptResultFinal=d;return this.GetTranscriptionRender()};a.prototype.SetTranscriptionText=function(a,c,b){if(this.m_transcriberResultSpan!=null){if(b)if(this.m_transcriberAccessibilityContentSpan!=null){this.m_transcriberAccessibilityContentSpan.innerText=a;this.m_transcriberAccessibilityContentSpan.getAttribute("aria-label")!=TranscriberResourceString.AccessibilityContentString&&this.m_transcriberAccessibilityContentSpan.setAttribute("aria-label",TranscriberResourceString.AccessibilityContentString);this.m_transcriberAccessibilityContentSpan.focus();this.m_transcriberAccessibilityContentSpan.setAttribute("aria-live","assertive")}this.m_transcriberResultSpan.style.color=c;this.m_transcriberResultSpan.innerText=this.GetTranscriptionText(a,b);this.m_transcriberResultSpan.scrollTop=this.m_transcriberResultSpan.scrollHeight;if(a!==""){this.m_transcriberResultSpan.style.padding=this.m_resultSpanPaddingValue;this.SetIdleStateTranscriptionDetectionText();this.m_inListeningStatus=false}else{this.m_transcriberResultSpan.style.padding="0px";this.SetTranscriptionDetectionText(TranscriberResourceString.DetectionString_Listening+"...",TranscriberDetectionDivStyle.Listening);this.m_inListeningStatus=true}}};a.prototype.SetTranscriptionErrorText=function(a){if(this.m_isMuted)return;if(this.m_transcriberResultSpan!=null){if(this.m_transcriberAccessibilityContentSpan!=null){this.m_transcriberAccessibilityContentSpan.innerText="";this.m_transcriberAccessibilityContentSpan.getAttribute("aria-label")!=TranscriberResourceString.AccessibilityWindowString&&this.m_transcriberAccessibilityContentSpan.setAttribute("aria-label",TranscriberResourceString.AccessibilityWindowString);this.m_transcriberAccessibilityContentSpan.focus();this.m_transcriberAccessibilityContentSpan.setAttribute("aria-live","assertive")}this.m_transcriberResultSpan.style.color="rgba( 255, 255, 0, 1 )";if(!a)a=TranscriberResourceString.GenericErrorMessage;this.m_transcriberResultSpan.textContent="["+a+"]";this.m_transcriberResultSpan.scrollTop=this.m_transcriberResultSpan.scrollHeight}};a.s_instance=null;a.s_guidEmpty="00000000-0000-0000-0000-000000000000";return a}();function SetMicrophoneState(b){var a=Transcriber.s_instance;if(!a){SessionLogger.traceTag(595358541,logCategory.PptSession,logLevel.Error,"Transcriber::SetMicrophoneState Transcriber instance is null.");return}a.SetMicrophoneState(b)}function HandleOnMessageTranscriptionError(b){var e=Transcriber.s_instance;if(!e){SessionLogger.traceTag(42272133,logCategory.PptSession,logLevel.Error,"Transcriber::HandleOnMessageTranscriptionError Transcriber instance is null.");return}try{b==null&&SessionLogger.traceTag(40452826,logCategory.PptSession,logLevel.Warning,"Transcriber::HandleOnMessageTranscriptionError TranscriberID "+Transcriber.s_instance.m_transcriberId+" Response received from speech service was null.");var a=b.getMessageerrorcode();if(a==null||a=="")a="Unknown";var f=b.getTranscriptresult(),d="Unknown";if(f!=null)d=f.getTranscripterrorcode();var g=["ErrorProtobufDeserializationFailure","ErrorInvalidSubscriptionFromConfig","ErrorInvalidRegionFromConfig","ErrorAddSessionFailure","ErrorInvalidMessage","ErrorCreateSpeechSessionBadRequest","ErrorWaitAudioTimeout","ErrorProtobufDeserializationFailure","ErrorSpeechHandlerWebSocketFailure","ErrorSpeechRecognitionFailure","ErrorTranslationFailure","ErrorFailedToGetSupportedTextLanguages","ErrorCustomEndpointTimeout"];if(g.indexOf(a)==-1)RecordError(a,d+"_"+b.getStatus(),Date.now(),false);else e.SetTranscriptionErrorText(TranscriberResourceString.GenericErrorMessage);var c={};c[TelemetryErrorFieldNames.MessageErrorCode]=a;c[TelemetryErrorFieldNames.TranscriptErrorCode]=d;c[TelemetryErrorFieldNames.ErrorStatus]=b.getStatus();e.LogTranscriberErrorTelemetry(c)}catch(h){SessionLogger.traceTag(40452827,logCategory.PptSession,logLevel.Warning,"Transcriber::HandleOnMessageTranscriptionError TranscriberID "+Transcriber.s_instance.m_transcriberId+" Exception thrown: "+h)}}function RecordError(c,g,f,e){var b=Transcriber.s_instance;if(!b){SessionLogger.traceTag(41227852,logCategory.PptSession,logLevel.Error,"Transcriber::RecordError Transcriber instance is null.");return}var a={};if(!c)c="ErrorEmpty";a.ErrorName=c;a.ErrorReason=g;a.ClientTimestampMS=f;var d=e?b.m_fatalErrors:b.m_nonFatalErrors;if(d.length<10)d.push(a);else SessionLogger.traceTag(40452828,logCategory.PptSession,logLevel.Warning,"Transcriber::RecordError Will not append error to error list because the list contains too many errors. isFatalErrorList: "+ +e+" TranscriberID: "+b.m_transcriberId+" "+JSON.stringify(a))}function RetryWebSocketConnection(){var a=Transcriber.s_instance;if(!a){SessionLogger.traceTag(40425038,logCategory.PptSession,logLevel.Info,"Transcriber::RetryWebSocketConnection - Transcriber instance is null");return}a.m_wsTimer=0;if(a.m_webSocketConnectionRetryAttempts>=a.c_maxWebSocketRetryAttempts||a.m_webSocketTotalRetryCountInSession>=TranscriberSettings.MaxAllowedRetryCountPerSession){RecordError(TelemetryErrorFieldNames.WebSocketRetryConnectionFailed,"Maximum retry count reached",Date.now(),true);if(a.m_fIsRehearsal)a.SetTranscriptionDetectionText(TranscriberDetectionSettings.WarningSign+TranscriberResourceString.GenericNetworkErrorMessage,TranscriberDetectionDivStyle.Error,true);else a.SetTranscriptionErrorText(TranscriberResourceString.GenericErrorMessage);var b={};b[TelemetryErrorFieldNames.WebSocketRetryConnectionFailed]="WebSocketRetryConnectionFailed";a.LogTranscriberErrorTelemetry(b);return}SessionLogger.traceTag(40425039,logCategory.PptSession,logLevel.Info,"Transcriber::RetryWebSocketConnection - WebSocket retry attempt: "+a.m_webSocketConnectionRetryAttempts+" WebSocket total retry attempts in session: "+a.m_webSocketTotalRetryCountInSession+" TranscriberID: "+a.m_transcriberId);if(a.m_webSocket){a.m_webSocket.onclose=function(){};a.m_webSocket.close()}if(a.m_fIsRehearsal)a.SetTranscriptionDetectionText(TranscriberDetectionSettings.WarningSign+TranscriberResourceString.GenericRetryErrorMessage,TranscriberDetectionDivStyle.Error,true);else a.SetTranscriptionErrorText(TranscriberResourceString.RetryErrorMessage);OpenWebSocketConnection()}function RetryWebSocketConnectionWrapper(a){if(Transcriber.s_instance.m_wsTimer==0)Transcriber.s_instance.m_wsTimer=setTimeout(function(){Transcriber.s_instance.LogTranscriberErrorTelemetry(a);RetryWebSocketConnection()},Transcriber.s_instance.c_websocketRetryInterval)}function ResetIntervalStats(b){var a=Transcriber.s_instance;if(!a){SessionLogger.traceTag(41157953,logCategory.PptSession,logLevel.Info,"Transcriber::ResetIntervalStats - Transcriber instance is null");return}if(b){if(a.m_startLogIntervalAudio<Number.MAX_VALUE)a.m_intervalAudio=Date.now()-a.m_startLogIntervalAudio;a.m_startLogIntervalAudio=Date.now()}else{if(a.m_startLogIntervalTranscript<Number.MAX_VALUE)a.m_intervalTranscript=Date.now()-a.m_startLogIntervalTranscript;a.m_startLogIntervalTranscript=Date.now()}}function DetectHighLatencyWithNetworkInfo(c,b,f){var a=Transcriber.s_instance;if(!a){SessionLogger.traceTag(40425040,logCategory.PptSession,logLevel.Warning,"Transcriber::DetectHighLatencyWithNetworkInfo - Transcriber instance is null");return}if(c>=TranscriberSettings.FragmentLatencyWarnThreshold){a.m_countFragmentLatencyInWarnWindow=Math.min(TranscriberSettings.FragmentLatencyWarnWindow,a.m_countFragmentLatencyInWarnWindow+1);if(c>=TranscriberSettings.FragmentLatencyErrorThreshold)a.m_countFragmentLatencyInErrorWindow=Math.min(TranscriberSettings.FragmentLatencyErrorWindow,a.m_countFragmentLatencyInErrorWindow+1);else a.m_countFragmentLatencyInErrorWindow=Math.max(0,a.m_countFragmentLatencyInErrorWindow-1)}else if(c!=-1){a.m_countFragmentLatencyInWarnWindow=Math.max(0,a.m_countFragmentLatencyInWarnWindow-1);a.m_countFragmentLatencyInErrorWindow=Math.max(0,a.m_countFragmentLatencyInErrorWindow-1)}if(b>=TranscriberSettings.RoundtripLatencyWarnThreshold){a.m_countRoundtripLatencyInWarnWindow=Math.min(TranscriberSettings.FragmentLatencyWarnWindow,a.m_countRoundtripLatencyInWarnWindow+1);if(b>=TranscriberSettings.RoundtripLatencyErrorThreshold)a.m_countRoundtripLatencyInErrorWindow=Math.min(TranscriberSettings.FragmentLatencyErrorWindow,a.m_countRoundtripLatencyInErrorWindow+1);else a.m_countRoundtripLatencyInErrorWindow=Math.max(0,a.m_countRoundtripLatencyInErrorWindow-1)}else if(b!=-1){a.m_countRoundtripLatencyInWarnWindow=Math.max(0,a.m_countRoundtripLatencyInWarnWindow-1);a.m_countRoundtripLatencyInErrorWindow=Math.max(0,a.m_countRoundtripLatencyInErrorWindow-1)}(c>=TranscriberSettings.FragmentLatencyWarnThreshold||b>=TranscriberSettings.RoundtripLatencyWarnThreshold)&&SessionLogger.traceTag(41223618,logCategory.PptSession,logLevel.Warning,JSON.stringify({CountFragmentLatencyInErrorWindow:a.m_countFragmentLatencyInErrorWindow,CountFragmentLatencyInWarnWindow:a.m_countFragmentLatencyInWarnWindow,CountRoundtripLatencyInErrorWindow:a.m_countRoundtripLatencyInErrorWindow,CountRoundtripLatencyInWarnWindow:a.m_countRoundtripLatencyInWarnWindow,CurrentHearbeatSendInterval:a.m_currentHeartbeatSendInterval,CurrentHeartbeatLatency:a.m_currentHeartbeatLatency,PartialMessageLatency:c,RoundtripLatencyMS:b,MessageCorrelationID:f,TranscriberID:a.m_transcriberId}));var e=a.m_currentHeartbeatSendInterval>=TranscriberSettings.HeartbeatInterval+TranscriberSettings.RoundtripLatencyWarnThreshold,d=a.m_currentHeartbeatLatency>=TranscriberSettings.RoundtripLatencyWarnThreshold,g=!e&&d;if(a.m_countFragmentLatencyInErrorWindow>=TranscriberSettings.FragmentLatencyErrorWindow||a.m_countRoundtripLatencyInErrorWindow>=TranscriberSettings.FragmentLatencyErrorWindow){a.m_inNetworkQualityErrorStatus=true;a.m_totalNetworkErrorMessageCount++;a.SetTranscriptionDetectionText(TranscriberDetectionSettings.WarningSign+TranscriberResourceString.DetectionString_NetworkQualityIssue,TranscriberDetectionDivStyle.Error,true)}else if(a.m_countFragmentLatencyInErrorWindow==0&&a.m_countRoundtripLatencyInErrorWindow==0){a.m_inNetworkQualityErrorStatus=false;a.m_gapNumberBetweenPingPongMessage=0;!a.m_inListeningStatus&&a.SetIdleStateTranscriptionDetectionText()}if(a.m_countFragmentLatencyInWarnWindow>=TranscriberSettings.FragmentLatencyWarnWindow||a.m_countRoundtripLatencyInWarnWindow>=TranscriberSettings.FragmentLatencyWarnWindow){a.m_inNetworkQualityWarnStatus=true;a.m_totalNetworkWarningMessageCount++;!a.m_inNetworkQualityErrorStatus&&a.SetTranscriptionDetectionText(TranscriberDetectionSettings.WarningSign+TranscriberResourceString.DetectionString_NetworkQualityIssue,TranscriberDetectionDivStyle.Warning,true)}else if(a.m_countFragmentLatencyInWarnWindow==0&&a.m_countRoundtripLatencyInWarnWindow==0){a.m_inNetworkQualityWarnStatus=false;!a.m_inListeningStatus&&a.SetIdleStateTranscriptionDetectionText()}if(a.m_inNetworkQualityErrorStatus)SessionLogger.traceTag(41223619,logCategory.PptSession,logLevel.Error,JSON.stringify({CountFragmentLatencyInErrorWindow:a.m_countFragmentLatencyInErrorWindow,CountFragmentLatencyInWarnWindow:a.m_countFragmentLatencyInWarnWindow,CountRoundtripLatencyInErrorWindow:a.m_countRoundtripLatencyInErrorWindow,CountRoundtripLatencyInWarnWindow:a.m_countRoundtripLatencyInWarnWindow,PartialMessageLatency:c,RoundtripLatencyMS:b,MessageCorrelationID:f,TranscriberID:a.m_transcriberId,CurrentHearbeatSendInterval:a.m_currentHeartbeatSendInterval,CurrentHeartbeatLatency:a.m_currentHeartbeatLatency,IsHighHeartbeatLatency:d,IsBrowserFreeze:e,IsNetworkIssue:g}));else a.m_inNetworkQualityWarnStatus&&SessionLogger.traceTag(41223620,logCategory.PptSession,logLevel.Error,JSON.stringify({CountFragmentLatencyInErrorWindow:a.m_countFragmentLatencyInErrorWindow,CountFragmentLatencyInWarnWindow:a.m_countFragmentLatencyInWarnWindow,CountRoundtripLatencyInErrorWindow:a.m_countRoundtripLatencyInErrorWindow,CountRoundtripLatencyInWarnWindow:a.m_countRoundtripLatencyInWarnWindow,PartialMessageLatency:c,RoundtripLatencyMS:b,MessageCorrelationID:f,TranscriberID:a.m_transcriberId,CurrentHearbeatSendInterval:a.m_currentHeartbeatSendInterval,CurrentHeartbeatLatency:a.m_currentHeartbeatLatency,IsHighHeartbeatLatency:d,IsBrowserFreeze:e,IsNetworkIssue:g}))}function HandleAgentCommand(b,a){if(b==null){SessionLogger.traceTag(50906641,logCategory.PptSession,logLevel.Error,"Transcriber::HandleAgentCommand null response, transcriberID:"+a);return}try{switch(b.getCommand().getCommandCase()){case proto.Microsoft.PowerPoint.SpeechFrontDoor.ProtoBuf.SpeechFDCommand.CommandCase.NEXT:window.api.Next();break;case proto.Microsoft.PowerPoint.SpeechFrontDoor.ProtoBuf.SpeechFDCommand.CommandCase.PREV:window.api.Prev();break;case proto.Microsoft.PowerPoint.SpeechFrontDoor.ProtoBuf.SpeechFDCommand.CommandCase.NAVIGATE:var c=b.getCommand().getNavigate().getIndex();window.api.GoToSlide(c,[{TimeLineId:"0_anim",Step:0}]);break;default:SessionLogger.traceTag(50906642,logCategory.PptSession,logLevel.Error,"Transcriber::HandleAgentCommand unable to interpret LiveAgent command. Transcriber ID: "+a)}}catch(d){SessionLogger.traceTag(50906643,logCategory.PptSession,logLevel.Error,"Transcriber::HandleAgentCommand error while attempting to execute LiveAgent command"+d+" TranscriberID: "+a)}}function DisplayQualityStatus(b){var a=Transcriber.s_instance;if(!a){SessionLogger.traceTag(41821152,logCategory.PptSession,logLevel.Info,"Transcriber::OpenWebSocketConnection - Transcriber instance is null");return}if(!b){SessionLogger.traceTag(41821153,logCategory.PptSession,logLevel.Error,"Transcriber::DisplayQualityStatus  Quality message null: TranscriberID: "+a.m_transcriberId);return}if(a.m_inNetworkQualityErrorStatus||a.m_inNetworkQualityWarnStatus){SessionLogger.traceTag(41821154,logCategory.PptSession,logLevel.Info,"Transcriber::DisplayQualityStatus  Already in network warn or error status: TranscriberID: "+a.m_transcriberId);return}try{var h=b.getSeverity();if(!h){SessionLogger.traceTag(41821155,logCategory.PptSession,logLevel.Error,"Transcriber::DisplayQualityStatus  Quality message Severity null: TranscriberID: "+a.m_transcriberId);return}var c=b.getShortcode(),g=b.getLongcode();if(c<2||c>5){SessionLogger.traceTag(41821184,logCategory.PptSession,logLevel.Error,"Transcriber::DisplayQualityStatus  Quality message shortCode invalid: TranscriberID: "+a.m_transcriberId);RecordError(TelemetryErrorFieldNames.QualityMessageShortcodeInvalid,"Invalid shortCode: "+c,Date.now(),false);return}switch(h){case 0:a.SetIdleStateTranscriptionDetectionText();break;case 1:a.m_totalQualityWarningMessageCount++;var f=c==null?b.getShortstring():TranscriberResourceString.QualityStatusStringDict[c];if(f!==""&&f!==undefined&&f!==null)a.SetTranscriptionDetectionText(TranscriberDetectionSettings.WarningSign+f,TranscriberDetectionDivStyle.Warning);else f="";SessionLogger.traceTag(41821185,logCategory.PptSession,logLevel.Warning,"Transcriber::DisplayQualityStatus quality severity 1: "+f+" ; TotalQualityWarningMessageCount: "+a.m_totalQualityWarningMessageCount+" TranscriberID: "+a.m_transcriberId);break;case 2:a.m_totalQualityErrorMessageCount++;var d=c==null?b.getShortstring():TranscriberResourceString.QualityStatusStringDict[c];if(d!==""&&d!==undefined&&d!==null)a.SetTranscriptionDetectionText(TranscriberDetectionSettings.WarningSign+d,TranscriberDetectionDivStyle.Error);else d="";var e=g==null?b.getLongstring():TranscriberResourceString.QualityStatusStringDict[g];if(e!==""&&e!==undefined&&e!==null){a.m_timerForClearTranscriptionText&&clearTimeout(a.m_timerForClearTranscriptionText);a.SetTranscriptionErrorText(e);a.m_timerForClearTranscriptionText=setTimeout(resetTransciptionTextToEmpty,TranscriberSettings.ResetQualityDetectionIntervalMS)}else e="";SessionLogger.traceTag(41821186,logCategory.PptSession,logLevel.Warning,"Transcriber::DisplayQualityStatus quality severity 2: shortText: "+d+" ; longText: "+e+" TotalQualityWarningMessageCount: "+a.m_totalQualityErrorMessageCount+" TranscriberID: "+a.m_transcriberId)}}catch(i){SessionLogger.traceTag(41821187,logCategory.PptSession,logLevel.Warning,"Transcriber::DisplayQualityStatus threw an exception "+i+" TranscriberID: "+a.m_transcriberId);RecordError(TelemetryErrorFieldNames.DisplayQualityStatusException,"DisplayQualityStatusException: "+i,Date.now(),false)}}function CalculateOnMessageTelemetry(a,h,d,f){try{if(!a||!d||d==Transcriber.s_guidEmpty){SessionLogger.traceTag(41157954,logCategory.PptSession,logLevel.Warning,"Transcriber::OpenWebSocketConnection:onmessage: The correlation ID of the message was either null or the empty guid. TranscriberID: "+a.m_transcriberId+" IsRehearsal: "+a.m_fIsRehearsal);return}var w=Date.now(),b=0,g=a.m_messageLatencyTable[d];if(g){var p=Date.now();b=p-g;if(!h){a.m_totalPartialMessagesCount+=1;a.m_totalPartialMessageLatency+=b;a.m_maxPartialMessageLatency=Math.max(a.m_maxPartialMessageLatency,b);a.m_minPartialMessageLatency=Math.min(a.m_minPartialMessageLatency,b);if(b>TranscriberSettings.MaxAllowedFragmentLatencyMS){a.m_totalHighLatencyPartialMessagesCount+=1;if(!TranscriberSettings.IsLogEachTranscriptMessage){var v=a.m_totalPartialMessageLatency/a.m_totalPartialMessagesCount;SessionLogger.traceTag(40477773,logCategory.PptSession,logLevel.Warning,JSON.stringify({PartialMessageCount:a.m_totalPartialMessagesCount,PartialMessageLatency:b,MaxPartialMessageLatency:a.m_maxPartialMessageLatency,MinPartialMessageLatency:a.m_minPartialMessageLatency,AvePartialMessageLatency:v,TotalPartialMessageLatency:a.m_totalPartialMessageLatency,MessageCorrelationID:d,MessageSentTime:g,CurrentTime:p,TotalHighLatencyPartialMessagesCount:a.m_totalHighLatencyPartialMessagesCount,HeartbeatRoundtripLatency:f,TranscriberID:a.m_transcriberId,IsRehearsal:a.m_fIsRehearsal}))}}DetectHighLatencyWithNetworkInfo(b,a.m_currentHeartbeatLatency,d)}else{a.m_totalFinalMessagesCount+=1;a.m_totalFinalMessageLatency+=b;a.m_maxFinalMessageLatency=Math.max(a.m_maxFinalMessageLatency,b);a.m_minFinalMessageLatency=Math.min(a.m_minFinalMessageLatency,b);if(b>TranscriberSettings.MaxAllowedFinalFragmentLatencyMS){a.m_totalHighLatencyFinalMessagesCount+=1;if(!TranscriberSettings.IsLogEachTranscriptMessage){var v=a.m_totalFinalMessageLatency/a.m_totalFinalMessagesCount;SessionLogger.traceTag(40895813,logCategory.PptSession,logLevel.Warning,JSON.stringify({FinalMessageCount:a.m_totalFinalMessagesCount,FinalMessageLatency:b,MaxFinalMessageLatency:a.m_maxFinalMessageLatency,MinFinalMessageLatency:a.m_minFinalMessageLatency,AveFinalMessageLatency:v,TotalFinalMessageLatency:a.m_totalFinalMessageLatency,MessageCorrelationID:d,MessageSentTime:g,CurrentTime:p,TotalHighLatencyFinalMessagesCount:a.m_totalHighLatencyFinalMessagesCount,HeartbeatRoundtripLatency:f,TranscriberID:a.m_transcriberId,IsRehearsal:a.m_fIsRehearsal}))}}for(var u in a.m_messageLatencyTable){var y=a.m_messageLatencyTable[u];if(y<=g){delete a.m_messageLatencyTable[u];a.m_totalEntriesInLatencyTable-=1}}}}else{a.m_totalMessageCorrelationIDNotFoundCount+=1;SessionLogger.traceTag(40477774,logCategory.PptSession,logLevel.Warning,"Transcriber::onmessage Message correlationID: "+d+" was not present in the correlationID table. Total messages with the correlation id not found "+a.m_totalMessageCorrelationIDNotFoundCount+" TranscriberID: "+a.m_transcriberId+" isFinalMessage: "+h+" IsRehearsal: "+a.m_fIsRehearsal)}var x=Date.now()-w;a.m_messageLatencyCalculationTime+=x;var c=0,e=0,o=0;a.m_totalTranscriptMessageCountInCurrentTimeInterval++;if(a.m_totalTranscriptMessageCountInPreviousTimeInterval>0&&a.m_lastReceivedTranscriptTimeUTC<Number.MAX_VALUE){o=a.m_intervalTranscript/a.m_totalTranscriptMessageCountInPreviousTimeInterval;e=Date.now()-a.m_lastReceivedTranscriptTimeUTC;c=o/(e>0?e:1);if(c>0){a.m_realTimeReceiveDataFactorCount++;a.m_realTimeReceiveDataFactorSum+=c;a.m_minRealTimeReceiveDataFactor=Math.min(a.m_minRealTimeReceiveDataFactor,c);a.m_maxRealTimeReceiveDataFactor=Math.max(a.m_maxRealTimeReceiveDataFactor,c);a.m_realTimeReceiveDataFactorCountInTimeInterval++;a.m_realTimeReceiveDataFactorSumInTimeInterval+=c;a.m_minRealTimeReceiveDataFactorInTimeInterval=Math.min(a.m_minRealTimeReceiveDataFactorInTimeInterval,c);a.m_maxRealTimeReceiveDataFactorInTimeInterval=Math.max(a.m_maxRealTimeReceiveDataFactorInTimeInterval,c);if(!TranscriberSettings.IsLogEachTranscriptMessage)if(c<TranscriberSettings.RealTimeFactorLowerThreshold||c>TranscriberSettings.RealTimeFactorUpperThreshold){a.m_totalTranscriptFactorOutsideOfThresholdCount++;var r=0,t=0,s=0;if(a.m_realTimeReceiveDataFactorCount>0){r=a.m_realTimeReceiveDataFactorSum*1/a.m_realTimeReceiveDataFactorCount;t=a.m_minRealTimeReceiveDataFactor;s=a.m_maxRealTimeReceiveDataFactor}SessionLogger.traceTag(41157955,logCategory.PptSession,logLevel.Warning,JSON.stringify({MessageCorrelationID:d,MessageLatency:b,IsFinalMessage:h,RealTimeReceivingDataFactor:c,AvgRealTimeReceivingDataFactor:r,MinRealTimeReceivingDataFactor:t,MaxRealTimeReceivingDataFactor:s,AvgReceivingDataDurationForInterval:o,RealTimeDurationForCurrentMessage:e,TotalTranscriptMessageCountInPreviousTimeInterval:a.m_totalTranscriptMessageCountInPreviousTimeInterval,AdjustedTimeInterval:a.m_intervalTranscript,HeartbeatRoundtripLatency:f,TranscriberID:a.m_transcriberId,IsRehearsal:a.m_fIsRehearsal}))}}}var l=0,n=0,m=0,i=0,k=0,j=0;if(TranscriberSettings.IsLogEachTranscriptMessage){if(a.m_totalTranscriptMessageCountInPreviousTimeInterval==0)if(a.m_lastReceivedTranscriptTimeUTC<Number.MAX_VALUE)e=Date.now()-a.m_lastReceivedTranscriptTimeUTC;if(a.m_realTimeReceiveDataFactorCount>0){l=a.m_realTimeReceiveDataFactorSum*1/a.m_realTimeReceiveDataFactorCount;n=a.m_minRealTimeReceiveDataFactor;m=a.m_maxRealTimeReceiveDataFactor}if(a.m_realTimeReceiveDataFactorCountInTimeInterval>0){i=a.m_realTimeReceiveDataFactorSumInTimeInterval*1/a.m_realTimeReceiveDataFactorCountInTimeInterval;k=a.m_minRealTimeReceiveDataFactorInTimeInterval;j=a.m_maxRealTimeReceiveDataFactorInTimeInterval}SessionLogger.traceTag(41157956,logCategory.PptSession,logLevel.Info,JSON.stringify({MessageCorrelationID:d,MessageLatency:b,IsFinalMessage:h,RealTimeReceivingDataFactor:c,AvgRealTimeReceivingDataFactor:l,MinRealTimeReceivingDataFactor:n,MaxRealTimeReceivingDataFactor:m,AvgRealTimeReceivingDataFactorForInterval:i,MinRealTimeReceivingDataFactorForInterval:k,MaxRealTimeReceivingDataFactorForInterval:j,AvgReceivingDataDurationForInterval:o,RealTimeDurationForCurrentMessage:e,TotalTranscriptMessageCountInPreviousTimeInterval:a.m_totalTranscriptMessageCountInPreviousTimeInterval,AdjustedTimeInterval:a.m_intervalTranscript,HeartbeatRoundtripLatency:f,TranscriberID:a.m_transcriberId,IsRehearsal:a.m_fIsRehearsal}))}if(Date.now()-a.m_lastTranscriptLogUTC>TranscriberSettings.DataLoggingIntervalMS){if(!TranscriberSettings.IsLogEachTranscriptMessage){if(a.m_realTimeReceiveDataFactorCount>0){l=a.m_realTimeReceiveDataFactorSum*1/a.m_realTimeReceiveDataFactorCount;n=a.m_minRealTimeReceiveDataFactor;m=a.m_maxRealTimeReceiveDataFactor}var q=0;if(a.m_totalAudioMessageCountInPreviousTimeInterval>0)q=a.m_intervalTranscript/a.m_totalAudioMessageCountInPreviousTimeInterval;if(a.m_realTimeReceiveDataFactorCountInTimeInterval>0){i=a.m_realTimeReceiveDataFactorSumInTimeInterval*1/a.m_realTimeReceiveDataFactorCountInTimeInterval;k=a.m_minRealTimeReceiveDataFactorInTimeInterval;j=a.m_maxRealTimeReceiveDataFactorInTimeInterval}SessionLogger.traceTag(41157957,logCategory.PptSession,logLevel.Info,JSON.stringify({MessageCorrelationID:d,MessageLatency:b,IsFinalMessage:h,AvgRealTimeReceivingDataFactor:l,MinRealTimeReceivingDataFactor:n,MaxRealTimeReceivingDataFactor:m,AvgRealTimeReceivingDataFactorForInterval:i,MinRealTimeReceivingDataFactorForInterval:k,MaxRealTimeReceivingDataFactorForInterval:j,AvgReceivingDataDurationForInterval:q,TotalTranscriptMessageCountInPreviousTimeInterval:a.m_totalTranscriptMessageCountInPreviousTimeInterval,AdjustedTimeInterval:a.m_intervalTranscript,HeartbeatRoundtripLatency:f,TranscriberID:a.m_transcriberId,IsRehearsal:a.m_fIsRehearsal}))}a.m_totalTranscriptMessageCountInPreviousTimeInterval=a.m_totalTranscriptMessageCountInCurrentTimeInterval;a.m_totalTranscriptMessageCountInCurrentTimeInterval=0;a.m_realTimeReceiveDataFactorCountInTimeInterval=0;a.m_realTimeReceiveDataFactorSumInTimeInterval=0;a.m_minRealTimeReceiveDataFactorInTimeInterval=Number.MAX_VALUE;a.m_maxRealTimeReceiveDataFactorInTimeInterval=Number.MIN_VALUE;a.m_lastTranscriptLogUTC=Date.now();ResetIntervalStats(false)}a.m_lastReceivedTranscriptTimeUTC=Date.now()}catch(z){SessionLogger.traceTag(40477775,logCategory.PptSession,logLevel.Warning,"Transcriber::onmessage Calculating the message latency threw an exception: "+z+ +" TranscriberID: "+a.m_transcriberId+" IsRehearsal: "+a.m_fIsRehearsal)}}function OpenWebSocketConnection(){var a=Transcriber.s_instance;if(!a){SessionLogger.traceTag(41223621,logCategory.PptSession,logLevel.Info,"Transcriber::OpenWebSocketConnection - Transcriber instance is null");return}if(a.m_isFirstWebSocketConnection&&a.m_webSocketTotalRetryCountInSession==0)a.m_sessionTelemetry[TelemetryFieldNames.WebSocketCreateTimestamp]=Date.now();else{a.m_webSocketTotalRetryCountInSession++;a.m_webSocketConnectionRetryAttempts++}if(a.m_webSocket){SessionLogger.traceTag(41420770,logCategory.PptSession,logLevel.Warning,"Transcriber::OpenWebSocketConnection Found existing web socket connection. Closing it and will open a new one. TranscriberID: "+a.m_transcriberId);a.m_webSocket.onclose=function(){};a.m_webSocket.close()}a.m_webSocket=new WebSocket(a.m_wsUri+"&sampleRate="+a.m_audioCtx.sampleRate);a.m_webSocket.binaryType="arraybuffer";var b={};b[TelemetryFieldNames.WebSocketRetryReason]="WebSocketConnectionTimeout";RetryWebSocketConnectionWrapper(b);a.m_webSocket.onopen=function(){var a=Transcriber.s_instance;if(!a){SessionLogger.traceTag(40706257,logCategory.PptSession,logLevel.Info,"Transcriber::OpenWebSocketConnection:onopen - Transcriber instance is null");return}if(!a.m_fIsRehearsal)a.m_roundLatencyTimerId=setInterval(sendPingMessage,TranscriberSettings.HeartbeatInterval);else a.m_sendPingMessageFlag=false;a.m_audioSendingCountIntervalTimerId=setInterval(checkAudioSendingIn10Mins,TranscriberSettings.AudioSendingCountIntervalMS);if(a.m_isFirstWebSocketConnection){a.m_sessionTelemetry[TelemetryFieldNames.WebSocketOpenedTimestamp]=Date.now();a.m_isFirstWebSocketConnection=false}a.SetTranscriptionText("","rgba( 255, 255, 255, 1 )",false);a.SetIdleStateTranscriptionDetectionText();clearTimeout(a.m_wsTimer);a.m_wsTimer=0;a.m_webSocketConnectionRetryAttempts=0;a.m_fSendClientMetadata=true};a.m_webSocket.onmessage=function(e){var a=Transcriber.s_instance;if(!a){SessionLogger.traceTag(40706258,logCategory.PptSession,logLevel.Info,"Transcriber::OpenWebSocketConnection:onmessage - Transcriber instance is null");return}if(a.m_sessionTelemetry[TelemetryFieldNames.FirstMessageLatencyMS]==undefined){var t=Date.now(),u=t-a.m_sessionTelemetry[TelemetryFieldNames.SendFirstMessageTime];a.m_sessionTelemetry[TelemetryFieldNames.FirstMessageLatencyMS]=u;a.LogTranscriberInitializationTelemetry();if(a.m_fIsRehearsal){a.SetIdleStateTranscriptionDetectionText();var d=Rehearsal.GetInstance();d!=null&&d.OnFirstMessageReceived()}}if(TranscriberSettings.MessageType==="protobuf"){if(a.m_fIsRehearsal){var r=proto.Microsoft.PowerPoint.SpeechFrontDoor.ProtoBuf.SpeechResponseMessage.deserializeBinary(new Uint8Array(e.data)),l=r.getMessagetype(),s=r.getMessage_asU8();if(l=="rehearsalresultmessage"){var f=proto.Microsoft.PowerPoint.SpeechFrontDoor.ProtoBuf.RehearsalResultMessage.deserializeBinary(new Uint8Array(s)),d=Rehearsal.GetInstance();d!=null&&d.UpdateRehearsalDashboard(f);var q=f.getCorrelationid().toLowerCase(),o=f.getIsfinal();CalculateOnMessageTelemetry(a,o,q,-1);return}else if(l=="qualitystatusmessage"){var p=proto.Microsoft.PowerPoint.SpeechFrontDoor.ProtoBuf.QualityStatusMessage.deserializeBinary(new Uint8Array(s));DisplayQualityStatus(p);return}else{SessionLogger.traceTag(41726081,logCategory.PptSession,logLevel.Error,"Transcriber::OpenWebSocketConnection:onmessage: Unexpected message type in rehearsal scenario: "+String(l));return}}var b=TranscriberSettings.fSupportSpeechResponseMessage?proto.Microsoft.PowerPoint.SpeechFrontDoor.ProtoBuf.SpeechResponseMessage.deserializeBinary(new Uint8Array(e.data)):proto.Microsoft.PowerPoint.SpeechFrontDoor.ProtoBuf.SpeechResultMessage.deserializeBinary(new Uint8Array(e.data));if(TranscriberSettings.fSupportSpeechResponseMessage){var k=b.getMessagetype(),h=b.getMessage_asU8();if(k=="qualitystatusmessage"){var p=proto.Microsoft.PowerPoint.SpeechFrontDoor.ProtoBuf.QualityStatusMessage.deserializeBinary(new Uint8Array(h));DisplayQualityStatus(p);return}else if(k=="speechresultmessage")b=proto.Microsoft.PowerPoint.SpeechFrontDoor.ProtoBuf.SpeechResultMessage.deserializeBinary(new Uint8Array(h));else if(k=="agentcommandmessage"){var w=proto.Microsoft.PowerPoint.SpeechFrontDoor.ProtoBuf.AgentCommandMessage.deserializeBinary(new Uint8Array(h));HandleAgentCommand(w,a.m_transcriberId);return}else return}var c=-1;if(b.getStatus()==="success"){var v=b.getTranscriptresult().getIspongmessage();if(v){a.m_gapNumberBetweenPingPongMessage=Math.max(0,a.m_gapNumberBetweenPingPongMessage-1);var g=Date.now();c=g-a.m_heartbeatSendTime;a.m_currentHeartbeatLatency=c;var i=b.getCorrelationid().toLowerCase();!TranscriberSettings.IsLogEachTranscriptMessage&&c>TranscriberSettings.RoundtripLatencyWarnThreshold&&SessionLogger.traceTag(41003223,logCategory.PptSession,logLevel.Warning,JSON.stringify({RoundtripLatency:c,HeartbeatSendTime:a.m_heartbeatSendTime,HeartbeatReceiveTime:g,TranscriberID:a.m_transcriberId,CorrelationID:i}));TranscriberSettings.IsLogEachTranscriptMessage&&SessionLogger.traceTag(41223622,logCategory.PptSession,logLevel.Info,JSON.stringify({RoundtripLatency:c,HeartbeatSendTime:a.m_heartbeatSendTime,HeartbeatReceiveTime:g,TranscriberID:a.m_transcriberId,CorrelationID:i}));DetectHighLatencyWithNetworkInfo(-1,a.m_currentHeartbeatLatency,i);return}if(a.m_inNetworkQualityErrorStatus){SessionLogger.traceTag(41948359,logCategory.PptSession,logLevel.Warning,"Transcriber::OpenWebSocketConnection:onmessage: In network error status, temporarily disable subtitles");RecordError(TelemetryErrorFieldNames.TemporaryDisableSubtitleDueNetworkError,"Network error with error windows : "+a.m_countFragmentLatencyInErrorWindow,Date.now(),false);return}var j=b.getTranscriptresult().getTranscriptsMap();j.forEach(function(c,d){var a=Transcriber.s_instance;if(!a){SessionLogger.traceTag(40706259,logCategory.PptSession,logLevel.Info,"Transcriber::OpenWebSocketConnection:onmessage: display transcription - Transcriber instance is null");return}if(c===j.get(d)&&a.m_translationLanguages.indexOf(d)!=-1){var e=b.getTranscriptresult().getIsfinal();a.m_timerForClearTranscriptionText&&clearTimeout(a.m_timerForClearTranscriptionText);a.m_timerForShowListeningDetectionMessage!==null&&a.m_timerForShowListeningDetectionMessage!==undefined&&a.m_timerForShowListeningDetectionMessage!=0&&clearTimeout(a.m_timerForShowListeningDetectionMessage);a.SetTranscriptionText(c,"rgba( 255, 255, 255, 1 )",e);a.m_timerForClearTranscriptionText=setTimeout(resetTransciptionTextToEmpty,TranscriberSettings.ResetTranscriptionTextIntervalMS)}});try{if(!TranscriberSettings.BroadcastSubtitlesFromSpeechFrontDoorForLive&&Transcriber.s_instance&&Transcriber.s_instance.m_fInLiveBroadcastingMode){var m=[];j.forEach(function(a,b){m.push({language:b,transript:a})});TranscriberPostMessageUpward({EventType:30,Transcripts:m,IsFinal:b.getTranscriptresult().getIsfinal()})}}catch(x){SessionLogger.traceTag(41759266,logCategory.PptSession,logLevel.Error,"Transcriber::OpenWebSocketConnection: Posting Live broadcasting subtitle threw an exception: "+x+" TranscriberID: "+a.m_transcriberId)}var q=b.getCorrelationid().toLowerCase(),n=b.getTranscriptresult(),o=n!=null?n.getIsfinal():false;CalculateOnMessageTelemetry(a,o,q,c)}else HandleOnMessageTranscriptionError(b)}else a.SetTranscriptionText(e.data,"rgba( 255, 255, 255, 1 )",true)};a.m_webSocket.onclose=function(c){var a=Transcriber.s_instance;if(!a){SessionLogger.traceTag(40425041,logCategory.PptSession,logLevel.Warning,"Transcriber::WebSocket closed after instance has been disposed");return}a.m_roundLatencyTimerId!==0&&clearInterval(a.m_roundLatencyTimerId);a.m_audioSendingCountIntervalTimerId!==0&&clearInterval(a.m_audioSendingCountIntervalTimerId);a.m_timerForClearTranscriptionText&&clearTimeout(a.m_timerForClearTranscriptionText);a.m_timerForShowListeningDetectionMessage&&clearTimeout(a.m_timerForShowListeningDetectionMessage);if(c.type==="NoAudioIn10Mins"&&c.code===4001){RecordError(TelemetryErrorFieldNames.ErrorNoAudioSend,"Close Websocket since no audio message in 10 mins",Date.now(),true);var b={};b[TelemetryErrorFieldNames.ErrorNoAudioSend]="WebSocketNoAudioSendInMins";a.LogTranscriberErrorTelemetry(b);return}if(c.code!=1e3){var b={};b[TelemetryErrorFieldNames.WebSocketErrorCode]=c.code;b[TelemetryFieldNames.WebSocketRetryReason]="WebSocketDisconnected";RetryWebSocketConnectionWrapper(b)}}}function setTranscriberUIVisibility(a){var d=Transcriber.s_instance;if(!d){SessionLogger.traceTag(41775949,logCategory.PptSession,logLevel.Info,"toggleTranscriberUI Transcriber instance is null");return}try{var c=document.getElementById(TranscriberElementIds.DetectionDivId),b=document.getElementById(TranscriberElementIds.TranscriberId);if(a==null){if(b==null){SessionLogger.traceTag(50595553,logCategory.PptSession,logLevel.Warning,"Canot determine intended visibility mode!");return}a=b.style.visibility!="hidden"}if(a)switch(TranscriberSettings.TranscriberPosition){case"AboveSlide":TranscriberPostMessageUpward({EventType:31,IsStartTranscription:true,SubtitlesPosition:"TopOverlay"});break;case"BelowSlide":TranscriberPostMessageUpward({EventType:31,IsStartTranscription:true,SubtitlesPosition:"BottomOverlay"})}else TranscriberPostMessageUpward({EventType:31,IsStartTranscription:true,SubtitlesPosition:TranscriberSettings.TranscriberPosition});if(c!=null)c.style.visibility=a?"hidden":"visible";if(b!=null)b.style.visibility=a?"hidden":"visible"}catch(e){SessionLogger.traceTag(41775950,logCategory.PptSession,logLevel.Warning,"Transcriber UI toggling threw an exception "+e+" TranscriberID: "+d.m_transcriberId)}}function setTranscriberLiveBroadcastMode(a,c){TranscriberSettings.LivePraugueSessionInfo=a?c:"";var b=Transcriber.s_instance;if(!b){SessionLogger.traceTag(41682721,logCategory.PptSession,logLevel.Info,"Transcriber::setTranscriberLiveBroadcastMode Transcriber instance is null");return}SessionLogger.traceTag(41682722,logCategory.PptSession,logLevel.Info,"Transcriber::setTranscriberLiveBroadcastMode:"+a);b.m_fInLiveBroadcastingMode=a;updateCurrentSpeechModes()}function updateCurrentSpeechModes(){var a=Transcriber.s_instance;if(!a){SessionLogger.traceTag(593757445,logCategory.PptSession,logLevel.Info,"Transcriber::addSpeechMode Transcriber instance is null");return}if(a.m_fInLiveBroadcastingMode)a.m_currentSpeechModes=["Live","Subtitles"];else if(getSpeechMode(a)==="Subtitles")a.m_currentSpeechModes=["Subtitles"]}function recordGetUserMediaError(l,k,h,j,g,d){if(!readTranscriberSettings(l,k,h,j,g)){RecordError(TelemetryErrorFieldNames.ReadSettingsFailed,"Failed to read settings",Date.now(),true);return}if(TranscriberSettings.IsStartRehearsal){var b=Rehearsal.GetInstance();Transcriber.s_instance=new Transcriber;var a=Transcriber.s_instance;a.m_fIsRehearsal=true;Transcriber.CreateTranscribeDetectionContainer();if(b&&a){b!=null&&b.InitializeError(RehearsalErrorReason.NoMicrophone);a.m_transcriberDetectionSpan=document.getElementById(TranscriberElementIds.DetectionSpanId);a.m_transcriberDetectionDiv=document.getElementById(TranscriberElementIds.DetectionDivId);a.SetTranscriptionDetectionText(TranscriberResourceString.DetectionString_NoMicrophone,TranscriberDetectionDivStyle.NoMicAccess,true)}RecordError(TelemetryErrorFieldNames.GetUserMediaFailed,"Error: "+d,Date.now(),false);return}if(!TranscriberSettings.IsStartTranscription){var e=Transcriber.s_instance;if(e){var i=Transcriber.DisposeInstance();!i&&SessionLogger.traceTag(41543387,logCategory.PptSession,logLevel.Warning,"Transcriber::recordGetUserMediaError dispose transcriber instance. Id "+e.m_transcriberId)}return}Transcriber.s_instance=new Transcriber;var c=Transcriber.s_instance;if(!c){SessionLogger.traceTag(41543388,logCategory.PptSession,logLevel.Info,"Transcriber::displayGetUserMediaError Transcriber instance is null");return}SessionLogger.traceTag(41543389,logCategory.PptSession,logLevel.Info,"Transcriber::displayGetUserMediaError error: "+d);var f=TranscriberSettings.RTLLanguages.search(TranscriberSettings.TranslationLanguages)!=-1;Transcriber.CreateTranscribeContainer(TranscriberSettings.TranscriberPosition,f,TranscriberSettings.TranslationLanguages);c.m_transcriberResultSpan=document.getElementById(TranscriberElementIds.ResultSpanId);c.SetTranscriptionErrorText(TranscriberResourceString.ErrorAudioDevice);RecordError(TelemetryErrorFieldNames.GetUserMediaFailed,"Error: "+d,Date.now(),false);return}function notifyTranscriberOnSlideChange(c){var a=Transcriber.s_instance;if(!a){SessionLogger.traceTag(41726082,logCategory.PptSession,logLevel.Error,"Transcriber::notifyTranscriberOnSlideChange Transcriber instance is null");return}a.m_currentSlideIndex=c;var b=Rehearsal.GetInstance();b!=null&&b.UpdateSlideTracker(a.m_currentSlideIndex)}function readTranscriberSettings(n,m,l,g,f){try{var a=JSON.parse(n);TranscriberSettings.WacUserSessionId=a.WacUserSessionId;TranscriberSettings.WacUserDatacenterCluster=a.WacUserDatacenterCluster;TranscriberSettings.PodSessionId=a.PodSessionId;TranscriberSettings.DocId=a.DocId;TranscriberSettings.EntryPoint=a.EntryPoint;TranscriberSettings.StartTime=a.StartTime;TranscriberSettings.WebServiceBase=a.PodsWebServiceBase;TranscriberSettings.DataLoggingIntervalMS=a.TranscriberLoggingIntervalInMS;TranscriberSettings.RealTimeFactorLowerThreshold=a.TranscribeRealTimeFactorLowerThreshold;TranscriberSettings.RealTimeFactorUpperThreshold=a.TranscribeRealTimeFactorUpperThreshold;TranscriberSettings.IsLogEachTranscriptMessage=a.IsTranscriberLogEachTranscriptMessage;TranscriberSettings.IsContentLoggingEnabled=a.IsTranscriberContentLoggingEnabled;TranscriberSettings.IsCustomEndpointEnabled=a.FUseEndpointInWebapp;TranscriberSettings.CustomEndpointRequestTimeoutInMs=a.CustomEndpointRequestTimeoutInMs;TranscriberSettings.RTLLanguages=a.RTLLanguages;TranscriberSettings.HeartbeatInterval=a.HeartbeatInterval;TranscriberSettings.RoundtripLatencyWarnThreshold=a.RoundtripLatencyThreshold;TranscriberSettings.RoundtripLatencyErrorThreshold=a.RoundtripLatencyThreshold*5;TranscriberSettings.AudioSendingCountIntervalMS=a.AudioSendingCountIntervalMS;TranscriberSettings.FragmentLatencyWarnThreshold=a.FragmentLatencyWarnThreshold;TranscriberSettings.FragmentLatencyErrorThreshold=a.FragmentLatencyErrorThreshold;TranscriberSettings.MessageType=a.MessageType;TranscriberSettings.MaxAllowedFragmentLatencyMS=a.MaxAllowedFragmentLatencyMS;TranscriberSettings.DynamicBufferEnabled=a.DynamicBufferEnabled;TranscriberSettings.DefaultBufferSize=a.DefaultBufferSize;TranscriberSettings.MaxAllowedFinalFragmentLatencyMS=a.MaxAllowedFinalFragmentLatencyMS;TranscriberSettings.fSupportSpeechResponseMessage=a.FSupportSpeechResponseMessage;TranscriberSettings.TranscriberShowListeningDetectionTextInMS=a.TranscriberShowListeningDetectionTextInMS;TranscriberSettings.IsLiveAgent=a.IsLiveAgent;TranscriberSettings.AudioContextSampleRate=a.PodTranscriberAudioContextSampleRate;TranscriberSettings.FShouldCreateCustomEndpointWithSession=a.ShouldCreateCustomEndpointWithSession;TranscriberSettings.FRehearsalGrammarIsEnabled=a.RehearsalGrammarIsEnabled;TranscriberSettings.PodRehearsalMonotoneEnabled=a.PodRehearsalMonotoneEnabled}catch(o){SessionLogger.traceTag(41775238,logCategory.PptSession,logLevel.Error,"Transcriber::readTranscriberSettings: Parse appSettings json string threw exception: "+o);return false}try{var c=JSON.parse(m);TranscriberSettings.TranscriberPosition=c.SubtitlesPosition;TranscriberSettings.SpeechLanguage=c.SpeechLanguage;TranscriberSettings.TranslationLanguages=c.TranslationLanguages;TranscriberSettings.IsStartTranscription=c.FUseSubtitles;TranscriberSettings.UserId=c.UserId;TranscriberSettings.TenantId=c.TenantId;TranscriberSettings.AudienceGroup=c.AudienceGroup;TranscriberSettings.BuildVersion=c.BuildVersion;TranscriberSettings.IdentityProvider=c.IdentityProvider;TranscriberSettings.Locale=c.Locale;TranscriberSettings.WacHost=c.WacHost;TranscriberSettings.WacDatacenter=c.WacDatacenter}catch(o){SessionLogger.traceTag(41775239,logCategory.PptSession,logLevel.Error,"Transcriber::readTranscriberSettings: Parse subtitlesContextInfo json string threw exception"+o);return false}try{var b=JSON.parse(l);TranscriberResourceString.InitialMessage=b.InitialMessage;TranscriberResourceString.GenericErrorMessage=b.GenericErrorMessage;TranscriberResourceString.RetryErrorMessage=b.RetryErrorMessage;TranscriberResourceString.DetectionString_HighJitter=b.Detection_HighJitter;TranscriberResourceString.DetectionString_HighLatency=b.Detection_HighLatency;TranscriberResourceString.DetectionString_Listening=b.Detection_Listening;TranscriberResourceString.DetectionString_MicReady=b.Detection_MicReady;TranscriberResourceString.DetectionString_NetworkQualityIssue=b.Detection_NetworkQualityIssue;TranscriberResourceString.DetectionString_NoMicrophone=b.Detection_NoMicrophone;TranscriberResourceString.DetectionString_SoundReminder=b.Detection_SoundReminder;TranscriberResourceString.AccessibilityContentString=b.Accessibility_Content;TranscriberResourceString.AccessibilityWindowString=b.Accessibility_Window;TranscriberResourceString.ErrorAudioDevice=b.ErrorAudioDevice;TranscriberResourceString.GenericRetryErrorMessage=b.GenericRetryErrorMessage;TranscriberResourceString.GenericNetworkErrorMessage=b.GenericNetworkErrorMessage;TranscriberResourceString.QualityStatusStringDict[2]=b.Detection_AudioQualityIssue;TranscriberResourceString.QualityStatusStringDict[3]=b.Detection_HighBackgroundNoise;TranscriberResourceString.QualityStatusStringDict[4]=b.Detection_SpeakingTooLoud;TranscriberResourceString.QualityStatusStringDict[5]=b.Detection_SpeakingTooQuiet;TranscriberResourceString.QualityStatusStringDict[10]=b.DetectionText_AudioQualityIssue;TranscriberResourceString.QualityStatusStringDict[11]=b.DetectionText_HighBackgroundNoise;TranscriberResourceString.QualityStatusStringDict[12]=b.DetectionText_SpeakingTooLoud;TranscriberResourceString.QualityStatusStringDict[13]=b.DetectionText_SpeakingTooQuiet}catch(o){SessionLogger.traceTag(41775240,logCategory.PptSession,logLevel.Error,"Transcriber::readTranscriberSettings: Parse subtitlesResourceStr json string threw exception"+o);return false}TranscriberSettings.ServiceRequestTranslationLanguages=TranscriberSettings.TranslationLanguages;if(f.length>0)try{var h=JSON.parse(f);TranscriberSettings.TranslationLanguagesForLive=h.TranslationLanguages;TranscriberSettings.BroadcastSubtitlesFromSpeechFrontDoorForLive=h.BroadcastSubtitlesFromSpeechFrontDoorForLive;if(!TranscriberSettings.BroadcastSubtitlesFromSpeechFrontDoorForLive&&TranscriberSettings.TranslationLanguagesForLive.length>0){var d=",",k=TranscriberSettings.TranslationLanguages.split(d),j=TranscriberSettings.TranslationLanguagesForLive.split(d),i=k.concat(j).filter(function(a,c,b){return c===b.indexOf(a)&&a.trim().length!=0});TranscriberSettings.ServiceRequestTranslationLanguages=i.join(d)}}catch(o){SessionLogger.traceTag(41985924,logCategory.PptSession,logLevel.Error,"Transcriber::readTranscriberSettings: Parse liveContextStr json string threw exception"+o);return false}if(g.length>0)try{var e=JSON.parse(g);TranscriberSettings.IsStartRehearsal=e.IsStartRehearsal;TranscriberSettings.SlideCount=e.SlideCount;TranscriberSettings.StartingSlideIndex=e.StartingSlideIndex-1;if(TranscriberSettings.IsStartRehearsal)TranscriberSettings.fSupportSpeechResponseMessage=true}catch(o){SessionLogger.traceTag(42063389,logCategory.PptSession,logLevel.Error,"Transcriber::readTranscriberSettings: Parse rehearsalContextStr json string threw exception"+o);return false}return true}function getSpeechMode(a){return a?a.m_fIsRehearsal?"Rehearsal":a.m_fInLiveBroadcastingMode?"Live":"Subtitles":"Unknown"}function startTranscriber(d,w,u,t,j,s){Transcriber.s_instance&&TranscriberSettings.IsStartTranscription&&SessionLogger.traceTag(42285012,logCategory.PptSession,logLevel.Warning,"Transcriber::startTranscriber already has existed instance. TranscriberID: "+Transcriber.s_instance.m_transcriberId);var q=Date.now();if(!readTranscriberSettings(w,u,t,j,s)){RecordError(TelemetryErrorFieldNames.ReadSettingsFailed,"Failed to read settings",Date.now(),true);return}var x=new UlsSessionLogger(TranscriberSettings.WacUserSessionId,TranscriberSettings.WebServiceBase);SessionLogger.init(x);var b=Transcriber.generateId();TranscriberPostMessageUpward({EventType:32,TranscriberSessionId:TranscriberSettings.WacUserSessionId+"_"+b});SessionLogger.traceTag(41775241,logCategory.PptSession,logLevel.Info,JSON.stringify({StartingTranscription:TranscriberSettings.IsStartTranscription,EnableCustomEndpoint:TranscriberSettings.IsCustomEndpointEnabled,TranscriptionEntryPoint:TranscriptionEntryPoint[TranscriberSettings.EntryPoint],TranscriberID:b,IsRehearsal:TranscriberSettings.IsStartRehearsal}));!TranscriberSettings.IsStartRehearsal&&TranscriberSettings.EntryPoint!=TranscriptionEntryPoint.LiveBroadcast&&TranscriberPostMessageUpward({EventType:31,IsStartTranscription:TranscriberSettings.IsStartTranscription,SubtitlesPosition:TranscriberSettings.TranscriberPosition});if(!TranscriberSettings.IsStartTranscription&&!TranscriberSettings.IsStartRehearsal){var f=Transcriber.s_instance,h="null";if(f)h=f.m_transcriberId;SessionLogger.traceTag(41775242,logCategory.PptSession,logLevel.Info,"Transcriber::startTranscriber Calling Transcriber.DisposeInstance to end the transcription session. TranscriberId of current instance: "+h);var v=Transcriber.DisposeInstance();if(!v){f=Transcriber.s_instance;var m=false;if(f)m=true;SessionLogger.traceTag(41775243,logCategory.PptSession,logLevel.Warning,"Transcriber::startTranscriber Ending the transcription session "+ +"but the transcriber instance was not successfully disposed. Transcriber.s_instance exists: "+m+" TranscriberId of instance that was attempted to be disposed: "+h)}return}var k=TranscriberSettings.DefaultBufferSize;if(!isNaN(k))TranscriberSettings.DefaultBufferSize=k;Transcriber.s_instance=new Transcriber;var a=Transcriber.s_instance;if(!a){SessionLogger.traceTag(41775244,logCategory.PptSession,logLevel.Info,"Transcriber::startTranscriber Transcriber instance is null");return}a.m_fIsRehearsal=TranscriberSettings.IsStartRehearsal;a.m_fIsTranscribe=TranscriberSettings.IsStartTranscription;a.m_fIsLiveAgent=TranscriberSettings.IsLiveAgent;a.m_fRehearsalGrammarIsEnabled=TranscriberSettings.FRehearsalGrammarIsEnabled;a.m_sessionTelemetry[TelemetryFieldNames.TranscriptionEntryPointCalled]=q;a.m_sessionTelemetry[TelemetryFieldNames.SpeechLanguage]=TranscriberSettings.SpeechLanguage;a.m_sessionTelemetry[TelemetryFieldNames.TranslationLanguage]=TranscriberSettings.TranslationLanguages;a.m_sessionTelemetry[TelemetryFieldNames.ServiceRequestTranslationLanguages]=TranscriberSettings.ServiceRequestTranslationLanguages;a.m_translationLanguages=TranscriberSettings.TranslationLanguages;a.m_translationLanguagesForLive=TranscriberSettings.TranslationLanguagesForLive;a.m_sessionTelemetry[TelemetryFieldNames.FEnableContentlogging]=TranscriberSettings.IsContentLoggingEnabled;a.m_sessionTelemetry[TelemetryFieldNames.TranscriberPosition]=TranscriberSettings.TranscriberPosition;if(a.m_fIsTranscribe&&!a.m_fIsRehearsal){var r=TranscriberSettings.RTLLanguages.search(TranscriberSettings.TranslationLanguages)!=-1;a.m_sessionTelemetry[TelemetryFieldNames.CreateTranscribeContainerStartTimeMS]=Date.now();Transcriber.CreateTranscribeContainer(TranscriberSettings.TranscriberPosition,r,TranscriberSettings.TranslationLanguages);a.m_sessionTelemetry[TelemetryFieldNames.CreateTranscribeContainerEndTimeMS]=Date.now()}a.m_fInLiveBroadcastingMode=TranscriberSettings.EntryPoint==TranscriptionEntryPoint.LiveBroadcast;a.m_fInLiveBroadcastingMode&&setTranscriberUIVisibility(a.m_fInLiveBroadcastingMode);a.m_sessionTelemetry[TelemetryFieldNames.SpeechMode]=getSpeechMode(a);a.m_currentSpeechModes=[getSpeechMode(a)];Transcriber.CreateTranscribeDetectionContainer();a.m_transcriberDetectionSpan=document.getElementById(TranscriberElementIds.DetectionSpanId);a.m_transcriberDetectionDiv=document.getElementById(TranscriberElementIds.DetectionDivId);if(a.m_fIsRehearsal){a.m_currentSlideIndex=TranscriberSettings.StartingSlideIndex;a.m_slideCount=TranscriberSettings.SlideCount;a.m_podsUrl=TranscriberSettings.WebServiceBase;a.m_podsId=TranscriberSettings.PodSessionId;var l=Rehearsal.GetInstance();if(l!=null){l.Initialize(b,a.m_currentSlideIndex,a.m_slideCount,j);a.SetTranscriptionDetectionText(TranscriberResourceString.DetectionString_MicReady,TranscriberDetectionDivStyle.MicReady,true)}}a.m_sessionTelemetry[TelemetryFieldNames.CustomEndpointEnabled]=TranscriberSettings.IsCustomEndpointEnabled;if(!TranscriberSettings.IsCustomEndpointEnabled||TranscriberSettings.FShouldCreateCustomEndpointWithSession)OnGetUserMediaSuccess(d,null,b,OnGetUserMediaSuccessEntryPoint.CustomEndpointNotEnabled);else{if(TranscriberSettings.DocId.length===0){RecordError(TelemetryErrorFieldNames.InvalidDocId,"",Date.now(),false);var n={};n[TelemetryErrorFieldNames.CustomEndpointClientFailureReason]="InvalidDocId";a.LogTranscriberErrorTelemetry(n);OnGetUserMediaSuccess(d,null,b,OnGetUserMediaSuccessEntryPoint.InvalidDocId);return}var o=TranscriberSettings.DocId,p=TranscriberSettings.DocId.indexOf("access_token");if(p===-1)SessionLogger.traceTag(41775246,logCategory.PptSession,logLevel.Warning,"Transcriber::RequestCustomEndpoint access_token was not found in docID. TranscriberID: "+b);else o=TranscriberSettings.DocId.substring(0,p);var g=Transcriber.generateId();SessionLogger.traceTag(41775247,logCategory.PptSession,logLevel.Info,"Transcriber::RequestCustomEndpoint CorrelationID: "+g+" TranscriberID: "+b);a.m_sessionTelemetry[TelemetryFieldNames.CustomEndpointRequestCorrelationID]=g;var e=null,i=queryParams.TranscriberURI.replace("wss","https");if(queryParams.wdLiveBroadcast)i=i.replace("ws://","http://");var y=i+"CustomEndpointHandler.ashx?action=GetOrCreateCustomEndpoint"+("&podurl="+TranscriberSettings.WebServiceBase)+("&PODSID="+TranscriberSettings.PodSessionId)+("&docid="+o)+("&locale="+TranscriberSettings.SpeechLanguage)+"&client=web&contenttype=url"+("&speechMode="+getSpeechMode(a))+("&fenablecontentlogging="+TranscriberSettings.IsContentLoggingEnabled)+("&correlationid="+g)+("&wacusersessionid="+TranscriberSettings.WacUserSessionId)+("&wacuserdatacluster="+TranscriberSettings.WacUserDatacenterCluster),c=new XMLHttpRequest;a.m_sessionTelemetry[TelemetryFieldNames.RequestCustomEndpointStartTimeMS]=Date.now();c.open("POST",y,true);c.timeout=TranscriberSettings.CustomEndpointRequestTimeoutInMs;c.send();c.onload=function(){SessionLogger.traceTag(41775248,logCategory.PptSession,logLevel.Info,"Transcriber::startTranscriber OnLoad Transcriber ID: "+b);a.m_sessionTelemetry[TelemetryFieldNames.RequestCustomEndpointEndTimeMS]=Date.now();e=c.getResponseHeader("X-EndpointID");!a.m_transcriberId&&OnGetUserMediaSuccess(d,e,b,OnGetUserMediaSuccessEntryPoint.OnLoadCustomEndpointRequest)};c.onerror=function(){SessionLogger.traceTag(41775249,logCategory.PptSession,logLevel.Info,"Transcriber::startTranscriber OnError Transcriber ID: "+b);RecordError(TelemetryErrorFieldNames.CustomEndpointServerError,c.getResponseHeader("X-ErrorCode")+" "+c.getResponseHeader("X-FailureReason")+" "+ +c.status,Date.now(),false);a.m_sessionTelemetry[TelemetryFieldNames.RequestCustomEndpointFailedEndTimeMS]=Date.now();var f={};f[TelemetryErrorFieldNames.CustomEndpointServerErrorCode]=c.getResponseHeader("X-ErrorCode");f[TelemetryErrorFieldNames.CustomEndpointServerFailureReason]=c.getResponseHeader("X-FailureReason");a.LogTranscriberErrorTelemetry(f);!a.m_transcriberId&&OnGetUserMediaSuccess(d,e,b,OnGetUserMediaSuccessEntryPoint.OnErrorCustomEndpointRequest)};c.ontimeout=function(){SessionLogger.traceTag(41775250,logCategory.PptSession,logLevel.Info,"Transcriber::startTranscriber OnTimeout Transcriber ID: "+b);RecordError(TelemetryErrorFieldNames.CustomEndpointClientError,"CustomEndpointRequestTimeout",Date.now(),false);a.m_sessionTelemetry[TelemetryFieldNames.RequestCustomEndpointTimedOutEndTimeMS]=Date.now();var c={};c[TelemetryErrorFieldNames.CustomEndpointClientFailureReason]="CustomEndpointRequestTimeout";a.LogTranscriberErrorTelemetry(c);!a.m_transcriberId&&OnGetUserMediaSuccess(d,e,b,OnGetUserMediaSuccessEntryPoint.OnTimeoutCustomEndpointRequest)}}}function sendPingMessage(){var a=Transcriber.s_instance;if(!a){SessionLogger.traceTag(41685893,logCategory.PptSession,logLevel.Info,"sendPingMessage - Transcriber instance is null");return}if(a.m_sendPingMessageFlag==false)a.m_sendPingMessageFlag=true}function displayListeningDetectionText(){var a=Transcriber.s_instance;a&&a.m_transcriberDetectionSpan!=null&&!a.m_fIsRehearsal&&a.SetTranscriptionDetectionText(TranscriberResourceString.DetectionString_Listening+"...",TranscriberDetectionDivStyle.Listening)}function resetTransciptionTextToEmpty(){var a=Transcriber.s_instance;if(a&&a.m_transcriberResultSpan!=null){a.m_transcriberResultSpan.style.color="rgba(255, 255, 255, 1)";a.m_transcriberResultSpan.innerText="";a.m_transcriberResultSpan.scrollTop=a.m_transcriberResultSpan.scrollHeight;a.m_transcriberResultSpan.style.padding="0px";a.m_transcriptDisplay1="";a.m_transcriptDisplay2="";a.m_fPreviousTranscriptResultFinal=false;a.m_timerForClearTranscriptionText=null;a.m_timerForShowListeningDetectionMessage=setTimeout(displayListeningDetectionText,TranscriberSettings.TranscriberShowListeningDetectionTextInMS);a.m_inListeningStatus=true}}function checkAudioSendingIn10Mins(){var a=Transcriber.s_instance;if(!a){SessionLogger.traceTag(41199754,logCategory.PptSession,logLevel.Info,"checkAudioSendingInMins - Transcriber instance is null");return}if(a.m_totalAudioMessageCountInMins>0)a.m_totalAudioMessageCountInMins=0;else{var b={code:4001,reason:"NoAudioIn10Mins",wasClean:false},c=new CloseEvent("NoAudioIn10Mins",b);if(a.m_webSocket&&a.m_webSocket.onclose)a.m_webSocket.onclose(c)}}function OnGetUserMediaSuccess(k,b,i,e){var a=Transcriber.s_instance;if(!a){SessionLogger.traceTag(41157959,logCategory.PptSession,logLevel.Info,"Transcriber::OnGetUserMediaSuccess Transcriber instance is null");return}a.m_transcriberId=i;var l=Transcriber.SanitizeDocID(TranscriberSettings.DocId,a.m_transcriberId),h=Transcriber.generateId(),j=queryParams.TranscriberURI+"SpeechHandler.ashx?action=Transcribe&client=web"+("&session="+TranscriberSettings.WacUserSessionId+"_"+a.m_transcriberId)+("&message="+TranscriberSettings.MessageType)+("&speechMode="+getSpeechMode(a))+("&PodSID="+TranscriberSettings.PodSessionId)+("&podurl="+TranscriberSettings.WebServiceBase)+("&wacusersessionid="+TranscriberSettings.WacUserSessionId)+("&wacuserdatacluster="+TranscriberSettings.WacUserDatacenterCluster)+("&fCreateCustomEndpoint="+TranscriberSettings.FShouldCreateCustomEndpointWithSession)+("&locale="+TranscriberSettings.SpeechLanguage)+"&contenttype=url"+("&fenablecontentlogging="+TranscriberSettings.IsContentLoggingEnabled)+("&docid="+l)+("&requestcorrelationid="+h)+("&liveagent="+a.m_fIsLiveAgent),m=j,c="Unknown";if(queryParams.TranscriberURI.toLowerCase().indexOf(".edog")!=-1)c="EDog";else if(queryParams.TranscriberURI.toLowerCase().indexOf(".live-int.")!=-1)c="Int";else c="Production";a.m_sessionTelemetry[TelemetryFieldNames.Endpoint]=c;a.m_sessionTelemetry[TelemetryFieldNames.TranscriberID]=a.m_transcriberId;a.m_sessionTelemetry[TelemetryFieldNames.TranscriptionEntryPoint]=TranscriptionEntryPoint[TranscriberSettings.EntryPoint];a.m_sessionTelemetry[TelemetryFieldNames.TranscriptionStartTime]=TranscriberSettings.StartTime;a.m_sessionTelemetry[TelemetryFieldNames.OnGetUserMediaSuccessEntryPoint]=OnGetUserMediaSuccessEntryPoint[e];a.m_lastTranscriptLogUTC=Date.now();a.m_lastAudioLogUTC=Date.now();a.m_intervalAudio=TranscriberSettings.DataLoggingIntervalMS;a.m_intervalTranscript=TranscriberSettings.DataLoggingIntervalMS;var d=document.getElementById("pptViewerAnchor-Met");if(!d||d.getBoundingClientRect().width==0){var f=a.m_transcriberId,g=Transcriber.DisposeInstance();SessionLogger.traceTag(40461377,logCategory.PptSession,logLevel.Warning,"Transcriber::OnGetUserMediaSuccess Dispose transcriber instance because SlideShow has been exited. Returned: "+ +g+" TranscriberID: "+f);return}a.m_sessionTelemetry[TelemetryFieldNames.InitializeWebSocketStartTimeMS]=Date.now();if(!a.initialTranscriberSession(k,TranscriberSettings.DefaultBufferSize,1,1,m)){SessionLogger.traceTag(41174223,logCategory.PptSession,logLevel.Info,"Transcriber::OnGetUserMediaSuccess: Initialize websocket failed. TranscriberID: "+a.m_transcriberId);return}a.m_sessionTelemetry[TelemetryFieldNames.InitializeWebSocketEndTimeMS]=Date.now();a.m_scriptNode.onaudioprocess=function(I){if(!a){SessionLogger.traceTag(40425042,logCategory.PptSession,logLevel.Info,"Transcriber::onaudioprocess Transcriber instance is null");return}if(!a.m_webSocket){SessionLogger.traceTag(40425043,logCategory.PptSession,logLevel.Info,"WebSocket is null. TranscriberID: "+a.m_transcriberId);return}if(a.m_webSocket.readyState!=WebSocket.OPEN){SessionLogger.traceTag(40425044,logCategory.PptSession,logLevel.Info,"Cannot send audio data because WebSocket not open. WebSocketReadyState: "+a.m_webSocket.readyState+ +" TranscriberID: "+a.m_transcriberId);return}if(a.m_fIsRehearsal){var w=Rehearsal.GetInstance();if(w==null||w.GetRehearsalState()!=RehearsalState.Started){SessionLogger.traceTag(42074945,logCategory.PptSession,logLevel.Info,"Rehearsal session is not started yet in onaudioprocess. TranscriberID: "+a.m_transcriberId);return}}var D=Date.now(),z=a.EncodeWAVWithoutHeader(I.inputBuffer.getChannelData(0));if(TranscriberSettings.MessageType==="protobuf"){var c=new proto.Microsoft.PowerPoint.SpeechFrontDoor.ProtoBuf.ClientAudioMessage,e=Transcriber.generateId();c.setCorrelationid(e);try{var y=Date.now();a.m_messageLatencyTable[e]=y;a.m_totalEntriesInLatencyTable+=1;if(a.m_totalEntriesInLatencyTable>a.c_maxEntriesInLatencyTable){var G=6e4;a.m_latencyTableDeletedCount+=1;for(var x in a.m_messageLatencyTable){var C=a.m_messageLatencyTable[x];if(C<y-G){delete a.m_messageLatencyTable[x];a.m_totalEntriesInLatencyTable-=1}}SessionLogger.traceTag(40477776,logCategory.PptSession,logLevel.Info,"Transcriber::onaudioprocess Deleted all entries in the latency table older than 1 minute. Number of times entries in the latency table have surpassed allowed max: "+a.m_latencyTableDeletedCount+" TranscriberID: "+a.m_transcriberId)}}catch(J){SessionLogger.traceTag(40477777,logCategory.PptSession,logLevel.Warning,"Transcriber::onaudioprocess Message latency logic threw an exception "+J+" TranscriberID: "+a.m_transcriberId)}var H=new Uint8Array(z.buffer);c.setAudio(H);c.setSourcelanguage(!a.m_fIsRehearsal?TranscriberSettings.SpeechLanguage:"en-us");c.getSettingsMap().set("targetLanguageList",!a.m_fIsRehearsal?TranscriberSettings.ServiceRequestTranslationLanguages:"en");c.getSettingsMap().set("currentSlideIndex",String(a.m_currentSlideIndex));if(TranscriberSettings.IsCustomEndpointEnabled&&typeof b!=="undefined"&&b!==""){a.m_sessionTelemetry[TelemetryFieldNames.WebSocketCustomEndpoint]=b;c.getSettingsMap().set("endpointId",b)}if(a.m_sendPingMessageFlag){c.getSettingsMap().set("isPingMessage","true");var l=a.m_heartbeatSendTime&&a.m_heartbeatSendTime!==0?a.m_heartbeatSendTime:Date.now(),j=Date.now(),i=j-l;a.m_sendPingMessageFlag=false;a.m_heartbeatSendTime=j;a.m_currentHeartbeatSendInterval=i;!TranscriberSettings.IsLogEachTranscriptMessage&&i>TranscriberSettings.HeartbeatInterval+TranscriberSettings.RoundtripLatencyWarnThreshold&&SessionLogger.traceTag(41035722,logCategory.PptSession,logLevel.Warning,JSON.stringify({RealHeartbeatSendInterval:i,PreHeartbeatSendTime:l,CurHeartbeatSendTime:j,TranscriberID:a.m_transcriberId,CorrelationID:e}));TranscriberSettings.IsLogEachTranscriptMessage&&SessionLogger.traceTag(41223623,logCategory.PptSession,logLevel.Info,JSON.stringify({RealHeartbeatSendInterval:i,PreHeartbeatSendTime:l,CurHeartbeatSendTime:j,TranscriberID:a.m_transcriberId,CorrelationID:e}));if(a.m_gapNumberBetweenPingPongMessage>=2){DetectHighLatencyWithNetworkInfo(-1,TranscriberSettings.NoInternetConnectionInMs,e);SessionLogger.traceTag(41964700,logCategory.PptSession,logLevel.Error,"Transcriber::OnGetUserMediaSuccess Probably loss network connection: TranscriberID: "+a.m_transcriberId+" CorrelationID: "+e);RecordError(TelemetryErrorFieldNames.LossInternetConnection,"gapNumberBetweenPingPongMessage : "+a.m_gapNumberBetweenPingPongMessage,Date.now(),false)}a.m_gapNumberBetweenPingPongMessage=Math.min(2,a.m_gapNumberBetweenPingPongMessage+1)}if(a.m_sessionTelemetry[TelemetryFieldNames.SendFirstMessageTime]==undefined)a.m_sessionTelemetry[TelemetryFieldNames.SendFirstMessageTime]=Date.now();if(a.m_fSendClientMetadata||getSpeechMode(a)==="Live"){a.m_fSendClientMetadata=getSpeechMode(a)==="Live";var E=a.m_fIsRehearsal?Rehearsal.GetRehearsalMetadataJSON(a.m_fRehearsalGrammarIsEnabled):"",v="";if(TranscriberSettings.fSupportSpeechResponseMessage)v=a.m_fIsRehearsal?"SpeechResultMessage,QualityStatusMessage,RehearsalResultMessage":"SpeechResultMessage,QualityStatusMessage";c.getSettingsMap().set("clientMetadata",JSON.stringify({supportedResponseTypes:v,rehearsalMetadata:E,livePragueSessionInfo:TranscriberSettings.LivePraugueSessionInfo,currentSlideIndex:String(a.m_currentSlideIndex),userID:TranscriberSettings.UserId,tenantId:TranscriberSettings.TenantId,audienceGroup:TranscriberSettings.AudienceGroup,buildVersion:TranscriberSettings.BuildVersion,identityProvider:TranscriberSettings.IdentityProvider,locale:TranscriberSettings.Locale,wacHost:TranscriberSettings.WacHost,wacDatacenter:TranscriberSettings.WacDatacenter}));c.getSettingsMap().set("currentSpeechModes",JSON.stringify(a.m_currentSpeechModes))}var F=c.serializeBinary();a.m_currentSentAudioTimeUTC=Date.now();var k=Date.now()-D;a.m_prepAudioCount++;a.m_prepAudioSum+=k;a.m_minPrepAudio=Math.min(a.m_minPrepAudio,k);a.m_maxPrepAudio=Math.max(a.m_maxPrepAudio,k);a.m_webSocket.send(F);a.m_totalAudioMessageCountInMins++;try{var A=Date.now(),K=0;a.m_totalAudioMessageCountInCurrentTimeInterval++;if(a.m_totalAudioMessageCountInPreviousTimeInterval>0&&a.m_lastSentAudioTimeUTC<Number.MAX_VALUE){var u=a.m_intervalAudio/a.m_totalAudioMessageCountInPreviousTimeInterval,m=Date.now()-a.m_lastSentAudioTimeUTC,d=u/(m>0?m:1);if(d>0){a.m_realTimeSendDataFactorCount++;a.m_realTimeSendDataFactorSum+=d;a.m_minRealTimeSendDataFactor=Math.min(a.m_minRealTimeSendDataFactor,d);a.m_maxRealTimeSendDataFactor=Math.max(a.m_maxRealTimeSendDataFactor,d);a.m_realTimeSendDataFactorCountInTimeInterval++;a.m_realTimeSendDataFactorSumInTimeInterval+=d;a.m_minRealTimeSendDataFactorInTimeInterval=Math.min(a.m_minRealTimeSendDataFactorInTimeInterval,d);a.m_maxRealTimeSendDataFactorInTimeInterval=Math.max(a.m_maxRealTimeSendDataFactorInTimeInterval,d);if(d<TranscriberSettings.RealTimeFactorLowerThreshold||d>TranscriberSettings.RealTimeFactorUpperThreshold){a.m_totalAudioFactorOutsideOfThresholdCount++;var f=0,h=0,g=0;if(a.m_realTimeSendDataFactorCount>0){f=a.m_realTimeSendDataFactorSum*1/a.m_realTimeSendDataFactorCount;h=a.m_minRealTimeSendDataFactor;g=a.m_maxRealTimeSendDataFactor}SessionLogger.traceTag(41157960,logCategory.PptSession,logLevel.Warning,JSON.stringify({MessageCorrelationID:e,SessionDurationInMS:Date.now()-TranscriberSettings.StartTime,RealTimeSendingDataFactor:d,AvgRealTimeSendingDataFactor:f,MinRealTimeSendingDataFactor:h,MaxRealTimeSendingDataFactor:g,AvgSendingDataDurationForInterval:u,RealTimeDurationForCurrentMessage:m,TotalAudioMessageCountInPreviousTimeInterval:a.m_totalAudioMessageCountInPreviousTimeInterval,AdjustedTimeInterval:a.m_intervalAudio,TranscriberID:a.m_transcriberId}))}}}if(Date.now()-a.m_lastAudioLogUTC>TranscriberSettings.DataLoggingIntervalMS){var f=0,h=0,g=0;if(a.m_realTimeSendDataFactorCount>0){f=a.m_realTimeSendDataFactorSum*1/a.m_realTimeSendDataFactorCount;h=a.m_minRealTimeSendDataFactor;g=a.m_maxRealTimeSendDataFactor}var q=0;if(a.m_totalAudioMessageCountInPreviousTimeInterval>0)q=a.m_intervalAudio/a.m_totalAudioMessageCountInPreviousTimeInterval;var n=0,p=0,o=0;if(a.m_realTimeSendDataFactorCountInTimeInterval>0){n=a.m_realTimeSendDataFactorSumInTimeInterval*1/a.m_realTimeSendDataFactorCountInTimeInterval;p=a.m_minRealTimeSendDataFactorInTimeInterval;o=a.m_maxRealTimeSendDataFactorInTimeInterval}var r=0,t=0,s=0;if(a.m_prepAudioCount>0){r=a.m_prepAudioSum/a.m_prepAudioCount;t=a.m_minPrepAudio;s=a.m_maxPrepAudio}SessionLogger.traceTag(41157961,logCategory.PptSession,logLevel.Info,JSON.stringify({SessionDurationInMS:Date.now()-TranscriberSettings.StartTime,AvgRealTimeSendingDataFactor:f,MinRealTimeSendingDataFactor:h,MaxRealTimeSendingDataFactor:g,AvgRealTimeSendingDataFactorForInterval:n,MinRealTimeSendingDataFactorForInterval:p,MaxRealTimeSendingDataFactorForInterval:o,AvgPrepAudioForInterval:r,MinPrepAudioForInterval:t,MaxPrepAudioForInterval:s,AvgSendingDataDurationForInterval:q,TotalAudioMessageCountInPreviousTimeInterval:a.m_totalAudioMessageCountInPreviousTimeInterval,AdjustedTimeInterval:a.m_intervalAudio,TranscriberID:a.m_transcriberId}));a.m_totalAudioMessageCountInPreviousTimeInterval=a.m_totalAudioMessageCountInCurrentTimeInterval;a.m_totalAudioMessageCountInCurrentTimeInterval=0;a.m_realTimeSendDataFactorCountInTimeInterval=0;a.m_realTimeSendDataFactorSumInTimeInterval=0;a.m_minRealTimeSendDataFactorInTimeInterval=Number.MAX_VALUE;a.m_maxRealTimeSendDataFactorInTimeInterval=Number.MIN_VALUE;a.m_prepAudioCount=0;a.m_prepAudioSum=0;a.m_minPrepAudio=Number.MAX_VALUE;a.m_maxPrepAudio=Number.MIN_VALUE;a.m_lastAudioLogUTC=Date.now();ResetIntervalStats(true)}a.m_lastSentAudioTimeUTC=a.m_currentSentAudioTimeUTC;var B=Date.now()-A;a.m_audioFactorCalculationDuration+=B}catch(J){SessionLogger.traceTag(41157962,logCategory.PptSession,logLevel.Warning,"Transcriber::onaudioprocess Calculating audio sending metrics threw an exception: "+J+" TranscriberID: "+a.m_transcriberId)}}else{if(a.m_sessionTelemetry[TelemetryFieldNames.SendFirstMessageTime]==undefined)a.m_sessionTelemetry[TelemetryFieldNames.SendFirstMessageTime]=Date.now();a.m_lastSentAudioTimeUTC=Date.now();a.m_webSocket.send(z.buffer)}};a.m_streamSource.connect(a.m_scriptNode);a.m_scriptNode.connect(a.m_audioCtx.destination)};