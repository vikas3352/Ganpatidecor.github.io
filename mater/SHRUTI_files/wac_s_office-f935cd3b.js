define("popover",["jquery-1.7.2","registernamespace"],function(){!function(e){registerNamespace("$UI"),window.$UI.Dialog=function(t,i,n,r,o,a){function s(){if(p){var e=p.style,t=$B.IE&&7==$B.V?m.offsetLeft/100:1;0==t&&(t=1),$Debug.trace("zoomAmount: ",t),$Debug.trace("scrollLeft: ",k.scrollLeft),$B.IE&&6==$B.V&&(e.width=k.scrollWidth-3+"px",e.pixelTop=Math.max(0,k.scrollTop/t)),e.pixelHeight=b.clientHeight/t,e.pixelWidth=b.clientWidth/t}}function l(e){var t;t=e.target==f?$UI.Dialog.findFocusableElement(D,g,!1):$UI.Dialog.findFocusableElement(D,f,!0),t&&setTimeout(function(){try{t.focus()}catch(e){}},0)}function d(){e(window).bind({"resize.ext":u,"scroll.ext":u})}function u(t){e(window).unbind(".ext",u),_.recalc(!1),d()}function c(){if($B.IE&&$B.V<7){v=w.getElementsByTagName("select");for(var e=D.getElementsByTagName("select"),t=0;t<v.length;t++){for(var i=!1,n=0;n<e.length;n++)if(v[t]==e[n]){i=!0;break}i||(v[t].wlppHide=v[t].style.visibility,v[t].style.visibility="hidden")}}}var h=window;o&&(h=o);var p,m,f,g,v,y,w=h.document||h.ownerDocument,C=w.body,b=w.documentElement,k=$B.RE_WebKit?C:w.documentElement,S=C.className.indexOf("rtl")>-1,_=this,I=e(),x=e(),D=null,E=null,P=null,T=null;this.dock=new $UI.Dialog.Rect(0,0,0,0),i&&5>i&&(i=5),r=r?" "+r:"",this.dispose=function(){y=!0,P&&(e(window).unbind("resize",P),P=null),T&&(e(window).unbind("focus",T),T=null),I.remove(),I=e(),x.remove(),x=e(),v=null,p=null,m=null,f=null,g=null,e(window).unbind(".ext",u)},this.setContents=function(i){I.remove(),I=e(),D=i;var n=D.parentNode;null!=n&&null!=n.tagName||(C.appendChild(D),I=I.add(e(D)));var o={"aria-hidden":"true"},s=null;$B.RE_WebKit?s="input":(s="a",o.href="#"),f=w.createElement(s),g=w.createElement(s);var u=e(f).attr(o).css("position","absolute"),c=e(g).attr(o).css("position","absolute");if((void 0===a||a)&&(u.bind("focus",l),c.bind("focus",l)),I=I.add(u),I=I.add(c),e(D).prepend(u).append(c),$B.RE_WebKit){var h="-10000px";S?g.style.right=f.style.right=h:g.style.left=f.style.left=h}return D.style.position="absolute",D.className+=r,!t&&$B.IE&&$B.V<7&&(E=new $UI.FramePopup),d(),D},this.recalc=function(t){if(D){s();var r=e(D);if(!n){var o=$UI.Dialog.getLocation(D);if(!o||o.isEmpty()){var a={visibility:r.css("visibility")||"visible",display:r.css("display")||"auto"};r.css({visibility:"hidden",display:"block"}),o=$UI.Dialog.getLocation(D),r.css(a)}$Debug.trace("recalc",Object.toJSON(o)),_.dock||(_.dock=new $UI.Dialog.Rect(0,0,0,0));var l=b.clientWidth/2-o.width/2;if(S?(_.dock.x=Math.min(l,0-(o.width-b.clientWidth)-25),$B.RE_WebKit&&(_.dock.x+=k.scrollWidth-b.clientWidth)):_.dock.x=Math.max(l,25),t){var d=b.clientHeight-o.height-3;_.dock.y=k.scrollTop+Math.min(Math.max(d>200?d:(b.clientHeight-o.height)/2,0),100)}$Debug.trace("dockbefore",Object.toJSON(_.dock)),_.dock.height=o.height,_.dock.width=o.width}var u=null;null!==_.dock.y&&(u={top:_.dock.y}),null!==_.dock.x&&(u=u||{},u.left=_.dock.x),u&&r.css(u),E&&E.positionAt(_.dock,i?1e3:i-2)}},this.show=function(n,o,d){function u(){try{(n?n:$UI.Dialog.findFocusableElement(D)).focus()}catch(e){}}_.recalc(!0);var h=e(D);if(h.show(),i&&h.css("z-index",i),t){$Debug.trace("Creating Modal Dialog"),p=w.createElement("div"),c(),m=w.createElement("div");var f=e(m).addClass("UI_Dialog_ZoomTest"+r);T=function(e){return e.stopImmediatePropagation(),!1};var g=e(p).attr("id","UI_Dialog_BG").addClass("UI_Dialog_BG"+r).bind({click:T,mousedown:T,keydown:T,keypress:T,dblclick:T});(void 0===a||a)&&g.bind("focus",l),i&&g.css("z-index",i-1),C.appendChild(p),C.appendChild(m),P=function(){setTimeout(s,0)},e(window).bind({resize:P,focus:T}),x=x.add(g),x=x.add(f),s()}o||(d=d||e.when(),d.then(function(){setTimeout(u,10)}))},this.hide=function(){if(x.remove(),x=e(),$B.IE&&$B.V<7&&v){for(var t=0;t<v.length;t++)"undefined"!=typeof v[t].wlppHide&&(v[t].style.visibility=v[t].wlppHide);v=null}},this.minimize=function(){if(E&&E.minimize(),D.style.visibility="hidden",t){if(p.style.display="none",v)for(var e=0;e<v.length;e++)v[e].style.visibility=v[e].wlppHide;s()}s()},this.restore=function(){D.style.visibility="visible",E&&E.restore(),_.recalc(!0),t&&(p.style.display="block",c(),s())}},window.$UI.Dialog.Rect=function(e,t,i,n){return new function(){var r=this;this.x=e,this.y=t,this.width=i,this.height=n,this.isEmpty=function(){return r.width<=0||r.height<=0}}},window.$UI.Dialog.findFocusableElement=function(t,i,n){function r(t){var i=e(t),n=i.attr("tabindex");if("-1"===n)return!1;if(i.is(".CloseX")&&i.is(":visible")&&0===i.parents(":hidden").length)return!0;var r="|BUTTON|TEXTAREA|FIELDSET|IFRAME|SELECT|";return t.tagName&&!t.disabled&&(r.indexOf("|"+t.tagName+"|")>-1||"A"==t.tagName&&t.href&&-1==t.className.indexOf("CloseX")||"INPUT"==t.tagName&&"hidden"!=t.type.toLowerCase()&&(!$B.Firefox||"file"!=t.type.toLowerCase()))&&e(t).is(":visible")}function o(e){if(!e)return null;for(var t=n?e.nextSibling:e.previousSibling;t&&1!=t.nodeType;)t=n?t.nextSibling:t.previousSibling;return t?t:o(e.parentNode)}function a(t,i){var a=i;if(a&&(a==t||e.contains(t,a)))for(;null!=a;){if(r(a))return a;a=n&&a.firstChild?a.firstChild:!n&&a.lastChild?a.lastChild:o(a)}return null}i=i?o(i):t;var s=a(t,i);return!s&&i&&i!=t?a(t,t):s},window.$UI.Dialog.getLocation=function(e){if(!e)return new $UI.Dialog.Rect(0,0,0,0);for(var t=0,i=0,n=e;n;)t+=n.offsetLeft,i+=n.offsetTop,n=n.offsetParent;return new $UI.Dialog.Rect(t,i,e.offsetWidth,e.offsetHeight)},window.$UI.Popover=function(){function t(){try{_.focus()}catch(e){}}function i(){var t=e(w.modal?$B.IE?"body":window:v);$B.IE?t.bind("keypress.showhide",o):t.bind("keydown.showhide",o),b=b.add(t)}function n(){var t=e(w.modal?$B.IE?"body":window:v);t.unbind(".showhide",o)}function r(t,i,n,r){e("<span />").text(" ").appendTo(e(m));var o=_ce("div");e(o).html('<button id="popover_btn_{0}" type="{1}" />'.format(t,n?"submit":"button"));var s=e(o.firstChild).toggleClass("Default",n).html("<nobr>"+i+"</nobr>").bind("click",function(e){a(t),e.stopPropagation()});C=C.add(e(s)),!n&&r&&(f=t),g[t]=s,e(s).appendTo(e(m))}function o(e){switch(e.which){case 27:a(f?f:"$cancel"),e.stopPropagation()}}function a(e){var t=!0;S&&(t=S(w,e)),t&&w.hide()}function s(){function t(t,i){if(t){var n=e(i);"string"==typeof t?n.html(t):n.html("").append(t)}}if(e(d).toggle(w.showHeader),e(c).toggle(w.showFooter),e(h).toggle(w.showCloseX).bind("click",function(){return a(f?f:"$cancel"),!1}),w.showCloseX){var i=GetString("live.shared.skydrive.pc.Sharing.Close");e(h).append(wLive.Core.ImageStrip.getImage("close",i,i))}w.bodyPadding||e(u).css("padding","0px"),t(w.header,p),t(w.body,u)}this.header=null,this.body=null,this.footerText=null,this.width=300,this.bodyPadding=!0,this.showHeader=!0,this.showFooter=!0,this.modal=!1,this.showCloseX=!1,this.zIndex=null,this.dispose=function(){l&&(l.dispose(),l=null)},this.addButton=function(e,t,i,n){k.push({name:e,value:t,isDefault:i,isCancel:n})},this.show=function(t,n,o,a){if(!y){if(S=t,_=n,!l){l=new $UI.Dialog(w.modal,w.zIndex),v=_ce("div");var C=e(v).hide().html('<a href="#"></a><div><h3></h3></div><div></div><div><nobr></nobr></div>');l.setContents(v),i(),C.addClass("UI_Popover");var b=v.childNodes;if(h=b[1],d=b[2],u=b[3],c=b[4],p=d.firstChild,m=c.firstChild,e(h).addClass("CloseX"),e(d).addClass("Header"),e(u).addClass("Body"),e(c).addClass("Footer"),null!=w.width){var I=w.width;C.css("width",parseInt(I,10)==I?I+"px":I)}f=null,g=new Array;for(var x=0;x<k.length;x++)r(k[x].name,k[x].value,k[x].isDefault,k[x].isCancel);0==k.length&&(w.showFooter=!1),s()}l.show(o?g[o]:null,a),y=!0}},this.hide=function(){if(y){_&&setTimeout(t,10);try{e(h).unbind("click"),b.unbind(".showhide",o),b=e(),C.remove(),C=e(),l.hide(),this.dispose()}catch(i){}y=!1,v=h=d=c=u=p=m=g=null}},this.enableButton=function(t){e(g[t]).attr("disabled",!1)},this.disableButton=function(t){e(g[t]).attr("disabled",!0)},this.recalc=function(){y&&l&&l.recalc(!1)},this.minimize=function(){l&&y&&(l.minimize(),n())},this.restore=function(){l&&y&&(l.restore(),i())};var l,d,u,c,h,p,m,f,g,v,y=!1,w=this,C=e(),b=e(),k=new Array,S=null,_=null}}(window.originaljQuery||jQuery)}),define("popover.msgbox",["popover"],function(){$UI.MsgBoxEx=function(e,t,i,n,r,o,a,s,l){var d="ok",u="cancel",c=new $UI.Popover,h=_ce("div"),p=function(e,t){var i=!0;return t==d?0==r({Popover:e})&&(i=!1):t==u&&o&&o(),i&&(c=null),i};if(a)for(var m=temp=a,f=0;10>f&&temp;f++){var g=temp.tagName&&temp.tagName.toLowerCase();if("a"==g||"button"==g||"input"==g){m=temp;break}if(temp=temp.parentElement,!temp){m=null;break}}return t&&(h.innerHTML='<div style="margin-bottom:10px">'+t+"</div>"),c.width=s?s:"416px",c.header=e,c.body=h,c.modal=!0,0!=i&&c.addButton(d,i,!0,!1),0!=n&&c.addButton(u,n,!1,!0),c.show(p,m,l?u:d),c},$UI.MsgBox=function(e,t,i,n,r,o){$UI.MsgBoxEx(e,t,i,n,o,null,r,null,!1)}}),define("queuing",["wliveloaded","popover.msgbox","jquery.views"],function(){!function(e){"use strict";var t=wLive.Controls.Notifications=wLive.Controls.Notifications||{},i=new function(){var t=this,i={},n=[];t.showDelay=600,t.start=function(){if(n){var e=n,t=e.length;n=null;for(var i=0;t>i;i++)e[i]()}},t.addNotification=function(e,r,o){if(n)n.push(function(){t.addNotification(e,r,o),t.showNextNotification(o.queueGroup)});else{var a=o.queueGroup||"default",s=o.queueMode||"fifo",l=o.queueTrumpLowPriOnScreen||{},d=!!o.queueIsPriorityHigh,u=i[a]=i[a]||{current:null,items:[]},c=u.items.length;if(0!==c&&d)for(c=0;c<u.items.length&&u.items[c].queueIsPriorityHigh;c++);u.items.splice(c,0,{mode:s,notification:e,queueTrumpLowPriOnScreen:l,queueIsPriorityHigh:d,callback:r})}},t.showNextNotification=function(e){var t,n,r=i[e],o=function(e){var t,i,n,r=e.length,o={mode:null,item:null};for(t=0;r>t&&(i=e[t],n=o.mode=i.mode,o.item=i,"fifo"!==n);t++);return o.item};r&&r.items.length>0&&(t=r.current,n=r.items,t&&"filo"===t.mode&&n.length>1&&t.queueTrumpLowPriOnScreen&&(t.notification.hide(),t=null),t||(t=r.current=o(n),t.callback()))},t.removeNotification=function(n){e.each(i,function(e,i){for(var r=i.items,o=!1,a=r.length-1;a>=0;a--)if(r[a].notification===n){r[a]===i.current&&(i.current=null),r.splice(a,1),o=!0;break}o&&setTimeout(function(){t.showNextNotification(e)},t.showDelay)})},t.reset=function(){e.each(i,function(e,t){for(var i,n=t.items,r=n.length-1;r>=0;r--)i=n[r],i===t.current?i.notification.dismiss():n.splice(r,1)})},t.registerSearchApi=function(n,r){t[n]=function(t){var n,o,a,s,l,d,u,c=[];for(t=t||function(e){return!0},n=r&&0!==r.length?e.map(r,function(e,t){return i[e]}):i,o=n.length,d=0;o>d;d++)for(s=n[d].items,l=s.length,u=0;l>u;u++)a=s[u].notification,t(a)&&c.push(a);return c}}};t.getQueue=function(){return i},t.dispose=function(){i&&(i.reset(),i=null)}}(window.originaljQuery||jQuery)}),define("automation",["queuing"],function(){!function(e){"use strict";var t=wLive.Controls.Notifications;t.AutomationOptions=new function(){var e,t,i=this;i.setModeAndLabels=function(i,n){e=i,t=n},i.getLabelAttribute=function(){return e},i.getLabelValue=function(i){var n;return e&&""!==e&&t&&(n=t[i]),n},i.getLabel=function(i,n){var r,o="",a=function(e){return(n?n[e]:null)||t[e]};return e&&""!==e&&t&&(r=a(i))&&""!==r&&(o=" "+e+'="'+r+'" '),o}}}(window.originaljQuery||jQuery)}),define("notificationbase",["automation"],function(){!function(e){"use strict";var t=27,i=13,n=9,r=wLive.Animations,o=wLive.Controls.Notifications,a=e(o),s=o.InternalTools=o.InternalTools||{},l=o.AutomationOptions,d=e(window),u=e("BODY"),c=u[0],h={fadein:"fadeIn",fadeout:"fadeOut",slidein:"showEdgeUI",slideout:"hideEdgeUI",slidefadein:"enterContent",slidefadeout:"exitContent",slidefadein2:"enterContent2",slidefadeout2:"exitContent2"},p=s.Toolkit={isEmptyString:function(e){return"undefined"==typeof e||null==e||""==e},checkEmptyArgument:function(e,t){if(p.isEmptyString(e))throw new Error(t)},getExtraDimensions:function(e){var t={},i=function(e){return parseInt(e)||0};return t.left=i(e.css("marginLeft"))+i(e.css("borderLeftWidth"))+i(e.css("paddingLeft")),t.right=i(e.css("marginRight"))+i(e.css("borderRightWidth"))+i(e.css("paddingRight")),t.width=t.left+t.right,t.top=i(e.css("marginTop"))+i(e.css("borderTopWidth"))+i(e.css("paddingTop")),t.bottom=i(e.css("marginBottom"))+i(e.css("borderBottomWidth"))+i(e.css("paddingBottom")),t.height=t.top+t.bottom,t},sanitizeOptions:function(t,i){var n=null;if(t){var r={};e.each(t,function(t,n){e.inArray(t,i)>=0&&(r[t]=n)}),n=r}return n},registerChangeUserOptionsApi:function(t,i,n){var r=function(t){e.extend(i,p.sanitizeOptions(t,n))};o["set"+t+"DefaultOptions"]=r},isLtr:function(){return"ltr"===e("BODY").css("direction")}},m=s.ButtonHelper=function(t,i){var n=this,r=[],o=e.extend({action:!1,close:!1,alternate:!1},i&&i.excludes?i.excludes:{}),a=i&&i.renderOrder?i.renderOrder.split(","):m.buttonNames;!function(){var e,i,n,s;if(t)for(s=a.length,n=0;s>n;n++)e=a[n],i=t[e],!o[e]&&i&&"string"==typeof i&&""!==i&&r.push({name:e,title:i})}(),n.getNamesAndTitles=function(){return r}};m.buttonNames=["action","close","alternate"],m.automationKeys={},e.each(m.buttonNames,function(e,t){m.automationKeys[t]=t.charAt(0).toUpperCase()+t.substr(1)+"Button"}),s.DeferredManager=function(t,i){function n(){o=i?i():{}}var r=this,o=null,a=null;n(),r.getDeferred=function(){return a=a||e.Deferred()},r.updateState=function(t){t&&"object"==typeof t&&(o=e.extend({},o,t))},r.resolve=function(){a&&(a.resolveWith(t,[o]),a=null),n()}};var f=s.TemplateHelper={basicContainer:'<div><div tabindex="-1" class="OuterContainer" {{if backgroundColor}}style="background-color: {{attr:backgroundColor}};"{{/if}}><div class="InnerContainer"><div class="Content {{attr:contentCssClassnames}}">{0}</div></div></div></div>',defaultPartialTemplate:'{{for #data tmpl="Notifications.UserAreaSubTemplate"/}}{{for #data tmpl="Notifications.ButtonSubTemplate"/}}',registerTemplate:function(t){var i=t.html||f.defaultPartialTemplate;i=f.basicContainer.format(i),e.templates(t.id,{markup:i})},render:function(t,i,n,r,o){var a=t.options.automationOptions,d=e.extend({contentCssClassnames:"",renderTitle:!0,showNotificationArea:!1,shouldRenderButtonArea:function(){return this.showNotificationArea&&r||this.buttons.length>0},prepareForAutomation:function(e){return l.getLabel(e,a)},buttons:e.map(o.getNamesAndTitles(),function(t){return e.extend({getButtonLabel:function(){return l.getLabel(s.ButtonHelper.automationKeys[this.name],a)}},t)})},t.options);p.isEmptyString(i)&&d.renderTitle&&(d.renderTitle=!1);var u=e.views,c=u.activeViews;u.activeViews=!1;var h=e.templates[t.id].render(d);u.activeViews=c;var m=e(h);return m.find(".UserTitle").append(i),m.find(".UserContent").append(n),d.showNotificationArea&&!p.isEmptyString(r)&&m.find(".NotificationArea").append(r),m}};e.templates("Notifications.ButtonSubTemplate",{markup:'{{if shouldRenderButtonArea()}}<div class="ButtonArea">{{if showNotificationArea}}<div class="NotificationArea" {{:prepareForAutomation("NotificationArea")}}></div>{{/if}}{{for buttons}}<button name="{{attr:name}}" type="button" {{if name=="action"}}class="default c_nobdr"{{/if}} {{:getButtonLabel()}}>{{>title}}</button>{{/for}}</div>{{/if}}'}),e.templates("Notifications.UserAreaSubTemplate",{markup:'<div class="UserArea"><div class="Clipper">{{if renderTitle}}<div class="UserTitle{{if titleCssClassnames}} {{attr:titleCssClassnames}}{{/if}}" {{:prepareForAutomation("Title")}}></div>{{/if}}<div class="UserContent" {{:prepareForAutomation("Contents")}}></div></div></div>'});var g=s.TimerHelper=function(e,t,i){var n,r,o,a=this,s=function(){n=null,t()},l=function(){o||(o=new Date,clearTimeout(n),n=null)},d=function(){if(o&&r){var t=e-(o-r);o=null,r=new Date,n=setTimeout(s,t)}},u={mouseenter:l,mouseleave:d};a.start=function(){e&&(e=parseInt(e))>0&&i&&i.length>0&&(i.bind(u),r=new Date,n=setTimeout(s,e))},a.stop=function(){n&&(i.unbind(u),clearTimeout(n),n=null)}},v=s.NotificationBase=function(m){function y(){var t=e.extend({},pe.ariaOptions);null===pe.tabIndex||isNaN(pe.tabIndex)||(t.tabindex=pe.tabIndex),se.attr(t)}function w(e){var t=e?"show":"hide";se&&(se[t](),se.attr("aria-hidden",!e),null!=le&&le[t]())}function C(e,t,i){return i=i||[ue],a.triggerHandler(e+m.name+t,i)}function b(e,t){return t=t||[ue],ce.triggerHandler(e,t)}function k(e,t,i){var n=e?e[t]:null;n&&"function"==typeof n&&n.apply({},i||[])}function S(){var t=l.getLabelValue(pe.automationKey);t&&e(ae).attr(l.getLabelAttribute(),t)}function _(){if(se){var e=l.getLabelAttribute();if(e){var t="automationtemp",i=se.attr(t);if(i&&""!==i)se.attr(e,i),se.attr(t,"");else{var n=se.attr(e);n&&""!==n&&(se.attr(t,n),se.attr(e,""))}}}}function I(){fe.timeoutInMsecs&&(ge=new g(fe.timeoutInMsecs,fe.callback,fe.getElements()),ge.start())}function x(){ge&&(ge.stop(),ge=null)}function D(){if(oe&&ae&&!re&&m.positioner){m.positioner(oe.dock,ae,pe.anchorElement,pe,he);var e=oe.dock,t=null;null!==e.y&&(t={top:e.y}),null!==e.x&&(t=t||{},t.left=e.x),t&&se.css(t)}}function E(t){var i,n,o,a,s=pe.animation||{},l=s.type||"none",d=s.entranceType||l+"in",u=s.exitType||l+"out",c=[ae];if(le&&le.length>0&&c.push(le[0]),t?(i=d,s.entranceArguments&&(n=e.isArray(s.entranceArguments)?e.extend(!0,[],s.entranceArguments):e.extend(!0,{},s.entranceArguments))):(i=u,s.exitArguments&&(n=e.isArray(s.exitArguments)?e.extend(!0,[],s.exitArguments):e.extend(!0,{},s.exitArguments))),o=h[i]){var p=[c];"undefined"!=typeof n&&p.push(n),p.push(!1),a=r[o].apply({},p)}else a=e.Deferred().resolve();return a}function P(){var e=$UI.Dialog.findFocusableElement(ae,ae,!0);e&&setTimeout(function(){try{e.focus()}catch(t){}},0)}function T(e){be||!e||$(e,ae)||P(),be=!1}function A(e){var r=e.which;if(null!=se&&!re)if(pe.dismissOnEsc&&r===t||!ke&&pe.dismissOnEnter&&r===i){var o=r===t?"close":"action";ie.changeAnimation(!1,"none"),e.stopImmediatePropagation(),se.find(".ButtonArea button[name="+o+"]").length>0&&(ve.updateState({buttonClicked:o}),b("buttonclick",[ue,o])),setTimeout(function(){ue.dismiss()},0)}else r===n?(T(e.srcElement),Ce||(se.find("BUTTON.default.c_nobdr").removeClass("c_nobdr"),Ce=!0)):be=!0;ke=!0}function L(e){T(e.srcElement)}function F(){se&&((pe.dismissOnEsc||pe.dismissOnEnter)&&se.keydown(A),pe.isModal&&(u.keydown(A),u.focusin(L)))}function M(){se&&((pe.dismissOnEsc||pe.dismissOnEnter)&&se.unbind("keydown",A),pe.isModal&&(u.unbind("keydown",A),u.unbind("focusin",L)))}function N(t){var i,n=t&&t.srcElement&&t.srcElement.name||e(this).attr("name");ie.changeAnimation(!1,"none"),t.stopPropagation(),ve.updateState({buttonClicked:n}),i=e(ue).triggerHandler("buttonclick",[ue,n]),i!==!1&&he.dismissOnButtonClick&&ue.dismiss()}function U(){se&&se.find(".ButtonArea button").bind("click.notification",N)}function R(){se&&se.find(".ButtonArea button").unbind("click.notification",N)}function O(){d.bind({"resize.nbwindowchanged":H,"scroll.nbwindowchanged":H})}function B(){d.unbind(".nbwindowchanged",H)}function H(){re||(B(),D(),O())}function j(){return _ge("UI_Dialog_BG")||c}function W(){if(pe.dismissOnOutsideClick){var t=j(),i=(e(t),function(){t.addEventListener?t.addEventListener("click",V,!0):(t.attachEvent("onclick",V),!_ge("UI_Dialog_BG")&&c.setCapture&&(c._capturingClicks=!0,c.attachEvent("onlosecapture",q),G())),we=null});pe.delayOutsideClickDetectionByMsecs<=0?i():we=setTimeout(i,pe.delayOutsideClickDetectionByMsecs)}}function Q(){var t=j();e(t);pe.dismissOnOutsideClick&&(null!=we&&(clearTimeout(we),we=null),t.removeEventListener?t.removeEventListener("click",V,!0):(t.detachEvent("onclick",V),!_ge("UI_Dialog_BG")&&t.releaseCapture&&(t._capturingClicks=!1,t.detachEvent("onlosecapture",q),t.releaseCapture())))}function $(e,t){for(var i=!1;e;)e===t?(e=null,i=!0):e=e.parentElement;return i}function V(e){re||e._alreadyCaptured||(FilesConfig&&FilesConfig.NextLegacyBundleEnabled&&Shared.ElementEventing.raise(window,"modalDialogClosed"),$(e.srcElement||e.target,ae)||ue.dismiss(),!c.addEventListener&&c.setCapture&&(e._alreadyCaptured=!0,e.srcElement.click(),c._capturingClicks&&G()),e._alreadyCaptured&&(e._alreadyCaptured=!1))}function q(){if(u){var e=u[0];e.attachEvent("onmousemove",z),de=!1}}function G(){u&&(u[0].setCapture(!0),de=!0)}function z(){u&&(G(),u[0].detachEvent("onmousemove",z))}function K(e){P()}function J(){pe.insideClickFocus&&se&&se.click(K)}function X(){pe.insideClickFocus&&se&&se.unbind("click",K)}function Y(e){e.stopImmediatePropagation(),e.preventDefault(),pe.dismissOnOutsideClick&&Z(e)}function Z(e){e&&e.srcElement&&!$(e.srcElement,ae)&&ue.dismiss()}function ee(){le&&pe.isModal&&le.bind("contextmenu",Y),u&&pe.dismissOnOutsideClick&&u.bind("contextmenu",Z)}function te(){le&&pe.isModal&&le.unbind("contextmenu",Y),u&&pe.dismissOnOutsideClick&&u.unbind("contextmenu",Z)}var ie=this,ne=(e(ie),!1),re=!1,oe=null,ae=null,se=null,le=null,de=!1,ue=m.instance,ce=e(ue),he=e.extend({},v.defaultUserOptions,m.userOptions),pe=e.extend({},v.defaultControlOptions,m.controlOptions),me=m.render=m.render||{},fe=m.timer=m.timer||{},ge=null,ve=new s.DeferredManager(ue),ye=new s.ButtonHelper(me.buttons,me.buttonOptions),we=null,Ce=!1,be=!1;me.template=me.template||{},me.template.options=me.template.options||{},me.template.options.automationOptions=p.sanitizeOptions(he.automation,["ActionButton","CloseButton","AlternateButton","Title","Contents"]),ie.changeAnimation=function(e,t,i){if(pe.changeAnimationOnUserInteraction){var n=e?"entrance":"exit";pe.animation[n+"Type"]=t,"undefined"!=typeof i&&(pe.animation[n+"Arguments"]=i)}},ie.popoverElement=function(){return ae},ie.isCurrentlyShown=function(){return ne&&!re},ie.isHidden=function(){return re},ie.getButton=function(e){var t,i=null;if(!e||""==(t=e.buttonName+""))throw new Error("buttonName was not supplied.");return se&&(i=se.find(".ButtonArea BUTTON[name="+t+"]")),i},ie.getDeferredManager=function(){return ve},ie.reposition=function(){oe&&(D(),oe.recalc())},ie.hide=function(){oe&&!re&&(C("before","hide"),b("beforehide"),re=!0,oe.minimize(),_(),C("after","hide"),b("afterhide"))},ie.dismiss=function(e){var t,i=function(){o.getQueue().removeNotification(ue),pe.anchorElement=pe.focusElement=null};if(oe){if(t=C("before","dismiss"),t===!1)return;if(t=b("beforedismiss"),t===!1)return;k(e,"beforeDismiss"),M(),R(),X(),Q(),B(),te(),x(),E(!1).then(function(){if(oe){if(oe.hide(),t=C("after","dismissanimation"),t===!1)return;if(t=b("afterdismissanimation"),t===!1)return;if(se.remove(),ae=null,se=null,oe.dispose(),oe=null,le=null,t=C("after","dismiss"),t===!1)return;if(t=b("afterdismiss"),t===!1)return;ve.resolve(),i(),ne=!1;var e;he.returnFocusTo&&(e=he.returnFocusTo.focus)&&"function"==typeof e&&he.returnFocusTo.focus()}})}else i()},ie.show=function(t){var i,n=o.getQueue(),r=ve.getDeferred(),a=!1;return oe?re&&oe.restore():(n.addNotification(ue,function(){if(oe&&re)_(),oe.restore(),re=!1;else if(!oe&&(i=C("before","render"),i!==!1&&(i=b("beforerender"),i!==!1))){var n=f.render(me.template,me.title,me.content,me.notificationArea,ye);if(he.focusFirstButton&&ye.getNamesAndTitles().length>0?pe.focusElement=n.find(".ButtonArea BUTTON").first()[0]:he.focusElement?pe.focusElement=he.focusElement:pe.focusElement=n.find(".OuterContainer").get(0),k(t,"afterRendering",[n]),pe.anchorElement=pe.anchorElement||window,he.moreCss=he.moreCss||"",oe=new $UI.Dialog(!!pe.isModal,pe.dialogZindex,!!m.positioner,"NotificationBase "+pe.controlCss+" "+he.moreCss,pe.anchorElement,pe.trapTab),n.appendTo(he.notificationContainer||"#notificationContainer"),ae=oe.setContents(n[0]),se=e(ae),isNaN(pe.tabIndex)||se.attr("tabindex",pe.tabIndex),y(),D(),k(t,"beforeShow"),i=C("before","show"),i!==!1&&(i=b("beforeshow"),i!==!1)){F(),U(),I(),S();var r=e.Deferred();oe.show(pe.focusElement,!pe.setFocus,r),pe.isModal&&(le=e("#UI_Dialog_BG")),w(!1),E(!0).then(function(){a||(a=!0,r.resolve(),w(!0),k(t,"afterShow"),setTimeout(function(){oe&&(W(),O(),J(),ee())},0),b("aftershow"),i=C("after","show"),ne=!0)})}}},pe),n.showNextNotification(pe.queueGroup)),r.promise()},ue.content=ie.popoverElement,ue.isCurrentlyShown=ie.isCurrentlyShown,ue.isHidden=ie.isHidden,ue.getButton=ie.getButton,ue.show=function(){return ie.show()},ue.dismiss=function(){ie.dismiss()},ue.hide=ie.hide,ue.reposition=ie.reposition;var ke=!1};v.defaultControlOptions={anchorElement:null,ariaOptions:{role:"alert","aria-hidden":"false"},automationKey:null,changeAnimationOnUserInteraction:!0,controlCss:null,dismissOnEnter:!1,dismissOnEsc:!0,dismissOnOutsideClick:!1,delayOutsideClickDetectionByMsecs:0,focusElement:null,insideClickFocus:!1,isModal:!1,returnFocusTo:null,setFocus:!1,trapTab:!0,tabIndex:null,queueGroup:null,queueMode:"fifo",queueTrumpLowPriOnScreen:!1},v.defaultUserOptions={dismissOnButtonClick:!0,focusFirstButton:!1,moreCss:null}}(window.originaljQuery||jQuery)}),define("notificationbar",["notificationbase"],function(){!function(e){"use strict";var t=window.wLive,i=t.Controls.Notifications,n=(e(i),i.AutomationOptions,i.InternalTools),r=n.Toolkit,o="Notifications.Bar";n.TemplateHelper.registerTemplate({id:o,html:'{{for #data tmpl="Notifications.UserAreaSubTemplate"/}}{{for #data tmpl="Notifications.ButtonSubTemplate"/}}<div class="Expand" {{:prepareForAutomation("ToggleExpansion")}}></div>'});var a="#c_header",s=860,l=120,d=function(t,i,n,o,a,d){var u=e("HTML"),c=e("BODY"),h=e(i),p=h.find(".InnerContainer"),m=p.find(".Content"),f=r.isLtr(),g=Math.max(p.outerWidth(),s),v=m.find(".UserArea"),y=r.getExtraDimensions(v),w=y.width,C=v.find(".Clipper"),b=v.find(".UserContent"),k=m.find(".ButtonArea"),S=k.outerWidth()||0,_=m.find(".Expand");m.width("").addClass("ForMeasure").removeClass("MinWidth NormalWidth WideWidth"),v.width("").addClass("ForMeasure"),_.removeClass("ShowImage").hide(),C.removeClass("ShowEllipsis"),b.addClass("ForMeasure").width("");var I=(m.outerWidth()||0,b.outerWidth()||0),x=g-w-S,D=I+w+S;if(s>D)x=s-w-S,v.width(x),m.addClass("MinWidth");else{var E=g-D>l,P=!E&&I>=x;if(E?(m.width(D),m.addClass("WideWidth")):(x-=l,P=I>=x,m.addClass("NormalWidth")),P){var T="margin"+(f?"Right":"Left");_.css(T,S).addClass("ShowImage").show(),C.addClass("ShowEllipsis"),x-=_.outerWidth(),b.width(x)}v.width(x)}if(0===S&&m.addClass("NoButton"),p.css("left",-(u.scrollLeft()+c.scrollLeft())),d){var A=e(a.topBarOffsetJquerySelector);if(A.length>0){var L=$UI.Dialog.getLocation(A[0]);t.y=L.height}}else h.css("bottom","0"),t.y="";b.removeClass("ForMeasure"),v.removeClass("ForMeasure"),m.removeClass("ForMeasure")},u={Top:{controlOptions:{animation:{entranceType:"slidein",entranceArguments:[{left:0,top:-50}],exitType:"slideout",exitArguments:[{left:0,top:-50}]},automationKey:"TopBar",controlCss:"NotificationBar TopBar",insideClickFocus:!0,queueGroup:"TopBar"},positioner:function(e,t,i,n,r){d(e,t,i,n,r,!0)}},Bottom:{controlOptions:{animation:{entranceType:"slidein",entranceArguments:[{left:0,top:50}],exitType:"slideout",exitArguments:[{left:0,top:50}]},automationKey:"BottomBar",controlCss:"NotificationBar BottomBar",insideClickFocus:!0,queueGroup:"BottomBar"},positioner:d}},c=i.BarDismissalMode={Explicit:"Explicit",Implicit:"Implicit",Timeout:"Timeout"},h={};h[c.Explicit]={controlOptions:{queueMode:"filo"}},h[c.Implicit]={controlOptions:{dismissOnOutsideClick:!0,delayOutsideClickDetectionByMsecs:1e3}},h[c.Timeout]={controlOptions:{dismissOnOutsideClick:!0,delayOutsideClickDetectionByMsecs:1e3}};var p=function(t,i,s,l,d){function m(){e(I.popoverElement()).find(".Expand").click(g)}function f(){e(I.popoverElement()).find(".Expand").unbind("click",g)}function g(){var t=e(I.popoverElement()).find(".Content"),i=t.hasClass("Collapsed"),n=t.find(".Clipper"),r=t.find(".UserContent");return n.toggleClass("ShowEllipsis"),i?(n.css("height",r.css("height")),t.removeClass("Collapsed")):(n.css("height",""),t.addClass("Collapsed")),I.reposition(),!1}function v(){var t=e(I.popoverElement()),i=t.find(".UserArea"),n=i.find(".Clipper"),r=i.find(".UserContent"),o=t.find(".Expand"),a=n.innerHeight(),s=r.innerHeight();s>a?(o.addClass("ShowImage"),n.addClass("ShowEllipsis")):o.attr("sutra","")}r.checkEmptyArgument(i,"Dismissal mode was not supplied.");var y=this,w=e(y),C=h[i];r.checkEmptyArgument(C,"Dismissal mode was supplied but is invalid."),r.checkEmptyArgument(t,"Mode was not supplied.");var b=u[t];if(r.checkEmptyArgument(b,"Mode was supplied but is invalid."),b===u.Top&&i===c.Implicit)throw new Error("Top bars cannot be dismissed implictly.");if(i===c.Explicit&&r.isEmptyString(l.action)&&r.isEmptyString(l.close)&&r.isEmptyString(l.alternate))throw new Error("An explict dismissable bar should contain at least one button.");var k=e.extend({trapTab:!1},C.controlOptions,b.controlOptions,p.defaultControlOptions),S=e.extend({},p.defaultUserOptions,d);r.isEmptyString(S.topBarOffsetJquerySelector)&&(S.topBarOffsetJquerySelector=a);var _={name:"bar",instance:y,controlOptions:k,userOptions:S,positioner:b.positioner,render:{content:s,buttons:l,buttonOptions:{renderOrder:"action,alternate,close"},template:{id:o,options:{contentCssClassnames:S.autoHeight?"":"Collapsed",backgroundColor:S.backgroundColor,renderTitle:!1}}}};i===c.Timeout&&(_.timer={timeoutInMsecs:7e3,callback:function(){I.getDeferredManager().updateState({timedOut:!0}),w.triggerHandler("timedout",[y]),I.changeAnimation(!1,"fadeout"),y.dismiss()},getElements:function(){var t=e(I.popoverElement());return e().add(t).add(t.children()).add(t.find(".UserContent").children()).add(t.find(".ButtonArea BUTTON")).add(t.find(".Expand"))}});var I=new n.NotificationBase(_);y.barType=function(){return t},y.dismissalMode=function(){return i},y.show=function(){return I.show({beforeShow:function(){var n=e(I.popoverElement());"Bottom"===t&&i!==c.Timeout&&n.find(".InnerContainer").addClass("WithMinWidth"),n.find(".Clipper").addClass("transitionOnHeightChange"),v(),m()}})},y.dismiss=function(){I.dismiss({beforeDismiss:function(){f()}})}};p.defaultUserOptions={autoHeight:!1,focusFirstButton:!1,topBarOffsetJquerySelector:null},p.defaultControlOptions={queueTrumpLowPriOnScreen:!0,tabIndex:0};var m=function(e,t){if(!t)throw new Error("No parameters were supplied.");return new p(e,t.dismissalMode,t.content,t.buttons,t.options)};i.createTopBar=function(e){return m("Top",e)},i.createBottomBar=function(e){return m("Bottom",e)},r.registerChangeUserOptionsApi("Bar",p.defaultUserOptions,["autoHeight","topBarOffsetJquerySelector","moreCss","notificationContainer"]),i.getQueue().registerSearchApi("getNotificationBars",[u.Top.controlOptions.queueGroup,u.Bottom.controlOptions.queueGroup])}(window.originaljQuery||jQuery)}),define("flyout",["notificationbar"],function(){!function(e){"use strict";var t=window.wLive,i=t.Controls.Notifications,n=(i.AutomationOptions,i.InternalTools),r=n.Toolkit,o="Notifications.Flyout";n.TemplateHelper.registerTemplate({id:o});var a=50,s=1,l=2,d=4,u=25,c=function(t,i,h,p,m){function f(t,i,n,r,o){for(var a,s=S(n),l=e(i),d=l.find(".OuterContainer"),u=_(l),c=e(n),h=3;h-- >0&&(I(t,u,r),a=o.offset||_(c),v(t,u,a,s),x(t,l,u,a,!!o.offset,c,d)););var p=g(t,r,o,a,c);D(t,p,s)}function g(e,t,i,n,o){var s=i.offset?n.width:o.outerWidth(!0),l=i.offset?n.height:o.outerHeight(!0),d=parseInt(s/2+n.left),u=parseInt(l/2+n.top),c=parseInt(e.width/2+e.x),h=parseInt(e.height/2+e.y),p=0,m=0;m=P(h,u,a),p=P(c,d,r.isLtr()?a:-a);var f=t.animation.entranceArguments[0];return f.override||(f.left=p,f.top=m),f}function v(e,t,i,n){var r=e.width,o=e.height,a=o/2,s=i.top,l=i.left,d=i.height,u=i.width,c=d/2;e.x=l+u/2-r/2,e.y=s-o,A.verticalCenterOverrride&&(e.y=s+c-a),e.y<0&&(e.y=s+d),e.x<0?(e.x=l+u,e.y=s+c-a):e.x+r>n.width&&(e.x=l-r,e.y=s+c-a)}function y(t,i,n,o,a){var l,d=r.isLtr()?o.position:o.position^s,u=S(n),c=e(i),h=c.find(".OuterContainer");null!==a.bubble&&(h.addClass("Bubble{0}".format(d)),l=e("<div/>",{"class":"BubbleBeak"}).appendTo(c));for(var p,m=_(c),f=e(n),g=3;g-- >0&&(I(t,m,o),p=a.offset||_(f),d=w(t,m,u,p,d,h,c,o,null!==a.bubble),x(t,c,m,p,!!a.offset,f,h)););null!==a.bubble&&l.addClass("Beak{0}".format(d));var v=k(d,o);D(t,v,u)}function w(t,i,n,r,o,a,s,l,d){var u=o,c=2;do o!==u&&(d&&a.removeClass("Bubble{0}".format(o)).addClass("Bubble{0}".format(u)),e.extend(i,_(s)),I(t,i,l)),o=u,C(t,o,r),u=b(t,o,n);while(u!=o&&c-- >0);
return o}function C(e,t,i){var n=e.width,r=e.height,o=i.top,a=i.left,c=i.width,h=i.height,p=h/2,m=c/2,f=t&s,g=t&l;t&d?(e.x=f?a-n+m+u:a+m-u,e.y=g?o-r:o+h):(e.x=f?a-n:a+c,e.y=g?o-r+p+u:o+p-u)}function b(e,t,i){var n=t&s,r=t&l,o=t&d;return e.y<0?t=r?t^l:o?t:t^d:e.y+e.height>i.height&&(t=r?o?t:t^d:t^l),e.x<0?t=n?t^s:o?t^d:t:e.x+e.width>i.width&&(t=n?o?t^d:t:t^s),t}function k(e,t){var i=e&d?e&l?-1:1:0,n=e&d?0:e&s?-1:1,r=t.animation.entranceArguments[0];return r.override||(r.left=a*n,r.top=a*i),r}function S(e){var t=null,i=null,n=0,r=0;return e&&(t=e.document||e.ownerDocument)&&(i=t.documentElement,n=i.clientWidth,r=i.clientHeight),{width:n,height:r}}function _(e){var t=e.offset();return t.width=e.outerWidth(),t.height=e.outerHeight(),t}function I(e,t,i){e.width=Math.max(Math.min(t.width,i.maxWidth),i.minWidth),e.height=Math.max(Math.min(t.height,i.maxHeight),i.minHeight)}function x(t,i,n,r,o,a,s){var l=!0,d=t.width,u=t.height,c=r.top,h=r.left,p=s.outerWidth(),m=s.outerHeight(),f={top:t.y,left:t.x};d!=n.width&&(f.width=d),u!=n.height&&(f.height=u),i.css(f);var g=s.outerWidth(),v=s.outerHeight();if(o||e.extend(r,a.offset()),p!==g||m!==v){var y=v-m,w=g-p;n.width+=w,n.height+=y}else c===r.top&&h===r.left&&(l=!1);return l}function D(e,t,i){var n=e.y+e.height-i.height;n>0&&(0!==t.top&&(n+=a,t.top-=n),e.y-=n),e.y=Math.max(0,e.y)}function E(e,t,i){var n=0,r=e-t,o=Math.abs(r)>i;return o&&(n=r>0?1:-1),n}function P(e,t,i){var n=0,r=E(e,t,5);return r>0?n=-i:0>r&&(n=i),n}if(r.checkEmptyArgument(i,"No content was supplied"),null==h)throw new Error("No anchor was supplied.");var T=this,A=e.extend({},c.defaultUserOptions,m),L=e.extend({anchorElement:h},c.defaultControlOptions,m),F=A.positionMode,M=null!==A.bubble;M&&(L.controlCss+=" Bubble",F=A.bubble),L.position=F;var N=new n.NotificationBase({name:"flyout",instance:T,controlOptions:L,userOptions:A,positioner:-1!==F?y:f,render:{title:t,content:i,buttons:p,buttonOptions:{excludes:{dismiss:!0}},template:{id:o}}});T.show=function(){return N.show({beforeShow:function(){L.width&&e(N.popoverElement()).find(".UserContent").css({width:L.width})}})}};c.defaultUserOptions={bubble:null,positionMode:-1},c.defaultControlOptions={animation:{entranceType:"slidefadein",entranceArguments:[{left:0,top:0}],exitType:"fadeout"},ariaOptions:{role:"alertdialog"},automationKey:"Flyout",changeAnimationOnUserInteraction:!1,controlCss:"Flyout",dismissOnEnter:!0,dismissOnOutsideClick:!0,isModal:!0,maxHeight:758,maxWidth:510,minHeight:54,minWidth:70,position:-1,queueGroup:"Flyout",setFocus:!0,trapTab:!1,verticalCenterOverrride:!1,width:null},i.createFlyout=function(e){if(!e)throw new Error("No parameters were supplied.");return new c(e.title,e.content,e.anchor,e.buttons,e.options)},r.registerChangeUserOptionsApi("Flyout",c.defaultUserOptions,["moreCss","notificationContainer"]),i.getQueue().registerSearchApi("getFlyouts",[c.defaultControlOptions.queueGroup])}(window.originaljQuery||jQuery)}),define("getstring",[],function(){window.GetString=function(e){for(var t=this,i=e.toLowerCase().split("."),n=i.length,r=0;n>r;r++){var o=i[r];if(t=t[o],null==t)return""}return"object"==typeof t?t.___str:t.toString()}}),define("alehelpers",["registernamespace","dependancies","getstring"],function(){!function(){function e(e){return window.GetString?GetString(e):""}var t="live.shared.skydrive.",i="live.shared.strings.",n="live.shared.marketinfo.";wLive.Core.AleHelpers={getString:function(i){return e(t+"shared."+i)},getPCString:function(i){return e(t+"pc."+i)},getSkyString:function(i){return e(t+i)},getMobileString:function(i){return e(t+"mobile."+i)},getMarketInfoValue:function(t){return e(n+t)},getSharedString:function(t){return e(i+t)}}}()}),define("inlineerror",["jquery-1.7.2","sutra","alehelpers"],function(){!function(){function e(e,t,i){var r=this;r.render=function(){var r=jQuery('<div class="ine_error"></div>');e.append(r),sutra(r,"$Sutra.SkyDrive.InlineError");var o=jQuery('<div class="ine_text"></div>');i&&t?o.html(t):t?o.text(t):o.text(n),r.append(o),r.append(jQuery('<div class="c_clr"></div>'))}}var t=wLive.Core,i=t.AleHelpers.getPCString,n=i("ReportAbuse.PopoverError");wLive.Controls.InlineError=e}()}),define("loadingspinner",["baseutil","jquery-1.7.2","sutra","alehelpers"],function(){!function(){function e(e,i){var n=this;n.render=function(){i=null==i?t:i;var n=$f&&$f.createLoading({returnMarkup:!0,useTransparentFallback:!0,text:i}),r=jQuery(n);e.append(r),$f.showLoading(r),r.find(".c_loadingText").addClass("t_ctc"),sutra(r,"$Sutra.SkyDrive.LoadingSpinner")}}var t=wLive.Core.AleHelpers.getString("Loading");wLive.Controls.LoadingSpinner=e}()}),define("sharedialogv3",["jquery-1.7.2","dependancies","flyout","inlineerror","loadingspinner","setup"],function(){!function(){function e(e,h,p){function m(o,d,c,p,m){T||(T=t.OfficePageController.getInstance().getAriaLogger()),Flight.Ramps&&Flight.Ramps.WacShareV3DialogTelemetry&&y(),N=o,U=!1,E=_ce("iframe");var g=_ce("form"),w=_ce("div"),C=_ce("div"),b=C.style;b.height=s+4+"px",b.width=l+"px",b.display="flex",b.alignItems="center",b.justifyContent="center",b.textAlign="center",w.appendChild(C),M=jQuery(C),F=jQuery(E),f();var S=_ge("c_base")||document.body;D=H&&H.createFlyout({anchor:S,content:w,options:{dismissOnOutsideClick:!0,moreCss:"shareV3Dialog",verticalCenterOverrride:!0}}),jQuery(D).bind({"aftershow.shareV3Dialog":function(u,c){h.sendBlurFocus(),j.bind("message"+n,v),t.IdentityTokenProvider.getInstance().getGraphToken().then(function(t){if(E){var i={authToken:t,itemName:e.name,listItemId:e.id,clientId:"odcWac",correlationId:d,mode:o,navId:m,accessChecked:p,hostOptions:{enableWiderDialog:!0}};O&&(i.defaultRecipients=O.map(function(e){return e.Id})),Flight.Ramps&&Flight.Ramps.WacAgeGroup&&$Config.ageGroup&&(i.ageGroup=$Config.ageGroup),E.id=r,E.name=r,E.frameBorder=0,E.height=s,E.width=l,w.appendChild(E),P=E.contentWindow;var n=_ce("input");n.type="hidden",n.name="context",n.value=JSON.stringify(i),g.target=r,g.action=a,g.method="post",g.appendChild(n),w.appendChild(g),g.submit()}},function(e){var t=getPCString("Sharing.GetPermissionsError"),n=jQuery(w),r=new i.InlineError(n,t);r.render()})},"afterdismiss.shareV3Dialog":function(e,t){N===u.atMention&&!U&&O&&x(O,R,!0,!1),Flight.Ramps&&Flight.Ramps.WacShareV3DialogTelemetry&&k(),N=null,U=!1,R=null,O=null,E=null,P=null,D=null,jQuery(t).unbind(".shareV3Dialog"),j.unbind(n),c&&c(),h.sendGrabFocus()}}),D.show()}function f(e){M.empty();var t=new wLive.Controls.LoadingSpinner(M,e);t.render(),M.show(),F.hide()}function g(){M.hide(),F.show()}function v(e){if(e=e.originalEvent,e.origin===o&&e.source===P){var t;try{t=JSON.parse(e.data)}catch(i){return}switch(t.name){case"share_dismiss":D.dismiss();break;case"share_ready":g(),w();break;case"share_resize":var n=E.width!=t.width;E.height=t.height,E.width=t.width,n&&D.reposition();break;case"share_readyForRecipients":var r={name:"atMention_defaultRecipients",recipientIds:O.map(function(e){return e.Id})};P.postMessage(JSON.stringify(r),o);break;case"share_grantAccessCompleted":U=!0,O&&x(O,R,!1,t.successful);break;case"share_error":var a=t.error;if(t.debugErrorMessage)try{a=JSON.parse(t.debugErrorMessage).error.name}catch(i){}C(a,t.errorMessage)}}}function y(){if(A=Date.now(),I(),T){var e=S(!1);T.logEvent(e)}}function w(){if(A&&(_(),T)){var e=S(!0,!0);T.logEvent(e),A=void 0}}function C(e,t){if(_(),T){var i=S(!0,!1);i.setProperty("Error",t),i.setProperty("ResultCode",e),T.logEvent(i)}}function b(){C("timeout","ShareV3 timed out")}function k(){_(),A&&C("canceled","ShareV3 canceled")}function S(e,t){var i=new microsoft.applications.telemetry.EventProperties;if(i.name="ev_Qos",i.setProperty("WebLog_FullName","Qos,"),i.setProperty("WebLog_EventType",e?"End":"Start"),i.setProperty("WebLog_Type_Qos","1"),i.setProperty("Name","Wac.ShareV3.render"),e){var n=Date.now();i.setProperty("Duration",n-A),i.setProperty("ResultType",t?"Success":"Failure")}return i}function _(){L&&(window.clearTimeout(L),L=void 0)}function I(){_(),L=window.setTimeout(b,d)}function x(e,t,i,n){var r=e.map(function(e){return{Id:e.Id,Provider:e.Provider,Status:n?c.Success:c.Failed}});h.sendGrantAccessResponse(t,i,r)}var D,E,P,T,A,L,F,M,N,U,R,O,B=this,H=i.Notifications,j=jQuery(window);B.showShareDialog=function(e,t){var i=u[e.mode]||u.share;m(i,e.ShareCorrelation,t,void 0,e.nav)},B.showAtMentionDialog=function(e,t){O=e.Persons,R=e.Id,m(u.atMention,e.ShareCorrelation,t,e.UserPermissionsVerified)}}var t=wLive.Core,i=wLive.Controls,n=".shareV3",r="shareFrame",o=Flight.Ramps&&Flight.Ramps.WacUseShareTestEndpoint?"https://www.onedrive-tst.com":"https://www.onedrive.com",a=o+"/share?consumer=true",s=423,l=480,d=3e4;i.ShareDialogV3=e;var u={share:1,copy:2,atMention:3,manageAccess:5},c={Success:0,CannotGrantPermission:1,UserDoesNotExist:2,Failed:3}}()}),define("browserstorage",["lightobject"],function(){!function(){var e={},t=window.$Config&&$Config.hcid?"."+$Config.hcid:"";window.BrowserStorage={setSessionValue:function(t,i){try{window.sessionStorage?sessionStorage[t]=Object.toJSON(i):e[t]=Object.toJSON(i)}catch(n){}},getSessionValue:function(t){try{var i;return i=window.sessionStorage?sessionStorage[t]:e[t],i?Object.fromJSON(i):void 0}catch(n){}},setLocalValue:function(e,i,n){try{window.localStorage&&(n||(e+=t),localStorage[e]=Object.toJSON(i))}catch(r){}},getLocalValue:function(e,i,n){try{if(window.localStorage){n||(e+=t);var r=localStorage[e],o=r?Object.fromJSON(r):void 0;return null!==o&&void 0!==o||void 0===i?o:i}}catch(a){}return i}}}()}),define("modaldialog",["flyout"],function(){!function(e){"use strict";var t=window.wLive,i=t.Controls.Notifications,n=(i.AutomationOptions,i.InternalTools),r=n.Toolkit,o="Notifications.ModalDialog";n.TemplateHelper.registerTemplate({id:o});var a=function(t,i,s,l,d){r.checkEmptyArgument(i,"No content was supplied");var u=this,c=null,h=e.extend({},a.defaultUserOptions,d),p=a.defaultControlOptions;p.dismissOnEsc=h.dismissOnEsc,p.dismissOnOutsideClick=h.dismissOnOutsideClick,FilesConfig&&FilesConfig.NextLegacyBundleEnabled&&(p.dismissOnOutsideClick=!0);var m=new n.NotificationBase({name:"dialog",instance:u,controlOptions:p,userOptions:h,positioner:function(t,i,n,o,a){var s=e("HTML"),l=e("BODY"),d=e(i),u=d.find(".InnerContainer"),c=e(window).innerHeight();if(!a.constrainSize){var h=Math.max(c-200,500)+"px";u.find(".UserArea").css("max-height",h),u.find(".dlg-height").css("height",h),u.css("width","auto")}var p=d.height(),m=(c-p)/2;t.y=m;var f=d.find(".NotificationArea");if(0!==f.contents().length){var g=d.find(".ButtonArea"),v=0;g.find("BUTTON").each(function(t){var i=e(this);v+=r.getExtraDimensions(i).width+i.outerWidth(!0)});var y=r.getExtraDimensions(f);d.find(".NotificationArea").width(g.width()-y.width-v),f.show()}else f.hide();u.css("left",-(s.scrollLeft()+l.scrollLeft()))},render:{title:t,content:i,notificationArea:s,buttons:l,template:{id:o,options:{showNotificationArea:!0}}}});u.show=function(){return m.show({beforeShow:function(){c=e(m.popoverElement()).find(".NotificationArea")}})},u.dismiss=function(){m.dismiss({beforeDismiss:function(){c=null}})},u.notificationArea=function(){return c}};a.defaultUserOptions={dismissOnEsc:!0,focusFirstButton:!0,constrainSize:!0},a.defaultControlOptions={animation:{type:"fade"},ariaOptions:{role:"alertdialog"},automationKey:"ModalDialog",changeAnimationOnUserInteraction:!1,controlCss:"ModalDialog",isModal:!0,setFocus:!0,queueGroup:"ModalDialog"},i.createModalDialog=function(e){return new a(e.title,e.content,e.notificationArea,e.buttons,e.options)},r.registerChangeUserOptionsApi("ModalDialog",a.defaultUserOptions,["dismissOnEsc","moreCss","notificationContainer"]),i.getQueue().registerSearchApi("getModalDialogs",[a.defaultControlOptions.queueGroup])}(window.originaljQuery||jQuery)}),define("navigationconstants",["do","bsi","defineutilities","elementeventing","objecteventing","lightstring","pagestats"],function(){wLive.Core.NavigationConstants={AzureADPrompt:{None:0,Login:1,Consent:2,AdminConsent:3}}}),define("navigation",["navigationconstants"],function(){!function(){function e(e){var t="",i=!0;for(var n in e)i?i=!1:t+="&",t+=n+"="+(e[n]||"").encodeURIComponent();return t}var t=wLive.Core,i=window.history,n=i&&!!i.pushState,r=new RegExp("wreply=[^&]*"),o=new RegExp("redirect_uri=[^&]*"),a=new RegExp("prompt=[^&]*"),s="aad_nonce";defineClass("Shared.Navigation",function(e){this._pathMappings=e||{},$Do.when("BeforeUnloadManager.attach",0,bind(this,this.change)),this.addElementListener(window,"hashchange",this.change),this.addElementListener(window,"popstate",this.change),this._updateViewParams()},{__isObservable:!0,_shouldRebaseHashes:!0,_viewParams:null,_viewParamsString:null,getViewParams:function(){return this._viewParams},getViewParamsString:function(){return this._viewParamsString},getUrl:function(){return document.URL},push:function(t){var r="string"==typeof t?t:e(t);n?(i.pushState({},null,"?"+r),this.change()):document.location.hash=r},pop:function(){n&&i.back()},replace:function(t){var r="string"==typeof t?t:e(t);n?(i.replaceState({},null,"/?"+r),this.change()):document.location.hash=r},change:function(){this._viewParams;this._updateViewParams()&&change(this,this._viewParams)},navigateTo:function(e,t){$BSI.navigateTo(e,t)},reload:function(){window.location.reload()},authenticate:function(){var e=FilesConfig.si.replace(r,"wreply="+this.getUrl().encodeUrl());this.navigateTo(e,"_top")},azureADAuthenticate:function(e,i){e=e?e:this.getUrl();var n=FilesConfig.aadsi.replace(o,"redirect_uri="+e.encodeUrl()),r=$Utility.generateGuid();$Cookie.setCookie(s,r,$Config.sd),n+="&nonce="+r;var l=t.NavigationConstants.AzureADPrompt;if(i!=l.None){var d="";switch(i){case l.Login:d="login";break;case l.Consent:d="consent";break;case l.AdminConsent:d="admin_consent"}n.match(a)?n=n.replace(a,"prompt="+d):n+="&prompt="+d}this.navigateTo(n,"_top")},_updateViewParams:function(){var e,t="",i=!1,r=window.document.location;if(r.hash.length>1?(t=r.hash.substr(1),n&&this._shouldRebaseHashes&&(e=t)):r.search.length>1&&(t=r.search.substr(1)),r.pathname&&this._pathMappings){var o=r.pathname.split("/")[1],a=o&&this._pathMappings[o];if(a){for(var s=[],l=0;l<a.length;l++)s.push(a[l]);t+=s.join("&"),n&&this._shouldRebaseHashes&&(e=t)}}if(t!=this._viewParamsString&&(this._viewParams={},this._viewParamsString=t||"",i=!0,this._viewParamsString))for(var d=this._viewParamsString.split("&"),u=0;u<d.length;u++){var c=d[u].split("="),h="";try{h=decodeURIComponent(c[1])}catch(p){}h&&(this._viewParams[c[0]]=h)}return e&&this.replace(e),i}},{},Shared.ElementEventing)}()}),define("postmessagehandler",["alehelpers"],function(){!function(){function e(){function e(e){var t=e.originalEvent||e,i=$Wac.getWacIframeDomain();if(i&&$Wac.domainsAreEqual(i,t.origin)){$e=t.origin;var H,j,W,Q;try{H=jQuery.parseJSON(t.data),j=H[n],W=H[r],Q=H[o]}catch($){}switch(We(!1,j,H[a],Q&&Q[s],W),j){case l:qe.trigger(ne,Q);break;case d:qe.trigger(re,Q);break;case u:Me(oe,Q);break;case c:Me(ae,Q);break;case h:case p:Me(se,Q);break;case m:Me(se,Q);break;case f:qe.trigger(le,Q);break;case g:qe.trigger(de,Q);break;case v:qe.trigger(ue,Q);break;case y:Me(ce,Q);break;case w:Me(he,Q);break;case k:qe.trigger(pe,Q);break;case S:qe.trigger(me,Q);break;case C:Me(fe,Q);break;case b:qe.trigger(ge,Q);break;case _:qe.trigger(ve,Q);break;case I:$Do.when("$WLXIM.UserSignedIn",0,function(){$WLXIM.registerWacChat(Ve)});break;case P:qe.trigger(P,Q);break;case x:qe.trigger(ye,Q);break;case D:qe.trigger(we,Q);break;case E:qe.trigger(Ce,Q);break;case T:qe.trigger(be,Q);break;case A:qe.trigger(ke,Q);break;case L:qe.trigger(Se,Q);break;case F:qe.trigger(_e,Q);break;case M:qe.trigger(Ie,Q);break;case N:qe.trigger(xe,Q);break;case U:qe.trigger(De,Q);break;case R:qe.trigger(Ee,Q);break;case O:qe.trigger(Pe,Q);break;case B:qe.trigger(Te,Q)}}}function Me(e,t){$Do.when("ale_Office",0,function(){qe.trigger(e,t)})}function Ne(e,t){$BSI.navigateTo(WacConfig.CloseUrl)}function Ue(e,t){$BSI.navigateTo(WacConfig.FilePropertiesUrl)}function Re(e,t){We(!0,e,Date.now()),$Wac.sendWacMessage(e,t,$e)}function Oe(e,t){$Wac.handleWacAppLoadingStatus(e,t,$e)}function Be(e,t){var i,n;t&&(i=t.Url,n=t.State),window.history&&window.history.pushState&&window.history.pushState(n,_d.title,i)}function He(e,t){t.NewMode&&(WacConfig.Mode=t.NewMode)}function je(e,t){window.navigator&&window.navigator.virtualKeyboard&&(window.navigator.virtualKeyboard.overlaysContent=t.overlayContent),Re(te,{})}function We(e,i,n,o,a){if(Flight.Ramps&&Flight.Ramps.WacLogPostMessages&&!Qe&&(Qe=t.OfficePageController.getInstance().getAriaLogger()),Qe){var l=new microsoft.applications.telemetry.EventProperties;l.name="ev_Engagement",l.setProperty("WebLog_FullName","Engagement,"),l.setProperty("WebLog_EventType","Single"),l.setProperty("WebLog_Type_Engagement","1"),l.setProperty("UsageType","Click"),l.setProperty("Name","WacPostMessage."+(e?"Send.":"Receive.")+i),l.setProperty("SendTime",n),l.setProperty("Application",WacConfig.Application),l.setProperty("Mode",WacConfig.Mode||WacConfig.OriginalMode),l.setProperty("OriginalMode",WacConfig.OriginalMode),l.setProperty(s,o),l.setProperty(r,a),Qe.logEvent(l)}}var Qe,$e,Ve=this,qe=jQuery(Ve),Ge=Ae+i++;Le.bind("message"+Ge,e),qe.bind(ne+Ge,Ne),qe.bind(re+Ge,Ue),qe.bind(pe+Ge,Oe),FilesConfig.enableWacHtmlHistory&&qe.bind(Se+Ge,Be),qe.bind(me+Ge,He),Fe&&Microsoft.Office[WacConfig.Unified.WacApplication].EventIds.SetOverlayContent?$Wac.addJsApiEventListener(function(e){e.type===Microsoft.Office[WacConfig.Unified.WacApplication].EventIds.SetOverlayContent&&je(null,e.data)}):qe.bind(Pe+Ge,je),$Do.register("WacPostMessageHandler"),$Do.when("WacPostMessageHandlersAttached",0,function(){for(var t=0;t<$Wac.queuedMessages.length;t++)e($Wac.queuedMessages[t]);Re(G)}),Ve.sendWebImFirstIncomingMessage=function(){Re(z,{isSend:!1})},Ve.sendWebImFirstOutgoingMessage=function(){Re(z,{isSend:!0})},Ve.sendBlurFocus=function(){Re(H)},Ve.sendGrabFocus=function(){Re(j)},Ve.sendCanEmbed=function(e){Re(W,{HostEmbeddedViewUrl:e})},Ve.sendCheckPolicyResponse=function(e){Re("CheckPolicyResponse",e||{})},Ve.sendGrantAccessResponse=function(e,t,i){Re(ee,{Id:e,DialogCanceled:t,Persons:i})},Ve.sendPopState=function(e){Re(J,e)},Ve.sendPostAccessToken=function(e,t,i,n,r){var o={AddinControlId:e,HostApplicationType:"OneDriveWOPI"};!!t&&(o.AccessToken=t),!!i&&(o.AddinSSOError=i),!!n&&(o.GetTokenSilentTime=n),!!r&&(o.GetTokenPopupTime=r),Re(K,o)},Ve.sendHostRefreshSessionInfo=function(e){Re(X,e)},Ve.sendWebimReady=function(e,t){Re(Q,{UnreadCount:e,PaneState:t})},Ve.sendWebimUnreadCountChanged=function(e,t){Re($,{UnreadCount:e,PaneState:t})},Ve.sendWebimPaneStateChanged=function(e){Re(V,{PaneState:e})},Ve.sendWebimGiveFocus=function(e,t){Re(q,{Direction:e,PaneState:t})},Ve.sendHostWopiInfoFromUrl=function(e,t,i,n,r,o,a){Re(Y,{Url:e,WopiSrc:t,AccessToken:i,AccessTokenExpiry:n,DriveId:r,ItemId:o,Error:a})},Ve.sendHostDavUrlFromIds=function(e,t,i,n,r,o,a){Re(Z,{DriveId:e,ItemId:t,Url:i,WopiSrc:n,AccessToken:r,AccessTokenExpiry:o,Error:a})},Ve.sendWacCustomAuthConfig=function(e){Re(ie,e)},Ve.dispose=function(){Le.unbind(Ge),qe.unbind(Ge)}}var t=wLive.Core,i=0,n="MessageId",r="CorrelationId",o="Values",a="SendTime",s="wdUserSession",l="UI_Close",d="UI_FileProperties",u="UI_Sharing",c="UI_FileEmbed",h="UI_CopyAndEdit",p="UI_Edit",m="UI_RedeemForCommenting",f="UI_SignIn",g="UI_ReplyWithChanges",v="UI_FileVersions",y="UI_ShareForm",w="UI_OpenInClient",C="UI_ReportAbuse",b="CheckPolicy",k="App_LoadingStatus",S="App_SwitchMode",_="File_Rename",I="VerifyWebImReady",x="StartGroupChat",D="ToggleMessagingPane",E="WebImTakeFocus",P="RegisterThreadId",T="Edit_Notification",A="GetAccessToken",L="App_PushState",F="App_RefreshSessionInfo",M="User_Activity",N="App_WopiInfoFromUrl",U="App_DavUrlFromIds",R="UI_CheckUserAccessAndGrantPermissions",O="SetOverlayContent",B="App_GetCustomAuthConfig",H="BlurFocus",j="GrabFocus",W="CanEmbed",Q="WebImReady",$="WebImUnreadCountChanged",V="WebImPaneStateChanged",q="WebImGiveFocus",G="Host_PostmessageReady",z="WebImFirstMessage",K="PostAccessToken",J="App_PopState",X="Host_RefreshSessionInfo",Y="Host_WopiInfoFromUrl",Z="Host_DavUrlFromIds",ee="CheckUserAccessAndGrantPermissions_Result",te="SetOverlayContent",ie="Host_SetCustomAuthConfig",ne=e.WacCloseEvent="Close",re=e.WacFilePropertiesEvent="FileProperties",oe=e.WacShareEvent="Share",ae=e.WacFileEmbedEvent="FileEmbed",se=e.WacCopyEditEvent="CopyEdit",le=e.WacSignInEvent="SignIn",de=e.WacReplyEvent="Reply",ue=e.WacFileVersionsEvent="FileVersions",ce=e.WacShareFormEvent="ShareForm",he=e.WacOpenInClientEvent="OpenInClient",pe=e.WacLoadingStatusEvent="AppLoadingStatus",me=e.WacSwitchModeEvent="AppSwitchMode",fe=e.WacReportAbuseEvent="ReportAbuse",ge=e.WacCheckPolicyEvent="CheckPolicy",ve=e.WacRenameFileEvent="RenameFile",ye=e.WacStartGroupChatEvent="StartGroupChat",we=e.WacToggleMessagingPaneEvent="ToggleMessagingPane",Ce=e.WacWebImTakeFocusEvent="WebImTakeFocus",be=e.WacEditNotificationEvent="EditNotification",ke=e.WacGetAccessTokenEvent="GetAccessToken",Se=e.WacPushStateEvent="WacPushState",_e=e.WacAppRefreshSessionInfoEvent="WacRefreshSessionInfo",Ie=e.WacUserActivityEvent="User_Activity",xe=e.WacWopiInfoFromUrlEvent="WopiInfoFromUrl",De=e.WacDavUrlFromIdsEvent="DavUrlFromIds",Ee=e.WacCheckAccessGrantPermissionsEvent="CheckAccessGrantPermissions",Pe=e.WacSetOverlayContentEvent="SetOverlayContent",Te=e.WacGetCusotomAuthConfigEvent="App_GetCustomAuthConfig",Ae=".postMessageHandler",Le=jQuery(window),Fe=WacConfig&&WacConfig.BootWithJsApiV2;t.PostMessageHandler=e}()}),define("identitytokenprovider",["jquery-1.7.2","cookie","dependancies","promise"],function(){!function(){function e(){function e(e){var i=t(e);return i?Shared.Promise.wrap(i):(f[e]||(f[e]=new Shared.Promise,d(e)),f[e])}function t(e){return $Cookie.getCookie(l(e))}function i(e,t,i){var n=Date.now()+1e3*i;$Cookie.setCookie(l(e),t,void 0,void 0,new Date(n),void 0,!0)}function l(e){return encodeURIComponent(e+$Config.unid+($Config.authSessionId||"0"))}function d(e){v||(g[e]++,y=e,v=document.createElement("iframe"),v.src=h(e),v.style.display="none",document.body.appendChild(v),m.bind("message"+a,c),w=setTimeout(function(){w=void 0;var t=g[e]<o;t?(u(e,!1),d(e)):u(e,!0)},r))}function u(e,t){if(y=void 0,v&&(document.body.removeChild(v),v=void 0),void 0!==w&&(clearTimeout(w),w=void 0),m.unbind("message"+a),t){var i=f[e];i&&i._error("Timed out acquiring OAuth token"),f[e]=void 0,g[e]=0,f[s.Msa]?d(s.Msa):f[s.Graph]&&d(s.Graph)}}function c(e){if(e=e.originalEvent,v&&e.source===v.contentWindow&&e.origin===C&&void 0!==y){var t="",n=0,r=e.data;if(r&&"object"==typeof r&&"ODSA"===r.source)t=r.token,n=parseInt(r.expiresIn,10);else{if("string"!=typeof r)return;var o=r.split(" ");if(2!==o.length)return;t=o[0],n=parseInt(o[1],10)}var a=!!t&&n>0;if(a){i(y,t,n);var s=f[y];s&&(s._complete(t),f[y]=void 0)}u(y,!0)}}function h(e){var t;switch(FilesConfig.env){case"soak2":case"soak3":case"dev":t="sa"+FilesConfig.env+".html";break;default:t="sa.html"}var i;switch(e){case s.Msa:i="dev"===FilesConfig.env?"onedrive-devbox.access":"onedrive_implicit.access";break;case s.Graph:i="contacts.read Files.ReadWrite"}return"https://login.live.com/oauth20_authorize.srf?res=success&resuictx=selection&response_type=token&display=none&client_id="+n+"&scope="+encodeURIComponent(i)+"&redirect_uri="+encodeURIComponent("https://p.sfx.ms/"+t)}var p=this,m=jQuery(window),f={},g={"msa_auth:":0,"graph_auth:":0},v=void 0,y=void 0,w=void 0,C=document.location.protocol+"//"+document.location.hostname;p.dispose=function(){m.unbind(a)},p.getCachedSessionToken=function(){return t(s.Msa)},p.getSessionToken=function(){return e(s.Msa)},p.getGraphToken=function(){return e(s.Graph)}}var t,i=wLive.Core,n="00000000481710A4",r=3e4,o=5,a=".identityTokenProvider";i.IdentityTokenProvider=e;var s={Msa:"msa_auth:",Graph:"graph_auth:"};i.IdentityTokenProvider.getInstance=function(){return t||(t=new i.IdentityTokenProvider),t}}()}),define("priorityqueue",["dependancies"],function(){!function(){function e(e,t,p){function m(e,t){var i=e[t];i&&(i.state==c?(k(i),i.abort&&i.abort()):g(i),S(i))}function f(e,t,i,n,r){var o={id:n,queueId:r,exec:e,abort:t,pri:i,timeoutId:0,next:null,prev:null,state:d};return o}function g(e){if(e&&e.state==u){e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev);var t=e.pri;N[t]==e&&(N[t]=e.next),U[t]==e&&(U[t]=e.prev),e.state=d,e.prev=e.next=null,E--}return e}function v(e){if(e&&e.state==d){var t=e.pri,i=U[t];i?(i.next=e,e.prev=i):N[t]=e,U[t]=e,e.state=u,E++}}function y(){!B&&!L&&E&&I>P&&(L=window.setTimeout(C,a))}function w(e,t){var i=!0;if(t>0){var n=Math.max(r,o-o*(t/D));i=(new Date).getTime()-e<n}return i}function C(){var e=(new Date).getTime(),t=0;for(L=0,B=!0;E>0&&D>=t&&I>P;){var i=N[t];if(i=i&&T[i.pri]<(x[i.pri]||I)?b(g(i)):null){if(!w(e,t))break}else t++}B=!1,y()}function b(e){if(e){P++,R[e.id]=e,e.startTime=(new Date).getTime(),T[e.pri]++,e.state=c;var t=e.exec(function(t){k(e,t)});t||k(e)}return e}function k(e,t){e.state===c&&(P--,delete R[e.id],T[e.pri]--,S(e))}function S(e){var t=M[e.queueId];e.state=h,delete t[e.id],y()}for(var _=this,I=e||n,x=t||{},D=p||i,E=0,P=0,T=[],A=0;D>=A;A++)T.push(0);var L=0,F=0,M={},N=[],U=[],R={},O=!1,B=!1;_.enqueue=function(e,t,i,n,r){var o=!1;if(!O){r=r||s,n=n||String(F++),i=void 0!==i?i:l;var a=M[r]=M[r]||{},d=a[n];d&&(d.state!=u||!d.next&&d.pri==i)||(d?(g(d),d.pri=i):(o=!0,d=a[n]=f(e,t,i,n,r)),v(d),y())}return o},_.abortAll=function(){O=!0;for(queueId in M)_.abort(queueId);O=!1},_.abortTask=function(e,t){e=e||s;var i=M[e];i&&m(i,t)},_.abort=function(e){e=e||s;var t=M[e];if(t){for(taskId in t)m(t,taskId);M[e]={}}},_.getActiveTaskCount=function(){return P},_.getActiveTasks=function(){return R}}var t=wLive.Core,i=3,n=5,r=20,o=100,a=0,s="root",l=2,d=0,u=1,c=2,h=4;t.PriorityQueue=e}()}),define("priorityqueueconfiguration",["priorityqueue"],function(){!function(){var e=wLive.Core,t=5,i=e.RequestPriorityEnum={FetchData:0,FetchImages:1,DefaultGet:2,DefaultPost:3,MoveOperation:4,CopyOperation:5,DeleteOperation:6,RestoreOperation:7,UploadOperation:8,RemoteUploadOperation:9,UpdateStatusOperation:10,ResetAbuseScoreOperation:11,OwnerRequestReviewOperation:12,RotateImageOperation:13,PublishToFacebookOperation:14,CopyAsyncOperation:15,PublishVideoOperation:16,AddFavoritesOperation:17,RemoveFavoritesOperation:18},n=18,r={};r[i.CopyOperation]=1,r[i.DeleteOperation]=1,r[i.MoveOperation]=1,r[i.RestoreOperation]=1,r[i.UploadOperation]=3,r[i.RemoteUploadOperation]=1,window.requests=new e.PriorityQueue(t,r,n),window.domUpdates=new e.PriorityQueue}()}),define("jsonconstants",["jquery-1.7.2","pagestats","validateconfig","jbase","workmonitor","basecontrol","alehelpers","dependancies","retriablepromise","priorityqueueconfiguration"],function(){wLive.Core.JSONConstants={ErrorCodes:{BlockedUserErrorCode:3009,HipCheck:3006,PartialPermissionsSetError:2019,UnverifiedAccount:3020},InvalidNameRegEx:'([:|*|?|\\\\|/|"|<|>||||])',InvalidItemNameCharacters:'* ? \\ / " : < > |',ViewType:{FolderPicker:"1",FilePicker:"2",Self:"3",Photos:"photos"},SortField:{Default:"0",Name:"1",ModifiedDate:"2",CreatedDate:"3",Size:"4",Type:"5",DateTaken:"6",Owner:"7",UserArranged:"8",LastOpened:"9",Relevancy:"10",DateDeleted:"11",OriginalLocation:"12",DateShared:"13",Sharer:"14"},SortDirection:{Default:"0",Ascending:"1",Descending:"2"},GroupBy:{Default:"-1",None:"-2",Folders:"0",FoldersDocumentsPhotos:"0,1,2"},FilterType:{Albums:"1",Folder:"2",Favorites:"4",AllFolders:"7",PhotosAndVideos:"8",PhotosVideosFolders:"15",Documents:"16"},SharingLevel:{Public:0,PublicUnlisted:2,Shared:3,Private:4},UserFactInfoType:{NewBrandBonus:1,CameraRollBonus:2,NewFriendAcceptedInvitation:3,CameraRollNewlyEnabled:4,InvitedFriendBonus:5,InvitedByFriendBonus:6,Upsells:7,Grandfather:8,OdbAccounts:9,QuotaFactExpiration:10,CameraRollBonus2:14,BubbleControl:17},UserFactInfoAction:{Set:1,Delete:2,InsertUpdate:3}}}),define("datarequest",["identitytokenprovider","jsonconstants"],function(){!function(e){function t(t,n,I,x,D,E,P,T,A,L,F){function M(){var e=window.location.search,t="";if(e){var i=$Utility.deserialize(e.substring(1)),n=i.iam,r="aad_auth:"+n,o=$Cookie.getCookie(r.decodeUrl().encodeUrl());if(o){var a="id_token=",s=o.indexOf(a);t=o.substring(s+a.length,o.indexOf("&",s))}}return t}function N(e){var t=!1;return 0!=e.indexOf("/")&&(t=U(e)!=U(window.location.host)),t}function U(e){var t=e.indexOf("://");return-1!==t&&(e=e.substr(t+3)),t=e.indexOf("?"),-1!==t&&(e=e.substr(0,t)),t=e.indexOf("/"),-1!==t&&(e=e.substr(0,t)),e.toLowerCase()}function R(){B._workId&&(a.completeWork(B._workId),B._workId=null)}function O(e){var r,o=e?e.error:null;if(R(),e=e||{},wLive.PageStats.add(e.pageStats,$),e.error){var a=e.error.stackTrace;r=e.error.debugMessage?e.error.debugMessage+"\n":"",r+=a&&a.encodeJson?a.encodeJson():"";'{"code": "'+e.error.code+'", "message": "'+e.error.message+'", "debug": "'+e.error.debugMessage+'", "stacktrace": "'+r+'", "retriesLeft": "'+Q+'", "requestUrl": "'+n+'"}'}if(e.error&&e.error.isRetriable&&Q>0)Trace.logTo(V,"Retrying request: "+n,C,{dataBundle:e,shouldSynchronizeSerialization:!0}),j&&j(),Q--,B.start();else{if(e.error)Trace.logTo(V,"Failed response: "+n,C,{dataBundle:e,shouldSynchronizeSerialization:!0}),j&&j(B.failureReentranceDelay),e.error.code!=m&&i(t,!1,e);else{var l=!1;Trace.logTo(V,"Response: "+n,C,{dataBundle:e,shouldSynchronizeSerialization:l}),j&&j(B.successReentranceDelay),G&&B.originId&&(e.originId=B.originId),i(t,!0,e)}if(B.apiId&&B.propertyId){var d=void 0,u=s.success;o&&(d=o.code+(o.status?"-"+o.status:""),u=o.isExpected?s.expected:s.unexpected),B.errorCodeSuffix&&(d=(d||"success")+"-"+B.errorCodeSuffix),window.Qos&&Qos.log(B.apiId,B.propertyId,$,d,u,r)}}}var B=this;B.successCallback=x,B.failureCallback=D,t=t||"key"+k++,S[t]=S[t]||[],S[t].push(this);var H,j,W=!1,Q=void 0!==T?T:v;E=E||c;var $,V=null,q=U(FilesConfig.skyApiDomain)===U(n),G=N(n);q&&(A=!0),B.priority=P||(I||F?y:w),B.queueId=I||F?u:d,B.originId=null,B.jsonpParameterName=void 0,B.successReentranceDelay=0,B.failureReentranceDelay=0,B._queuedWorkStarted=!1,I&&(I=I.replace(/\?/g,"\\u003F")),B.apiId="",B.propertyId="",B.errorCodeSuffix="",B._workId=null,B.start=function(){var i=a.startWork([a.StandardTags.Network,a.StandardTags.Network_Data]);return B._enqueued=window.requests.enqueue(function(s){if(B._queuedWorkStarted=!0,W)a.completeWork(i);else{B._workId=i,j=s,$=(new Date).getTime(),V=Trace.log("Request: "+n,C,{dataBundle:I,shouldSynchronizeSerialization:!0});var l,d=null,u=n,c=!1;if(!G||q){d={canary:FilesConfig.canary,Accept:"application/json",AppId:FilesConfig.appId},u.indexOf("/GetItems?")>-1&&(d["Cache-Control"]="private",d["X-ForceCache"]="1"),B.originId&&(d["X-SkyApiOriginId"]=B.originId),FilesConfig.oauthToken&&(d["X-Auth"]=FilesConfig.oauthToken);var h=M();h&&(d.Authorization="Bearer "+h),FilesConfig.authKey&&(d.InvitationToken=FilesConfig.authKey),FilesConfig.vault&&(d[f]=g),FilesConfig.skyApiDomain&&u.toLowerCase().startsWith("/api/")&&$Config.d&&(c=!0)}else if(!A){u+=-1===n.indexOf("?")?"?":"&",u+="canary="+FilesConfig.canary.encodeUrl(),l="dataRequestCallback_"+b++;var m=!1,v=setTimeout(function(){m||(m=!0,O(B.parseError(H,"timeout",p)))},E);o.DataRequest[l]=function(e){m||(clearTimeout(v),m=!0,O(e)),delete o.DataRequest[l]}}if(B.isVroom){d=d||{},d.Accept="application/json";var h=o.IdentityTokenProvider.getInstance().getCachedSessionToken();h&&(d.Authorization="Bearer "+h),FilesConfig.vault&&(d[f]=g)}var y=function(e,t,i){c?setTimeout(function(){O(e)},0):O(e)},w=function(e,t,i){c?setTimeout(function(){O(B.parseError(e,t,i))},0):O(B.parseError(e,t,i))},k={url:u,dataType:L?L:G&&!A?"jsonp":"json",jsonp:B.jsonpParameterName,jsonpCallback:l?"wLive.Core.DataRequest."+l:void 0,data:I,processData:!1,type:I||F?"POST":"GET",headers:d,timeout:E,success:G&&!A?void 0:y,error:G&&!A?void 0:w,xhrFields:!A||q?{withCredentials:1}:null},S=window.$InlineRequests&&$InlineRequests[t];S?(Trace.logTo(V,"Inline request: "+n,C),S.then(y,w)):c?$Do.when("skyApiProxy",0,function(){
W||(_&&_.contentWindow&&_.contentWindow.jQuery?H=_.contentWindow.jQuery.ajax(k):(m=!0,O(B.parseError(null,"proxyfailure",p)),r()))}):H=e.ajax(k)}return!W},function(){G||B.abort()},B.priority,t,B.queueId),B._enqueued||a.completeWork(i),B._enqueued},B.abort=function(){W=!0,H&&!G&&(Trace.logTo(V,"Abort: "+n,C,{dataBundle:I,shouldSynchronizeSerialization:!0}),H.abort(),H=null),j?(j(),j=null):B._enqueued&&!B._queuedWorkStarted&&(requests.abortTask(B.queueId,t),B._enqueued=!1),R()},B.getStartTime=function(){return $},B.parseError=function(e,t,i){var r={};if(e&&500==e.status)try{r=Object.fromJSON(e.responseText)||{}}catch(o){}if(!r.error&&!r.items){var a=!0,s=!1,d=h+(e&&e.status?": status "+e.status:""),u=l("LoadGenericError");switch(r.pageStats={url:n,error:t,tasks:[],executionTimeMs:0,schedulerTimeMs:0},t){case"proxyfailure":case"timeout":d=p,u=l("LoadTimeoutError");break;case"abort":d=m,a=!1,s=!0,r.pageStats.info=t,r.pageStats.error=null}r.error={isRetriable:a,isExpected:s,code:d,message:u,status:t,debugMessage:e?"(xhr status "+e.status+") xhr.responseText: "+e.responseText:"",stackTrace:""},e&&(r.error.xhrStatus=e.status,r.error.xhrResponseText=e.responseText)}return r}}function i(e,t,i){var n=S[e];delete S[e];for(var r=0;n&&r<n.length;r++){var o=n[r];t&&o.successCallback&&o.successCallback(i),!t&&o.failureCallback&&o.failureCallback(i)}}function n(){_||(_=ce("IFRAME"),_.id="skyApiProxyFrame",_.src=FilesConfig.skyApiDomain+"/api/proxy?v=3",document.head.appendChild(_))}function r(){if(_){var e=_.parentNode;e.removeChild(_),_=null}$Do.unregister("skyApiProxy"),n()}var o=wLive.Core,a=Shared.WorkMonitor,s=Qos.responseType,l=o.AleHelpers.getString,d="fetch",u="write",c=3e4,h="unexpected",p="timeout",m="aborted",f="Prefer",g="Include-Feature=Vault",v=1,y=o.RequestPriorityEnum.DefaultPost,w=o.RequestPriorityEnum.DefaultGet,C="DataRequest",b=0,k=0,S={},_=null;FilesConfig.skyApiDomain&&$Config.d&&(FilesConfig.lightweightEmbedPage&&window.self!==window.top||(document.domain=$Config.d,_=byId("skyApiProxyFrame"),n())),o.DataRequest=t,o.DataRequest.hasPendingRequest=function(e){return!!S[e]}}(window.originaljQuery||jQuery)}),define("vroomrequestor",["datarequest","identitytokenprovider","promise"],function(){!function(){function e(){function e(){var e;switch(FilesConfig.env){case"soak2":e="soak2.test.";break;case"soak3":e="soak3.test.";break;case"dev":e="newapi.dev.";break;default:e=""}var t="dev"===FilesConfig.env?"storage.live-int.com":"api.onedrive.com";return"https://"+e+t+"/v1.0"}var i=this;i.send=function(i,n,r){var o=function(o,a){var s=e()+i,l=new t.DataRequest(s,s,n,o,a,void 0,void 0,void 0,!0,void 0,r);l.isVroom=!0,l.start()};return t.IdentityTokenProvider.getInstance().getSessionToken().then(function(){return new Shared.Promise(o)})}}var t=wLive.Core;t.VroomRequestor=e}()}),define("vaultcontroller",["jquery-1.7.2","alehelpers","browserstorage","do","modaldialog","navigation","postmessagehandler","setup","vroomrequestor"],function(){!function(){function e(e){function a(e){return i.getSkyString(o+e)}function m(){D(),N.bind("storage"+U,E),f()}function f(){var e=_()-Date.now();P=M.setTimeout(v,e-d),T=M.setTimeout(C,e)}function g(){M.clearTimeout(P),M.clearTimeout(T)}function v(){S()?F.showExpirationDialog():D().then(function(e){d>e?F.showExpirationDialog():w()},function(){F.showExpirationDialog()})}function y(t){if(A&&A.isCurrentlyShown()&&A.dismiss(),t){var i=jQuery(t);i.bind({"aftershow.dlg":function(t,i){e.sendBlurFocus()},"afterdismiss.dlg":function(t,n){i&&i.unbind(".dlg"),e.sendGrabFocus()}}),t.show(),A=t}}function w(){L&&L.dismiss(),g(),f()}function C(){g(),k(),F.showUnlockDialog()}function b(){R.reload()}function k(){var e;e=WacConfig.UseUnifiedApps?_ge("WACContainer"):_ge("sdx_ow_div"),e&&e.remove()}function S(){}function _(){return S()?Date.now()+2*l:I()}function I(){return BrowserStorage.getLocalValue(s,null,!0)}function x(e){BrowserStorage.setLocalValue(s,e,!0)}function D(){return B.send(u).then(function(e){var t=1e3*e.vault.expirationInSeconds;return x(Date.now()+t),Shared.Promise.wrap(t)},function(e){return Shared.Promise.wrapError(e.error)})}function E(e){var t=e.originalEvent;if(t.key===s){var i=t.oldValue,n=t.newValue;n?i?n>i&&w():b():C()}}var P,T,A,L,F=this,M=window,N=jQuery(M),U=p+h++,R=new Shared.Navigation,O=wLive.Controls.Notifications,B=new t.VroomRequestor;e.vaultController=F,F.dispose=function(){N.unbind(U),A&&A.dismiss()},F.showExpirationDialog=function(){$Do.when(r,0,function(){L=O&&O.createModalDialog({buttons:{action:a("ExpirationDialogExtendButton"),close:a("ExpirationDialogCloseButton")},title:a("ExpirationDialogTitle"),content:a("ExpirationDialogBody")}),jQuery(L).bind({"buttonclick._expirationDialog":function(e,t,i){"action"===i?F.extendVault():"close"===i&&F.closeFile()},"afterdismiss._expirationDialog":function(e,t){jQuery(L).unbind("._expirationDialog"),L=null}}),y(L)})},F.showSharingDisabledDialog=function(){$Do.when(r,0,function(){var e=O&&O.createModalDialog({buttons:{action:n("OK")},options:{dismissOnOutsideClick:!0},title:a("SharingDisabledDialogTitle"),content:a("SharingDisabledDialogBody")});y(e)})},F.showUnlockDialog=function(){$Do.when(r,0,function(){var e=O&&O.createModalDialog({buttons:{action:a("UnlockDialogExtendButton"),close:a("UnlockDialogCloseButton")},title:a("UnlockDialogTitle"),content:a("UnlockDialogBody")});jQuery(e).bind({"buttonclick.unlockDialog":function(e,t,i){"action"===i?F.unlockVault():"close"===i&&F.goToOneDrive()}}),y(e)})},F.closeFile=function(){M.close()},F.extendVault=function(){B.send(c,void 0,!0).then(function(){D().then(null,function(e){e||w()})},function(e){})},F.goToOneDrive=function(){R.navigateTo("/")},F.unlockVault=function(){R.reload()},F.onUserActivity=function(){F.extendVault()},m()}var t=wLive.Core,i=t.AleHelpers,n=i.getPCString,r="ale_Office",o="ProjectV.",a="oneDriveVault"+$Config.unid,s=a+"expirationtime",l=6e4,d=l,u="/drive/special/vault",c=u+"/action.unlockVault",h=0,p=".vaultController";t.VaultController=e}()}),define("toast",["modaldialog"],function(){!function(e){"use strict";var t=window.wLive,i=t.Controls.Notifications,n=(i.AutomationOptions,i.InternalTools),r=n.Toolkit,o="Notifications.Toast";n.TemplateHelper.registerTemplate({id:o,html:'{{if contentImage}}<div class="ContentImage" {{:prepareForAutomation("ContentImage")}}><img src="{{attr:contentImage}}"></div>{{/if}}{{for #data tmpl="Notifications.UserAreaSubTemplate"/}}{{if sourceIcon}}<div class="SourceIcon" {{:prepareForAutomation("SourceIcon")}}><img src="{{attr:sourceIcon}}"></div>{{/if}}<div class="CloseIcon" {{:prepareForAutomation("CloseIcon")}}><div class="HoverArea"><span class="CloseText">&times;</span></div></div>{{if soundSourceFiles}}<audio autoplay loop>{{for soundSourceFiles}}<source src="{{attr:uri}}" type="{{attr:type}}"/>{{/for}}</audio>{{/if}}'});var a=i.ToastPriority={Normal:"Normal",High:"High"},s=i.ToastTimeout={Normal:"Normal",Long:"Long"},l=function(t,d,u,c,h){function p(){var t=e(x.popoverElement());w&&t.click(f),t.find(".CloseIcon").click(g)}function m(){var t=e(x.popoverElement());w&&t.unbind("click",f),t.find(".CloseIcon").unbind("click",g)}function f(){x.getDeferredManager().updateState({clicked:!0}),b.triggerHandler("click",[C]),x.changeAnimation(!1,"none"),C.dismiss()}function g(){x.changeAnimation(!1,"none"),C.dismiss()}r.checkEmptyArgument(d,"No content was supplied"),r.checkEmptyArgument(c,"No source icon was supplied");var v=e.extend({timeoutInMsecs:h.timeout===s.Long?6e4:7e3,queueIsPriorityHigh:h.priority===a.High},l.defaultControlOptions),y=e.extend({},l.defaultUserOptions,h),w=y.dismissOnInsideClick,C=this,b=e(C),k=null,S=y.soundSourceFiles;e.isArray(S)?k=S:(k=[],S.aac&&k.push({uri:S.aac,type:"audio/mp4"}),S.ogg&&k.push({uri:S.ogg,type:"audio/ogg"}));var _={id:o,options:{backgroundColor:y.backgroundColor,soundSourceFiles:k,contentImage:u,sourceIcon:c,renderTitle:!!t,titleCssClassnames:"TextSemiBold LineHeightStandard"}},I=function(e,t){e&&(_.options.contentCssClassnames=(_.options.contentCssClassnames||"")+" "+t)};I(!r.isEmptyString(u),"WithContentImage"),I(!r.isEmptyString(t),"WithTitle");var x=new n.NotificationBase({name:"toast",instance:C,controlOptions:v,userOptions:y,positioner:function(e,t,i,n,r){e.x=null,e.y=null},render:{title:t,content:d,template:_},timer:{timeoutInMsecs:v.timeoutInMsecs,callback:function(){x.getDeferredManager().updateState({timedOut:!0}),b.triggerHandler("timedout",[C]),C.dismiss()},getElements:function(){var t=e(x.popoverElement);return e().add(t.find(".OuterContainer").find("*"))}}});C.show=function(){return x.show({beforeShow:function(){i.enableAriaSupport(),p()}})},C.dismiss=function(){x.dismiss({beforeDismiss:function(){m()}})}};l.defaultUserOptions={timeout:s.Normal,priority:a.Normal,dismissOnInsideClick:!0,soundSourceFiles:{}},l.defaultControlOptions={animation:{entranceType:"slidein",exitType:"fadeout"},automationKey:"Toast",controlCss:"Toast",queueGroup:"Toast",queueMode:"fifo"},$B.SF_Mac||(l.defaultControlOptions.animation.entranceArguments=[{top:0,left:400}]),i.createToast=function(e){var t=window.top,i=null,n=null;try{t!==window&&t.wLive&&t.wLive.Controls&&t.wLive.Controls.Notifications&&(i=t.wLive.Controls.Notifications,i.getQueue().start(),n=i.createToast(e))}catch(r){}return n||(n=new l(e.title,e.content,e.contentImage,e.sourceIcon,e.options)),n},r.registerChangeUserOptionsApi("Toast",l.defaultUserOptions,["backgroundColor","moreCss","notificationContainer"]),i.getQueue().registerSearchApi("getToasts",[l.defaultControlOptions.queueGroup])}(window.originaljQuery||jQuery)}),define("ariasupport",["toast"],function(){!function(e){var t=wLive.Controls.Notifications;t.enableAriaSupport=function(){if(0===e("#notificationContainer").length){var t={position:"absolute",padding:"0",margin:"0",height:"100%",width:"100%",top:"0"};t[wLive.Controls.Notifications.InternalTools.Toolkit.isLtr()?"left":"right"]="0",e('<div id="notificationContainer" class="NotificationContainer" persist="1" role="alert" aria-live="assertive" aria-atomic="false" aria-haspopup="true"></div>').css(t).prependTo("BODY")}}}(window.originaljQuery||jQuery)}),define("doregister",["ariasupport"],function(){!function(){$Do.register("NotificationControls")}()}),define("viewparams",["dependancies","defineutilities"],function(){!function(){defineClass("wLive.Core.ViewParams",function(){},{})}()}),define("viewcontext",["viewparams","browserstorage"],function(){!function(){var e,t=wLive.Core,i="SkyDrive.UserSettings";defineClass("wLive.Core.ViewContext",function(){this.viewParams=new t.ViewParams;try{this.userSettings=BrowserStorage.getLocalValue(i)||{}}catch(e){this.userSettings={}}},{updateSettings:function(e){mix(this.userSettings,e);try{BrowserStorage.setLocalValue(i,this.userSettings)}catch(t){}}},{getInstance:function(){return e||(e=new wLive.Core.ViewContext),e}})}()}),define("bicihelpers",["jquery-1.7.2","dependancies","lightstring","bsi","domutilities","viewcontext"],function(){!function(){function e(e){for(var t=e.context;t;){if(t.control)return t.control;t=t.parentElement}}var t=wLive.Core,i="TypeOfPage",n="Search",r="SearchesBeforeAction",o="SearchItemPos",a="frestatus",s="ABTest",l=5,d="ODREFID",u="SR",c="SB",h=jQuery.ajax;t.BiciHelpers={reportClickAction:function(p,m,f,g,v,y){var w,C={SkyCmnd:p,ClickLoc:m};if(!f){w=wLive.Core.ViewContext.getInstance(),f=w&&w.biciPageId;var b=w&&w.biciSetViewContentType;b&&(f+=b)}if(f&&(C[i]=f),p==u&&m==c){var k={searchCount:-1,searchId:-1,currentQuery:"",pageSearchedFrom:f};t.Search&&(k.searchCount=t.Search.getSearchesBeforeAction(),k.searchId=t.Search.getSearchStartTime(),k.currentQuery=t.Search.getCurrentQuery()),Qos.logData("SkyDriveWeb_Internal_Search_Query","SkyDrive",k.searchId,null,null,k,Date.now())}if(f&&f.startsWith(n)){var S={searchesBeforeAction:-1,searchItemPosition:-1,resultCount:-1,searchSucceeded:!1,searchId:-1,searchQuery:"",skyCmnd:p,clickLoc:m};t.Search&&(C[r]=t.Search.getSearchesBeforeAction(),S.searchesBeforeAction=C[r],S.searchId=t.Search.getSearchStartTime(),t.Search.clearSearchesBeforeAction(p)),w&&(S.searchItemPosition=w.selectionManager.getSelection().firstSelectedIndex,S.resultCount=w.currentItem.estimatedResultCount,S.searchQuery=w.viewParams.q);var _;if(g){var I=e(g);if(I){for(;I&&I.dataContext&&void 0==I.dataContext.itemIndex;)I=I.parent;I&&I.dataContext&&(S.searchItemPosition=I.dataContext.itemIndex,_=I.dataContext.item)}}!_&&y&&(_=y),_&&_.urls&&_.urls.bingClickInstrumentation&&h(_.urls.bingClickInstrumentation),S.searchItemPosition>=0&&(C[o]=S.searchItemPosition,S.searchSucceeded=!0),Qos.logData("SkyDriveWeb_Internal_Search_Result","SkyDrive",S.searchId,null,null,S,Date.now())}for(var x in v)C[x]=v[x];for(var D=1;l>D;D++){var E=s+D,P=$Cookie.getCookie(E);null!=P&&(C[E]=P)}var T=$Cookie.getCookie(d);null!=T&&(C[d]=T);var A=$Cookie.getCookie(a);if(null!=A){var L="0";"shown"==A&&(L="1"),$BSI.reportEvent("SkyDrive.FREEligible.ActionAfter",{FREShown:L}),$Cookie.deleteCookie(a)}$BSI.reportEvent("ClickedSelected.Command.SkyDrive",C)},prependBiciReportClickAction:function(e,i,n){return function(r){if(r){if(r.target)var o=jQuery(r.target);if(r.data)var a=r.data}return t.BiciHelpers.reportClickAction(i,n,null,o,null,a),e&&e.apply(this,arguments)}}}}()}),define("actionmanager",["jquery-1.7.2","dependancies","lightstring","bsi","bicihelpers"],function(){!function(){function e(){this._actions={}}var t=wLive.Core;t.ActionManager=e;var i=e.prototype;i.registerAction=function(e,t){this._actions[e]=t},i.isActionRegistered=function(e){return!!this._actions[e]},i.getAction=function(e,t){var i=this._actions[e];return i?i.getAction.apply(i,arguments):null},i.doAction=function(e){var t=!0;return e&&(e.click&&(t=e.click()),e.url&&($BSI.navigateTo(e.url,e.target),t=!1)),t},e.getATagAction=i.getATagAction=function(e,i,n){var r=e.click||function(){return $BSI.navigateTo(e.url),!1},o=e.skyCmd;return i&&o&&(r=e.click=t.BiciHelpers.prependBiciReportClickAction(r,o,i)),n&&(e.click=function(e){return n(e,r)}),e},e.setATagAction=i.setATagAction=function(t,i,n,r){return i=i||jQuery(document.createElement("a")),t=e.getATagAction(t,n,r),t.click&&i.bind("click.action",t.click),i.attr("href",t.url||"#"),t.target&&i.attr("target",t.target),i}}()}),define("imagestrip",["validateconfig","dependancies","wliveimagestrip"],function(){!function(){function e(e){for(var i=-1,n=0;n<t.length;n++)if(t[n].hasOwnProperty(e)){i=n;break}return i}var t=[window.FilesIS32||{},window.FilesIS8||{}],i=[FilesConfig.imageStripUrl_32,FilesConfig.imageStripUrl_8];window.require&&!$B.Mobile&&require(["skydrive_pc_strip_8_ltr","skydrive_pc_strip_32_ltr"],function(){t=[window.FilesIS32||{},window.FilesIS8||{}]});var n=wLive.Core.ImageStrip={};n.getImage=function(n,r,o){r=r||"",o=o||"";var a,s=e(n);if(s>-1){var l=t[s],d=i[s],u=l[n];a=$IS.Create(u.x,u.y,u.w,u.h,FilesConfig.imgBaseUrl,d,r,o)}return a}}()}),define("ticketredeemer",["alehelpers"],function(){!function(){function e(e){function u(e,t,i,n,r){if(ee.html((i?E:D).format($Config.email||"")),te.html(b(e,t,i)),i){var a=y(e,n,r),s=jQuery(o.format(F,a,M));X.append(s)}else require(["ic"],function(){$Do.when("$icm",0,function(){var e=$icm.createICForPerson("TokenRedemptionTemplate",$Config.cid,{namespace:d,showICCard:!0});e?(Z.html(e.render()),e.activate(jQuery(".c_ic",Z))):Z.html($Config.email)})})}function c(e,t,i,n,r,o){t==s?p(r,i,o):t==a?h(r.id,o,n):I.dispose()}function h(e,t,i){m(e,t,i),X.detach(),Y.html(P),ie.detach()}function p(e,t,i){var n=y(e,t,i);$BSI.navigateTo(n)}function m(e,i,n){var r=Object.toJSON({id:e,authKey:i}),o=new t.DataRequest(l,l,r,function(){f(n)},g);o.apiId="SkyDrive_Json_RedeemPermissionToken",o.propertyId="SkyDrive",o.start()}function f(t){e.tokenHasBeenRedeemed=!0,I.dispose(),t&&t()}function g(e){Y.html(X),ie.insertBefore(X.find(".header"))}function v(e,t,i){var n=w(e,t,i),r=FilesConfig.signInUrl+"&ru="+n.encodeUrl()+"&wreply="+n.encodeUrl();return r}function y(e,t,i){var n=w(e,t,i),r=FilesConfig.autoRedeemSignOut+("&lru="+n.encodeUrl());return r}function w(e,t,i){var n,r=t&&t.url;return n=r?r:"/?id="+e.id.encodeUrl()+"&cid="+e.ownerCid.encodeUrl()+(t?"&action="+t.name.encodeUrl():""),FilesConfig.autoRedeemUrl+"?resid="+e.id.encodeUrl()+"&authkey="+i.encodeUrl()+"&ru="+n.encodeUrl()}function C(e){var t;return t=e.folder?G:e.video?z:e.photo?K:J}function b(e,t,i){var n,r=0==t;return n=e.folder?i?V:r?R:j:e.video?i?q:r?O:W:e.photo?i?$:r?U:H:i?Q:r?N:B}var k,S,_,I=this,x="Office.TicketRedeem.",D=n(x+"You"),E=n(x+"Mobile.You"),P=n(x+"PleaseWait"),T=n(x+"Error"),A=n(x+"ContinueStr"),L=n(x+"SwitchAccounts"),F=n(x+"Mobile.SameAccount"),M=n(x+"Mobile.SwitchAccounts"),N=n(x+"GoldenTicketBodyDocument"),U=n(x+"GoldenTicketBodyPhoto"),R=n(x+"GoldenTicketBodyFolder"),O=n(x+"GoldenTicketBodyVideo"),B=n(x+"InfiniteTicketBodyDocument"),H=n(x+"InfiniteTicketBodyPhoto"),j=n(x+"InfiniteTicketBodyFolder"),W=n(x+"InfiniteTicketBodyVideo"),Q=n(x+"Mobile.BodyDocument"),$=n(x+"Mobile.BodyPhoto"),V=n(x+"Mobile.BodyFolder"),q=n(x+"Mobile.BodyVideo"),G=n(x+"HeaderFolder"),z=n(x+"HeaderVideo"),K=n(x+"HeaderPhoto"),J=n(x+"HeaderDocument"),X=jQuery(r),Y=jQuery(_ce("div")).html(X),Z=X.find(".icPlaceholder").css("padding-bottom","8px"),ee=X.find(".header").css("padding-bottom","8px"),te=X.find(".body"),ie=jQuery(_ce("div")).html(T).addClass("error");I.show=function(t){_=t;var n=t.callback,r=t.item,o=t.action,l=t.authkey,d=!t.container;d||(Y=t.container.html(X));var m=(r.id,r.tokenType);if(e.callerCid&&""!==e.callerCid)if(e.callerCid.toLowerCase()===r.ownerCid.toLowerCase())I.dispose(),n&&n();else{u(r,m,!d,o,l);var f=0===m?"GoldenTicketRedeem":"InfiniteTicketRedeem";if(k=C(r),d){var g={buttons:{action:A,alternate:L},title:k,content:Y};S=i.Notifications.createModalDialog(g);var y=jQuery(S);y.bind({"aftershow._dlg":function(e,i){var n=X.closest(".ModalDialog");sutra(n,"$Sutra.SkyDrive."+f);var r=S.getButton({buttonName:a});sutra(r,"$Sutra.SkyDrive.RedeemContinue");var o=S.getButton({buttonName:s});sutra(o,"$Sutra.SkyDrive.RedeemSwitchAccounts"),t.onShow&&t.onShow()},"afterdismiss._dlg":function(e,t){y&&y.unbind("._dlg"),y=null,S=null},"buttonclick._dlg":function(e,t,i){c(t,i,o,n,r,l)}}),S.show()}else{var w=X.find(".same"),b=X.find(".switch");w.click(function(){return h(r.id,l,n),!1}),b.click(function(){return p(r,o,l),!1}),sutra(Y,"$Sutra.SkyDrive."+f),sutra(w,"$Sutra.SkyDrive.RedeemContinue"),sutra(b,"$Sutra.SkyDrive.RedeemSwitchAccounts")}}else $BSI.navigateTo(v(r,o,l),"_top")},I.dispose=function(){X.remove(),ie.remove(),window.$icm&&window.$icm.removeAllICsByNamespace(d),S&&S.dismiss(),_.onHide&&_.onHide()}}var t=wLive.Core,i=wLive.Controls,n=t.AleHelpers.getPCString,r='<div class="ticketRedeemer"><div class="header"></div><div class="icPlaceholder"></div><div class="body"></div></div>',o='<ul class="commands"><li><a href="#" class="same">{0}</a></li><li><a href="{1}" class="switch">{2}</a></li></ul>',a="action",s="alternate",l=FilesConfig.baseApiUrl+"RedeemPermissionToken",d="Folders_TicketRedeemer";i.TicketRedeemer=e}()}),define("stringhelpers",["jquery-1.7.2","browserstorage","pagestats","jbase","basecontrol","validateconfig","lightobject","lightstring","alehelpers","datarequest","bicihelpers","viewcontext","imagestrip"],function(){!function(){wLive.Core.StringHelpers={caseInsensitiveStringEquals:function(e,t){return e==t?!0:null==e||null==t?!1:e.toLowerCase()==t.toLowerCase()}}}()}),define("throttle",["stringhelpers"],function(){!function(){var e={},t={};wLive.throttle=function(i,n,r,o){function a(){e[i]=setTimeout(function(){r(),delete e[i],o&&t[i]&&(r=t[i],delete t[i],a())},n)}return o&&e[i]?void(t[i]=r):(e[i]&&clearTimeout(e[i]),void a())},wLive.getExpDelayBackoff=function(e,t,i){if(0===t)return 0;var n=Math.floor(100*Math.random()),r=e*Math.pow(2,t-1),o=Math.min(r,i)+n;return o}}()}),define("skydriveitemset",["throttle"],function(){!function(){function e(e,t){var i=t._headerItemsSet&&e&&-1!==t._headerItemsSet.indexOf(e);return i&&n.push({set:t,headerSet:t._headerItemsSet,item:e}),!i}function t(e,t,i,n){for(var r=e+1;r<t.length;r++){var o=t[r];if(!(o.startIndex<=i.endIndex+1))break;if(o.mergeUp){if(n.endIndex<o.endIndex){var a=o.endIndex-n.endIndex;n.mergeDown=o.mergeDown,n.count+=a,n.endIndex+=a}o.count=-1,o.startIndex=-1,o.endIndex=-1}else{if(!o._filler)break;if(n.endIndex<o.endIndex){var s=o.endIndex-n.endIndex;o.count-=s,o.startIndex+=s}else o.count=-1,o.startIndex=-1,o.endIndex=-1}}}var i=wLive.Core,n=[];s_infiniteScrollBuffer=20;var r="SkyDriveItemSet",o="headerFilter",a=Shared.ItemSet.prototype;defineSubClass("SkyDrive.Core.SkyDriveItemSet",Shared.ItemSet,function(t,n,r){var a=this;a._dataModel=t,a._parentItemKey=n,a._setKey=r,a.setKeyParts=i.SkyDriveItem.getSetKeyParts(r),a._headerItemsSet=null,a.setFilter(o,e)},{modifiedDate:"-1",defaultGroupName:"FolderDocumentsPhotos",groupings:null,_rawCount:void 0,firstGroupingId:"folder",hasPendingRequests:function(){var e=this;return e._dataModel.hasPendingRequests(e._parentItemKey,e._setKey)},setHeaderItemsSet:function(e){var t=this;t._headerItemsSet&&t.removeChangeListener(t._headerItemsSet),t._headerItemsSet=e,e&&this.addChangeListener(e,t._onChildChanged)},isOutOfDate:function(){var e=this,t=!1,i=e.getParent(!0);if(i&&i.folder&&!i.neverExpires){var n=i&&i.modifiedDate!=e.modifiedDate,r=i&&0===i.folder.totalCount&&0===e._childCount,o=e.setKeyParts.tagFilter;t=i&&(i.hasExpired()||n&&(!r||o))}return t},peek:function(e,t){return this._get(e,t,!0)},get:function(e,t){return this._get(e,t,!1)},_get:function(e,t,i){var n=this,o=null,s=!1,l=!1,d=n._dataModel,u=n._parentItemKey,c=n._setKey,h=n._headerItemsSet,p=n.getCount(t),m=n._filteredIndexToActualIndex,f=n.isOutOfDate();if(h&&h.getCount()>0&&(h.getCount()>e?(o=h.get(e,t),s=!0):e-=h.getCount()),s||(o=a.get.call(n,e,t),l=!o&&e>=0&&p>e),o&&o.hasExpired()&&n.parentShouldBeExpiredOnGet()){f=!0;var g=o.getParent(!0);g&&g.expire(!1,!0)}if(!i&&(l||f)){var v=e;t||void 0===m[e]||(v=m[e]),d.fetchItem(u,c,null,v)&&Trace.log("get miss - index: "+e+", exists: "+!!o+", setExpired: "+f+", setKey: "+c,r)}return o&&(o.parentKey=u),o},parentShouldBeExpiredOnGet:function(){return!0},getCount:function(e){var t=this,i=t._headerItemsSet,n=a.getCount.call(t,e);return i&&(n+=i.getCount()),t.isOutOfDate()&&!n&&!t._materializedCount&&(n=1),n},getRawCount:function(){return this._rawCount||this.getCount()},setCount:function(e){var t=this,i=t.getParent(!0);if(!i||i.hasMoreResults!==!0&&i.hasMoreResults!==!1)a.setCount.call(t,e);else{var n=t._rawCount,r=i.folder.totalCount,o=i.folder.totalCount,s=t._childCount;if(i.hasMoreResults&&(n>r&&(r=n),s>=o?o=s:o+=s_infiniteScrollBuffer),t._rawCount=r,t._childCount=t._filteredCount=o,t._requiresFilter=!0,s>o)for(var l=s-1;l>=o;l--)t._indexToItem[l]&&t._materializedCount--,delete t._indexToItem[l]}},getGroupings:function(e){var t,i,n=this,r=n._headerItemsSet,o=a.getGroupings.call(n,e);if(r&&(i=r.getCount(e))){for(var s=[],l=0;l<o.length;l++){var d=o[l],u={name:d.name,itemGroups:[],partial:d.partial};s.push(u);var c=d.itemGroups;if(0==c.length||c[0].groupingId!=n.firstGroupingId){u.itemGroups.push({groupingId:n.firstGroupingId,startIndex:0,endIndex:i-1,count:i});for(var h=0;h<c.length;h++)t=c[h],u.itemGroups.push({groupingId:t.groupingId,startIndex:t.startIndex+i,endIndex:t.endIndex+i,count:t.count})}else for(var p=0;p<c.length;p++)t=c[p],u.itemGroups.push({groupingId:t.groupingId,name:t.name,startIndex:t.startIndex?t.startIndex+i:0,endIndex:t.endIndex+i,count:t.groupingId==n.firstGroupingId?t.count+i:t.count})}o=s}return i=this.getCount(e),i&&!o.length&&o.push({groupingId:"other",startIndex:0,endIndex:i-1,count:i}),o},getParent:function(e){var t=this,i=t._dataModel;return i?i.getItem(t._parentItemKey,e):null},indexOf:function(e,t,i){var n=this,o=n._headerItemsSet,s=n._dataModel,l=n._parentItemKey,d=n._setKey,u=n.isOutOfDate(),c=-1;return o&&(c=o.indexOf(e,t)),-1==c&&(c=a.indexOf.call(n,e,t),i||-1!==c&&!u||s.fetchItem(l,d,e.id,0)&&Trace.log("indexOf miss - id: "+e.id+", setExpired: "+u+", setKey: "+d,r),o&&-1!==c&&(c+=o.getCount(t))),c},remove:function(e){var t=this,i=t.indexOf(e,!0,!0);-1!=i&&t.removeAt(i,!0)},removeAt:function(e,t){var i=this._headerItemsSet;if(i){var n=i.getCount();n>e?i.removeAt(e,t):a.removeAt.apply(this,[e-n,t])}else a.removeAt.apply(this,arguments)},insertWithGroupHint:function(e,t,i,n){var r=this._headerItemsSet;if(r){var o=r.getCount();o>e?r.insertWithGroupHint(e,t,i,n):a.insertWithGroupHint.apply(this,[e-o,t,i,n])}else a.insertWithGroupHint.apply(this,arguments)},clone:function(){var e=this,t=new SkyDrive.Core.SkyDriveItemSet(e._dataModel,e._parentItemKey,e._setKey),i=a.get;t.groupings=this.groupings;for(var n=0;n<e.getCount();n++){var r=i.call(e,n);r&&t.set(n,r)}t.modifiedDate=e.modifiedDate;var o=e._headerItemsSet,s=new Shared.ItemSet;if(o)for(n=0;n<o.getCount();n++){var l=o.peek(n);l&&s.set(n,l)}return t.setHeaderItemsSet(s),t},isComplete:function(){var e=this;return e._materializedCount===e._childCount},sort:function(){for(var e=this,t=i.SkyDriveItem.getSetKeyParts(e._setKey),n=[],r=0;r<e.getCount();r++){var o=e.peek(r);n.push(o)}var a=n.sort(function(e,n){function r(e,t){var n=i.JSONConstants.SortField;switch(t){case n.ModifiedDate:return e.dateModifiedOnClient||0;case n.CreatedDate:return e.creationDate||0;case n.Size:return e.size||0;case n.Name:return e.name}}var o=t.sr;t.sd&&(o=t.sd==i.JSONConstants.SortDirection.Default);var a=r(n,t.sb),s=r(e,t.sb),l=t.sb==i.JSONConstants.SortField.Name?a.localeCompare(s):a-s;return o&&(l=-l),e.folder&&!n.folder?-1:!e.folder&&n.folder?1:!e.video&&!e.photo||n.photo||n.video?!n.video&&!n.photo||e.photo||e.video?l:-1:1});for(r=0;r<a.length;r++)e.set(r,a[r])},_mergeGroupingsFromServer:function(e,i){var n=this,r=this.getCount(!0);!i&&n.groupings||(n.groupings=e);for(var o=0;o<e.length;o++){for(var a,s=e[o],l=n.groupings,d=0;d<l.length;d++)l[d].name===s.name&&(a=l[d]);if(a||(a=e[o],n.groupings.push(e[o])),s.partial){var u=[],c=s.itemGroups;if(i){if(c.length>0){var h=c[0];0!==h.startIndex&&u.push({groupingId:"other",startIndex:0,endIndex:h.startIndex-1,count:h.startIndex,__filler:!0});for(var p=0;p<c.length;p++){var m=c[p];m.endIndex=m.startIndex+m.count-1,u.push(m)}var f=c[c.length-1],g=f.startIndex+f.count-1;g!==r-1&&u.push({groupingId:"other",startIndex:g+1,endIndex:r-1,count:r-g-1,__filler:!0})}}else for(var v=a.itemGroups,y=c.length>0?c[0]:null,w=0;w<v.length;w++){var C=v[w];if(y&&y.startIndex<=C.endIndex&&C.__filler){for(var b=0;b<c.length;b++){var k=c[b];if(k.endIndex=k.startIndex+k.count-1,k.startIndex<=C.endIndex&&k.endIndex>=C.startIndex)if(k.startIndex<=C.startIndex){var S=k;if((k.mergeUp||k.startIndex<C.startIndex)&&w>0&&v[w-1].mergeDown){var _=k.count-(C.startIndex-k.startIndex);S=v[w-1],S.count+=_,S.endIndex+=_,S.mergeDown=k.mergeDown,C.count-=_,C.startIndex+=_}else u.push(k),C.count-=k.count,C.startIndex+=k.count;if(C.count<=0){t(w,v,k,S);break}}else if(u.push({groupingId:"other",startIndex:C.startIndex,endIndex:k.startIndex-1,count:k.startIndex-C.startIndex,__filler:!0}),u.push(k),C.startIndex=k.endIndex+1,C.count=C.endIndex-C.startIndex+1,C.count<=0){t(w,v,k,k);break}}C.count>0&&u.push(C)}else C.count>0&&u.push(C)}a.itemGroups=u}}}},{removeMarkedHeaderItems:function(){for(;n.length>0;){var e=n.pop(),t=e.set,i=e.headerSet,r=e.item;i.remove(r),t._requiresFilter=!0}},setInfiniteScrollBuffer:function(e){s_infiniteScrollBuffer=e}})}()}),define("skydriveitem",["skydriveitemset"],function(){!function(){function e(e,i){var n=e.parentKey,r=e.key,o=e.snippet,a=e.highlights,s=e.directlyShared,l={};t(l,e.keyParts,1),t(e,i,1),delete e.partialData,e.parentKey=n,e.key=r,e.keyParts=l,e.snippet=o,e.highlights=a,e.directlyShared=s}function t(e,i,n){for(var r in i){var o=i[r];if(o&&"object"==typeof o&&!Object.isArray(o)&&n>0){var a=e[r]=e[r]||{};t(a,o,n-1)}else e[r]=o}}function i(e){if(H&&e)for(var t=0;t<H.length;t++)if(e.id===H[t].id)return!1;return!0}function n(e,t){if("shared"==t.qt){if(!H&&(H=l.getLocalValue(g))){for(var n=new Date,r=0;r<H.length;r++){var o=H[r];new Date(o.expire)<n&&(H.splice(r,1),r--)}l.setLocalValue(g,H)}e.setFilter("abdicatedItems",i)}}function r(e){var t=e.folder;t&&(t.covers=t.covers||null,t.hasSubfolders=!!t.hasSubfolders),e.isProcessingVideo=e.isProcessingVideo||!1}function o(e,t){var i=a.JSONConstants.FilterType,n=e.totalCount,r=a.SkyDriveItem.getSetKeyParts(t),o=r?r.ft:"";return o==i.AllFolders?n=void 0!==e.folderCount?e.folderCount:e.hasSubfolders?1:0:o==i.PhotosAndVideos&&void 0!==e.photoCount&&(n=e.photoCount),void 0!==n?n:1}var a=wLive.Core,s=(a.AleHelpers.getPCString,a.AleHelpers.getString),l=window.BrowserStorage,d="SkyDriveItem",u="root",c="default",h="NonEmptyDocumentFolder",p=wLive.Core.AleHelpers.getPCString("SkyDriveProductName"),m=0,f="SkyDriveItem",g="SkyDrive.AbdicatedItems",v="SkyDrive.RecycledItems",y="shared",w="sharedby",C="allmyphotos",b="search",k="mru",S="recyclebin",_=s("DocsSharedWithMe"),I=s("RecentDocuments"),x=s("RecycleBin"),D=s("SharedWithGroup"),E=s("SearchResults"),P=s("SharedLandingPage"),T=s("AllMyPhotosLandingPage"),A=s("AllFilesRootTitle"),L=s("AllFilesVisitorRootTitle"),F=0,M="rd,1",N=12e4,U=36e7,R={},O={},B=null,H=null,j="f",W="p",Q="r",$="h",V="s",q="d",G="b",z="y";defineClass("wLive.Core.SkyDriveItem",function(e,t,i,n){t==i&&(i=null);var r=this;r.instance=m++,r._dataModel=e,r.key=t,r.specialFolderKey=n,r.keyParts=a.SkyDriveItem.getItemKeyParts(t),r.parentKey=i,r.id=r.keyParts.id,r.did=r.keyParts.did,r.documentFormat=wLive.Core.SkyDriveItem.DocumentFormat.Default,r.name=r._getNameForItem(r.keyParts)},{__isObservable:!0,commands:null,parentId:null,ghostId:null,modifiedDate:-1,name:null,extension:null,orderedFriendlyName:null,ownerName:null,ownerCid:null,resourcePartitionCid:null,iconType:null,isUnknownFileType:!1,folder:null,sharingLevel:null,group:null,groupFolderType:0,hasPendingGroupJoinRequest:null,userInvitedToGroupOnDifferentEmail:null,userRole:null,partialData:null,hasMoreResults:null,neverExpires:null,estimatedResultCount:null,maxReturnableResultCount:null,directlyShared:null,snippet:null,sharingRootResourceId:null,highlights:null,textEditorMimeType:null,tokenNeedsRedeeming:!1,photo:null,video:null,ocr:null,tags:null,downloadUrl:null,downloadUrlTimestamp:0,quotaRemaining:0,recycledSharedItemInfo:null,thumbnailSet:null,isAlbum:!1,_isLoadingItem:!1,_missingName:!0,_expirationDate:0,_isNewFolder:!1,_childSets:null,_headerItemsSet:null,_dataContext:null,_version:0,processItem:function(e){var i=this,n=!1;if(this._isNewFolder=!1,void 0===e.modifiedDate||e.modifiedDate>=i.modifiedDate||this.parentId!=e.parentId){if(r(e),this.parentKey&&this.parentId!=e.parentId){var o=a.SkyDriveItem.getItemKeyParts(this.parentKey),s=a.SkyDriveItem.getItemKey(this.parentId,o.cid,o.group,null,null,o.q,o.sft);s==this.parentKey&&(this.parentKey=a.SkyDriveItem.getItemKey(e.parentId,o.cid,o.group,o.qt,o.did,o.q,o.sft))}var l=a.GroupFolderType.None;e.groupFolderType&&(l="OriginalSyncRoot"==e.groupFolderType?a.GroupFolderType.OriginalSyncRoot:"MountPoint"==e.groupFolderType?a.GroupFolderType.MountPoint:a.GroupFolderType.None);var d=this.folder?this.folder.totalCount:-1,u=l==a.GroupFolderType.MountPoint&&!!e.folder&&!e.folder.totalCount,p=e.folder&&!u?e.folder.totalCount:-1;(e.modifiedDate!=i.modifiedDate||p!=d||e.sharingLevel!=i.sharingLevel||e.ocr&&(!i.ocr||e.ocr.engineVersion!=i.ocr.engineVersion)||e.quotaRemaining&&e.quotaRemaining!=i.quotaRemaining)&&(i._version++,n=!0);var m=null;e.folder&&(m=e.folder.children,delete e.folder.children),t(i,e,1),i.groupFolderType=l,m&&(e.folder.children=m),e.folder&&(!i._childSets&&(i._childSets={}),!i._headerItemsSet&&(i._headerItemsSet=new Shared.ItemSet)),i.itemStatus=e.itemStatus||0,i.folder&&(i.folder.totalCount=p),i._missingName=!e.name,i.name=i._getNameForItem(i.keyParts),i.parentId=e.parentId,i.resourcePartitionCid=e.resourcePartitionCid?e.resourcePartitionCid:"",e.sharingRootResourceId&&(i.sharingRootResourceId=e.sharingRootResourceId);var f=i.isViewerOwner();if(!i.ownerName&&(i.ownerName=f?FilesConfig.userDisplayName:""),
!i.ownerCid&&(i.ownerCid=i.keyParts.cid),!i.iconType&&(i.iconType=e.folder?h:c),i.isUnknownFileType=a.StringHelpers.caseInsensitiveStringEquals(i.iconType,c),e.docFormat&&1==e.docFormat&&(i.documentFormat=a.SkyDriveItem.DocumentFormat.ODF),i.thumbnailSet&&i.thumbnailSet.thumbnails){var g=!!FilesConfig.thumbnailCropEnabled;if(i.photo&&!g)i.thumbnailSet.size={width:i.photo.width,height:i.photo.height};else for(var v=0;v<i.thumbnailSet.thumbnails.length;v++){var y=i.thumbnailSet.thumbnails[v];if("scaled2560"==y.name){i.thumbnailSet.size={width:y.width,height:y.height};break}}}}i._commands=null,i.did&&(i.commands=M+(i.commands?","+i.commands:"")),i.isAlbum&&(i.commands="de,1"+(i.commands?","+i.commands:""));var w=i.neverExpires?U:N;return i._expirationDate=(new Date).getTime()+w,n},updateItemProperties:function(e,t,i,n){var r=this;r._dataModel.updateItemProperties(r,e,t,i,n)},updateItemProperty:function(e,t,i,n,r,o){var a=this;this._isNewFolder&&"name"==e?(a.name=(t||"").trim(),a.invalidate(),a._dataModel.createSubfolder(a.getParent(),a.name,null,i,n,a)):a._dataModel.updateItemProperty(a,e,t,i,n,r,o)},updateTags:function(e,t,i,n,r){var o=this;o._dataModel.updateTags(o,e,t,i,n,r)},createSubFolder:function(e,t,i,n){var r=this;r._dataModel.createSubfolder(r,e,t,i,n)},getExtendedInfo:function(e,t,i){var n;switch(i){case a.SkyDriveItem.ExtendedProperty.MoSkyDocProperties:n="&with=davUrl,mimetype";break;case a.SkyDriveItem.ExtendedProperty.QuotaInfo:n="";break;case a.SkyDriveItem.ExtendedProperty.WacIFrameViewUrl:n="&with=waciframeviewurl"}this._dataModel.fetchItem(this.key,a.SkyDriveItem.getSetKey(),null,0,!0,this.modifiedDate,e,t,0,n)},hasExpired:function(){return this._expirationDate<(new Date).getTime()},getVersion:function(){return this._version},getDisplayName:function(e,t){var i=this,n=i.name;if(e&&!i.parentKey)if(i.did){var r=e.deviceItemSet.getByKey(i.did.toLowerCase());n=r?r.name:""}else n=i.isQt("search")?s("SearchResults").format(i.getSearchQuery()):i.isQt("recyclebin")?s("RecycleBinLowerCase"):i.isQt("sharedby")?s("SharedLandingPage"):i.ownerName&&(i.isViewerOwner()||i.isViewerCoOwner())?i.orderedFriendlyName&&i.isViewerOwner()?s("UsersSkyDrive").format(i.orderedFriendlyName):s("UsersSkyDrive").format(i.ownerName):p;else{var o=i.extension;(i.isUnknownFileType||i.textEditorMimeType||t)&&o&&(n+=o)}return n},getJsonApiCommandActionIndex:function(e){return wLive.Core.SkyDriveItem.getJsonApiCommandActionIndex(this,e)},isViewerOwner:function(){var e=this;return!e.ownerCid||e.ownerCid.toLowerCase()==FilesConfig.hcid.toLowerCase()},isViewerCoOwner:function(){return 4===this.userRole||FilesConfig.isUserInGfRamp&&1===this.userRole},doesViewerHaveEditAccess:function(){var e=this;return 1===e.userRole||e.isViewerCoOwner()||e.isViewerOwner()},getUploadUrlCid:function(){var e=this;return e.resourcePartitionCid?e.resourcePartitionCid:e.ownerCid},hasPendingRequests:function(){return this._dataModel.hasPendingRequests(this.key)},isLoading:function(){return this._isLoadingItem},isWebPlayableVideo:function(){return!!this.video},isQt:function(e){return a.StringHelpers.caseInsensitiveStringEquals(this.keyParts.qt,e)},isParQt:function(e){return a.StringHelpers.caseInsensitiveStringEquals(this.keyParts.parQt,e)},getSearchQuery:function(){return this.keyParts.q||""},extendPartialData:function(t){var i=this,n=a.SkyDriveItem.getItemKeyParts(i.key),r=a.SkyDriveItem.getItemKey(n.id,n.cid,parseInt(n.group),void 0,n.did,void 0,void 0),o=i._dataModel.getItem(r,!0),s=i._dataModel.getItem(i.key,!0);o&&!o.hasExpired()&&s&&!s.hasExpired()?(e(i,o),t(i)):i._dataModel.fetchItem(r,a.SkyDriveItem.getSetKey("0"),null,0,!1,i.modifiedDate,function(n){e(i,n),t(i)})},getParent:function(e){var t=this;return t.parentKey?t._dataModel.getItem(t.parentKey,e):null},getChildren:function(e){var t=this,i=this._childSets,r=null;if(i){if(e=e||B,t.isQt("shared")||t.isQt("sharedby")||t.isParQt("sharedby")||t.isQt("allmyphotos")||t.isParQt("allmyphotos")){var s=a.SkyDriveItem.getSetKeyParts(e);e=a.SkyDriveItem.getSetKey(s.sb,null,s.ft,"0",s.sd,s.tagFilter)}if(r=i[e],!r){var l=a.SkyDriveItem.getSetKeyParts(e);for(var d in i){var u=a.SkyDriveItem.getSetKeyParts(d),c=i[d];if(l.ft===u.ft&&l.tagFilter===u.tagFilter&&u.sb===l.sb&&u.sd===l.sd&&c.isComplete()&&1==c.getCount()){r=i[e]=c.clone(),r._setKey=e,r.setKeyParts=$Utility.deserialize(e,"&",!1,!1);break}}r||(r=i[e]=new SkyDrive.Core.SkyDriveItemSet(t._dataModel,t.key,e),l&&l.ft&&l.ft===a.JSONConstants.FilterType.PhotosAndVideos||r.setHeaderItemsSet(t._headerItemsSet),n(r,this.keyParts))}"-1"==r.modifiedDate&&r.setCount(o(t.folder,e))}return r},remove:function(){raiseEvent(this,"removeItem",this)},setVisibility:function(e){var t=this;t.isVisible=e,change(this)},getVisibility:function(){var e=this;return void 0===e.isVisible||e.isVisible},clearRotationState:function(){this.rotationState=null,this.invalidate(!0)},getRotationState:function(e){var t=this;return e?t.rotationState:t.rotationState||0},rotateClockwise:function(e){this.rotationState=((this.rotationState||0)+e)%4,this.invalidate(!0)},invalidate:function(e){var t=this;Trace.log("Item invalidating (name: "+this.name+", suppressVersionIncrement: "+e+")",d),e||t._version++;var i=t;for(change(this);i;)t._dataModel._fireDataChanged(i),i=i.getParent(!0)},expire:function(e,t){var i=this;if(-1!=i._expirationDate&&(Trace.log("Item expiring (name: "+this.name+", expireAncestors: "+e+", suppressAbort: "+t+")",d),i._expirationDate=-1,i._dataModel.setItemVersion(i.key)),e){var n=i.getParent(!0);n&&n.expire(!0,t)}t||i._dataModel.abortPendingRequests(i.key)},getHasSubfolders:function(){var e=this.folder&&this.folder.hasSubfolders,t=this.ghostId&&this.folder&&(void 0!==this.folder.childCount?this.folder.childCount>0:this.folder.totalCount>0);return e||this._headerItemsSet&&this._headerItemsSet.getCount()>0||t},createPinnedSubfolder:function(){var e=this,t=null;if(e._headerItemsSet){var i="NewFolder"+F++;t=new a.SkyDriveItem(this._dataModel,a.SkyDriveItem.getItemKey(i),this.key),t.processItem({folder:{totalCount:0,childCount:0},name:FilesConfig.defaultFolderString,commands:"rn,1",group:e.group,cid:e.ownerCid,ownerName:e.ownerName,sharingLevel:e.sharingLevel,_isNewFolder:!0}),Trace.log("Creating a pinned subfolder under: "+this.key,f),e._headerItemsSet.insert(0,t),e._headerItemsSet.invalidate()}return t},removePinnedSubfolder:function(e){var t=this,i=t._headerItemsSet;i&&(i.remove(e),i.invalidate())},updatePinnedSubfolderKey:function(e){var t=this,i=!1;if(t._headerItemsSet){var n=t._headerItemsSet.indexOf(e);n>=0&&(t._headerItemsSet.remove(e),e.key=a.SkyDriveItem.getItemKey(e.id,e.ownerCid,e.group,null,null),e.keyParts=a.SkyDriveItem.getItemKeyParts(e.key),e.clearItemSets(),t._headerItemsSet.insert(n,e),t._headerItemsSet.invalidate(),i=!0)}i||(e.key=a.SkyDriveItem.getItemKey(e.id,e.ownerCid,e.group,null,null),e.keyParts=a.SkyDriveItem.getItemKeyParts(e.key),e.clearItemSets())},clearItemSets:function(){var e=this;if(null!==e._childSets){for(var t in e._childSets)e._childSets[t].clear();e._childSets={}}},getDevice:function(){var e=this,t=null;if(e.keyParts.did){var i=a.ViewContext.getInstance().deviceItemSet;t=i.getByKey(e.keyParts.did.toLowerCase())}return t},getDeviceBaseUrl:function(){var e=this,t=null,i=e.getDevice();return i&&(t=i.baseUrl),t||FilesConfig.devicesBaseUrl},getViewCategory:function(){return wLive.Core.SkyDriveItem.getViewCategory(this)},_getNameForItem:function(e){var t=this,i=t.name||"",n="1"==e.group;if(t.id==u&&t._missingName){var r=e.qt;if(e.did){var o=t.getDevice();i=o?o.name:""}else if(r===y)i=n?D:_;else if(r===w)i=P;else if(r===C)i=T;else if(r===b)i=E.format(t.getSearchQuery());else if(n)i=t.ownerName||"";else if(r===k)i=I;else if(r===S&&FilesConfig.recycleBinEnabled)i=x;else{var s=t.checkForName&&t.checkForName(t,a.ViewContext.getInstance());if(s)i=s;else if(!this.parentKey&&!this._isLoadingItem){var l=this.ownerCid&&this.ownerCid.toLowerCase()==FilesConfig.hcid.toLowerCase();i=l?A:this.ownerName?L.format(this.ownerName):""}}}return i}},{getJsonApiCommandActionIndex:function(e,t){var i=null;if(e&&e.commands){if(!e._commands){var n=e.commands.split(",");e._commands={};for(var r=0;r<n.length;r+=2)e._commands[n[r]]=n[r+1]}i=e._commands[t]}return i},getItemKey:function(e,t,i,n,r,o,a,s,l){return this.getItemKeyFromObject({id:e,ownerCid:t,isGroup:i,queryType:n,deviceId:r,searchQuery:o,searchFilterType:a,internalPath:s,rif:l})},getItemKeyFromObject:function(e){var t={id:e.id||u,cid:(e.ownerCid||""+FilesConfig.hcid).toLowerCase(),group:Number(e.isGroup)?"1":"0",qt:(e.queryType||"").toLowerCase(),did:e.deviceId||"",q:e.searchQuery||"",sft:e.searchFilterType||"",beginDate:e.beginDate||"",endDate:e.endDate||"",highlights:e.highlights||"",internalPath:e.internalPath||"",rif:e.rif};t.did||(t.id=t.id.toLowerCase()),void 0===t.rif&&(t.rif=this.getRecycledFilter(t));var i="id="+t.id.encodeUrl()+"&cid="+t.cid.encodeUrl()+"&group="+t.group.encodeUrl()+"&qt="+t.qt.encodeUrl()+"&rif="+t.rif.encodeUrl();return t.did&&(i+="&did="+t.did.encodeUrl()),t.q&&(i+="&q="+t.q.encodeUrl()),t.sft&&(i+="&sft="+t.sft.encodeUrl()),t.beginDate&&(i+="&beginDate="+t.beginDate.encodeUrl()),t.endDate&&(i+="&endDate="+t.endDate.encodeUrl()),t.highlights&&(i+="&highlights="+t.highlights.encodeUrl()),t.internalPath&&(i+="&internalPath="+t.internalPath.encodeUrl()),R[i]=t,i},getItemKeyParts:function(e){var t=R[e];if(!t){var i=$Utility.deserialize(e,"&",!1,!1);a.SkyDriveItem.getItemKey(i.id,i.cid,parseInt(i.group),i.qt,i.did,i.q,i.sft,i.internalPath,i.rif),t=R[e]}return t},getSetKey:function(e,t,i,n,r,o){var a=O[B]||{},s=e||a.sb||"0",l=null!==t&&void 0!==t,d=l?t:a.sr,u=Number(d)?"1":"0",c=String(i||"");n=n||"0,1,2",r=r||"0";var h="ft="+c.encodeUrl()+"&sb="+s.encodeUrl()+(l?"&sr="+u:"")+(l?"":"&sd="+r)+"&gb="+n.encodeUrl();return o&&(h+="&tagFilter="+o.encodeUrl()),O[h]={ft:c,sb:s,gb:n},l?O[h].sr=d:O[h].sd=r,o&&(O[h].tagFilter=o),h},getSetKeyParts:function(e){return e=e||B,O[e]},setDefaultSetKey:function(e){B=e},getDefaultSetKey:function(){return B},areItemsSame:function(e,t,i){if(e&&t){var n=!i||e.commands===t.commands&&e.name===t.name&&!t.error;return e.key===t.key&&e.modifiedDate===t.modifiedDate&&e._isLoadingItem===t._isLoadingItem&&n}return!e&&!t},isFolderWithCovers:function(e){return e&&e.folder&&e.folder.covers},getRecycledFilter:function(e){var t="0";if(FilesConfig.showRecycledItemsMenu){var i=FilesConfig.hcid.toLowerCase(),n=e.cid.toLowerCase(),r=wLive.Core.SkyDriveItemHelper.parseCidFromItemId(e.id.toLowerCase()),o=i===n&&(!r||i===r);t=o&&l.getSessionValue(v)||"0"}return t},setRecycledFilter:function(e){l.setSessionValue(v,e)},DocumentFormat:{Default:0,ODF:1},ExtendedProperty:{Default:0,MoSkyDocProperties:1,QuotaInfo:2,WacIFrameViewUrl:3},getViewCategory:function(e){var t=j;return e&&e.folder&&(1===e.folder.category?t=W:"mru"===e.keyParts.qt?t=Q:"shared"===e.keyParts.qt?t=$:"search"===e.keyParts.qt?t=V:"recyclebin"===e.keyParts.qt?t=G:"sharedby"===e.keyParts.qt?t=z:e.did&&(t=q)),t},ViewCategories:{DefaultFolder:j,PhotoFolder:W,RecentDocs:Q,Shared:$,Search:V,Devices:q,RecycleBin:G,SharedBy:z}}),a.ClientSortableFields={2:!0,3:!0,4:!0},a.QuotaStatus={Normal:0,Nearing:1,Exceeded:2},a.ItemStatus={Active:0,Restricted:1,RestrictedICN:2},a.ReviewState={NotReviewed:0,AutoReviewed:1,AgentReviewed:2,Challenged:3,ChallengeReviewed:4},a.GroupFolderType={None:0,OriginalSyncRoot:1,MountPoint:2},a.ThumbnailCropMode={Center:0,Fit:1},B=a.SkyDriveItem.getSetKey()}()}),define("deviceitem",["skydriveitem"],function(){!function(){defineClass("wLive.Core.DeviceItem",function(e){this.processItem(e)},{__isObservable:!0,processItem:function(e){var t=this;t.isVisible=!0,jQuery.extend(t,e),t.id="root",t.folder={},t.commands="defc,1",t.baseUrl=null},setVisibility:function(e){this.isVisible=e,change(this)},isQt:function(e){return!1},getJsonApiCommandActionIndex:wLive.Core.SkyDriveItem.prototype.getJsonApiCommandActionIndex},{hasNewBaseUrlError:function(e,t){var i=!1;if((!e||e.isRetriable)&&t){var n=wLive.Core.ViewContext.getInstance().deviceItemSet,r=n.getByKey(t.toLowerCase());r&&(r.baseUrl=null,i=!0)}return i}})}()}),define("deviceitemset",["deviceitem"],function(){!function(){function e(){d||(d=!0,l.callerCid&&t())}function t(){var e=new n.DataRequest(s,s,null,function(e){Trace.log("DeviceItemSet.js getDevices() successCallback - devices count: "+(e.devices?e.devices.length:"no devices returned"),o),e.devices&&i(e)},function(){i(null)});e.apiId="SkyDrive_Json_GetDevices",e.propertyId="SkyDrive",e.start()}function i(e){if(Trace.log("DeviceItemSet.js parseResponse()",o),!e||e.error)c>0&&(c--,t());else{var i=e.devices||[];h=[];for(var n=0;n<i.length;n++){var r=i[n];r.key=r.did.toLowerCase(),h.push(new wLive.Core.DeviceItem(r))}change(wLive.Core.DeviceItemSet)}}var n=wLive.Core,r=n.AleHelpers.getPCString,o="DeviceItemSet",a="DeleteRemove.Device",s=FilesConfig.baseApiUrl+"GetDevices",l=n.ViewContext.getInstance(),d=!1,u=3,c=u,h=null,p=Shared.ItemSet.prototype;defineSubClass("wLive.Core.DeviceItemSet",Shared.ItemSet,function(){var t=this;t._onLoadCallbacks=[],e(),h&&(t.isLoaded=!0,t.load(h)),t.addChangeListener(wLive.Core.DeviceItemSet,function(){t.isLoaded=!0,t.load(h),t.invalidate()})},{isLoaded:!1,waitForLoad:function(e){var t=this;t.isLoaded?e.apply(t):t._onLoadCallbacks.push(e)},load:function(e,t,i){var n=this;if(n._onLoadCallbacks&&n._onLoadCallbacks.length){for(var r=0;r<n._onLoadCallbacks.length;r++)n._onLoadCallbacks[r].apply(n);n._onLoadCallbacks=[]}Shared.ItemSet.prototype.load.apply(n,arguments)},remove:function(e){var t=this,i=FilesConfig.baseApiUrl+"RemoveDevice";$BSI.reportEvent(a,{});var o=n.ViewContext.getInstance();e.setVisibility(!1),$BSI.navigateTo("#cid="+FilesConfig.hcid.encodeUrl());var s={did:e.did},l=new n.DataRequest(i,i,Object.toJSON(s),function(i){p.remove.call(t,e);var n=jQuery("<span>"+r("RemoveDevice.SuccessNotification").format(e.name).encodeHtml()+"</span>");sutra(n,"$Sutra.SkyDrive.RemoveDeviceSuccess"),o.errorManager.add({$element:n,priority:1,type:2})},function(t){e.setVisibility(!0);var i=jQuery("<span>"+r("RemoveDevice.ErrorNotification").format(e.name).encodeHtml()+"</span>");sutra(i,"$Sutra.SkyDrive.RemoveDeviceError"),o.errorManager.add({$element:i,priority:0,type:0,code:"deviceRemove"})});l.apiId="SkyDrive_Json_RemoveDevice",l.propertyId="SkyDrive",l.start()}})}()}),define("groupinfo",["deviceitemset"],function(){!function(){function e(e,t){var v=this,y=$Utility.deserialize(t,"&",!1,!1),w=(e.displayName,e.email),C=e.membershipState,b=e.permissions,k=e.membership,S=y.cid;v.emailHtml=function(){var e;if(w&&w!==o){var t=s.format(w.encodeUrl());e=n.format(t.encodeHtmlAttribute(),w.encodeHtmlAttribute());var i=jQuery(e);i.click(g(null,"EG",a)),e=i}else if(C&&C>5){var r=m.format(S);e=h+'<br /><a href="'+r.encodeHtmlAttribute()+'">'+p+"</a>"}return e},v.emailTitle=function(){return w},v.emailHistoryHtml=function(){var e;if(w&&w!==o){var t=u.format(w.encodeUrl());e=n.format(t.encodeHtmlAttribute(),c);var i=jQuery(e);i.click(g(null,"VGE",a)),e=i}return e},v.membershipHtml=function(){var e;return C&&C>3&&(e=i(r+".Membership"+C)),e},v.permissionsHtml=function(){var e;return null!=b&&(e=i(r+".Permissions"+b)),e},v.groupOptionsLink=function(){var e;if(C&&C>4){var t=l.format(S);e=n.format(t.encodeHtmlAttribute(),d);var i=jQuery(e);i.click(g(null,"VGO",a)),e=i}return e},v.canInvite=function(){return C&&C>5},v.groupMembership=function(){return k},v.membershipPageLink=function(e){var t=f.format(S);return n.format(t.encodeHtmlAttribute(),e)}}var t=wLive.Core,i=t.AleHelpers.getPCString,n='<a href="{0}">{1}</a>',r="GroupInfo",o="",a="IP",s=FilesConfig.groupMailUrl,l="/cid-{0}/GroupOptions",d=i(r+".ViewGroupOptions"),u=FilesConfig.groupMailSearchUrl,c=i(r+".ViewEmail"),h=i(r+".EmailTurnedOff"),p=i(r+".TurnOnEmailLinkText"),m=l+"/email",f="/cid-{0}/Groupmembership/",g=t.BiciHelpers.prependBiciReportClickAction;t.GroupInfo=e}()}),define("skydriveitemhelper",["groupinfo"],function(){!function(){function e(e){var i=t(e,"qt");return i&&""!==i}function t(e,t){return e?(e.keyParts||(e.keyParts=$Utility.deserialize(e.key,"&",!1,!1)),e.keyParts[t]):void 0}function i(e,t,i,r){var o=mix({},e);r=r||n.ThumbnailCropMode.Center;var a,s,l,d=Math.round(Math.min(e.width,t)),u=Math.round(Math.min(e.height,i));if(r===n.ThumbnailCropMode.Center)a=d,s=u,l="&cropMode=center";else{var c=e.width/e.height,h=d/u;c>h?(a=d,s=d/c):(a=u*c,s=u),l=""}return mix(o,{url:e.url.replace("http:","https:")+(e.url.indexOf("?")>-1?"&":"?")+"width="+d+"&height="+u+l,width:a,height:s}),o}var n=wLive.Core,r=n.JSONConstants,o=r.SharingLevel,a=n.AleHelpers.getPCString,s=n.AleHelpers.getSkyString,l=n.AleHelpers.getString,d="SkyDriveItemHelper";Trace.register(d,{isEnabled:!1});var u="",c=":",h=1e3,p=6e4,m=36e5,f="lastModifierName",g=1,v=new RegExp(r.InvalidNameRegEx),y="root",w="photomail_",C=a("SkyDriveProductName"),b=l("UsersSkyDrive"),k="Doc",S="One",_="Ppt",I="Xls",x="Vsd",D="Lib",E="Drive",P="CDDrive",T="USBDrive",A="ExtDrive",L="NetDrive",F="ipi_",M='<span class="'+F+'arrow">{0}</span>',N=null,U=1,R=2,O={WinDocuments:D,WinLibrary:D,WinMusic:D,WinPictures:D,WinPodcastLibrary:D,WinVideos:D,WinDrive:E,CDDrive:P,GenericDrive:E,UsbDrive:T,ExternalDrive:A,NetworkStorage:L,Accdb:"Mdb",Doc:k,Docm:k,Docx:k,Dot:k,Dotm:k,Dotx:k,Exe:"Exe",Html:"Html",Mdb:"Mdb",Mpp:"Mpp",Mpt:"Mpp",Odp:_,Ods:I,Odt:k,One:S,Onepkg:S,Onetoc2:S,Notebook:"OneNotebook",Pot:_,Potm:_,Potx:_,Ppa:_,Ppam:_,Pps:_,Ppsm:_,Ppsx:_,Ppt:_,Pptm:_,Pptx:_,Pub:"Pub",Rtf:"Rtf",Txt:"Txt",Vdw:x,Vsd:x,Vsdm:x,Vsdx:x,Vsl:x,Vss:x,Vssm:x,Vssx:x,Vst:x,Vstm:x,Vstx:x,Xaml:"Xaml",Xla:I,Xlam:I,Xll:I,Xls:I,Xlsb:I,Xlsm:I,Xlsx:I,Xlt:I,Xltm:I,Xltx:I,Xml:"Xml",Xps:"Xps",Xsn:"Xsn",Zip:"Zip"},B={},H="PC.Sharing.EditableAttribute",j="PC.Sharing.OwnedAttribute",W="PC.Sharing.ViewOnlyAttribute",Q="PC.Sharing.PublicViewLinkTitle",$="";n.SkyDriveItemHelper={duration:function(e){var t=u,i=!1;if(e>=m){var n=Math.floor(e/m);e%=m,t+=n+c,i=!0}var r=Math.floor(e/p);e%=p,10>r&&i&&(t+="0"),t+=r+c;var o=Math.floor(e/h);return 10>o&&(t+="0"),t+=o},getThumbnail:function(e,t){var i=e.thumbnails;if(i)for(var n=i.length,r=0;n>r;r++){var o=i[r];if(o.name==t)return o}},getPixelRatio:function(){if(!N){var e=1,t=window.devicePixelRatio,i=screen.deviceXDPI;t?e=t:$B.IE&&$B.Mobile?e=window.screen.availWidth/document.documentElement.clientWidth:i&&(e=i/96),N=Math.min(Math.max(e,U),R)}return N},pickThumbnail:function(e,t,r,o,a){var s=null,l=null,d=o||g,u=n.SkyDriveItemHelper.getPixelRatio(),c=t*u,h=r*u,p=c*h*d;if(e&&e.thumbnails&&e.thumbnails.length>0)for(var m=0;m<e.thumbnails.length;m++){var f=e.thumbnails[m];"unRes"==f.name&&(f=i(f,c,h,a)),f.totalPixels=f.width*f.height;var v=f.coverage=Math.min(f.width,c)*Math.min(f.height,h)*Math.max(d,1);v>=p?(!s||f.totalPixels<s.totalPixels)&&(s=f):(!l||f.totalPixels>l.totalPixels)&&(l=f)}return s||l},isHtml5DropEnabled:function(e){return e&&e.folder&&!e.did&&"mru"!=e.keyParts.qt&&"shared"!=e.keyParts.qt&&!("search"==e.keyParts.qt&&"root"==e.id)&&"sharedby"!=e.keyParts.qt&&"recyclebin"!=e.keyParts.qt&&"allmyphotos"!=e.keyParts.qt&&n.SkyDriveItem.getJsonApiCommandActionIndex(e,"up")},isRootItem:function(e){return e.id===y},isSkyDriveRoot:function(t){return n.SkyDriveItemHelper.isRootItem(t)&&!t.group&&!t.did&&!e(t)},isDeviceRoot:function(e){return e&&n.SkyDriveItemHelper.isRootItem(e)&&e.did},isGroupRoot:function(e){return n.SkyDriveItemHelper.isRootItem(e)&&"1"===t(e,"group")&&null!=e.ownerCid},isGroupItem:function(e){return"1"===t(e,"group")},isCoOwner:function(e){return e&&e.isViewerCoOwner()},isOwnerOrCoOwner:function(e){return e&&(e.isViewerOwner()||e.isViewerCoOwner())},canViewSharingInfo:function(e){return e&&e.doesViewerHaveEditAccess()&&!n.SkyDriveItemHelper.isAlbumRoot(e)&&!e.isTagsRoot},isSharedLandingPageRoot:function(e){return e&&n.SkyDriveItemHelper.isRootItem(e)&&n.SkyDriveItemHelper.isSharedByQuery(e)},isAlbumRoot:function(e){return e&&e.isAlbumRoot},treatAsAlbum:function(e,t){return e&&(e.isAlbum||e.folder&&!e.isAlbumRoot&&!e.isTagsRoot&&!e._isLoadingItem&&t.viewParams&&"photos"==t.viewParams.v&&"allmyphotos"!=t.viewParams.qt)},isSharerFolder:function(e){return e&&e.isSharerFolder},isLegacyPhotomail:function(e){return e.id&&e.id.startsWith(w)},isTopLevelItem:function(e){if(n.SkyDriveItemHelper.isRootItem(e))return!1;var t=e.getParent(!0);return t&&n.SkyDriveItemHelper.isRootItem(t)},getTopLevelItem:function(e){for(;e&&!n.SkyDriveItemHelper.isTopLevelItem(e);)e=e.getParent(!0);return e},isViewerOwner:function(e){return!e.ownerCid||e.ownerCid.toLowerCase()==FilesConfig.hcid.toLowerCase()},isMruQuery:function(e){var i=t(e,"qt");return i&&"mru"===i.toLowerCase()},isHighlightsQuery:function(e){return!!t(e,"highlights")},isRecycleBinQuery:function(e){var i=t(e,"qt");return i&&"recyclebin"===i.toLowerCase()},isAllMyPhotosQuery:function(e){var i=t(e,"qt");return!!i&&"allmyphotos"===i.toLowerCase()},isAllMyPhotosDescendant:function(e){var t=e&&e.getParent&&e.getParent(!0);return n.SkyDriveItemHelper.isAllMyPhotosQuery(t)},isSharedQuery:function(e){var i=t(e,"qt");return i&&"shared"===i.toLowerCase()},isSharedByQuery:function(e){var i=t(e,"qt");return i&&"sharedby"===i.toLowerCase()},isSearchQuery:function(e){var i=t(e,"qt");return i&&"search"===i.toLowerCase()&&n.SkyDriveItemHelper.isRootItem(e)},isBingSearchQuery:function(e){return n.SkyDriveItemHelper.isSearchQuery(e)&&2147483647===e.maxReturnableResultCount},getSearchQuery:function(e){return t(e,"q")||""},getErrorMessageForNewItemName:function(e,t){var i;if(e)if(!t&&e.endsWith("."))i=a("CantStartOrEndWithDotError");else{var n=e.match(v);n&&n.length>1&&(i=a("InvalidTextFormatError").format(r.InvalidItemNameCharacters))}else i=a("NameRequiredError");return i},isPartOfBundle:function(e){var t=e&&e.getParent&&e.getParent(!0);return t&&t.isBundle},hasExtractedTextUrl:function(e){return e&&e.photo&&e.urls&&e.urls.textContent},hasOneNoteWebUrl:function(e){return e&&e.urls&&e.urls.oneNoteWeb},hasOneNoteClientUrl:function(e){return e&&e.urls&&e.urls.oneNoteClient},isGifOrPng:function(e){return e&&e.mimeType&&("image/gif"===e.mimeType||"image/png"===e.mimeType)},isRestricted:function(e){return e.itemStatus&&e.itemStatus>0&&4!=e.sharingLevelValue},isSearchResult:function(e){var t=e&&e.getParent&&e.getParent(!0);return n.SkyDriveItemHelper.isSearchQuery(t)},isSearchOrDescendent:function(e){for(;e;){if(n.SkyDriveItemHelper.isSearchQuery(e))return!0;e=e.getParent&&e.getParent(!0)}return!1},highlightAndEncodeField:function(e,t){if(e&&e[t]){var i=e[t],r=e.highlights;if("name"==t&&e.internalPath){var o;o=1==e.internalPath.length?[i,e.internalPath[0]]:e.internalPath.slice(0);for(var a=0,s=0;s<o.length;s++){var l=o[s];o[s]=n.SkyDriveItemHelper.highlightAndEncodeFieldWithValue(r,t,l,a),a+=l.length}var d=n.ImageStrip.getImage("chevronRightBlack",null,null).outerHTML;return o.join(M.format(d))}return n.SkyDriveItemHelper.highlightAndEncodeFieldWithValue(r,t,i,0)}return""},highlightAndEncodeFieldWithValue:function(e,t,i,n){var r=i,o=[];if(e)for(var a=e.length-1;a>=0;a--){var s=e[a].startIndex-n,l=e[a].endIndex-n;if(e[a].fieldName==t&&s<r.length){o.unshift(r.substring(l).encodeHtml());var d=jQuery(_ce("span")).addClass("highlight").html(r.substring(s,l).encodeHtml());sutra(d,"$Sutra.SkyDrive.SearchHighlight");var u=jQuery(_ce("span")).append(d);o.unshift(u.html()),r=r.substring(0,s)}}return o.unshift(r.encodeHtml()),o.join("")},hasFieldHighlight:function(e,t){if(e&&e[t]&&e.highlights)for(var i=e.highlights,n=0;n<i.length;n++)if(i[n].fieldName==t)return!0;return!1},clearFieldHighlights:function(e,t){if(e&&e.highlights)for(var i=e.highlights,n=0;n<i.length;)i[n].fieldName==t?i.splice(n,1):n++},evaluateThrottleNotification:function(e,t,i){for(var r=!1,o=e;o&&!o.throttleRestrictions;)o=t.itemProvider.peekParent(o);if(o&&!o.hasExpired()&&(!B[o.ownerCid]||i)){var s=o.throttleRestrictions;if(s)for(var l=s.split(","),d=0;d<l.length;d++){var u=l[d];if("4"===u||"Download_Visitor"===u){r=!0,B[o.ownerCid]=!0;var c=n.SkyDriveItemHelper.isViewerOwner(e);t.errorManager.add({$element:a("BandwidthThrottledNotification."+(c?"Owner":"NonOwner")),priority:2,ui:1,type:1});break}}}return r},getNormalizedExtension:function(e){return e&&O[e.iconType]},getFriendlyFileType:function(e){var t=e.getVersion(),i="friendlyFileTypeVersion";if(e[i]!==t){var r=e.extension,o=r&&r.substring(1).toUpperCase(),s=n.SkyDriveItemHelper.getNormalizedExtension(e),l=a("FileType.NoExtension");!s&&e.folder?l=a("FileType.Folder"):e.isPanorama?l=a("FileType.Panorama"):e.photo&&!e.video?l=a("FileType.Image").format(o||"").trim():s?l=a("FileType."+s):o&&(l=a("FileType.Unknown").format(o)),e.friendlyFileType=l,e[i]=t}return e.friendlyFileType},getModifiedDateHtml:function(e,t,i){var r="",o=n.DateFactory,a=t.callerCid;if(!e._isNewFolder){var s=e.displayModifiedDate||o.getDateString(e.dateModifiedOnClient||e.modifiedDate,null,!1)||"";if(r='<span class="modifiedDateText">'+htmlEncode(s)+"</span>",a!==e.ownerCid||a!==e.lastModifierCid){var l=e.lastModifierName;l&&(l=i?n.SkyDriveItemHelper.highlightAndEncodeField(e,f):htmlEncode(l),r+='&nbsp;<span class="modifiedDateNameText">'+l+"</span>")}}return r},getCreatedDateText:function(e,t){var i="",r=n.DateFactory,o=t.callerCid;if(!e._isNewFolder&&(i=e.displayCreationDate||r.getDateString(e.creationDate,null,!1),o!==e.creatorCid)){var a=e.creatorName;a&&(i+=" "+a)}return i},getLocationText:function(e){var t;if(n.SkyDriveItemHelper.isSearchResult(e))t=e.locatedIn||C;else if(n.SkyDriveItemHelper.isViewerOwner(e)){var i=e.getParent();t=!i||n.SkyDriveItemHelper.isRootItem(i)?C:i.name}else t=e.ownerName?b.format(e.ownerName):C;return t},getOriginalLocationText:function(e){var t=e.deletedFromLocation;return t||(t=b.format(e.ownerName)),t},getSharedWithText:function(e){var t;if(FilesConfig.visualUpdatesForSharedContent){var i=void 0===e.sharingLevelValue||e.sharingLevelValue===o.Private,r=e.sharingLevelValue===o.Public;return t=r?s(Q):i?$:!FilesConfig.isUserInGfRamp||e.groupFolderType!=n.GroupFolderType.MountPoint&&e.groupFolderType!=n.GroupFolderType.OriginalSyncRoot?this.fetchDetailedSharingText(e):s(H)}if(t=void 0!==e.sharingLevelValue&&e.sharingLevelValue!==o.Private?e.sharingLevel:"",t&&(e.groupFolderType==n.GroupFolderType.MountPoint||e.groupFolderType==n.GroupFolderType.OriginalSyncRoot)){var a=s(FilesConfig.isUserInGfRamp?"GF.Sharing.EditorAttribute":"GF.Sharing.CoOwnedAttribute");t=t+" "+a}return t},fetchDetailedSharingText:function(e){var t;return e.sharingLevelValue!==o.Public&&e.sharingLevelValue!==o.Private&&(t=e.groupFolderType==n.GroupFolderType.MountPoint?H:e.isViewerCoOwner()?H:e.isViewerOwner()?j:e.doesViewerHaveEditAccess()?H:W),s(t)},getDateSharedText:function(e){var t="",i=n.DateFactory;return t=e.dateShared?e.displayDateShared||i.getDateString(e.dateShared,null,!1):""},getRestoreItem:function(e){var t={};return e.recycledSharedItemInfo?t.restoreSharedItemInfo={relativePath:e.recycledSharedItemInfo.relativePath,sharedFolderResId:e.recycledSharedItemInfo.sharedFolderResId,ghostRootResId:e.recycledSharedItemInfo.ghostRootResId}:t.deletedFromLocation=e.deletedFromLocation,t.name=e.extension?e.name+e.extension:e.name,t.id=e.id,t},parseCidFromItemId:function(e){var t=e.indexOf("!")>-1?e.substring(0,e.indexOf("!")):0;return t}}}()}),define("datamodel",["skydriveitemhelper"],function(){!function(){function e(e){var t=c.ViewContext.getInstance().deviceItemSet;return t.getByKey(e.toLowerCase())}function t(e){return e&&"recyclebin"===o(e,"qt")&&o(e,"id")===v}function i(e){return e&&"search"===o(e,"qt")&&o(e,"id")===v}function n(e){for(var t=e?e.getParent(!0):null;t&&t.parentKey&&!t.isSharerFolder;)e=t,t=t.getParent(!0);return t?e:null}function r(e,t){var i=h.getItemKeyParts(e);return c.StringHelpers.caseInsensitiveStringEquals(i.id,t)||!t&&!i.id}function o(e,t){var i=h.getItemKeyParts(e);return i[t]}function a(e){var t=!1;if(e)switch(e.code){case 101:case 102:case 103:case 152:case 200:case 201:case 202:case 3e3:case 10001:case 10002:case 10004:case 10006:case 10009:case 10011:case 10012:case 10013:case 10027:t=!0}return t}function s(e){return!e||e.hasExpired()}function l(e){if(void 0!==e.childCount){for(var t=e.childCount,i=[],n=[],r=null,o=0;t>o;o++){var a=e.children[o];a.isHeader?(r&&r.count&&n.push(r),r={groupingId:"other",name:a.name,startIndex:i.length,endIndex:i.length,count:0}):(r.endIndex=i.length,i.push(a),r.count++)}r&&r.count&&n.push(r),e.itemGroupings=[{name:"FolderDocumentsPhotos",itemGroups:n}],e.children=i,e.totalCount=i.length,e.childCount=i.length}}function d(e){var t="SkyDrive_Json_GetItems",i=h.getItemKeyParts(e);return t+="mru"===i.qt?"Mru":"shared"===i.qt?"Shared":"recyclebin"===i.qt?"RecycleBin":"search"===i.qt?"Search":"sharedby"===i.qt?"SharedBy":"allmyphotos"===i.qt?"AllMyPhotos":"Folders"}var u,c=wLive.Core,h=c.SkyDriveItem,p=c.SkyDriveItemHelper,m=c.JSONConstants.SortField,f=c.JSONConstants.SortDirection,g=c.JSONConstants.GroupBy,v="root",y="id",w="cid",C="lct=1",b="rset",k=FilesConfig.useNewThumbs,S=(k?"odweb":"skyweb")+($B.Mobile?"_mobile":""),_="skyweb_picker",I="DataModel",x=1e3,D=45e3,E=15e4,P=2e3,T=3,A=4,L=5,F=6e4,M="SkyDrive.GetItemsVersionLookup",N="albums",U={};defineClass("wLive.Core.DataModel",function(e,t,i,n,r){mix(this,{extraGetItemsParams:"",baseUrl:e,_baseUrl:e||null,_callerCid:(i||"").toLowerCase(),_market:n||"",_pageSize:r||100,_appId:t||"",_items:[],_maxRetries:1,_groupInfo:{},_pendingRequests:{},_restoreAllWorkItemCount:0,_versionLookup:BrowserStorage.getLocalValue(M)||{},_suspendedChangeEvents:null})},{__isObservable:!0,dispose:function(){var e=this;for(var t in e._pendingRequests)e._pendingRequests[t].abort()},hasPendingRequests:function(e,t){var i=this._pendingRequests[e],n=i&&t?i[t]:null;return!!(t?n:i)},abortPendingRequests:function(e){var t=this._pendingRequests[e];if(t){for(var i in t)if("count"!==i)for(var n in t[i])if("count"!==n){var r=t[i][n];r.abort()}delete this._pendingRequests[e]}},setItemVersion:function(e,t){Trace.log("Setting item version (key: "+e+", version: "+t+")",I),t?this._versionLookup[e]=t:delete this._versionLookup[e],BrowserStorage.setLocalValue(M,this._versionLookup)},getRestoreAllWorkItemCount:function(){return this._restoreAllWorkItemCount},getItem:function(e,t,i,n,r){var o=this,a=null;if(e&&(a=o._items[e]||null,!t)){var l=s(a),d=o._hasAncestors(a,e);if(l||!d&&a.id!==v){var u=n||h.getDefaultSetKey();o.fetchItem(e,u,null,0,!1,a?null:i,null,null,void 0,null,r)&&Trace.log("getItem miss - exists: "+!!a+", expired: "+l+", hasAncestors: "+d+", key: "+e+", setKey: "+u,I)}}return a},processResponse:function(t,i,n){var r=this,a=!1;n=n||h.getDefaultSetKey();var s=n;if(t&&t.items&&!t.error){var l=o(i,"did"),d=h.getSetKeyParts(n);if(d.sb==m.Default||d.sd==f.Default||d.gb==g.Default)if(l){var u=d.sb==m.Default?m.Name:d.sb,c=d.sd,v=d.gb;c==f.Default&&(c=u!=m.Name?f.Descending:f.Ascending),v==g.Default&&(v=g.Folders),n=h.getSetKey(u+"",null,d.ft,v+"",c+"",t.tagFilter,t.rif)}else n=h.getSetKey(t.sortOrder+"",null,d.ft,t.groupBy||d.gb,t.sortDirection+"",t.tagFilter,t.rif);t.restoreAllWorkItemCount&&t.restoreAllWorkItemCount>0&&(r._restoreAllWorkItemCount=t.restoreAllWorkItemCount);var y=t.items;r._preprocessGetItemsResponse(t);var w=t.baseUrl;if(l&&w){var C=e(l);C&&(C.baseUrl=w)}for(var b=0;b<y.length;b++)a=r._processItem(y[b],i,n,null,a,s)||a;var k=r.getItem(i,!0);if(void 0!==t.lastVersion||k&&p.isSkyDriveRoot(k)&&p.isViewerOwner(k)){var S=FilesConfig.lastVersion||t.lastVersion,_=S?S.split(","):[];FilesConfig.lastVersion=_[0]||"0",void 0===FilesConfig.freRenderIndex&&(FilesConfig.freRenderIndex=Number(_[1]||"0"))}}return a},suspendChangeEvents:function(){this._suspendedChangeEvents||(this._suspendedChangeEvents=[])},resumeChangeEvents:function(){var e=this;if(e._suspendedChangeEvents){var t=e._suspendedChangeEvents;for(e._suspendedChangeEvents=null;t.length;)e._fireDataChanged(t.pop())}},createSubfolder:function(e,t,i,n,r,o){var a=this,s=this._baseUrl+"AddFolder?"+C,l=null,d={parentId:e.id,
cid:e.ownerCid,group:e.group,name:t,permissionsInfo:null};i&&(d.permissionsInfo={ownerCid:i.ownerCid,message:i.message,requireSignIn:i.requireSignIn,entities:i.entities},d.doNotRollbackOnPartialPermissionsError=i.doNotRollbackOnPartialPermissionsError,d.sendShareNotification=i.sendSharingNotification,l=F),p.isRootItem(e)&&"photos"==c.ViewContext.getInstance().viewParams.sc&&(d.category=1);var u=null,h=new c.DataRequest(s,s,Object.toJSON(d),function(t){var i=t?t.item:null,r=o?o:e.createPinnedSubfolder();r.processItem(i),e.updatePinnedSubfolderKey(r),a._items[r.key]=r,e.expire(),e.invalidate(),n&&n(t,r)},function(e){e&&e.error&&e.error.code===x&&(e.error.isExpected=!0),r&&r(e,u)},l);h.apiId="SkyDrive_Json_AddFolder",h.propertyId="SkyDrive",h.start()},updateItem:function(e,t,i,n,r,o){var a=this,s=a._baseUrl+t+"?"+C,l=new c.DataRequest(s+Math.random(),s,i,function(t){var i=t&&t.item;if(i){var r=h.getItemKey(i.id,i.ownerCid,i.group);a._processItem(i,r)&&a.getItem(r).invalidate()}n&&n(t,e)},function(t){if(r){var i=a.getItem(e.key,!0);r(t,i)}});l.apiId="SkyDrive_Json_"+(o?t+"_"+o:t),l.propertyId="SkyDrive",l.start()},updateItemProperties:function(e,t,i,n,r){var o=this,a=e.parentId;t.id=e.id,a&&a!==v&&(t.lid=e.parentId),t[b]=S,o.updateItem(e,"UpdateItem",Object.toJSON(t),i,n,r)},updateItemProperty:function(e,t,i,n,r,o,a){var s="";o&&(s=', "overrideLock":"true"');var l=e[t],d=e[t]=i,u=e.extension;"name"===t&&u&&(d+=u),e.invalidate();var c=e.parentId;this.updateItem(e,"UpdateItem",'{"id":"'+e.id+'","'+t+'":"'+d.encodeJson()+(c&&c!==v?'","lid":"'+c.encodeJson():"")+'","'+b+'":"'+S+'"'+s+"}",n,function(e,n){r(e,n),n[t]===i&&(n[t]=l,n.invalidate())},a)},updateTags:function(e,t,i,n,r,o){this.updateTagsForItems([e],t,i,n,r,o)},updateTagsForItems:function(e,t,i,n,r,o){for(var a=this,s="UpdateTags",l={ids:[],tagsToAdd:t,tagsToDelete:i},d=0;d<e.length;d++)l.ids.push(e[d].id);var u=a._baseUrl+s,h=new c.DataRequest(u+Math.random(),u,Object.toJSON(l),function(t){n&&n(t,e)},function(t){r&&r(t,e)});h.apiId="SkyDrive_Json_"+s,h.propertyId="SkyDrive",h.start()},getPlaceholderItem:function(e,t,i,n){var r=new h(this,e,null),a=o(e,w).toUpperCase(),s={name:t,isPlaceholder:!0,id:o(e,y),ownerName:a==FilesConfig.hcid?FilesConfig.userDisplayName:"",ownerCid:a};return i&&(s.folder={totalCount:1,childCount:1}),r.processItem(s),mix(r,n),r},getLoadingItem:function(e,t,i){var n=void 0!==t?t:!0;return i=i||{},mix(i,{_isLoadingItem:!0}),this.getPlaceholderItem(e,"",n,i)},getGroupInformation:function(e,t,i){var n="cid="+e.toLowerCase().encodeUrl(),r=i.viewParams;r.authkey&&(n+="&authkey="+(r.authkey||"").encodeUrl()),r.ticket&&(n+="&ticket="+(r.ticket||"").encodeUrl());var o=this._groupInfo[n];return o||this._fetchGroupInformation(n,t,this._maxRetries),o},_ensureCompletelyDownloaded:function(e,t,i){function n(i,n){function h(){var h=[],g=l.getItem(d,!0);if(!p)if("-1"!=c&&c!=g.modifiedDate&&(Trace.log("EnsureCompletelyDownloaded refresh loop detected: modifiedDateChanges - "+u+" itemModifiedDate - "+c+" item.modifiedDate - "+e.modifiedDate,I),u++,c=g.modifiedDate),u>T)Trace.log("EnsureCompletelyDownloaded refresh loop hit: modifiedDateChanges - "+u+" itemModifiedDate - "+c+" item.modifiedDate - "+e.modifiedDate,I),l.resumeChangeEvents(),n(null);else{var v=g?g.getChildren(t):e.getChildren(t);if(r?h=l._getMissingGroupRanges(g||e,t,a,s):v.isComplete()||(h=l._getMissingRanges(g||e,t,o)),h.length){m=[],l.suspendChangeEvents();for(var y=0;y<h.length;y++){var w=h[y];f(y,w.start,w.count)}}else l.resumeChangeEvents(),i(g||e)}}function f(e,i,n){m[e]=l.fetchItem(d,t,null,i,!1,null,function(){g(e)},v,1,null,{pageSize:n})}function g(e){var t;for(m[e]=!1,t=0;t<m.length&&!m[t];t++);t==m.length&&h()}function v(e){Trace.log("EnsureCompletelyDownloaded fetch error: itemKey - "+d+" setKey - "+t,I),l.resumeChangeEvents(),n(e)}h()}var r=i.downloadGroupMode,o=i.indexes,a=i.groupIndex,s=i.subGroupIndex;t=t||h.getDefaultSetKey();var l=this,d=e.key,u=0,c=e.modifiedDate,p=!1,m=[];return new Shared.Promise(n,function(){l.resumeChangeEvents(),l.abortPendingRequests(d),p=!0})},ensureCompletelyDownloaded:function(e,t,i){return this._ensureCompletelyDownloaded(e,t,{indexes:i,downloadGroupMode:!1})},ensureGroupCompletelyDownloaded:function(e,t,i,n){return this._ensureCompletelyDownloaded(e,t,{groupIndex:i,subGroupIndex:n,downloadGroupMode:!0})},fetchItem:function(e,t,n,r,a,s,l,d,u,m,f){var g=this;f=f||{};var v=f.pageSize||g._pageSize;n||(r-=r%g._pageSize,r>0&&!f.pageSize&&(r-=g._pageSize,v=2*g._pageSize));var y=g.replaceGetItemsUrl&&g.replaceGetItemsUrl(e,g._baseUrl),w=f.itemKey||e,C=f.startId||n,b=y||g._createGetItemsUrl(w,t,C,r,v,u,m),k=window.$InlineRequests||{},S=k[b],_=S?S.originId:Math.random(),I=g.getItem(e,!0);I&&I.hasExpired()&&(a=!0);var x;if(I&&p.isAllMyPhotosQuery(I)&&!a){var T=I.getChildren(t);T&&T.getGroupings(!1).length<2&&(a=!0)}x=c.Search&&i(e)&&!a?c.Search.getSearchOrigin(o(e,"q")):a?_:S?S.version:g._versionLookup[e]||_;var A=FilesConfig.authKey?"&authkey="+FilesConfig.authKey.encodeUrl():FilesConfig.ticket?"&ticket="+FilesConfig.ticket.encodeUrl():"",L=b+A+"&v="+x,F=!!h.getItemKeyParts(e).did,M=(new Date).getTime(),N=!c.DataRequest.hasPendingRequest(b),R=null,O=(new Date).getTime();lastErrorForRequest=U[e+"_"+t],lastErrorForRequest&&O-lastErrorForRequest.time<P?(raiseEvent(this,wLive.Core.DataModel.errorEvent,lastErrorForRequest.error),d&&d(lastErrorForRequest.error)):(R=new c.DataRequest(b,L,null,function(i){N&&g._handleServerResponse(i,e,t,n,r,_,M,x,b),l&&l(g.getItem(e,!0))},function(i){N&&g._handleServerResponse(i,e,t,n,r,_,M,x,b),d&&d(i?i.error:null)},F?E:D),R.originId=_);var B=R&&R.start();if(B){var H=g._pendingRequests[w]=g._pendingRequests[w]||{},j=H[t]=H[t]||{};j[b]=R,j.count=(j.count||0)+1,H.count=(H.count||0)+1}return B},getApplicationDetails:function(e,t,i){var n=this,r=n._baseUrl+"GetApplicationDetails?appId="+e,o=new c.DataRequest(n._baseUrl,r,null,function(e){t&&t(e)},function(e){i&&i(e?e.error:null)},D);return o.originId=Math.random(),o.failureReentranceDelay=P,o.start()},_getMissingGroupRanges:function(e,t,i,n){var r=e.getChildren(t),o=r.getGroupings(),a=[],s=o[i];if(s){var l=s.itemGroups[n];if(l){if(l.mergeUp){var d=Math.max(l.startIndex-this._pageSize,0);a.push({start:d,count:l.startIndex-d})}l.mergeDown&&a.push({start:l.endIndex+1,count:this._pageSize})}}return a},_getMissingRanges:function(e,t,i){var n,r=this._pageSize,o=[],a=e.getChildren(t),s={};if(i)for(n=0;n<i.length;n++){var l=i[n];a.peek(l)||(s[l-l%r]=!0)}else for(n=0;n<a.getCount();n+=r)a.peek(n)||(s[n]=!0);for(n in s)o.push({start:Number(n),count:r});if(o.length>A){var d=0;for(n=0;n<o.length-1;n++){var u=o[n];++d<L&&u.start+u.count==o[n+1].start?(u.count+=o[n+1].count,o.splice(n+1,1),n--):d=0}}return o},_fireDataChanged:function(e){var t=this;t._suspendedChangeEvents?t._suspendedChangeEvents.push(e):raiseEvent(this,wLive.Core.DataModel.dataChangedEvent,e)},_handleServerResponse:function(t,i,n,r,s,l,u,h,p){var m,f,g,v=this,y=(new Date).getTime(),w=v._pendingRequests[i],C=d(i);if(window.$InlineRequests&&delete window.$InlineRequests[p],w){var b=w[n];b&&(delete b[p],b.count--,b.count||delete w[n]),w.count--,w.count||delete v._pendingRequests[i]}if(t&&t.items&&!t.error){var k=l&&l!=t.originId,S=k,_=v.processResponse(t,i,n);m=(k?"cacheHit-":"cacheMiss-")+(S?"revalidating-":"valid-")+(_?"changed":"nochange"),f="s",Trace.log("Received response: ("+m+")",I);var x=v.getItem(i,!0);x&&(k||(this.setItemVersion(i,h),raiseEvent(v,c.DataModel.responseAvailableEvent,{itemKey:i,setKey:n,originId:l,response:t}),(x.isSpecialFolder||x.isAlbumRoot)&&(x.specialFolderKey!=i?(v.setItemVersion(x.specialFolderKey,h),raiseEvent(v,c.DataModel.responseAvailableEvent,{itemKey:x.specialFolderKey,setKey:n,originId:l,response:t})):(v.setItemVersion(x.key,h),raiseEvent(v,c.DataModel.responseAvailableEvent,{itemKey:x.key,setKey:n,originId:l,response:t}))),x.isRecycled&&Qos.log("SkyDrive_Json_GetItemsWithDeleted","SkyDrive",u,null,null,null,y)),_&&x.invalidate(!0)),S&&v.fetchItem(i,n,r,s,!0)}else{var D=t?t.error:null;D=D||{code:2147745797,debugMessage:"Server returned no success or failure"};var E=o(i,"did");if(E){var P=e(E);P&&P.baseUrl&&c.DeviceItem.hasNewBaseUrlError(D,E)&&v.fetchItem(i,n,r,s,!0)}m=D.code,f=a(D)?"c":"f",g=D.debugMessage+"\n"+D.stackTrace,D.key=i,D.rootCauseApiId=C,D.rootCauseErrorType=f,D.rootCauseStartTime=u,U[i+"_"+n]={error:D,time:(new Date).getTime()},raiseEvent(this,wLive.Core.DataModel.errorEvent,D)}Qos.log(C,"SkyDrive",u,m,f,g,y)},_processItem:function(e,t,i,n,a,s){var d,u=this,m=h.getItemKeyParts(t),f=void 0;if(t&&r(t,e.id))d=t;else{var g=m.qt,y=c.ViewContext.getInstance(),w=y&&y.viewParams.parId;e.id==w&&(g=y.viewParams.parQt),"search"===g&&e.internalPath&&(f=e.internalPath.join(",")),d=h.getItemKey(e.id,e.ownerCid,e.group,g,m.did,m.q,m.sft,f)}var C=u.getItem(d,!0),b=e.folder;if(!n&&e.parentId)if("search"===m.qt)n=h.getItemKey(v,void 0,0,m.qt,0,m.q,m.sft);else{var k=e.isAlbum?"albums":e.parentId;n=h.getItemKey(k,e.ownerCid,e.group,m.qt,m.did)}if(!C){a=!0;var S,_=e.isAlbumRoot;(_||e.isSpecialFolder)&&(S=h.getItemKey((_?N:e.specialFolderCanonicalName).toLowerCase(),e.ownerCid,e.group,null,m.did)),C=u._items[d]=new h(u,d,n,S),S&&(u._items[S]=C)}if(a=C.processItem(e)||a,b){var I=C.getChildren(i);s&&i!=s&&(a=a||C._childSets[s]!==I,C._childSets[s]=I),p.isDeviceRoot(C)&&l(b);var x=!1,D=I.getCount(!0);I.modifiedDate==C.modifiedDate&&D==b.childCount||void 0==b.childCount||(x=!0,I.modifiedDate=C.modifiedDate,I.setCount(b.childCount),D=I.getCount(!0),I._requiresFilter=!0,a=!0),b.itemGroupings&&C.hasMoreResults!==!0&&C.hasMoreResults!==!1&&I._mergeGroupingsFromServer(b.itemGroupings,x),void 0!==b.photoCount&&(C.folder.photoCount=b.photoCount);var E=o(t,"qt");"allmyphotos"!==E&&"sharedby"!==E||(E=null);var P=o(t,"q"),T=o(t,"sft");if(b.children){var A=b.startIndex||0;if(A+b.children.length>b.totalCount){var L=b.totalCount-A;b.children.length=L>0?L:0}for(var F=0,M=A;F<b.children.length;F++,M++){var U=b.children[F];f=void 0,"search"===E&&U.internalPath&&(f=U.internalPath.join(","));var R=h.getItemKey(U.id,U.ownerCid,U.group,E,C.did,P,T,f);a=u._processItem(U,R,i,d,a)||a,a=I.set(M,u.getItem(R,!0))||a}a&&change(I)}}return a},_mergeGroupsAfterCurrent:function(e,t,i,n){for(var r=e+1;r<t.length;r++){var o=t[r];if(!(o.startIndex<=i.endIndex+1))break;if(o.mergeUp){if(n.endIndex<o.endIndex){var a=o.endIndex-n.endIndex;n.mergeDown=o.mergeDown,n.count+=a,n.endIndex+=a}o.count=-1,o.startIndex=-1,o.endIndex=-1}else{if(!o._filler)break;if(n.endIndex<o.endIndex){var s=o.endIndex-n.endIndex;o.count-=s,o.startIndex+=s}else o.count=-1,o.startIndex=-1,o.endIndex=-1}}},_preprocessGetItemsResponse:function(e){for(var t=e.items,i=e.tokenNeedsRedeeming,n=e.tokenType,r=c.ViewContext.getInstance(),o=0;o<t.length;o++){var a=t[o];if(a.id!=v&&(i&&null!=n||!a.tokenNeedsRedeeming)){a.tokenNeedsRedeeming=i,a.tokenType=n;var s=a.folder;if(s&&s.children){var l=0;for(s.startIndex||0;l<s.children.length;l++){var d=s.children[l];d.tokenNeedsRedeeming=i,d.tokenType=n}}}a.settings&&r&&a.ownerCid&&p.isViewerOwner(a)&&r.updateSettings(a.settings)}},_createGetItemsUrl:function(t,i,r,a,s,l,d){var u,p=this,g=p.getItem(t,!0),v=(n(g),d?d:p.extraGetItemsParams),y=c.ViewContext.getInstance(),w=y&&y.viewParams,k=S;w&&w.v==FilesConfig.filePickerViewParam?(u=w.auth==FilesConfig.skyDrivePickerOAuth?2:1,k=_):w&&w.iam&&(u=1);var I=(void 0===l?"&d=1":"&d="+l)+"&iabch=1&caller="+p._callerCid+"&path="+(0===l?"0":"1")+(r?"&sid="+r:"&si="+a)+"&ps="+s+"&pi=5&m="+p._market+"&"+b+"="+k+"&"+C+(u?"&urlType="+u:"")+(FilesConfig.eventRange?"&eventRange="+FilesConfig.eventRange:"")+v;$B.Mobile&&(I+="&isMobile=1");var x=this._baseUrl;if(-1!==t.indexOf("&did=")){var D=e(o(t,"did"));x=D&&D.baseUrl?D.baseUrl:FilesConfig.devicesBaseUrl;var E=h.getSetKeyParts(i);if(void 0!==E.sd){var P="0";P=E.sb==m.Default||E.sb==m.Name?E.sd==f.Descending?"1":"0":E.sd==f.Ascending?"0":"1",i=i.replace("sd="+E.sd,"sr="+P)}}return x+"GetItems?"+t+"&"+i+I},_fetchGroupInformation:function(e,t,i){var n=this._baseUrl+"GetGroupInfo?"+e+"&retrieveMembership=true",r=this,o=new c.DataRequest(n,n,null,function(t){var i=new c.GroupInfo(t.groupInfo,e);r._groupInfo[e]=i,raiseEvent(r,wLive.Core.DataModel.groupInfoChangedEvent,null)});o.apiId="SkyDrive_Json_GetGroupInfo",o.propertyId="SkyDrive",o.start()},_hasAncestors:function(e,r){var o=n(e);return i(r)||t(r)?!1:!!(e&&e.parentKey||o&&this.getItem(o.parentKey,!0))}},{getInstance:function(){if(!u){var e=window.FilesConfig;u=new wLive.Core.DataModel(e.baseApiUrl,e.appId,e.hcid,$Config.mkt,e.dataPageSize)}return u},dataChangedEvent:"dataChanged",responseAvailableEvent:"responseAvailable",groupInfoChangedEvent:"groupInfoChanged",errorEvent:"error"},Shared.ObjectEventing,Shared.Async)}()}),define("errormanager",["datamodel"],function(){!function(){function e(){function e(e,t){return e.priority!=t.priority?e.priority-t.priority:e.type-t.type}var t=this;t._errors=[],t.errorReceivedEventName="errorreceived",t.errorClearedEventName="errorcleared",t.add=function(n){if(n.priority|=0,n.type|=0,0==n.type&&$Config.hc&&n.$element){var r="Help",o=n.$element.children("a").length>0;if(o)r="Other";else if(n.code){var a=null;if($Config.hc.slcList&&$Config.hc.slcList[n.code]){r="SLC";var s="&nbsp;"+i("ErrorStatusMessage"),l='<a href="'+$Config.hc.slcUrl+'" target="_blank">'+i("ErrorStatusLinkLabel")+"</a>";a=jQuery("<span/>",{"class":"errorHelpLink",html:s.format(l)}),a.click(function(){$BSI.reportEvent("ClickSelected.SLC.SkyDriveInProductLink",{CMXErrorCodeSD:n.code})}),$BSI.reportEvent("Action.SLC.SkyDriveOutageError",{CMXErrorCodeSD:n.code})}else a=jQuery('<span class="errorHelpLink">&nbsp;<a target="_blank">'+$Config.hc.label+"</a></span>"),$HelpContext.attachContextTo(a.children("a"),n.code,n.$element.text());n.$element.append(a)}else n.code="noCode",r="None";$BSI.reportEvent("Log.WL.ErrorDisplayed",{WLErrorProduct:$Config.prop,WLErrorCode:n.code,WLErrorLinkType:r})}t._errors.push(n),t._errors.sort(e),jQuery(t).trigger(t.errorReceivedEventName)},t.removeAt=function(e){var i=t._errors&&t._errors.length;i>0&&e>=0&&i>e&&(t._errors.splice(e,1),0===t._errors.length&&jQuery(t).trigger(t.errorClearedEventName))},t.clear=function(){t._errors.length>0&&(t._errors=[],jQuery(t).trigger(t.errorClearedEventName))},t.dismiss=function(){var e=t._errors;e.length>0&&e[0].dismissCallback&&e[0].dismissCallback(),t.clear()},t.getErrors=function(){return t._errors}}var t=wLive.Core,i=t.AleHelpers.getString;t.ErrorManager=e}()}),define("itemactionhelper",["jquery-1.7.2","errormanager"],function(){!function(){function e(e){return e?e.encodeURIComponent():r}function t(e,t,i,n){var r=e?e.ownerCid:null;return n?n:r||t.callerCid}function i(e,t){var i=e&&!e.isTagFolder&&(e.photo||e.video||e.isProcessingVideo||"SelfView"===t.currentViewType);return{shouldKeepQueryType:t.viewParams.qt&&("allmyphotos"===t.viewParams.qt&&!e.isAlbum&&!e.isTagsRoot||"sharedby"===t.viewParams.qt&&(i||e.isSharerFolder)),hasParentParam:t.viewParams.parQt||t.viewParams.parId,shouldUseSelfView:i,hasChildren:e&&e.folder&&e.folder.childCount}}var n=wLive.Core,r="",o="&v=",a=n.ViewContext.getInstance(),s=n.SkyDriveItemHelper,l=n.JSONConstants;wLive.Core.ItemActionHelper={itemStringFormat:function(d,u,c,h){return d.itemFormat({item:u,$Config:window.$Config,FilesConfig:FilesConfig,ViewContext:a},{encodeUrl:function(e){return e?e.encodeUrl():r},encodeURIComponent:e,cid:t,cidQueryString:function(i,n,o,a,l){var d=l||i&&i.group,u=i&&s.isSearchQuery(i)&&"root"==i.id,c=i&&s.isRecycleBinQuery(i);return u?"qt=search&q="+s.getSearchQuery(i).encodeURIComponent():"cid="+e(t(i,n,o,a))+(d?"&group=1":r)+(c?"&qt=recyclebin":r)},profileDomain:function(e,t,i,n,r){var o=r===!0||r===!1?r:e&&e.group;return o?i.groupsDomain:i.profileDomain},groupsDomain:function(){return FilesConfig.groupsDomain},groupEmail:function(e){return e&&s.isGroupRoot(e)&&e.groupEmail?e.groupEmail:""},deviceIdQueryString:function(e,t){return e&&e.did?"&did="+e.did.encodeURIComponent():r},resIdQueryString:function(e,t){return e&&"root"!=e.id?"&resid="+e.id.encodeURIComponent():r},idAsParentIdQueryString:function(e){return e?"&parid="+e.id.encodeURIComponent():r},appQueryString:function(e,t){var i=wLive.Core.SkyDriveItemHelper.getNormalizedExtension(e)||e.iconType,n=null;switch(i){case"Doc":n="Word";break;case"Pdf":n="WordPdf";break;case"Xls":n="Excel";break;case"Ppt":n="PowerPoint";break;case"One":case"OneNotebook":n="OneNote"}return n?"&app="+n:r},authKeyQueryString:function(e,t){var i=t.viewParams;return i.ticket?"&ticket="+i.ticket.encodeURIComponent():i.authkey?"&authkey="+i.authkey.encodeURIComponent():r},iamQueryString:function(e,t){var i=t.viewParams;return i.iam?"&iam="+i.iam.encodeURIComponent():r},idQueryString:function(e,t){var n=r,o=i(e,t);return o.shouldKeepQueryType||!o.hasParentParam||o.shouldUseSelfView&&!o.hasChildren||e&&e.parentId===t.viewParams.id?e&&(n=!e.isTagsRoot&&(e.isTagFolder||t.viewParams.tagFilter&&t.viewParams.v==l.ViewType.Photos&&e.folder)?"root":e.id):n=t.viewParams.parId,"root"==n?r:"&id="+n.encodeURIComponent()},parentIdQueryString:function(e,t){return e.parentId&&!e.directlyShared?"root"==e.parentId?r:"&id="+e.parentId.encodeURIComponent():r},parentId:function(e,t){return(e.parentId||r).encodeURIComponent()},isFolder:function(e){return e.folder?1:0},scenario:function(e,t){return t.viewParams.sc?"&sc="+t.viewParams.sc:r},queryType:function(e,t){return t.viewParams.qt?"&qt="+t.viewParams.qt:r},wacQueryType:function(e,t){var i=r;return t.viewParams.wacqt?i="&wacqt="+t.viewParams.wacqt:t.viewParams.qt?i="&wacqt="+t.viewParams.qt:t.viewParams.cid&&!n.StringHelpers.caseInsensitiveStringEquals(t.viewParams.cid,t.callerCid)&&(i="&wacqt=sharedby"),i},selfViewQueryType:function(e,t){function n(e){return d&&(e+="&beginDate="+d),u&&(e+="&endDate="+u),c&&(e+="&highlights="+c),e}var o=r,a=t.viewParams.qt,s=t.viewParams.parQt,l=t.viewParams.parId,d=t.viewParams.beginDate,u=t.viewParams.endDate,c=t.viewParams.highlights,h=e&&e.getParent&&e.getParent(!0),p=i(e,t);if(p.shouldKeepQueryType)if(p.shouldUseSelfView){var m="sharedby"!==a||t.viewParams.id&&"root"!==t.viewParams.id?t.viewParams.id:e.ownerDCid;o="&parQt="+a+"&parId="+(m||"root"),o=n(o)}else o="&qt="+t.viewParams.qt;else p.hasParentParam?p.shouldUseSelfView&&!p.hasChildren&&"SelfView"===t.currentViewType?(s&&(o="&parQt="+s),l&&(o+="&parId="+l),o=n(o)):s&&(o="&qt="+s):h&&(h.isBundle||h.isAlbum)?o="&parId="+h.id:e&&e.isSharerFolder?o="&qt=sharedby":e&&e.keyParts&&e.keyParts.qt&&("sharedby"===e.keyParts.qt||e.isTagFolder)&&(o="&qt="+e.keyParts.qt);return o},filterTypeParams:function(e,t){var i=t.viewParams.ft;return i?"&ft="+i.encodeUrl():r},tagFilterParams:function(e,t){var i=t.viewParams.tagFilter;return e&&(e&&e.isTagFolder?i=e.tagName||e.name:e&&e.isTagsRoot&&(i=null)),i?"&tagFilter="+i.encodeUrl():r},searchParams:function(e,t){var i=e&&s.isSearchResult(e),n=e&&(e.photo||e.video||e.isProcessingVideo||"SelfView"===t.currentViewType);return i&&n?"&qt=search&q="+s.getSearchQuery(e).encodeURIComponent():r},viewQueryString:function(e,t){var i=t.viewParams.v,n=!1;e&&(FilesConfig.tailoredPhotos?n=FilesConfig.enableAlbumsView&&(e.isAlbum||e.isAlbumRoot)||s.isAllMyPhotosQuery(e)||FilesConfig.enableTagsView&&"tags"==e.id:FilesConfig.enableAlbumsRecipientView&&(n=e.isAlbum));var a=e&&(e.photo||e.video||e.isProcessingVideo),d=r;return a?d=o+l.ViewType.Self:i&&i!=l.ViewType.Self&&"DevicesView"!==i&&"TextFileEditor"!==i?d=o+i:n&&(d=o+l.ViewType.Photos),d}},[u,a,FilesConfig,c,h])}}}()}),define("permissionsprovider",["jquery-1.7.2","wliveloaded","alehelpers","errormanager"],function(){!function(){function e(o){function c(e){return function(t,i,n){var r=n&&n[0];r&&(i.code=r.code),e&&e(t,i)}}function h(e,t,o,a,c,h,p,m,f,g,v,w){g=g||{};var C={entities:o};if(e)C.id=e.id;else{for(var b=[],k=0;k<t.length;k++)b.push(t[k].id);C.ids=b,C.bundleName=g.bundleName}null!==c&&(C.requireSignIn=c),h&&(C.group=1,C.groupUserRole=p,C.ownerCid=e.ownerCid),a&&(C.message=a),null!==m&&(C.suppressNotification=m),null!=f&&(C.userAction=f);var S=Object.toJSON(C),_=FilesConfig.baseApiUrl+"SetPermissions",I=new i.DataRequest(null,_,S,function(r){var o=r.permissions,a=o&&o.permissionScopes,s=a&&a[0]&&a[0].entities;if(e&&e.expire)e.expire(!1),e.invalidate();else if(t)for(var l=0;l<t.length;l++){var d=t[l];d.expire(!1),d.invalidate()}var u=a&&a[0],c=e;!e&&t&&u&&(c=i.DataModel.getInstance().getPlaceholderItem(i.SkyDriveItem.getItemKey(u.id,D,h),u.name,!0,{isBundle:!0,ownerCid:D,commands:"sh,1"})),c?(u&&(c.selectionId=u.id),y(c,o),v&&v(c,s)):w&&w(e,{message:n("Sharing.ShareErrorAllFailed")},null)},function(t){1==o.length&&o[0].role==r&&t.error&&t.error.code==d?x.fetchPermissions(e,function(){e.expire(!1),e.invalidate(),v&&v(e,void 0)},null,!0):(!t.errorResult&&t.error.code!=s||t.primaryError&&t.primaryError.code==l||!e||x.fetchPermissions(e,function(){e.expire&&(e.expire(!1),e.invalidate())},null,!0),w&&w(e,t.primaryError?t.primaryError:t.error,t.errorResult))},u,null,0);I.apiId="SkyDrive_Json_SetPermissions",I.propertyId="SkyDrive",I.start()}function p(e){return{id:e.id,refId:"",canChange:!1,name:e.name,allowedActions:[],entities:[]}}function m(e,t,i,n){for(var r=t.permissionScopes,o=0;o<r.length;o++)if(r[o].id==e.id)return n?r.splice(o,1)[0]:r[o];if(i){var a=p(e);return r.push(a),a}return null}function f(e,t){var i;if(e&&!e.getParent)return i=m(e,t,!1,!0),void(i&&t.permissionScopes.unshift(i));for(var n=[];e;)i=m(e,t,!1,!0),i&&n.push(i),e=e.getParent(!0);t.permissionScopes=n.concat(t.permissionScopes)}function g(t){for(var i=null,n=null,r=null,o=0;o<t.length;o++){var a=t[o];a.type==e.EntityType.Link?a.linkType==e.LinkType.View?i=a:a.linkType==e.LinkType.Edit&&(n=a):a.type==e.EntityType.Public&&(r=a)}r&&(t.remove(r),t.unshift(r)),n&&(t.remove(n),t.unshift(n)),i&&(t.remove(i),t.unshift(i))}function v(t,n){n.permissionScopes=n.permissionScopes||[],f(t,n);for(var r=n.permissionScopes,o=0;o<r.length;o++)r[o].entities.remove||(r[o].entities=Array.prototype.slice.call(r[o].entities)),g(r[o].entities);var a=r[0];if(0!=r.length&&i.StringHelpers.caseInsensitiveStringEquals(a.id,t.id)||(a=p(t),r.splice(0,0,a)),n.group||!E.isViewerOwner(t)||E.isCoOwner(t)||t.groupFolderType==i.GroupFolderType.MountPoint){var s,l;if(n.group){var d=L(t);s=m(d,n,!0),l={role:n.groupUserRole,type:e.EntityType.GroupOwned}}else s=r[0],l={did:n.ownerDCid?n.ownerDCid:t.ownerDCid,id:n.ownerCid,name:n.ownerName,role:e.Role.Owner,type:e.EntityType.User};return void s.entities.unshift(l)}}function y(e,i,n){if(v(e,i),S(e))return void k(e,i);void 0===n&&(n=!1);var r=i.permissionScopes,o={};for(var a in i)"permissionScopes"!==a&&(o[a]=i[a]);var s=e,l=e.getParent(!0);s._cachingParentId=l&&l.id;for(var d,u=r.slice(0);s&&!P(s);){var c=[];for(d=0;d<u.length;d++){var h=u[d];h.id!==s.id&&(h.refId!=s.id||l&&h.id==l.id)||(c.push(u[d]),u.splice(d,1),d--)}if(0==c.length&&c.push(p(s)),s._permissionScope=new t(c),n)break;s=s.getParent(!0)}u.length>0&&!n?e._cappedPermissions=u:_(e)&&(e._cappedPermissions=[]);var m=new t(o);if(e._permissionExtra=m,!o.group&&!n)for(s=e.getParent(!0);s&&!P(s);)s._permissionExtra=m,s=s.getParent(!0)}function w(e,t){if(S(e))return b(e,t);var i=e.getParent(!0),n=e._permissionExtra;if(!n||!t&&n.isExpired()||!i||e._cachingParentId!=i.id)return null;var r={};for(var o in n.value)r[o]=n.value[o];r.permissionScopes=[];for(var a=[],s=e;s&&!P(s);){var l=s._permissionScope;if(!l||!t&&l.isExpired())return null;for(var d=l.value,u=0;u<d.length;u++){var c=d[u];(c.entities.length>0||s==e)&&(c.refId?a.push(c):(c.name=s.name,r.permissionScopes.push(c)))}s=s.getParent(!0)}return a.length>0&&(r.permissionScopes=r.permissionScopes.concat(a)),_(e)&&e._cappedPermissions&&e._cappedPermissions.length>0&&(r.permissionScopes=r.permissionScopes.concat(e._cappedPermissions)),r}function C(e){if(S(e))return b(e)?void 0:!1;var t=e.getParent(!0);if(_(e)&&(!e._cappedPermissions||t&&e._cachingParentId&&e._cachingParentId!=t.id))return!1;for(var i=-1,n=0,r=e;r&&!P(r);){var o=r._permissionScope;if(!o||o.isExpired())i=n;else{var a=r._permissionExtra;r!==e||a&&!a.isExpired()||(i=n)}if(i>0)break;r=r.getParent(!0),n++}return-1!==i?T(e)?!1:!i:void 0}function b(e,t){var i=e._simplePermissions;return!i||!t&&i.isExpired()?null:i.value}function k(e,i){e._simplePermissions=new t(i)}function S(e){return A(e)||FilesConfig.isWacSharing||!e.getParent||!e.group&&!I(e)}function _(e){return I(e)}function I(e){return i.StringHelpers.caseInsensitiveStringEquals(D,e.ownerCid)||E.isOwnerOrCoOwner(e)}var x=this,D=o,E=i.SkyDriveItemHelper,P=i.SkyDriveItemHelper.isRootItem,T=i.SkyDriveItemHelper.isGroupItem,A=i.SkyDriveItemHelper.isSearchResult,L=i.SkyDriveItemHelper.getTopLevelItem,F={};x.hasCachedData=function(e){return void 0===C(e)},x.deletePermission=function(t,i,n,o){i.role=r,this.updatePermissions(t,null,i,{suppressNotification:!0},e.UserAction.Manage,n,c(o))},x.embedLink=function(t,i,n){var r={role:e.Role.View,type:e.EntityType.Link,linkType:e.LinkType.Embed};this.updatePermissions(t,null,r,null,e.UserAction.Share,i,c(n))},x.submitFormLink=function(t,i,n){var r={role:e.Role.Submit,type:e.EntityType.Link,linkType:e.LinkType.Form};this.updatePermissions(t,null,r,null,e.UserAction.Share,i,c(n))},x.makePublic=function(t,i,n,r,o){var a={role:e.Role.View,type:e.EntityType.Public};this.updatePermissions(t,i,a,n,e.UserAction.Share,r,c(o))},x.createLink=function(t,i,n,r,o,a){var s={role:n,type:e.EntityType.Link,linkType:n==e.Role.Edit?e.LinkType.Edit:e.LinkType.View};this.updatePermissions(t,i,s,r,e.UserAction.Share,o,c(a))},x.createPermissionEntity=function(t,i){var n=null;if(t.error())return n;var r=jQuery("<div></div>"),o=t&&t.contact(),a=o&&o.cid();a&&a.indexOf("-")>-1&&(a=null);var s=t.email(),l=t.isGroup()?e.EntityType.Group:a?e.EntityType.User:o&&"FB"===o.sourceId()?e.EntityType.Facebook:e.EntityType.Email;return n={role:i,type:l},s&&l!=e.EntityType.Facebook&&(n.email=r.html(s).text()),l==e.EntityType.User?n.did=a:l==e.EntityType.Group?n.abId=o&&o.id():l==e.EntityType.Facebook&&(n.id=o&&o.id()),n},x.shareToContacts=function(t,i,r,o,a,s,l,d,u){for(var c,p=[],m=0;m<r.length;m++){var f=x.createPermissionEntity(r[m],o);if(null==f){c=!0;break}p.push(f)}c?u&&u(t,{message:n("Sharing.ShareInvalidEmailError")}):0==p.length?u&&u(t,{message:n("Sharing.ShareNoRecipientError")}):h(t,i,p,s,a,!1,null,null,e.UserAction.Share,l,function(e,t){var i,n=p[0];if(t)for(var r=0;r<t.length;r++){var o=t[r];if(n.role===o.role&&n.email===o.email){i=t[r];break}}d&&d(e,i)},u)},x.shareToNetworks=function(t,i,n,r,o,a,s,l){for(var d=[],u=0;u<n.length;u++){var c=n[u],p={role:r,type:e.EntityType.Link,linkType:e.LinkType.Network,linkName:c.id};d.push(p)}h(t,i,d,o,null,!1,null,null,e.UserAction.Share,a,function(e,t){var i,n=d[0];if(t)for(var r=0;r<t.length;r++){var o=t[r];if(n.linkType===o.linkType&&n.role===o.role&&n.type===o.type&&n.linkName===o.linkName){i=t[r];break}}s&&s(e,i)},l)},x.updatePermissions=function(t,n,r,o,a,s,l){var d=r.type==e.EntityType.GroupOwned;delete r.link,h(t,n,d?[]:[r],null,null,d,d?r.role:null,o&&o.suppressNotification,a,o,function(e,t){var n;if(t)for(var o=0;o<t.length;o++){var a=t[o];r.linkType!==a.linkType||r.role!==a.role||r.type!==a.type||null!=r.id&&!i.StringHelpers.caseInsensitiveStringEquals(r.id,a.id)||(n=t[o])}s&&s(e,d?r:n)},l)},x.fetchPermissions=function(e,t,n,r){var o=!r&&w(e);if(o)t(e,o);else{var a=C(e),s=F[e];if(void 0!==s)t&&s.successCallbacks.push(t),n&&s.failureCallbacks.push(n);else{var l={id:e.id,v:Math.random(),mkt:$Config.mkt};e.ownerCid&&(l.cid=e.ownerCid),T(e)&&(l.group=e.group),a&&(l.itemOnly=a),FilesConfig&&FilesConfig.ticket?l.ticket=FilesConfig.ticket:FilesConfig&&FilesConfig.authKey&&(l.authkey=FilesConfig.authKey);var d=FilesConfig.baseApiUrl+"GetPermissions?"+$Utility.serialize(l),u=new i.DataRequest(d,d,null,function(t){y(e,t,a);var i=w(e,!0),n=F[e];delete F[e];for(var r=0;r<n.successCallbacks.length;r++)n.successCallbacks[r](e,i)},function(t){var i=F[e];delete F[e];for(var n=0;n<i.failureCallbacks.length;n++)i.failureCallbacks[n](e,t.error)});u.apiId="SkyDrive_Json_GetPermissions",u.propertyId="SkyDrive";var c={successCallbacks:[],failureCallbacks:[],request:u};void 0!==t&&c.successCallbacks.push(t),void 0!==n&&c.failureCallbacks.push(n),F[e]=c,u.start()}}},x.updateBundle=function(e,t,n,r,o){for(var a={bundleId:e.id},s=[],l=0;l<t.length;l++)s.push(t[l].id);a.items=s,null!=n&&(a.bundleAction=n);var d=Object.toJSON(a),c=FilesConfig.baseApiUrl+"UpdateBundle",h=new i.DataRequest(null,c,d,function(t){r&&r(e,t)},function(t){o&&o(e,t)},u,null,0);h.apiId="SkyDrive_Json_UpdateBundle",h.propertyId="SkyDrive",h.start()},x.getCachedPermissions=function(e){if(e.sharingLevelValue==a){var t={canChange:!0,group:!1,groupUserRole:0,ownerName:e.ownerName,ownerCid:e.ownerCid,permissionScopes:[p(e)]};return t}var i=w(e);return i}}function t(e){this.value=e,this.expires=(new Date).getTime()+o,this.isExpired=function(){return this.expires<(new Date).getTime()}}var i=wLive.Core,n=i.AleHelpers.getPCString,r=0,o=12e4,a=4,s=3e3,l=3006,d=3012,u=6e4;e.Role={Owner:-1,View:1,Edit:2,Submit:3,CoOwner:4},e.GroupRole={View:0,Edit:1},e.EntityType={Email:0,User:1,Group:2,Link:3,Public:4,Friends:5,Facebook:6,Application:7,GroupOwned:99},e.LinkType={Network:1,Embed:3,App:4,View:5,Edit:6,Form:7},e.UserAction={Share:0,Manage:1},e.BundleAction={Add:0,Remove:1},e.AllowedActions={Remove:0},e.Expiry={LongedLived:0,ShortLived:1},i.PermissionsProvider=e}()}),define("embed",["doregister","jquery-1.7.2","wliveloaded","alehelpers","errormanager","itemactionhelper","permissionsprovider"],function(){!function(){function e(e){function n(e){W.empty();var t=$f.createLoading(!0);W.html(t),W.show();var i=(e-W.height())/2;W.css("padding-top",Math.ceil(i))}function p(){W.hide()}function m(e,t){if(t){var i=x(e),n=jQuery(_ce("div")).attr({id:"preview"}).width(i),r=jQuery(_ce("div")).attr({id:"column"}).width(a-i);f(n,e),v(r,e,t),jQuery("#mainBody").append(n,r);var o=_ge("generateButton");o&&o.focus()}}function f(e,t){if(B)e.append(B.embedCode),e.children("iframe").attr({id:"preview_iframe",tabindex:"-1"});else{var n,r=o(t)||t.iconType;n=H&&r===c?jQuery(_ce("img")).attr({id:"preview_iframe",src:FilesConfig.foldersImgBaseUrl+"/embed_excel.png",alt:"Excel",tabindex:"-1"}):H&&r===u?jQuery(_ce("img")).attr({id:"preview_iframe",src:FilesConfig.foldersImgBaseUrl+"/embed_ppt.png",alt:"PowerPoint",tabindex:"-1"}):!H||r!==d&&r!==h?jQuery(_ce("iframe")).attr({id:"preview_iframe",tabindex:"-1",scrolling:"no",frameborder:"0",width:""+x(t),height:""+D(t,!0),src:i.ItemActionHelper.itemStringFormat("/embed?{cidQueryString}{resIdQueryString}",t,t.ownerCid,t.group)}):jQuery(_ce("img")).attr({id:"preview_iframe",src:FilesConfig.foldersImgBaseUrl+"/embed_word.png",alt:"Word",tabindex:"-1"}),e.append(n)}}function g(e,t){H&&(e.html(B.embedCode),e.children("iframe").attr({id:"preview_iframe"}))}function v(e,t,i){var n=jQuery(_ce("div")).attr({id:"instructions"}),o=jQuery(_ce("div")).attr({id:"gen"}),a=jQuery(_ce("div")).attr({id:"disclaimer"}).html(r("Embed.Disclaimer"));y(n,t),C(o,t,i),e.append(n,o,a),k(e,t)}function y(e,t){B?$B.IE?(e.html(r("Embed.CopyInstructions."+I(t)).format('<span id="copyHtml">',"</span>")),jQuery(e).find("span").click(w)):e.html(r("Embed.CopyInstructions."+I(t)).format("","")):e.html(r("Embed.GenerateInstructions."+I(t)))}function w(){document.getElementById("embedTextbox").createTextRange().execCommand("Copy")}function C(e,t,i){if(B){var n=jQuery(_ce("input")).attr({id:"embedTextbox",name:"HTML",type:"text",value:B.embedCode}).width(a-s-x(t));$B.SF_iPhone&&!$B.Mobile||n.attr("readonly","readonly"),n.click(function(){b(jQuery(this))}),e.html(n)}else{var o=jQuery(_ce("input")).attr({id:"generateButton","class":"default",name:r("Embed.Generate"),type:"button",value:r("Embed.Generate")}).click(function(){S(t,i)});e.html(o)}}function b(e){e.focus(),e.select()}function k(e,t){if(j&&B&&B.embedConfiguratorUrl){var i=jQuery(_ce("div")).attr({id:"configurator"
});i.html(jQuery(_ce("a")).attr({href:B.embedConfiguratorUrl,target:"_blank"}).html(r("Embed.Configurator"))),e.append(i)}}function S(t,i){jQuery("#generateButton").attr("disabled","disabled"),e.embedLink(t,function(e,t){P(e,t,i)},T)}function _(e){R&&R(),e.dismiss(),Q.dispose()}function I(e){var t;return t=e.photo?"Photo":e.folder&&e.folder.covers?"Album":e.folder?"Folder":"File"}function x(e){var t=o(e)||e.iconType;if(e.photo||e.video){var i=e.video?e.video:e.photo,n=320;return i.width>i.height?Math.min(i.width,n):i.height<n?i.width:Math.floor(n*(i.width/i.height))}return e.folder?165:H&&t===c?402:H&&t===u?402:!H||t!==d&&t!==h?98:476}function D(e,t){var i=o(e)||e.iconType;if(e.photo||e.video){var n=e.photo?e.photo:e.video,r=320;return n.height>n.width?Math.min(n.height,r):n.width<r?n.height:Math.floor(r*(n.height/n.width))}return H&&i===c?346:H&&i===u?327:!H||i!==d&&i!==h?t&&e.folder?128:e.folder?139:t?120:125:288}function E(e,n,r){var o=t.FilesConfig.baseApiUrl+"GetEmbedInfo?id="+e.id,a=new i.DataRequest(o,o,null,n,r);a.apiId="SkyDrive_Json_GetEmbedInfo",a.propertyId="SkyDrive",a.start()}function P(e,t,i){return O?void O(t):void E(e,function(t){A(t),M&&(jQuery("#column").empty(),v(jQuery("#column"),e,i),g(jQuery("#preview"),e),jQuery("div.Footer button").show(),b(jQuery("#embedTextbox")),F())},L)}function T(){jQuery("#instructions").html(r("Embed.PopoverError")),jQuery("#generateButton").removeAttr("disabled")}function A(e){B=e&&e.embedCode?e:null}function L(e,t){e&&e.error&&e.error.code==l&&t?(e.error.isExpected=!0,t(e)):jQuery("#mainBody").html(r("Embed.PopoverError"))}function F(){sutra(N.find(".Content"),"$Sutra.SkyDrive.EmbedPopover"),sutra(N.find(".UserTitle"),"$Sutra.SkyDrive.EmbedTitle"),sutra(jQuery("#preview"),"$Sutra.SkyDrive.EmbedPreview"),sutra(jQuery("#preview_iframe"),"$Sutra.SkyDrive.EmbedPreviewIframe"),sutra(jQuery("#embedTextbox"),"$Sutra.SkyDrive.EmbedTextbox"),sutra(jQuery("#configurator"),"$Sutra.SkyDrive.EmbedExcelLink"),sutra(jQuery("#generateButton"),"$Sutra.SkyDrive.EmbedGenerateBtn"),sutra(jQuery(M.getButton({buttonName:"close"})),"$Sutra.SkyDrive.EmbedDoneBtn")}var M,N,U,R,O,B,H,j,W,Q=this,$=wLive.Controls.Notifications;Q.dispose=function(){M&&(M.dismiss(),M=null)},Q.show=function(e,t,i,a,s){function l(e){A(e),g()}j=t,H=i,a&&(R=a),s&&(O=s);var d=function(e,t,i){jQuery("iframe#preview_iframe").attr({src:""}),jQuery("#CancelIcon").unbind("click"),_(t)};W=jQuery('<div id="embedLoading"></div>');var u=D(e);U=r(j||o(e)!==c?"Embed.Done":"Embed.Cancel"),e.video&&SkyDrive.UI.VideoDataContext&&SkyDrive.UI.VideoDataContext.pauseAll();var h=jQuery(_ce("div")).attr({id:"mainBody"}).css({"min-height":u}).append(W);M=$.createModalDialog({buttons:{close:U},title:r("Embed.EmbedDocumentTitle").format(e.name),content:h});var f=jQuery(M);f.bind({"aftershow._dlg":function(t,i){n(u),N=jQuery(M.content()),E(e,l,function(e){L(e,l)})},"afterdismiss._dlg":function(e,t){f&&f.unbind("._dlg"),f=null,M=null},"buttonclick._dlg":d}),M.show();var g=function(){M&&(p(),m(e,M),jQuery("#mainBody").height(function(t,i){var n=jQuery("#column").height(),r=D(e,!0);return n>r?n:(jQuery("#column").height(r),r)}),F())}}}var t=window,i=wLive.Core,n=wLive.Controls,r=i.AleHelpers.getPCString,o=i.SkyDriveItemHelper.getNormalizedExtension,a=795,s=18,l=3017,d="Doc",u="Ppt",c="Xls",h="Pdf";n.Embed=e}()}),define("skydrive_pc_strip_32_ltr",[],function(){window.FilesIS32={InteractiveModeButtonActive:{x:1,y:1,w:97,h:96},InteractiveModeButtonRest:{x:1,y:99,w:97,h:96},InteractiveModeButtonHover:{x:100,y:1,w:97,h:96},mobileUpsell:{x:100,y:99,w:77,h:42},previousRest:{x:100,y:143,w:69,h:40},nextRest:{x:1,y:197,w:69,h:40},nextHover:{x:72,y:197,w:69,h:40},previousHover:{x:199,y:1,w:69,h:40},groupsIcon60:{x:199,y:43,w:60,h:60},video_48:{x:179,y:105,w:48,h:48},processingVideo_48:{x:171,y:155,w:48,h:48},ft_48_Notebook:{x:1,y:239,w:48,h:48},ft_48_Docx:{x:51,y:239,w:48,h:48},ft_48_Pptx:{x:101,y:239,w:48,h:48},ft_48_Xlsx:{x:151,y:205,w:48,h:48},skydrive:{x:221,y:155,w:45,h:40},PanoBackRest:{x:201,y:205,w:41,h:41},PanoBackActive:{x:270,y:1,w:41,h:41},PanoBackHover:{x:261,y:44,w:41,h:41},PanoZoomInActive:{x:229,y:105,w:40,h:40},PanoZoomOutRest:{x:271,y:87,w:40,h:40},PanoZoomOutActive:{x:271,y:129,w:40,h:40},PanoZoomOutHover:{x:268,y:171,w:40,h:40},PanoZoomInRest:{x:244,y:213,w:40,h:40},PanoZoomInHover:{x:1,y:289,w:40,h:40},formLinkIcon_40:{x:43,y:289,w:40,h:40},friendsIcon_40:{x:85,y:289,w:40,h:40},formLinkIcon_40_White:{x:151,y:255,w:40,h:40},embedIcon_40_White:{x:193,y:255,w:40,h:40},publicIcon_40:{x:235,y:255,w:40,h:40},publicIcon_40_White:{x:313,y:1,w:40,h:40},linkIcon_40_White:{x:304,y:44,w:40,h:40},linkIcon_40:{x:313,y:86,w:40,h:40},groupsIcon_40_White:{x:313,y:128,w:40,h:40},groupsIcon_40:{x:310,y:171,w:40,h:40},friendsIcon_40_White:{x:286,y:213,w:40,h:40},embedIcon_40:{x:277,y:255,w:40,h:40},ft_32_Tag:{x:1,y:331,w:38,h:38},ft_32_NonEmptyFavoriteFolder:{x:41,y:331,w:32,h:32},processingVideo_32:{x:75,y:331,w:32,h:32},ft_32_Txt:{x:109,y:331,w:32,h:32},ft_32_Video:{x:127,y:297,w:32,h:32},embedIcon:{x:161,y:297,w:32,h:32},friendsIcon:{x:143,y:331,w:32,h:32},publicIconWhite:{x:195,y:297,w:32,h:32},publicIcon:{x:177,y:331,w:32,h:32},mailIcon:{x:229,y:297,w:32,h:32},friendsIconWhite:{x:211,y:331,w:32,h:32},formLinkIconWhite:{x:263,y:297,w:32,h:32},formLinkIcon:{x:319,y:255,w:32,h:32},embedIconWhite:{x:245,y:331,w:32,h:32},linkIconWhite:{x:297,y:297,w:32,h:32},linkIcon:{x:279,y:331,w:32,h:32},ft_32_Zip:{x:313,y:331,w:32,h:32},ft_32_Docx:{x:355,y:1,w:32,h:32},ft_32_Pptx:{x:355,y:35,w:32,h:32},ft_32_Audio:{x:355,y:69,w:32,h:32},ft_32_Notebook:{x:355,y:103,w:32,h:32},ft_32_Xlsx:{x:355,y:137,w:32,h:32},ft_32_Blank:{x:352,y:171,w:32,h:32},photosTab:{x:328,y:213,w:30,h:30},tagsTab:{x:353,y:245,w:30,h:30},BackToFolderHover:{x:331,y:289,w:30,h:30},BackToFolderRest:{x:347,y:321,w:30,h:30},BackToFolderPressed:{x:1,y:371,w:30,h:30},panorama:{x:33,y:371,w:30,h:30},albumsTab:{x:65,y:365,w:30,h:30},groupsIconWhite:{x:97,y:365,w:30,h:30},groupsIcon:{x:129,y:365,w:30,h:30},PreviousItemPressed:{x:161,y:365,w:30,h:30},PreviousItemRest:{x:193,y:365,w:30,h:30},ViewItemInfoPressed:{x:225,y:365,w:30,h:30},ViewItemInfoRest:{x:257,y:365,w:30,h:30},HideItemInfoHover:{x:289,y:365,w:30,h:30},HideItemInfoRest:{x:321,y:365,w:30,h:30},HideItemInfoPressed:{x:353,y:353,w:30,h:30},ViewItemInfoHover:{x:389,y:1,w:30,h:30},NextItemRest:{x:389,y:33,w:30,h:30},NextItemHover:{x:389,y:65,w:30,h:30},NextItemPressed:{x:389,y:97,w:30,h:30},PreviousItemHover:{x:389,y:129,w:30,h:30},video_32:{x:389,y:161,w:30,h:30},videoPausePressed:{x:360,y:205,w:26,h:26},videoPlay:{x:388,y:193,w:26,h:26},videoPlayPressed:{x:388,y:221,w:26,h:26},videoVolume:{x:385,y:249,w:26,h:26},videoVolumePressed:{x:363,y:277,w:26,h:26},videoMute:{x:391,y:277,w:26,h:26},videoMutePressed:{x:379,y:305,w:26,h:26},videoExpand:{x:385,y:333,w:26,h:26},videoExpandPressed:{x:385,y:361,w:26,h:26},videoCollapse:{x:1,y:403,w:26,h:26},videoCollapsePressed:{x:29,y:403,w:26,h:26},videoSettings:{x:57,y:403,w:26,h:26},videoSettingsPressed:{x:85,y:397,w:26,h:26},videoCloud:{x:113,y:397,w:26,h:26},videoSettingsDisabled:{x:141,y:397,w:26,h:26},videoSettingsHover:{x:169,y:397,w:26,h:26},videoCollapseDisabled:{x:197,y:397,w:26,h:26},videoCollapseHover:{x:225,y:397,w:26,h:26},videoExpandDisabled:{x:253,y:397,w:26,h:26},videoExpandHover:{x:281,y:397,w:26,h:26},videoMuteDisabled:{x:309,y:397,w:26,h:26},videoMuteHover:{x:337,y:397,w:26,h:26},videoVolumeDisabled:{x:365,y:389,w:26,h:26},videoVolumeHover:{x:393,y:389,w:26,h:26},videoPlayDisabled:{x:421,y:1,w:26,h:26},videoPlayHover:{x:421,y:29,w:26,h:26},videoPauseDisabled:{x:421,y:57,w:26,h:26},videoPauseHover:{x:421,y:85,w:26,h:26},uploadIconDark:{x:421,y:113,w:26,h:26},createIconLight:{x:421,y:141,w:26,h:26},videoPause:{x:421,y:169,w:26,h:26},uploadIconLight:{x:416,y:197,w:26,h:26},createIconDark:{x:416,y:225,w:26,h:26},cancelActive:{x:413,y:253,w:20,h:20},CancelDarkHover:{x:419,y:275,w:20,h:20},CancelDarkRest:{x:407,y:305,w:20,h:20},CancelLightActive:{x:413,y:327,w:20,h:20},CancelLightRest:{x:413,y:349,w:20,h:20},EditDarkHover:{x:421,y:371,w:20,h:20},EditLightActive:{x:421,y:393,w:20,h:20},EditLightHover:{x:1,y:431,w:20,h:20},EditLightRest:{x:23,y:431,w:20,h:20},SaveDarkHover:{x:45,y:431,w:20,h:20},SaveLightActive:{x:67,y:431,w:20,h:20},SaveLightRest:{x:89,y:425,w:20,h:20},SaveLightHover:{x:111,y:425,w:20,h:20},SaveDarkRest:{x:133,y:425,w:20,h:20},SaveDarkActive:{x:155,y:425,w:20,h:20},EditDarkRest:{x:177,y:425,w:20,h:20},EditDarkActive:{x:199,y:425,w:20,h:20},CancelLightHover:{x:221,y:425,w:20,h:20},CancelDarkActive:{x:243,y:425,w:20,h:20},cancelRest:{x:265,y:425,w:20,h:20},addCoOwnersIcon:{x:287,y:425,w:20,h:20},cancelHover:{x:309,y:425,w:20,h:20},skydrive_16Selected:{x:429,y:297,w:18,h:18},goBackNormal:{x:331,y:425,w:18,h:18},goBackHover:{x:351,y:425,w:18,h:18},skydrive_16:{x:371,y:417,w:18,h:18},zoomInRest:{x:391,y:417,w:16,h:16},zoomOutRest:{x:409,y:417,w:16,h:16},zoomOutHover:{x:391,y:435,w:16,h:16},zoomInHover:{x:427,y:415,w:16,h:16},ft_16_NonEmptyDocumentFolderSelected:{x:409,y:435,w:16,h:16},ft_16_NonEmptyAlbumSelected:{x:427,y:433,w:16,h:16},ft_16_BundleSelected:{x:449,y:1,w:16,h:16},ft_16_SharedFolder:{x:449,y:19,w:16,h:16},info_gray_16:{x:449,y:37,w:16,h:16},info_16:{x:449,y:55,w:16,h:16},ft_16_Docx:{x:449,y:73,w:16,h:16},ft_16_SharedGlyph:{x:449,y:91,w:16,h:16},ft_16_Pptx:{x:449,y:109,w:16,h:16},blocked16:{x:449,y:127,w:16,h:16},ft_16_Notebook:{x:449,y:145,w:16,h:16},ft_16_SharedGlyphGray:{x:449,y:163,w:16,h:16},ft_16_Xlsx:{x:449,y:181,w:16,h:16},ft_16_SharedGlyphSelected:{x:444,y:199,w:16,h:16},ft_16_SharedFolderSelected:{x:444,y:217,w:16,h:16},centerHover:{x:444,y:235,w:16,h:16},centerRest:{x:435,y:253,w:16,h:16},ft_16_BundleWithBorderSelected:{x:441,y:271,w:16,h:16},ft_16_Bundle:{x:449,y:289,w:16,h:16},ft_16_EmptyAlbumSelected:{x:449,y:307,w:16,h:16},ft_16_EmptyDocumentFolderSelected:{x:435,y:325,w:16,h:16},ft_16_NonEmptyDocumentFolder:{x:435,y:343,w:16,h:16},ft_16_NonEmptyAlbum:{x:443,y:361,w:16,h:16},ft_16_NonEmptyFavoriteFolderSelected:{x:443,y:379,w:16,h:16},ft_16_EmptyFavoriteFolderSelected:{x:443,y:397,w:16,h:16},ft_16_EmptyAlbum:{x:445,y:415,w:16,h:16},ft_16_EmptyDocumentFolder:{x:445,y:433,w:16,h:16},ft_16_EmptyFavoriteFolder:{x:1,y:453,w:16,h:16},ft_16_NonEmptyFavoriteFolder:{x:19,y:453,w:16,h:16},searchIcon:{x:37,y:453,w:14,h:14},warning:{x:53,y:453,w:12,h:12},checkMark:{x:67,y:453,w:12,h:12},whiteClosedUp11x9:{x:81,y:453,w:9,h:11},freClose:{x:92,y:447,w:11,h:11},freCloseHover:{x:105,y:447,w:11,h:11},collapse11x9:{x:100,y:185,w:11,h:9},expand11x9:{x:113,y:185,w:11,h:9},darkPanelOpenUp11x9:{x:126,y:185,w:11,h:9},whiteOpenUp11x9:{x:139,y:185,w:11,h:10},openUp11x9:{x:152,y:185,w:11,h:9},darkPanelClosedUp11x9:{x:118,y:447,w:9,h:11},closedUp11x9:{x:129,y:447,w:9,h:11},privateIcon:{x:261,y:87,w:8,h:10},privateIconWhite:{x:140,y:447,w:10,h:10},restoreRest:{x:360,y:233,w:10,h:10},restoreHover:{x:152,y:447,w:10,h:10},whiteClosedUp:{x:171,y:143,w:6,h:8},whiteOpenUp:{x:143,y:197,w:8,h:6},openUp:{x:153,y:196,w:8,h:6},darkPanelOpenUp:{x:229,y:147,w:8,h:6},closedUp:{x:143,y:205,w:6,h:8},darkPanelClosedUp:{x:143,y:215,w:6,h:8},sortMenuBullet:{x:92,y:460,w:8,h:8},chevronRightGray:{x:143,y:225,w:6,h:8},chevronRightBlack:{x:346,y:43,w:6,h:8}}}),define("skydrive_pc_strip_8_ltr",[],function(){window.FilesIS8={ft_48_Blank:{x:1,y:1,w:48,h:48},ft_48_NonEmptyFavoriteFolder:{x:51,y:1,w:48,h:48},ft_48_Zip:{x:1,y:51,w:48,h:48},ft_48_Photo:{x:51,y:51,w:48,h:48},ft_48_Txt:{x:101,y:1,w:48,h:48},ft_48_NonEmptyAlbum:{x:101,y:51,w:48,h:48},ft_48_EmptyAlbum:{x:1,y:101,w:48,h:48},ft_48_NonEmptyDocumentFolder:{x:51,y:101,w:48,h:48},ft_48_EmptyDocumentFolder:{x:101,y:101,w:48,h:48},ft_48_Video:{x:151,y:1,w:48,h:48},ft_48_Audio:{x:151,y:51,w:48,h:48},ft_32_NonEmptyDocumentFolder:{x:151,y:101,w:32,h:32},ft_32_EmptyDocumentFolder:{x:1,y:151,w:32,h:32},ft_32_Photo:{x:35,y:151,w:32,h:32},ft_32_NonEmptyAlbum:{x:69,y:151,w:32,h:32},ft_32_EmptyAlbum:{x:103,y:151,w:32,h:32},groups:{x:151,y:135,w:32,h:32},gridIconSelected:{x:1,y:185,w:26,h:26},listIconSelected:{x:29,y:185,w:26,h:26},customIconSelected:{x:57,y:185,w:26,h:26},infoPaneIconSelected:{x:85,y:185,w:26,h:26},infoPaneIcon:{x:113,y:185,w:26,h:26},customIcon:{x:141,y:169,w:26,h:26},listIcon:{x:169,y:169,w:26,h:26},upIcon:{x:201,y:1,w:26,h:26},gridIcon:{x:201,y:29,w:26,h:26},darkPanelOpen:{x:201,y:57,w:20,h:25},lightPanelOpen:{x:201,y:84,w:20,h:25},panelClose:{x:185,y:111,w:20,h:25},error:{x:207,y:111,w:16,h:16},ft_16_Blank:{x:185,y:138,w:16,h:16},ft_16_Zip:{x:207,y:129,w:16,h:16},ft_16_Photo:{x:203,y:147,w:16,h:16},ft_16_Video:{x:197,y:165,w:16,h:16},ft_16_Txt:{x:197,y:183,w:16,h:16},ft_16_Audio:{x:1,y:213,w:16,h:16},redX:{x:19,y:213,w:16,h:16},ppRedX:{x:37,y:213,w:13,h:13},ppSearch:{x:52,y:213,w:13,h:13},ppGreyX:{x:67,y:213,w:13,h:13},close:{x:137,y:151,w:10,h:10}}}),define("skydrive_sharing_strip_8_ltr",[],function(){window.SharingIS={linkedin:{x:1,y:1,w:20,h:20},add:{x:23,y:1,w:20,h:20},weibo:{x:1,y:23,w:20,h:20},twitter:{x:23,y:23,w:20,h:20},facebook:{x:45,y:1,w:20,h:20}}}),define("header_strip_ltr",[],function(){window.HeaderIS={dogfood:{x:2,y:2,w:110,h:110},onenote:{x:116,y:2,w:110,h:110},people:{x:2,y:116,w:110,h:110},sway:{x:116,y:116,w:110,h:110},office:{x:230,y:2,w:110,h:110},word:{x:230,y:116,w:110,h:110},ppt:{x:2,y:230,w:110,h:110},outlook:{x:116,y:230,w:110,h:110},excel:{x:230,y:230,w:110,h:110},onedrive:{x:344,y:2,w:110,h:110},calendar:{x:344,y:116,w:110,h:110}}}),define("loadingcue",["loadingspinner"],function(){!function(){function e(e){e.html(i);var s=jQuery(".lcCenter",e),l=jQuery(".lcWrapper",e).hide(),d=new t.LoadingSpinner(l);d.render(),l.css("margin-"+o,-(l.width()/2)),sutra(l,"$Sutra.SkyDrive.LoadingCue");var u=this,c=!1;u.setVisibility=function(e){e?(c||(r?l.stop(!0).delay(n).css("opacity",0).show().animate({opacity:1},500):l.show()),s.offset().top>=(a.scrollTop&&a.scrollTop())?l.css({position:"absolute"}):l.css({position:"fixed"})):l.stop(!0).hide(),c=e},u.update=function(){u.setVisibility(c)}}var t=wLive.Controls,i='<div class="lcCenter"><div class="lcWrapper"></div></div>',n=250,r=jQuery.support.opacity,o=$B.ltr?"left":"right",a=jQuery(window);t.LoadingCue=e}()}),define("imageloader",["defineutilities","trace","retriablepromise","domutilities","workmonitor","elementeventing"],function(){!function(){var e=Shared.WorkMonitor,t=10,n="ImageLoader",r=3,o=[5e3,15e3,3e4];Trace.register(n,{isEnabled:!1});var a="retryid";defineNamespace("Shared.ImageLoader",{_loadedUrls:{},_imageStates:{},_urlQueue:[],_loadAttempts:0,_loadRetryAttempts:0,_loadSuccess:0,_loadError:0,_loadAbort:0,_loadPending:0,loadImagePromise:function(t,i){var a,s=t,l=this,d=0,u=new Shared.RetriablePromise(function(e,r){1===++d?a=Trace.log("Loading image: "+t,n):Trace.logTo(a,"Retrying image (attempt: "+d+", pending: "+l._loadPending+")",n),l.loadImage(s,i,e,r,d>1)},function(){var e=l._imageStates[t];e&&(e.references--,e.references||delete l._imageStates[t])},r,o,null);return u.then(function(){Trace.logTo(a,"Complete",n)},function(){Trace.logTo(a,"Error",n)}),e.monitorPromise([e.StandardTags.Network,e.StandardTags.Network_Image],u),u},loadImage:function(e,t,i,n,r){var o=this;if(t=t||ce("img"),o._loadedUrls[e])t.src=e,i(e,t);else{var a=o._imageStates[e];a?(a.elements.push(t),a.references++,i&&a.callbacks.push(i),n&&a.errorCallbacks.push(n),a.forceDownload=a.forceDownload||r):(r&&o._loadRetryAttempts++,a=o._imageStates[e]={url:e,elements:[t],callbacks:[],errorCallbacks:[],references:1,forceDownload:r},i&&a.callbacks.push(i),n&&a.errorCallbacks.push(n),o._urlQueue.push(e),o.processQueue())}},isIdle:function(){return 0===this._loadPending},isLoaded:function(e){return!!this._loadedUrls[e]},isDomainAccessible:function(e,t){return!0},onError:function(e){},processQueue:function(){for(var e=0,i=this;e<i._urlQueue.length&&i._loadPending<t;)if(Shared.ImageLoader.isDomainAccessible(i._urlQueue[e])){var n=i._urlQueue.shift(),r=i._imageStates[n];if(r){var o=r.elements[0],s=n;i._addImageEventHandlers(o),r.forceDownload&&(s+=(-1==n.indexOf("?")?"?":"&")+a+"="+Math.random()),i._loadAttempts++,i._loadPending++,o.s=n,o.src=s}}else e++},_addImageEventHandlers:function(e){return this.addElementListener(e,"load",this._onImageLoad),this.addElementListener(e,"error",this._onImageError),this.addElementListener(e,"abort",this._onImageAbort),e},_removeImageEventHandlers:function(e){this.removeElementListener(e,"load",this._onImageLoad),this.removeElementListener(e,"error",this._onImageError),this.removeElementListener(e,"abort",this._onImageAbort)},_onImageLoad:function(e,t){var n=this,r=e.currentTarget,o=r.s,a=n._imageStates[o];if(n._removeImageEventHandlers(r),n._loadPending--,a){if(t){if(1===t){for(i=0;i<a.errorCallbacks.length;i++)a.errorCallbacks[i](o);Shared.ImageLoader.onError(o)}}else for(n._loadSuccess++,n._loadedUrls[o]=!0,i=0;i<a.callbacks.length;i++)try{i>0&&(a.elements[i].src=o),a.callbacks[i](o,a.elements[i])}catch(s){}delete n._imageStates[o]}this.processQueue()},_onImageError:function(e){this._loadError++,this._onImageLoad(e,1)},_onImageAbort:function(e){this._loadAbort++,this._onImageLoad(e,2)}}),mix(Shared.ImageLoader,Shared.ElementEventing)}()}),define("contentcontrol",["jbase","basecontrol"],function(){!function(){defineSubClass("JBase.UI.ContentControl",JBase.UI.BaseControl,function(){mix(this,{_contentControlType:null,_controlTable:{}})},{controlType:JBase.UI.BaseControl,controlOptions:null,currentControl:null,disposeOnSwap:!1,getControlType:function(e){return this.controlType},getControlOptions:function(e){return this.controlOptions},getChildDataContext:function(e){return e},onRenderHtml:function(){return this.currentControl?this.currentControl.renderHtml():this.defaultRenderHtml("")},onCurrentControlChanged:function(){},onDataContextChanged:function(e){var t=this.getControlType(e);t&&t.isPromise?t.then(bind(this,this._evaluateControlType)):this._evaluateControlType(t)},_evaluateControlType:function(e){var t=this.dataContext,i=this.currentControl;if(this._contentControlType!==e){var n=ce("div");if(i&&(this.removeChild(i),this.currentControl=null,this.disposeOnSwap?(delete this._controlTable[this._contentControlType.prototype.__fullName],i.dispose()):i.deactivate()),this._contentControlType=e,e){var r=e.prototype.__fullName;i=this.currentControl=this._controlTable[r],i?this.addChild(i):(i=this.currentControl=this._controlTable[r]=this.createChild(e,this.getControlOptions(t)),i.id=this.id,this.onCurrentControlChanged()),i.setDataContext(this.getChildDataContext(t),!0),this.element&&(i.element||(setHtml(n,i.renderHtml()),i.element=n.firstChild),this.element.parentNode&&this.element.parentNode.replaceChild(i.element,this.element),this.element=i.element,this.isActive&&i.activate())}else if(this.element){setHtml(n,this.defaultRenderHtml(""));var o=n.firstChild;this.element.parentNode&&this.element.parentNode.replaceChild(o,this.element),this.element=o}}else i&&i.setDataContext(this.getChildDataContext(t))},onDispose:function(){for(var e in this._controlTable)this._controlTable.hasOwnProperty(e)&&this._controlTable[e].dispose();this._controlTable={}}})}()}),define("repeater",["jbase","basecontrol","imageloader","contentcontrol"],function(){!function(){defineSubClass("JBase.UI.Repeater",JBase.UI.BaseControl,function(){},{childControl:JBase.UI.ContentControl,onRenderHtml:function(){return this.defaultRenderHtml(this._buildHtml())},onDataContextChanged:function(){var e=this;e.element&&(e.element.childNodes.length?e._update():(setHtml(e.element,e._buildHtml()),e.activate(),e._updateKeyToElementMap()))},getChildContext:function(e,t){var i=e;return e.__isDataContext||(i={item:e}),i},getKeyFromChildContext:function(e){return e.key||(e.item?e.item.key:null)},_updateKeyToElementMap:function(){var e=this,t=e.element.childNodes;e._keyToElement={};for(var i=0;i<t.length;i++){var n=t[i],r=n.control,o=r&&r.dataContext&&r.dataContext.key?r.dataContext.key:null;o&&(e._keyToElement[r.dataContext.key]=n)}},_buildHtml:function(){var e=this,t="";if(e.dataContext){var i=e.dataContext.items;if(e.clearChildren(),i&&e.childControl)for(var n,r=0;r<i.length;r++)n=e.createChild(e.childControl),n.setDataContext(e.getChildContext(i[r],r)),t+=n.renderHtml()}return t},_update:function(){var e=this;if(e.element){var t=e.dataContext.items,i=e._keyToElement||{},n=e.element.childNodes,r={};if(t&&t.length){for(var o=0;o<t.length;o++){var a=t[o],s=this.getChildContext(a,o),l=this.getKeyFromChildContext(s),d=n[o];if(d){var u=d.control&&d.control.dataContext?this.getKeyFromChildContext(d.control.dataContext):null;if(u!=l)if(void 0===i[l])r[l]=e._insertCell(o,s);else{for(var c=-1,h=0;h<t.length;h++){var p=t[h];if(p&&p.key===u){c=h;break}}-1===c?(e._removeCell(d),o--):r[l]=e._insertCell(o,s)}else r[l]=d,d.control&&d.control.setDataContext(s)}else r[l]=e._insertCell(o,s)}for(;n.length>t.length;)this._removeCell(n[n.length-1]);this._keyToElement=r}else e.clearChildren(),setHtml(e.element,"")}},_insertCell:function(e,t){var i=this,n=i.element,r=i.createChild(i.childControl),o=ce("div");i.dataContext.items;r.setDataContext(t),setHtml(o,r.renderHtml());var a=r.element=o.firstChild;return e>=n.childNodes.length?n.appendChild(a):n.insertBefore(a,n.childNodes[e]),r.activate(),a},_removeCell:function(e){var t=e.control;t&&(t.dispose(),this.removeChild(t)),this.element&&this.element.removeChild(e)}})}()}),define("repeaterv2",["repeater"],function(){!function(){var e={col:1,colgroup:1,tr:1,tbody:1,tfoot:1,thead:1,table:1};defineSubClass("JBase.UI.RepeaterV2",JBase.UI.BaseControl,function(){},{childControlType:JBase.UI.ContentControl,childControlOptions:{},getChildControlType:function(e){return this.childControlType},getChildControlOptions:function(e){return this.childControlOptions},onRenderHtml:function(){return this.defaultRenderHtml(this._buildHtml())},onDataContextChanged:function(){var e=this;e.element&&(e.element.childNodes.length?e._update():(setHtml(e.element,e._buildHtml()),e.activate(),e._updateKeyToElementMap()))},getChildContext:function(e,t){var i=e;return e.__isDataContext||(i={item:e}),i},getKeyFromChildContext:function(e){return e.key||(e.item?e.item.key:null)},_updateKeyToElementMap:function(){var e=this,t=e.element.childNodes;e._keyToElement={};for(var i=0;i<t.length;i++){var n=t[i],r=n.control,o=r&&r.dataContext&&r.dataContext.key?r.dataContext.key:null;o&&(e._keyToElement[r.dataContext.key]=n)}},_buildHtml:function(){var e=this,t="";if(e.dataContext){var i=e.dataContext.itemSet;if(e.clearChildren(),i)for(var n,r=i.getCount(),o=0;r>o;o++){var a=i.get(o);if(!a)break;n=e.createChild(e.getChildControlType(a),e.getChildControlOptions(a)),n.setDataContext(e.getChildContext(a,o)),t+=n.renderHtml()}}return t},_update:function(){var e=this;if(e.element){var t=e.dataContext.itemSet,i=e._keyToElement||{},n=e.element.childNodes,r={},o=0;if(t&&t.getCount()){for(var a=t.getCount();a>o;o++){var s=t.get(o);if(!s)break;var l=this.getChildContext(s,o),d=this.getKeyFromChildContext(l),u=n[o];if(u){var c=u.control&&u.control.dataContext?this.getKeyFromChildContext(u.control.dataContext):null;if(c!=d)if(void 0===i[d])r[d]=e._insertCell(o,l,s);else{var h=t.getByKey(c),p=h?t.indexOf(h):-1;-1===p?(e._removeCell(u),o--):r[d]=e._insertCell(o,l,s)}else r[d]=u,u.control&&u.control.setDataContext(l)}else r[d]=e._insertCell(o,l,s)}for(;n.length>o;)this._removeCell(n[n.length-1]);this._keyToElement=r}else e.clearChildren(),setHtml(e.element,"")}},_insertCell:function(t,i,n){var r=this,o=r.element,a=r.createChild(r.getChildControlType(n),r.getChildControlOptions(n)),s=ce(r.baseTag);a.setDataContext(i),r.baseTag in e?jQuery(s).append(jQuery(a.renderHtml())):setHtml(s,a.renderHtml());var l=a.element=s.firstChild;return t>=o.childNodes.length?o.appendChild(l):o.insertBefore(l,o.childNodes[t]),a.activate(),l},_removeCell:function(e){var t=e.control;t&&(t.dispose(),this.removeChild(t)),this.element&&this.element.removeChild(e)}})}()}),define("imagestriphelper",["repeaterv2"],function(){!function(){var e=[],t=[],i={};defineNamespace("JBase.UI.ImageStripHelper",{registerStrip:function(i,n){e.push(i),t.push(n)},getImageInfo:function(n,r,o){var a;if(n&&(a=i[n],!a)){for(var s=0,l=-1;s<t.length&&-1==l;)l=t[s].hasOwnProperty(n)?s:-1,s++;if(l>=0){var d=t[l][n];a=i[n]={url:e[l],containerSize:{width:d.w,height:d.h},imagePosition:{left:-d.x,top:-d.y}}}}return a?{url:a.url,containerSize:a.containerSize,imagePosition:a.imagePosition,alt:r,title:o}:null}})}()}),define("imagesizehelper",["imagestriphelper"],function(){!function(){var e=.5;defineNamespace("JBase.UI.ImageSizeHelper",{scaleToContainer:function(e,t,i,n,r){var o={};if(e.width=e.width||i&&i.width||0,e.height=e.height||i&&i.height||0,e.width&&e.height){var a=e.width/e.height,s=t.width/t.height;if(!n&&a>s||n&&s>a){var l=i&&!r?Math.min(i.width,t.width):t.width;o={width:l,height:Math.ceil(l*(1/a))}}else{var d=i&&!r?Math.min(i.height,t.height):t.height;o={width:Math.ceil(d*a),height:d}}}return o},centerPosition:function(t,i,n,r){var o=t.width>i.width,a=t.height>i.height;n=o&&void 0!==n?n:e,r=a&&void 0!==r?r:e;var s=Math.round(.5*i.height-t.height*r),l=Math.round(.5*i.width-t.width*n),d={left:o?Math.min(0,l):l,top:a?Math.min(0,s):s,width:t.width,height:t.height};return d},swapWidthAndHeight:function(e){return{left:e.left,top:e.top,width:e.height,height:e.width}}})}()}),define("imagetile.css",["registerstyle","imagesizehelper"],function(e){registerStyle("/* Root image tile style. */\r\n.c-ImageTile\r\n{\r\n    display: inline-block;\r\n    position: relative;\r\n    overflow: hidden;\r\n}\r\n\r\n/* Image within the tile container. */\r\n.c-ImageTile img \r\n{     \r\n    position: absolute;\r\n    opacity: 0;\r\n    left: 0; /* This works in RTL as well, it's just a default position required for Safari RTL. */\r\n    top: 0;\r\n}\r\n\r\n/* Visible state. */\r\n.c-ImageTile img.visible\r\n{\r\n    opacity: 1;\r\n}\r\n\r\n/* Visible animated state. */\r\n.c-ImageTile img.animated\r\n{\r\n    opacity: 1;\r\n    animation-name: imageTileFadeIn;\r\n    -ms-animation-name: imageTileFadeIn;\r\n    -webkit-animation-name: imageTileFadeIn;\r\n    -moz-animation-name: imageTileFadeIn;\r\n}\r\n\r\n/* Disabling image animations in Chrome when the language picker is visible. */\r\n.Chrome.langPickerVisible .c-ImageTile img.animated\r\n{\r\n   animation-name: none;\r\n    -ms-animation-name: none;\r\n    -webkit-animation-name: none;\r\n    -moz-animation-name: none;\r\n}")}),define("imagetile",["imagetile.css"],function(){!function(e){function t(e){return e?generateStyleAttribute("width.px",e.width,"height.px",e.height,"left.px",e.left,"right.px",e.right,"top.px",e.top):""}var i=JBase.UI.ImageSizeHelper,n="visible",r="animated",o={url:""},a=.5,s=Shared.ImageLoader,l="keyframes imageTileFadeIn {0% { opacity: 0; }100% { opacity: 1; }}";registerStyle(".c-ImageTile > img { filter: alpha(opacity=0); }.c-ImageTile > img.visible { filter: alpha(opacity=100); }@"+l+"@-ms-"+l+"@-moz-"+l+"@-webkit-"+l);var d=!($B.IE&&$B.V<10||$B.SF_iPhone&&$B.rtl);defineSubClass("JBase.UI.ImageTile",JBase.UI.BaseControl,function(){mix(this,{scaleToFit:!1,_currentUrl:null,_lastLoadedImage:null,_loadingImagePromise:null,thumbnailStyle:null,_lastLoadedUrl:null,_purgeTimeout:null,_renderedImageHtml:!1,_rotationClass:null})},{baseTag:"span",imageAnimationDuration:null,horizontalCenterRatio:a,verticalCenterRatio:a,allowStretching:!1,onRenderHtml:function(){var e="",t=this.dataContext||o;return t.url&&s.isLoaded(t.url)&&!this._lastLoadedImage&&(this._renderedImageHtml=!0,e="<img "+(t.alt?' alt="'+htmlAttributeEncode(t.alt)+'"':"")+(t.title?' title="'+htmlAttributeEncode(t.title)+'"':"")+' src="'+htmlAttributeEncode(t.url)+'" class="'+n+'" style="'+this.thumbnailStyle+'" />'),this.defaultRenderHtml(e)},onActivate:function(){var e=this;e._lastLoadedImage&&e._onImageAvailable(e._lastLoadedUrl,e._lastLoadedImage),e._renderedImageHtml&&e.element&&(e._currentImage=e.element.children[0],e._renderedImageHtml=!1)},onDispose:function(){this._loadingImagePromise&&this._loadingImagePromise.cancel(),this._loadingImagePromise=null},onDataContextChanged:function(e){if(e=e||o,e.url!=this._currentUrl){this._currentUrl=e.url,this._currentImage=null;var t=this.element;if((!this.imageAnimationDuration||!e.url)&&t)for(var i;i=t.firstChild;)t.removeChild(i);!this.isActive&&s.isLoaded(e.url)||this._loadImage(e.url)}this._updateContentSize()},onImageLoaded:function(){},_loadImage:function(e){var t=this;t._loadingImagePromise&&t._loadingImagePromise.cancel(),e&&(t._loadingImagePromise=s.loadImagePromise(e,null),t._loadingImagePromise.then(bind(this,this._onImageAvailable)))},_onImageAvailable:function(e,t){var i=this,r=this.dataContext;e===i._currentUrl&&(i._loadingImagePromise=null,i.isActive?(i.element&&(i._currentImage=t,t.alt=r.alt||"",t.title=r.title||"",!i.imageAnimationDuration&&(t.className=n),i._updateContentSize(),i.element.appendChild(t),i.onImageLoaded&&i.onImageLoaded(),i.imageAnimationDuration&&i._fadeInImage()),i._lastLoadedImage=i._lastLoadedUrl=null):(i._lastLoadedImage=t,i._lastLoadedUrl=e))},_fadeInImage:function(){var t=this;t.imageAnimationDuration&&(d?setTimeout(function(){if(t._currentImage){var e=t._currentImage.style;e.animationDuration=e.msAnimationDuration=e.webkitAnimationDuration=e.MozAnimationDuration=t.imageAnimationDuration/1e3+"s",t._currentImage.className=r}},20):e(t._currentImage).css("opacity",0).animate({opacity:1},t.imageAnimationDuration,function(){t._currentImage&&(t._currentImage.className=n)}),clearTimeout(t._purgeTimeout),t._purgeTimeout=setTimeout(function(){t._currentImage&&(t._currentImage.className=n),t._purgeHiddenImages()},t.imageAnimationDuration+20))},_updateContentSize:function(){var e=this.dataContext||{},n=e.containerSize,r=e.imagePosition,o=e.originalSize,a=e.rotation||0;r&&void 0===r.left&&void 0===r.top&&(a%2!=0&&(r=i.swapWidthAndHeight(r),o=o&&i.swapWidthAndHeight(o)),r=i.scaleToContainer(r,n,o,!this.scaleToFit,this.allowStretching),r=i.centerPosition(r,n,this.horizontalCenterRatio,this.verticalCenterRatio),a%2!=0&&(r=i.swapWidthAndHeight(r))),this.baseStyle=t(n),this.thumbnailStyle=t(r),this.element&&(this.element.style.cssText=this.baseStyle),this._currentImage&&(this._currentImage.style.cssText=this.thumbnailStyle)&&this._updateRotationClass(a)},_purgeHiddenImages:function(){if(this.element)for(;this.element.childNodes.length>1;)this.element.removeChild(this.element.children[0])},_updateRotationClass:function(e){if(this._currentImage&&(e||this._rotationClass)){var t=e?"rotate"+Math.round(90*e):"";this._currentImage.className=this._rotationClass?this._currentImage.className.replace(this._rotationClass,t):this._currentImage.className+" "+t,this._rotationClass=t}}})}(window.originaljQuery||jQuery)}),define("networklink",["wliveloaded","imagetile","alehelpers","skydrive_pc_strip_32_ltr","skydrive_pc_strip_8_ltr","skydrive_sharing_strip_8_ltr","header_strip_ltr"],function(){!function(){var e=JBase.UI.ImageStripHelper,t=wLive.Core.AleHelpers.getPCString;require(["skydrive_sharing_strip_8_ltr"],function(){e.registerStrip(FilesConfig.sharingStripUrl,SharingIS)});var i=2083,n={FB:{url:"https://www.facebook.com/sharer/sharer.php?u={{url}}",customUrl:"https://www.facebook.com/dialog/feed?app_id=30713015083&display=popup&name={{title}}&caption={{summary}}&description={{desc}}&link={{url}}&picture={{img}}&redirect_uri=https://www.facebook.com",icon:"facebook",width:626,height:436,sutra:"NetworkIconFB"},TWITR:{url:"http://twitter.com/share?url={{url}}",customUrl:"https://twitter.com/intent/tweet?text={{text}}&url={{url}}",icon:"twitter",height:300,width:550,sutra:"NetworkIconTWITR"},LI:{url:"http://www.linkedin.com/shareArticle?mini=true&url={{url}}",customUrl:"http://www.linkedin.com/shareArticle?mini=true&title={{title}}&summary={{summary}}&url={{url}}",icon:"linkedin",height:427,width:550,sutra:"NetworkIconLI"},SINWE:{url:"http://service.weibo.com/share/share.php?url={{url}}",customUrl:"http://service.weibo.com/share/share.php?title={{text}}&url={{url}}&pic={{img}}",
icon:"weibo",height:400,width:600,sutra:"NetworkIconSINWE"}};defineSubClass("SkyDrive.UI.NetworkLink",JBase.UI.BaseControl,function(){this.icon=this.createChild(JBase.UI.ImageTile)},{shortenButtonText:"",showShortenButton:!1,url:"",network:"",networkUrl:"",networkInfo:null,baseTag:"span",sutraLabel:"",bici:null,onDataContextChanged:function(t){var i=t.item;i.url&&(this.url=i.url),i.network&&(this.network=i.network),i.bici&&(this.bici=i.bici),n.hasOwnProperty(this.network)?(this.networkInfo=n[this.network],i.custom?this.networkUrl=this._generateCustomShareUrl(i,this.networkInfo.customUrl):this.networkUrl=this._generateShareUrl(this.url,this.networkInfo.url),this.icon.setDataContext(e.getImageInfo(this.networkInfo.icon))):(this.networkInfo=null,this.networkUrl="",this.icon.setDataContext({url:null}))},onActivate:function(e,t){t.anchor&&this.networkInfo&&sutra(t.anchor,"$Sutra.SkyDrive."+this.networkInfo.sutra)},_onClick:function(e){this.bici&&this.bici();var t=window.screenLeft?window.screenLeft:window.screenX?window.screenX:0,i=window.innerWidth||0,n=Math.max(i/2-this.networkInfo.width/2+t,0),r=window.screenTop?window.screenTop:window.screenY?window.screenY:0,o=window.innerHeight||0,a=Math.max(o/2-this.networkInfo.height/2+r,0);window.open(this.networkUrl,"sharing_"+this.network,"resizable, width="+this.networkInfo.width+", height="+this.networkInfo.height+", left="+n+", top="+a);return!1},_generateShareUrl:function(e,t){var i=t;return i=i.replace("{{url}}",encodeURIComponent(e))},_generateCustomShareUrl:function(e,n){var r=n;if("FB"===e.network){r=r.replace("{{title}}",encodeURIComponent(e.title)),r=r.replace("{{img}}",encodeURIComponent(e.img));var o=encodeURIComponent(e.text),a=encodeURIComponent(e.addon);!$B.IE||r.length+o.length+a.length-"{{summary}}".length-"{{desc}}".length<i?(r=r.replace("{{summary}}",o),r=r.replace("{{desc}}",a)):(r=r.replace("{{summary}}",""),r=r.replace("{{desc}}",""))}else if("TWITR"===e.network)r=r.replace("{{text}}",encodeURIComponent(e.oneline));else if("LI"===e.network){r=r.replace("{{title}}",encodeURIComponent(e.title));var s=encodeURIComponent(t("Sharing.NetworkPostTextFormat").format(e.text,e.addon));r=!$B.IE||r.length+s.length-"{{summary}}".length<i?r.replace("{{summary}}",s):r.replace("{{summary}}","")}else"SINWE"===e.network&&(r=r.replace("{{text}}",encodeURIComponent(e.oneline)),r=r.replace("{{img}}",encodeURIComponent(e.img)));return r=r.replace("{{url}}",encodeURIComponent(e.url))}})}()}),define("networklink.html",["networklink"],function(){SkyDrive.UI.NetworkLink.prototype.onRenderHtml=function(){return"<"+this.baseTag+' id="'+htmlAttributeEncode(this.id+"_0")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="c-'+this.controlName+" "+this.baseClass+'"><a target="_blank" id="'+htmlAttributeEncode(this.id+"_1")+'"'+generateAttributesString("href",this.url)+">"+this.icon.renderHtml()+"</a></"+this.baseTag+">"},processAnnotations(SkyDrive.UI.NetworkLink,[{id:0},{id:1,attr:["href","url"],childId:"anchor",userActions:{click:"_onClick"}}],[],{})}),define("sharinglink",["networklink.html"],function(){!function(){var e=wLive.Core.AleHelpers.getPCString("Sharing.ShortenLink");defineSubClass("SkyDrive.UI.SharingLink",JBase.UI.BaseControl,function(){var e=this;e.networkLinks=e.createChild(JBase.UI.Repeater,{baseTag:"span",childControl:SkyDrive.UI.NetworkLink})},{shortenButtonText:e,url:"",networks:[],isDisabled:!1,isShortenEnabled:!1,isLinkShortened:!1,isReadOnly:!0,showShortenButton:!1,entity:null,onDataContextChanged:function(e){e.url&&(this.url=e.url),e.entity&&(this.entity=e.entity),e.networks&&(this.networks=e.networks),e.hasOwnProperty("isReadOnly")&&(this.isReadOnly=e.isReadOnly),e.hasOwnProperty("shortenEnabled")&&(this.isShortenEnabled=!1,this.showShortenButton=this.isShortenEnabled&&!this.isLinkShortened),e.shortenAction&&(this._shortenAction=e.shortenAction),e.disabled&&(this.isDisabled=e.disabled,this.networks=[],this.showShortenButton=!1),this.networkLinks.setDataContext({items:this._buildNetworkLinksDataContext()})},select:function(){var e=this.subElements.linkDisplay;if(e&&e.setSelectionRange){var t=function(){try{e.setSelectionRange(0,9999)}catch(t){}};this.setTimeout(t,0)}},_buildNetworkLinksDataContext:function(){for(var e=[],t=0;t<this.networks.length;t++)e.push({network:this.networks[t],url:this.url});return e},_onDisplayClick:function(e){this.select()},_onFocus:function(e){Shared.ElementEventing.raise(window,"sharingLinkFocused")},_onShortenClick:function(e){return this._shortenAction(this.entity,this,bind(this,this._onShortenSuccess),bind(this,this._onShortenFailure)),!1},_onShortenSuccess:function(e){this.isLinkShortened=!0,this.setDataContext({url:e})},_onShortenFailure:function(){},_shortenAction:function(e,t,i,n){}})}()}),define("sharinglink.html",["sharinglink"],function(){SkyDrive.UI.SharingLink.prototype.onRenderHtml=function(){return"<"+this.baseTag+sutraAttribute("SkyDrive.PermissionPaneLinkContainer")+' id="'+htmlAttributeEncode(this.id+"_0")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="c-'+this.controlName+" "+this.baseClass+'"><div class="sd_perm_link"><span class="sd_perm_link_url"><input type="text"'+sutraAttribute("SkyDrive.LinkHolder")+' id="'+htmlAttributeEncode(this.id+"_1")+'" class="sd_link_display sd_focusable"'+generateAttributesString("readonly",this.isReadOnly,"value",this.url,"disabled",this.isDisabled)+'></input></span><span class="sd_perm_link_networks">'+this.networkLinks.renderHtml()+'</span><span role="button" id="'+htmlAttributeEncode(this.id+"_2")+'" style="'+generateStyleAttribute("display",this.showShortenButton)+'" class="sd_perm_link_shorten"><a href="#"'+sutraAttribute("SkyDrive.LinkShortenLinkButton")+' id="'+htmlAttributeEncode(this.id+"_3")+'" class="sd_shorten_button">'+htmlEncode(this.shortenButtonText)+'</a></span><div class="sd_perm_clear"></div></div></'+this.baseTag+">"},processAnnotations(SkyDrive.UI.SharingLink,[{id:0},{id:1,attr:["readonly","isReadOnly","value","url","disabled","isDisabled"],childId:"linkDisplay",userActions:{click:"_onDisplayClick",focus:"_onFocus"}},{id:2,css:["display","showShortenButton"]},{id:3,attr:["text","shortenButtonText"],childId:"shortenlink",userActions:{click:"_onShortenClick"}}],[],{})}),define("sendform",["doregister","jquery-1.7.2","wliveloaded","alehelpers","errormanager","loadingcue","permissionsprovider","sharinglink.html"],function(){!function(){function e(e){function i(e,i){var r={id:e.id};r.type=k.EntityType.Link,r.linkType=k.LinkType.Form,r.cid=e.ownerCid,t.SkyDriveItemHelper.isGroupItem(e)&&(r.group=e.group);var o=FilesConfig.baseApiUrl+"Shorten?"+$Utility.serialize(r),a=function(e){f||i(e.url)},s=function(e){f||(T.hide(),A.text(n("SendSurvey.Error")),A.show())},l=new t.DataRequest(o,o,null,a,s);l.apiId="SkyDrive_Json_ShortenUrl",l.propertyId="SkyDrive",l.start()}function r(){M.empty();var e=new wLive.Controls.LoadingSpinner(M);e.render(),M.show()}function o(){M.hide()}function a(e,t){f||(m=t,y.show(),v.addClass(U),o(),h(t,e))}function s(e,t){if(!f){T.hide();var i;if(L.show(),o(),t&&t.code==N){var r=t.data,a=t.message;if(r&&a){var s=Object.fromJSON(r),l=s.smsUrl,d=s.displayAction;if(l&&d){i=a.encodeHtml()+' <a href="'+l.encodeHtml()+'" target="_blank">'+d.encodeHtml()+"</a>"}A.html(i)}}else A.text(n("SendSurvey.Error"));A.show()}}function l(e){f||(m=null,c(e,m),g&&g.reposition())}function d(e,i){if(!f){m=null;for(var n=i.permissionScopes,r=0;r<n.length;r++)for(var o=n[r],a=t.StringHelpers.caseInsensitiveStringEquals(o.id,e.id),s=o.entities,l=0;l<s.length;l++){var d=s[l];a&&d.type==k.EntityType.Link&&d.linkType==k.LinkType.Form&&(m=d)}c(e,m),g&&g.reposition()}}function u(e,t){if(!f){E.show(),T.hide(),L.hide(),y.hide(),v.removeClass(U);var i=jQuery(_ce("img")).attr({id:"img_element",src:FilesConfig.foldersImgBaseUrl+"/embed_form.png",tabindex:"-1"});P.append(i),A.text(n("SendSurvey.Error")),A.show(),g&&g.reposition()}}function c(t,i){E.show(),A.hide(),o(),T.text(I);var n=jQuery(_ce("img")).attr({id:"img_element",src:FilesConfig.foldersImgBaseUrl+"/embed_form.png",tabindex:"-1"});P.append(n),i?(y.show(),v.addClass(U),L.hide(),h(i,t)):(y.hide(),v.removeClass(U),L.show(),L.click(function(){L.hide(),L.unbind("click"),r(),e.submitFormLink(t,a,s)}),F.html(""),C&&(C.dispose(),C=null))}function h(e,t){C=new SkyDrive.UI.SharingLink,C.setDataContext({shortenEnabled:FilesConfig.urlShorteningEnabled,url:e.link,isReadOnly:!x,shortenAction:function(e,n,r){i(t,r)},entity:e});var n=F[0];setHtml(n,C.renderHtml()),C.activate()}function p(){sutra(w,"$Sutra.SkyDrive.ShareFormDialog"),sutra(jQuery(".UserTitle",w),"$Sutra.SkyDrive.ShareFormTitle"),sutra(P,"$Sutra.SkyDrive.ShareFormIcon"),sutra(T,"$Sutra.SkyDrive.ShareFormText"),sutra(A,"$Sutra.SkyDrive.ShareFormError"),sutra(L,"$Sutra.SkyDrive.ShareFormGenerateBtn"),sutra(v,"$Sutra.SkyDrive.ShareFormDoneBtn"),sutra(y,"$Sutra.SkyDrive.ShareFormRemoveBtn")}var m,f,g,v,y,w,C,b=this,k=t.PermissionsProvider,S=(k.Role,wLive.Controls.Notifications),_=n("SendSurvey.Title"),I=n("SendSurvey.Note"),x=$B.SF_iPhone&&!$B.Mobile,D='<div id="sendFormBody"><div id="formIcon"></div><div id ="formNote"><div id="formText" type="text"></div><div id="errorText" type="text"></div><div id="LinkBox"><div id="linkControlHolder"></div><input id="btnGenerate" class="default" type="button" value="'+n("Sharing.CreateLink")+'"></input><div class="sf_loading"></div></div></div></div>',E=jQuery(D),P=jQuery("#formIcon",E),T=jQuery("#formText",E),A=jQuery("#errorText",E),L=jQuery("#btnGenerate",E),F=jQuery("#linkControlHolder",E),M=jQuery(".sf_loading",E),N=204,U="default";b.dispose=function(){C&&(C.dispose(),C=null),g&&(g.dismiss(),g=null),f=!0},b.show=function(t,i){E.hide();var r=function(i,n,r){"close"===r?(L.unbind("click"),b.dispose()):"alternate"===r&&(y.hide(),e.deletePermission(t,m,l,u))};g=S.createModalDialog({buttons:{close:n("SendSurvey.DoneButton"),alternate:n("Sharing.RemoveLink")},options:{dismissOnButtonClick:!1},title:_.format((i||t.form&&t.form.title||t.name).encodeHtml()),content:E});var o=jQuery(g);o.bind({"aftershow._dlg":function(i,n){w=jQuery(g.content()),v=jQuery(g.getButton({buttonName:"close"})),y=jQuery(g.getButton({buttonName:"alternate"})),v.parent().append(v.detach()),p(),e.fetchPermissions(t,d,u)},"afterdismiss._dlg":function(e,t){o&&o.unbind("._dlg"),o=null},"buttonclick._dlg":r}),g.show()}}var t=(window,wLive.Core),i=wLive.Controls,n=t.AleHelpers.getPCString;i.SendForm=e}()}),define("navitemdatacontext",["jbase","basecontrol","imagetile","wlivemenu"],function(){!function(){defineSubClass("Shared.UI.NavItemDataContext",JBase.DataContext,function(e){},{reset:function(){mix(this,{type:"NavLink",html:"",text:"Nav Link",url:"#",target:"",key:"",sutra:"",imageData:null,isEnabled:!0,isVisible:!0,isSelected:!1,isBolded:!1,isImageSelectMode:!1,childItems:null,click:null,chevronDark:!0,showChevron:!0,allowClicks:null,includeSeparator:!1,closeMenuOnClick:null})}})}()}),define("navseparator",["navitemdatacontext"],function(){!function(){defineSubClass("Shared.UI.NavSeparator",JBase.UI.BaseControl,function(){},{baseTag:"span",baseDataContextType:Shared.UI.NavItemDataContext,onDataContextChanged:function(e){this.isVisible=!!e.isVisible}})}()}),define("navseparator.html",["navseparator"],function(){Shared.UI.NavSeparator.prototype.onRenderHtml=function(){return"<"+this.baseTag+' role="presentation" aria-hidden="true" id="'+htmlAttributeEncode(this.id+"_0")+'" style="'+this.baseStyle+" "+generateStyleAttribute("display",this.isVisible)+'" class="c-'+this.controlName+" "+this.baseClass+' c_ms"></'+this.baseTag+">"},processAnnotations(Shared.UI.NavSeparator,[{id:0,css:["display","isVisible"]}],[],{})}),define("navlink",["navseparator.html"],function(){!function(){var e;defineSubClass("Shared.UI.NavLink",JBase.UI.BaseControl,function(){e=e||$menu.createChevron($menu.chevronTypes.SmallRightDark,!0),this.thumbsLinkImage=this.createChild(JBase.UI.ImageTile)},{baseTag:"a",baseDataContextType:Shared.UI.NavItemDataContext,sutra:"",onActivate:function(){window.sutra&&this.sutra&&sutra(this.element,this.sutra)},onDataContextChanged:function(t){var i=this;i.navHtml=t.html||($B.rtl?"&rlm;":"&lrm;")+htmlEncode(t.text)+(t.targetOverlay?t.targetOverlay:""),i.chevronHtml=t.showBCBChevron?e:"",i.showChevron=t.showBCBChevron,i.isSelected=!!t.isSelected,i.url=t.url||"#",i.isBolded=!!t.isBolded,i.displayImage=!!t.imageData||t.isImageSelectMode,i.isImageVisible=t.imageData&&!(t.isImageSelectMode&&!t.isSelected),i.target=t.target||"",i.sutra=t.sutra||"",i.closeMenuOnClick=t.closeMenuOnClick||null,t.imageData&&i.thumbsLinkImage.setDataContext(t.imageData),i.isVisible=!!t.isVisible},_onLinkClicked:function(e){var t=this.dataContext.click;return this.closeMenuOnClick&&window.$menu&&$menu.closeAll(),t?t(e):!0}})}()}),define("navlink.html",["navlink"],function(){Shared.UI.NavLink.prototype.onRenderHtml=function(){return"<"+this.baseTag+sutraAttribute("SkyDrive.SharedNavLink")+' id="'+htmlAttributeEncode(this.id+"_0")+'" style="'+this.baseStyle+" "+generateStyleAttribute("display",this.isVisible)+'" class="c-'+this.controlName+" "+this.baseClass+generateClassAttribute("isSelected",this.isSelected)+'"'+generateAttributesString("href",this.url,"target",this.target)+"><span"+sutraAttribute("SkyDrive.Image")+' id="'+htmlAttributeEncode(this.id+"_1")+'" style="'+generateStyleAttribute("display.inlineblock",this.displayImage)+'" class="navLinkImage'+generateClassAttribute("imageVisible",this.isImageVisible)+'">'+this.thumbsLinkImage.renderHtml()+'</span><span id="'+htmlAttributeEncode(this.id+"_2")+'" class="'+generateClassAttribute("c_rchev",this.showChevron)+'">'+this.chevronHtml+'</span><span id="'+htmlAttributeEncode(this.id+"_3")+'" class="navLinkText'+generateClassAttribute("isBolded",this.isBolded)+'">'+this.navHtml+"</span></"+this.baseTag+">"},processAnnotations(Shared.UI.NavLink,[{id:0,css:["display","isVisible"],attr:["href","url","target","target"],className:["isSelected","isSelected"],userActions:{click:"_onLinkClicked"}},{id:1,css:["display.inlineBlock","displayImage"],className:["imageVisible","isImageVisible"]},{id:2,attr:["html","chevronHtml"],className:["c_rchev","showChevron"]},{id:3,attr:["html","navHtml"],className:["isBolded","isBolded"]}],[],{})}),define("navlinkdisabled",["navlink.html"],function(){!function(){defineSubClass("Shared.UI.NavLinkDisabled",Shared.UI.NavLink,function(){},{baseTag:"span",_onLinkClicked:function(e){return this.dataContext.allowClicks===!0}})}()}),define("navitem",["navlinkdisabled"],function(){!function(){defineSubClass("Shared.UI.NavItem",JBase.UI.BaseControl,function(){this.contentControl=this.createChild(JBase.UI.ContentControl,{getControlType:bind(this,this.getControlType)})},{baseTag:"li",baseDataContextType:Shared.UI.NavItemDataContext,onDataContextChanged:function(e){var t=this;e.baseClass&&(t.baseClass=e.baseClass),t.contentControl.setDataContext(e),e.teachingBubble&&(t.teachingBubble=e.teachingBubble,t.teachingBubble.setDataContext({isVisible:e.isVisible}))},onDispose:function(){var e=this;e.teachingBubble&&e.teachingBubble.dispose()},getControlType:function(e){var t=e.type;return"NavLink"==t?(e.isEnabled||(t+="Disabled"),e.includeSeparator&&(this.includeSeparator=!0)):this.includeSeparator=!1,Shared.UI[t]||t}})}()}),define("navitem.html",["navitem"],function(){Shared.UI.NavItem.prototype.onRenderHtml=function(){return"<"+this.baseTag+' id="'+htmlAttributeEncode(this.id+"_0")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="c-'+this.controlName+" "+this.baseClass+'">'+this.contentControl.renderHtml()+'<span role="presentation" id="'+htmlAttributeEncode(this.id+"_1")+'" style="'+generateStyleAttribute("display",this.includeSeparator)+'" class="c_ms"></span></'+this.baseTag+">"},processAnnotations(Shared.UI.NavItem,[{id:0},{id:1,css:["display","includeSeparator"]}],[],{})}),define("menu",["navitem.html"],function(){!function(e){defineSubClass("Shared.UI.Menu",JBase.UI.BaseControl,function(){this.navLinksRepeater=this.createChild(JBase.UI.Repeater,{childControl:Shared.UI.NavItem,baseTag:"ul",baseClass:"uxfa_m c_m t_hovl"}),this.thumbsLinkImage=this.createChild(JBase.UI.ImageTile)},{baseTag:"span",isExpanded:!1,suppressUpdates:!1,menuLoc:0,skipEdgeDetection:!1,subMenuLoc:6,arrowKeysNavigate:!0,_menu:null,baseDataContextType:Shared.UI.NavItemDataContext,sutra:"",onActivate:function(){window.sutra&&this.sutra&&sutra(this.subElements.menuLink,this.sutra)},onDeactivate:function(){this._menu&&(this._menu.dispose(),this._menu=null)},onDataContextChanged:function(e){var t=this,i=e.chevronType||(e.chevronDark?$menu.chevronTypes.SmallDownDark:$menu.chevronTypes.SmallDownLight);t.showChevron=!!e.showChevron;for(var n=e.childItems||[],r=0;r<n.length;r++){var o=n[r];o.childItems||o.closeMenuOnClick===!1||(o.closeMenuOnClick=!0)}t.navLinksRepeater.setDataContext({items:n}),t.text=e.text||"",t.chevronHtml=" "+($menu.createChevron(i,!0)||""),t.isEnabled=!!e.isEnabled,t.displayImage=!!e.imageData||e.isImageSelectMode,t.isImageVisible=e.imageData&&!(e.isImageSelectMode&&!e.isSelected),t.sutra=e.sutra||"",e.imageData&&t.thumbsLinkImage.setDataContext(e.imageData),t.doOnEndOfRenderFrame("updateMenu",function(){t.isActive&&t._menu&&!t.suppressUpdates&&t._menu.update()})},show:function(){this.isExpanded||(this._menuBind(),this._menu&&this._menu.show(),this.isExpanded=!0,this._updateBindings())},hide:function(){this.isExpanded&&(this._menuBind(),this._menu&&this._menu.hide(),this.isExpanded=!1,this._updateBindings())},_menuClick:function(e){this._menuBind(e),this.isExpanded=this._menu.isOpen();var t=this.dataContext.click;return t&&t(e),e.preventDefault(),!1},_menuBind:function(e){if(this.isActive&&(e=e||{target:this.element,type:"click"},!this._menu)){var t={};t.defaultLoc=this.menuLoc,t.skipEdgeDetection=this.skipEdgeDetection,t.menuEl=this.navLinksRepeater.element,t.sourceEl=this.subElements.menuLink,t.arrowKeysNavigate=this.arrowKeysNavigate,$menu.create(e,this.subMenuLoc,t)&&(this._menu=this.navLinksRepeater.element.binding,this._menu.addStateListener(bind(this,this._onMenuStateChanged))),this.isExpanded=!0,this._updateBindings()}},_onMenuStateChanged:function(){var e=this._menu.isOpen();this.isExpanded!=e&&(this.isExpanded=e,this._updateBindings())}})}(window.originaljQuery||jQuery)}),define("menu.html",["menu"],function(){Shared.UI.Menu.prototype.onRenderHtml=function(){return"<"+this.baseTag+sutraAttribute("SkyDrive.SharedMenu")+' id="'+htmlAttributeEncode(this.id+"_0")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="c-'+this.controlName+" "+this.baseClass+'"><a href="#" role="button" aria-haspopup="true" onclick="return false" id="'+htmlAttributeEncode(this.id+"_1")+'" class="uxfa_ml c_ml"'+generateAttributesString("aria-expanded",this.isExpanded)+'><span id="'+htmlAttributeEncode(this.id+"_2")+'" style="'+generateStyleAttribute("display.inlineblock",this.displayImage)+'" class="navLinkImage'+generateClassAttribute("imageVisible",this.isImageVisible)+'">'+this.thumbsLinkImage.renderHtml()+'</span><span id="'+htmlAttributeEncode(this.id+"_3")+'" class="c_mlu">'+htmlEncode(this.text)+'</span><span role="presentation" aria-hidden="true" id="'+htmlAttributeEncode(this.id+"_4")+'" style="'+generateStyleAttribute("display.inline",this.showChevron)+'" class="c_chev">'+this.chevronHtml+"</span></a><span"+sutraAttribute("SkyDrive.Links")+">"+this.navLinksRepeater.renderHtml()+"</span></"+this.baseTag+">"},processAnnotations(Shared.UI.Menu,[{id:0},{id:1,attr:["aria-expanded","isExpanded"],childId:"menuLink",userActions:{click:"_menuClick",mousedown:"_menuBind"}},{id:2,css:["display.inlineBlock","displayImage"],className:["imageVisible","isImageVisible"]},{id:3,attr:["text","text"]},{id:4,css:["display.inline","showChevron"],attr:["html","chevronHtml"]}],[],{})}),define("droppablenavlink",["menu.html"],function(){!function(){defineSubClass("Shared.UI.DroppableNavLink",Shared.UI.NavLink,function(){},{key:null,processDropCallback:null,processDropLocationCallback:null,removeDropLocationCallback:null,onActivate:function(){var e=this;e.element&&(e.element.dropTarget=!0),Shared.UI.NavLink.prototype.onActivate.call(e)},onDataContextChanged:function(e){var t=this,i=e.dropTarget;t.key=i.key,t.processDropCallback=i.processDropCallback,t.processDropLocationCallback=i.processDropLocationCallback,t.removeDropLocationCallback=i.removeDropLocationCallback,Shared.UI.NavLink.prototype.onDataContextChanged.call(t,e)},onProcessDrop:function(e,t,i){return this.processDropCallback(e,t,i,this.key)},onProcessDropLocation:function(e,t,i){return this.processDropLocationCallback(e,t,i,this.key)},onRemoveDropLocation:function(){this.removeDropLocationCallback(this.key)}})}()}),define("beforeunloadmanager",["imagetile","jquery-1.7.2","pagestats","alehelpers"],function(){!function(){function e(e){c.bind(d,e),a&&jQuery.isEmptyObject(o)||c.trigger(d,o)}function t(e,t,i){require(["modaldialog","doregister"],function(){var n=wLive.Controls.Notifications.createModalDialog({buttons:{action:r("LeavePageStr"),close:r("Cancel")},title:"",content:e}),o=jQuery(n);o.bind({"aftershow._dlg":function(e,t){var i=jQuery(t.content());sutra(i,"$Sutra.SkyDrive.BeforeUnloadDialog"),sutra(t.getButton({buttonName:"action"}),"$Sutra.SkyDrive.BeforeUnloadContinueButton"),sutra(t.getButton({buttonName:"close"}),"$Sutra.SkyDrive.BeforeUnloadCancelButton")},"afterdismiss._dlg":function(e,t){o&&o.unbind("._dlg"),o=null,t=null},"buttonclick._dlg":function(e,n,r){"action"===r?t():i&&i()}}),n.show()})}function i(e){var t="";return raiseEventWithProcessing(n.BeforeUnloadManager,e?"beforehashchange":"beforeunload",function(e){return!(t=e)},{},!1),t}var n=wLive.Core,r=n.AleHelpers.getPCString,o={},a=!0,s=!1,l=!1,d="navigate",u={},c=jQuery(u);n.BeforeUnloadManager={registerHandler:function(e,t){this.addObjectListener(this,t?"beforehashchange":"beforeunload",e)},unRegisterHandler:function(e){this.removeObjectListener(this,"beforehashchange"),this.removeObjectListener(this,"beforeunload")}},mix(n.BeforeUnloadManager,Shared.ObjectEventing),$Do.when("$History.attach",0,function(e,n){var r=i(!0);a=!1,r&&!s?($BSI.navigateTo("#"+$Utility.serialize(o)),l||(l=!0,t(r,function(){setTimeout(function(){l=!1,s=!0,o=n,$BSI.navigateTo("#"+$Utility.serialize(n))},0)},function(){l=!1,s=!1}))):(s=!1,o=n,c.trigger(d,n))});var h=window.onbeforeunload;window.onbeforeunload=function(){var e;return h&&(e=h.apply(this,arguments)),!e&&window.__onbeforeunload&&(e=window.__onbeforeunload.apply(this,arguments)),e||(e=i(!1)),e?e:void 0},$Do.register("BeforeUnloadManager.attach",e,!0)}()}),define("legacycontroladapter",["imagetile","errormanager"],function(){!function(){defineSubClass("SkyDrive.UI.LegacyControlAdapter",JBase.UI.BaseControl,function(){this._controlInstance=null},{controlType:null,constructorOption:null,renderOption:null,disposeOnDeactivate:!1,onResize:function(){this._controlInstance&&this._controlInstance.resize&&this._controlInstance.resize()},onActivate:function(){this._updateControl(!0)},onDeactivate:function(){this.disposeOnDeactivate&&this._controlInstance&&(this._controlInstance.dispose(),this._controlInstance=null)},onDataContextChanged:function(e){this._updateControl()},_updateControl:function(e){var t=this.dataContext;(this.isActive||e)&&t&&t.item?(this._controlInstance||(this._controlInstance=new this.controlType(jQuery(this.element),wLive.Core.ViewContext.getInstance(),this.constructorOption),this._controlInstance.parent=this),this._controlInstance.render(t.item,this.renderOption)):this._controlInstance&&(this._controlInstance.dispose(),this._controlInstance.parent=null,this._controlInstance=null)},onDispose:function(){this._controlInstance&&(this._controlInstance.dispose(),this._controlInstance=null)}})}()}),define("newcontroladapter",["legacycontroladapter"],function(){!function(){defineClass("SkyDrive.UI.NewControlAdapter",function(e,t){this.element=e?e[0]:null,this._viewContext=t,this._constructorArgs=Array.prototype.slice.call(arguments,2),this._controlInstance=null},{controlType:null,initialize:function(){if(!this._controlInstance&&this.controlType){var e=this._constructorArgs;this._controlInstance=new this.controlType(e[0],e[1],e[2],e[3],e[4],e[5]),this._controlInstance.parent=this}},render:function(e,t){var i=e?{item:e}:{};this.initialize(),this._controlInstance.setDataContext(i,t),this._controlInstance.isActive||(this.element.innerHTML=this._controlInstance.renderHtml(),this._controlInstance.activate())},exposeResources:function(e){this.initialize(),this._controlInstance.exposeResources(e)},isLoaded:function(){return!this._controlInstance||!this._controlInstance.isLoaded||this._controlInstance.isLoaded()},resize:function(){this._controlInstance&&this._controlInstance.resize&&this._controlInstance.resize()},dispose:function(){this._controlInstance&&(this._controlInstance.dispose(),this._controlInstance.parent=null,this._controlInstance=null)}})}()}),define("domhelpers",["dependancies","domutilities"],function(){!function(){wLive.Core.DomHelpers={isInputElement:function(e){return isInputElement(e[0])},setTimeoutZero:function(e){return window.msSetImmediate?(window.msSetImmediate(e),null):window.setTimeout(e,0)}}}()}),define("filetypes",["imagetile","errormanager"],function(){!function(){defineNamespace("SkyDrive.Constants.FileTypes",{access:"access",adobe:"adobe",audio:"audio",excel:"excel",exe:"exe",folder:"folder",file:"file",html:"html",infoPath:"infopath",oneNote:"onenote",pdf:"pdf",picture:"picture",powerPoint:"powerpoint",project:"project",publisher:"publisher",richText:"richtext",text:"text",video:"video",visio:"visio",word:"word",xaml:"xaml",xml:"xml",xps:"xps",zip:"zip"})}()}),define("filetypehelper",["filetypes"],function(){!function(){var e=JBase.UI.ImageStripHelper,t=SkyDrive.Constants.FileTypes,i="v2",n={accdb:t.access,ai:t.adobe,audio:t.audio,doc:t.word,docm:t.word,docx:t.word,dot:t.word,dotm:t.word,dotx:t.word,exe:t.exe,html:t.html,mdb:t.access,mpp:t.project,mpt:t.project,odp:t.powerPoint,ods:t.excel,odt:t.word,one:t.oneNote,onepkg:t.oneNote,onetoc2:t.oneNote,notebook:t.oneNote,pdf:t.pdf,photo:t.picture,pot:t.powerPoint,potm:t.powerPoint,potx:t.powerPoint,ppa:t.powerPoint,ppam:t.powerPoint,pps:t.powerPoint,ppsm:t.powerPoint,ppsx:t.powerPoint,ppt:t.powerPoint,pptm:t.powerPoint,pptx:t.powerPoint,ps:t.adobe,psd:t.adobe,pub:t.publisher,rtf:t.richText,txt:t.text,video:t.video,vdw:t.visio,vsd:t.visio,vsdm:t.visio,vsdx:t.visio,vsl:t.visio,vss:t.visio,vssm:t.visio,vssx:t.visio,vst:t.visio,vstm:t.visio,vstx:t.visio,xaml:t.xaml,xla:t.excel,xlam:t.excel,xll:t.excel,xls:t.excel,xlsb:t.excel,xlsm:t.excel,xlsx:t.excel,xlt:t.excel,xltm:t.excel,xltx:t.excel,xml:t.xml,xps:t.xps,xsn:t.infoPath,zip:t.zip};defineNamespace("SkyDrive.FileTypeHelper",{iconVersion:i,getFileType:function(e){var i="";if(e){var r=e.iconType||"";i=e.folder?t.folder:n[r.toLowerCase()]}return i||t.file},getIconInfo:function(t,n,r,o,a,s){var l;if(t){var d=this.isAdobeFile(t),u=s||(d?"Photo":t.iconType)||"";s||"NonEmptyAlbum"!==u&&"EmptyAlbum"!==u||t.isSpecialFolder||(u="Folder"),"Folder"===u&&(u=t.folder&&!t.folder.totalCount?"Empty":"NonEmpty",u+="DocumentFolder"),FilesConfig.visualUpdatesForSharedContent&&!s&&!t.isBundle&&t.folder&&t.sharingLevelValue!==wLive.Core.JSONConstants.SharingLevel.Private&&(u="SharedFolder");var c="ft_"+n+"_"+u+(t.folder&&r?"Selected":"");if(l=e.getImageInfo(c,o,a),!l&&t.iconType){var h=16===n?"tiny":32===n?"smaller":"small";l={url:FilesConfig.foldersImgBaseUrl+"/icons/"+i+"/"+h+"/"+t.iconType+".png",containerSize:{width:n,height:n},imagePosition:{left:0,top:0},alt:o,title:a}}}return l},isOfficeDocument:function(e){var i=this.getFileType(e);return i===t.word||i===t.excel||i===t.powerPoint||i===t.oneNote||i===t.pdf},isAdobeFile:function(e){var i=this.getFileType(e);return i==t.adobe}})}()}),define("operationmanager",["dependancies","do"],function(){!function(){function e(){var e=this;e.execute=function(e,t){require([e.toLowerCase()+"operation","registeroperations"],function(){$Do.when(n+e,0,t)})},e.register=function(e,t){$Do.register(n+e,function(i){t(e,i)})}}var t=wLive.Core;t.OperationManager=e;var i=new e,n="Operation_";t.OperationManager.getInstance=function(){return i},t.OperationManager.Current=new e}()}),define("placeholderinput",["jquery-1.7.2","wliveloaded"],function(){!function(){function e(e,t){function i(){e.val()==t&&(e.removeClass("pi_placeholder"),e.val(""))}function n(){""==e.val()&&(e.addClass("pi_placeholder"),e.val(t))}var r=this;r.render=function(){return e.length&&"placeholder"in e[0]?void e.attr("placeholder",t):(e.focus(i),e.blur(n),void n())}}wLive.Controls.PlaceholderInput=e}()}),define("selectionmanager",["errormanager","baseutil"],function(){!function(){function e(c){function h(e,t){var i=_(t);switch(i){case l:p(e),q=e;break;case d:m(e,t);break;case s:g(e),q=e}var n=U.getSelection();V=0===n.selectionCount?-1:e}function p(e){!z&&E(e)&&v(),C(e)}function m(e,t){t.ctrl||(W={},Q={},P(q));for(var i=U.isSelected(L,q),n=Math.min(Math.min(q,V),e),r=Math.max(Math.max(q,V),e),o=Math.max(Math.min(q,e),0),a=Math.max(Math.max(q,e),0),s=n;r>=s;s++)s>=o&&a>=s?s!==q&&(i&&(!K&&!E(s)||K)?y(s):w(s)):(delete W[s],delete Q[s])}function f(e){return e=e||{},e.ctrl=G&&e.ctrl,e.shift=G&&e.shift,e}function g(e){var t=U.getSelection(),i=t&&1===t.selectionCount&&U.isSelected(L,e);v(),i||P(e)}function v(){W={},Q={},$=!1,V=-1,q=-1}function y(e){P(e)}function w(e){delete W[e],delete Q[e]}function C(e){U.isSelected(L,e)?(delete W[e],delete Q[e]):P(e)}function b(e){for(var t=e;null!=W[t];)t--;return t}function k(e){for(var t=e;null!=W[t];)t++;return t}function S(e){var t=!1;e||(t=!0),!n(e,L)&&e&&(t=!0,L=e);var i=c.getSetKey(e?e.key:null);if(F!==i&&(F=i),e){var o=c.getChildren(e);B||(O=o?o.getGroupings():[]),M=r(e)?o.getRawCount():o.getCount()}return t}function _(e){var t=e&&e.ctrl,i=e&&e.shift;return i&&q>-1?d:t?l:s}function I(e){var t=0;for(var i in H)t++;return t>1&&!n(e,L)}function x(e,t){var i=n(e.parent,t.parent)&&e.relationshipsKey===t.relationshipsKey&&e.inPreselectionMode===t.inPreselectionMode&&e.selectionCount===t.selectionCount;if(i){var r=e.indexes,o=t.indexes;for(var a in r)if(r[a]!==o[a]){i=!1;break}}return i}function D(e){for(var t=O[0].itemGroups,i=0;i<t.length;i++){var n=t[i];if(n.startIndex<=e&&n.endIndex>=e)return i}return-1}function E(e){for(var t in W){if(D(e)!=D(t))return!0;break}return!1}function P(e){W[e]=parseInt(e);var t=c.getChildren(L).peek(e);t&&(Q[e]=t)}function T(e,t){var i=U.getSelection();S(t)&&v();var n=e();return x(i,U.getSelection())||A(),n}function A(){R.trigger(e.SelectionChangedEvent,[U.getSelection()])}var L,F,M,N,U=this,R=jQuery(U),O=[],B=!1,H={},j={},W={},Q={},$=!1,V=-1,q=-1,G=!0,z=!0,K=!0,J=!0,X=0,Y=null,Z=null;U.dispose=function(){clearTimeout(X),v()},U.setMultiSelectEnabled=function(e){G=e},U.setCrossGroupSelectEnabled=function(e,t){z=e,K=t&&e},U.setSelectionEnabled=function(e){J=e,G=e},U.setSelectionFilter=function(e){N=e},U.registerList=function(e,t){H[e]=t,j[t.key]=e},U.unregisterList=function(){j={},H={}},U.clickSelect=function(e,t,i){if(i=f(i),J){if(N){var n=c.getChildren(e).peek(t);if(n&&!N(n))return}T(function(){h(t,i),$=i&&i.preselect},e)}},U.keyboardSelect=function(e,t,i){return i=f(i),I(e)||!J?!0:T(function(){var n=V,r=i.shift;switch(t){case o:if(-1!==n){var s=r?n-1:b(n);n=Math.max(0,s)}else S(H[0]),n=M-1;break;case a:if(-1!==n){var l=r?n+1:k(n);n=Math.min(M-1,l)}else S(H[0]),n=0;break;default:return!0}if(n===V)return!0;if(i.ctrl=!1,N){var d=c.getChildren(e).get(n);if(!N(d))return!1}return h(n,i),!1},e)},U.resolveSelection=function(t){var i=e.ResolveSuccess,n=t?c.getChildren(t):null;if(n&&0!==n.getCount()){var r={};U.getSelection();if(S(t))i=e.ResolveFailed;else if(n.getMaterializedCount())for(var o in W){var a=Q[o];if(!a){i=e.ResolveWaiting;break}var s=a?n.indexOf(a,!1,!0):-1;if(!(s>-1)){i=e.ResolveFailed;break}r[s]=a}else i=e.ResolveWaiting;if(i===e.ResolveSuccess){var l=Q[V],d=l?n.indexOf(l,!1,!0):-1,u=Q[q],h=u?n.indexOf(u,!1,!0):-1;
T(function(){v();for(var e in r)P(e);q=h,V=d},t)}else i===e.ResolveFailed&&U.deselectAll()}else U.deselectAll();return i},U.selectAll=function(e){return U.selectRange(e,0,M-1)},U.deselectAll=function(e,t){t?v():T(function(){v()},e)},U.selectRange=function(e,t,i){return I(e)||!G?!0:(T(function(){for(var e=t;i>=e;e++)P(e)},e),!1)},U.deselectRange=function(e,t,i){return I(e)||!G?!0:(T(function(){for(var e=t;i>=e;e++)w(e)},e),!1)},U.getSingleSelectedItem=function(e){var t,i=this.getSelection();if(e=e||L,e&&1===i.selectionCount)for(var n in i.indexes){t=c.getChildren(e).get(n);break}return t},U.multipleSelected=function(){var e=0;for(var t in W)if(W.hasOwnProperty(t)&&(e++,e>1))break;return e>1},U.anySelected=function(){var e=!1;for(var t in W)if(W.hasOwnProperty(t)){e=!0;break}return e},U.getSelection=function(){var e=0,t=-1;for(var i in W)(t>i||-1===t)&&(t=i),e++;var n={parent:L,inPreselectionMode:$,indexes:W,selectionCount:e,firstSelectedIndex:t,lastInteractedIndex:V};return n},U.showSelectionDialog=function(e){var t=this;!Z&&e&&require(["modaldialog","doregister"],function(){var n=$f&&$f.createLoading({returnMarkup:!0,useTransparentFallback:!0,text:e});Z=wLive.Controls.Notifications.createModalDialog({buttons:{close:i("Cancel")},title:"",content:n});var r=jQuery(Z);r.bind({"afterdismiss._dlg":function(e,i){r.unbind(),t.dialog=null},"buttonclick._dlg":function(e,t,i){"close"===i&&Y&&(Y.cancel(),Y=null)}}),Z.show()})},U.dismissSelectionDialog=function(){$header&&$header.hideLoading(),clearTimeout(X),X=0,Z&&(Z.dismiss(),Z=null)},U.selectGroupFromIndex=function(e,i,n,r,o){var a=t.DataModel.getInstance(),s=U.getSelection(),l=s.parent,d=l.key,h=c.getSetKey(d);$header.showLoading(),X=setTimeout(function(){$header.hideLoading(),U.showSelectionDialog(o)},u),Y=a.ensureGroupCompletelyDownloaded(l,h,e,i).then(function(){U.dismissSelectionDialog();var t=l.getChildren(h),o=t.getGroupings()[e];if(o){var a=o.itemGroups[i];a?(n||U.deselectAll(l,!0),U.isRangeSelected(l,a.startIndex,a.endIndex)?U.deselectRange(l,a.startIndex,a.endIndex):U.selectRange(l,a.startIndex,a.endIndex),r()):Trace.log("Failed to get the  subgroup for: "+d+" at group index "+e+" at subgroup index "+a,"Selection Manager")}else Trace.log("Failed to get the group for: "+d+" at group index "+e,"Selection Manager")},function(){U.dismissSelectionDialog(),Trace.log("Failed to get the selected items for: "+d,"Selection Manager")})},U.getSelectedItems=function(e,i){var n=t.DataModel.getInstance(),r=U.getSelection(),o=r.parent,a=[];for(var s in r.indexes)a.push(s);var l=o.key,d=c.getSetKey(l);$header.showLoading(),X=setTimeout(function(){$header.hideLoading(),U.showSelectionDialog(i)},u),Y=n.ensureCompletelyDownloaded(o,d,a).then(function(){U.dismissSelectionDialog();var t=[];for(var i in r.indexes){var n=c.getChildren(o).get(i);n&&t.push(n)}e(t)},function(){U.dismissSelectionDialog(),Trace.log("Failed to get the selected items for: "+l,"Selection Manager")})},U.isSelected=function(e,t){return n(e,L)&&W[t]===t},U.isRangeSelected=function(e,t,i){var r=n(e,L);if(r)for(var o=t;i>=o;o++)if(W[o]!==o){r=!1;break}return r},U.hasPreselectedChild=function(e){return n(e,L)&&$},U.resetPreselectionFlag=function(){$=!1},U.setGroupings=function(e){if(e)O=e,B=!0;else{if(L){var t=c.getChildren(L);O=t?t.getGroupings():[]}else O=[];B=!1}}}var t=wLive.Core,i=t.AleHelpers.getPCString,n=t.SkyDriveItem.areItemsSame,r=t.SkyDriveItemHelper.isSearchQuery,o=38,a=40,s=0,l=1,d=2,u=3e3;e.SelectionChangedEvent="selectionChanged",e.ResolveFailed=-1,e.ResolveWaiting=1,e.ResolveSuccess=2,wLive.Core.SelectionManager=e}()}),define("networksprovider",["wliveloaded","errormanager"],function(){!function(){function e(){function r(e,t){for(var i=0;i<e.length;i++){var n=e[i];try{n&&n(t)}catch(r){}}}function o(e,t){for(var i=[],n=e.length,r=0;n>r;r++){var o=e[r];o.status==t&&i.push(o)}return i}var a,s=this,l=[],d=[];s.clearCache=function(){t=null},s.fetchNetworks=function(e,o,s){if(t)e&&e(t.networks);else if(e&&l.push(e),o&&d.push(o),!a){a=!0;var u={resultSet:n},c=FilesConfig.baseApiUrl+"GetNetworks?"+$Utility.serialize(u),h=new i.DataRequest(c,c,null,function(e){a=!1,t=e,r(l,t.networks),l=[],d=[]},function(e){a=!1;var t=e&&e.error;r(d,t),l=[],d=[]},s);h.apiId="SkyDrive_Json_GetNetworks",h.propertyId="SkyDrive",h.start()}},s.getConnectedNetworks=function(t){var i=o(t,e.Status.Connected),n=o(t,e.Status.Error);return jQuery.merge(i,n),i},s.getUpsellNetworks=function(t){return o(t,e.Status.None)},s.findTargetNetwork=function(e,t){for(var i,n=0;n<e.length;n++)if(e[n].id===t){i=e[n];break}return i},s.hasOffer=function(e,t){if(e){var i=e.offers;if(i)for(var n=0;n<i.length;n++)if(i[n]===t)return!0}return!1},s.getContactSyncLastSuccessTime=function(e){return e.contactSyncSuccess&&e.contactSyncSuccess.match(/EndTime: .* Success\./)[0]},s.areRequiredNetworkOffersPresent=function(e,t){for(var i=0;i<t.length;i++)if(!s.hasOffer(e,t[i]))return!1;return!0}}var t,i=wLive.Core,n=1;e.Status={None:0,Connected:1,Error:2},i.NetworksProvider=e}()}),define("sharinghelper",["imagetile","jquery-1.7.2","droppablenavlink","wliveloaded","actionmanager","alehelpers","beforeunloadmanager","newcontroladapter","errormanager","domhelpers","filetypehelper","imagestrip","inlineerror","loadingcue","operationmanager","permissionsprovider","placeholderinput","selectionmanager","sharinglink.html","networksprovider","skydrive_pc_strip_32_ltr","skydrive_pc_strip_8_ltr","skydrive_sharing_strip_8_ltr","header_strip_ltr","doregister"],function(){!function(){function e(e,t,i,o){var a=jQuery('<div class="sd_pop_wrapper"></div>');require(["modaldialog","doregister","sharedialog"],function(){function s(){d&&d.dismiss(),d=null}function l(){d&&d.reposition()}var d=r.Notifications.createModalDialog({content:a[0]}),c=jQuery(d);c.bind({"aftershow._dlg":function(c,h){var p=new n.PermissionsProvider(u.callerCid),m=new r.ShareDialog(a,p,e,t,u,s,l,i,o);i.showLinkPane&&m.setVisiblePane(r.ShareDialog.Panes.Link),m.render(),jQuery(".UserArea").on("click",".sd_cancel",function(e){s()}),d.reposition()},"afterdismiss._dlg":function(e,t){jQuery(".ModalDialog").unbind("onclose._dlg"),c&&c.unbind("._dlg"),c=null,d=null,f=!1}}),d.show(),f=!0})}function t(e,t,n,r,o,a,s){i(function(){var i=window.$icm.createNonContactIC(a,t,{namespace:"Folders_SharingList",userTileUrl:e,name:o});s.html(i.render()),i.activate()})}function i(e){require(["ic"],function(){$Do.when("$icm",0,e)})}var n=wLive.Core,r=wLive.Controls,o=n.AleHelpers.getPCString,a=n.ImageStrip,s=n.PermissionsProvider,l=s.EntityType,d=s.LinkType,u=wLive.Core.ViewContext.getInstance(),c="SharingListExpandedTemplate",h="SharingDialogPermissionTemplate",p="sharingListIc",m="click",f=!1;n.SharingHelper={icSize:{Medium:1,XLarge:2},showSharingDialog:function(t,i,n,a){if(n=n||{},i&&i.selectionCount>FilesConfig.maxBundleItemCount||a&&a.length>FilesConfig.maxBundleItemCount)u.errorManager.add({$element:jQuery("<div>"+o("Sharing.BundleSelectionOverLimitError").format(FilesConfig.maxBundleItemCount,i.selectionCount)+"</div>"),priority:1,type:4});else if(t&&t.isSpecialFolder&&4===t.sharingLevelValue&&!n.ignoreWarning&&t.isViewerOwner()){var s={buttons:{action:o("Sharing.SpecialFolder.Button"),alternate:o("Sharing.SpecialFolder.ShareButton")},content:jQuery("<p>"+o("Sharing.SpecialFolder.Msg1")+"</p><p>"+o("Sharing.SpecialFolder.Msg2")+"</p>"),title:o("Sharing.SpecialFolder.Header")},l=r.Notifications.createModalDialog(s),d=jQuery(l);d.bind({"aftershow._dlg":function(e,t){},"afterdismiss._dlg":function(e,t){n&&n.dismissCallback&&dismissCallback(),d&&d.unbind("._dlg"),d=null,l=null,f=!1},"buttonclick._dlg":function(i,r,o){"alternate"===o&&e(t,null,n),l.dismiss()}}),l.show(),f=!0}else e(t,i,n,a)},renderTileForEntity:function(e,n,r,o,s,u){var m=this,f=null,g=e.name,v=e.type,y=e.did,w=e.icon,C=g,b=m.icSize.XLarge==s?h:c;if(v==l.User)e.did?(f=p+e.id,o&&i(function(){window.$icm.createICsFromCids(b,[[e.did,f]],o,{namespace:"Folders_SharingList",showICCard:!0})})):m.loadDefaultIc(e,b,n);else if(v==l.Email||v==l.Facebook)m.loadDefaultIc(e,b,n);else if(v==l.Group&&w)t(w,C,e.id,y,g,b,n);else if(v==l.Link||v==l.Public||v==l.Friends||v==l.Group||v==l.GroupOwned){var k;if(w&&w.url)k=jQuery("<img/>"),k.attr("src",w.url),k.attr("height",r),k.attr("width",r);else{var S;v==l.Link?S=e.linkType!=d.Embed?e.linkType!=d.Form?"linkIcon":"formLinkIcon":"embedIcon":v==l.Friends?S="friendsIcon":v==l.Group||v==l.GroupOwned?(S="groupsIcon",S=60==r?S+"60":S):S="publicIcon",S=u?S+"White":S,k=jQuery(a.getImage(S,C,C))}k.addClass("ips_ic_icon"),k.attr("alt",C),k.attr("title",C),n.append(k)}return f},loadDefaultIc:function(e,i,n){t(null,e.email,e.id,e.did,e.name,i,n)},buildScopeLinkHeaderHref:function(e,t,i,r){null==r&&(r=!1);var o,a=n.SkyDriveItem.getItemKey(t.id,i.ownerCid,i.group),s=e.dataModel&&e.dataModel.getItem(a,!0);if(!FilesConfig.isWacSharing&&s&&t.id==e.viewParams.id&&n.StringHelpers.caseInsensitiveStringEquals(e.callerCid,i.ownerCid))o="#";else{var l=Number(e.actionId)+1,d=t.refId&&!r?t.id.split("!")[0]:i.ownerCid;o=i.group?"/?cid={0}&id={1}&action=Share&actionId={2}&group={3}".format(d.encodeUrl(),(r?t.refId:t.id).encodeUrl(),l,i.group):"/?cid={0}&id={1}&action=Share&actionId={2}".format(d.encodeUrl(),(r?t.refId:t.id).encodeUrl(),l)}return o},buildScopeLinkHeaderCallback:function(e,t,i,r,o){null==o&&(o=!1);var a,s=n.SkyDriveItem.getItemKey(o?t.refId:t.id,i.ownerCid,i.group),l=e.dataModel&&e.dataModel.getItem(s,!0);return a=!FilesConfig.isWacSharing&&l&&t.id==e.viewParams.id&&n.StringHelpers.caseInsensitiveStringEquals(e.callerCid,i.ownerCid)?function(){return e.selectionManager.deselectAll(),r&&r(),n.SharingHelper.showSharingDialog(l),!1}:function(){e.selectionManager&&e.selectionManager.deselectAll(),r&&r()}},buildScopeLinkHeader:function(e,t,i,r,o,a,s){var l=t.name||t.id,d='<a href="'+n.SharingHelper.buildScopeLinkHeaderHref(e,t,i)+'" class="'+o+'">'+l.encodeHtml()+"</a>",u='<div class="'+a+'">'+r.format(d)+"</div>",c=jQuery(u),h=jQuery("a",c);return h.bind(m,n.SharingHelper.buildScopeLinkHeaderCallback(e,t,i,s)),c}},mix(n.SharingHelper,Shared.ObjectEventing),n.SharingHelper.addObjectListener(n.BeforeUnloadManager,"beforehashchange",function(){f&&wLive&&wLive.Controls&&wLive.Controls.Notifications&&wLive.Controls.Notifications.getQueue().reset()})}()}),define("permissionentitycontrol",["sharinghelper"],function(){!function(){function e(e,t,i,a,v,y,w,C,b){function k(){var t=jQuery(".ips_ic_details .ips_ic_role",T);if(!x())return T.addClass("ips_link_entity"),void t.remove();var i=e.role;sutra(t,"$Sutra.SkyDrive.InfoPaneSharingEntityRole"),t.text(D(i))}function S(){var t=jQuery(".ips_ic_details .ips_ic_name",T);t.text(e.name),t.attr("type",e.type),sutra(t,"$Sutra.SkyDrive.InfoPaneSharingEntityName")}function _(e){var t=e.name,i=e.type,r=e.did,a=e.icon,s=t;if(i==d.User)P=h+e.id;else if(i==d.Email)E.loadIcFromEmail(e.email);else if(i==d.Facebook)E.loadDefaultIc();else if(i==d.Group&&a)I(a,s,e.id,r,t,A);else if(i==d.Link||i==d.Public||i==d.Friends||i==d.Group||L){var l;if(a&&a.url)l=jQuery("<img/>"),l.attr("src",a.url),l.attr("height",m),l.attr("width",f);else{var c;i==d.Link?c=e.linkType!=u.Embed?e.linkType!=u.Form?"linkIcon_40":"formLinkIcon_40":"embedIcon_40":i==d.Friends?c="friendsIcon_40":i==d.Group||L?(c="groupsIcon_40",L&&(s=n("Sharing.GroupMembersHeader"))):c="publicIcon_40",c=U?c+"_White":c,l=jQuery(o.getImage(c,s,s))}l.addClass("ips_ic_icon"),l.attr("alt",s),l.attr("title",s),A.append(l)}}function I(e,t,i,n,r,o){var a=window.$icm.createNonContactIC(c,t,{namespace:p,userTileUrl:e,name:r});o.html(a.render()),a.activate()}function x(){var t=e.type;return!(t==d.Link&&(e.linkType==u.View||e.linkType==u.Edit))}function D(e){var t="CanView";if(L)e==l.Edit&&(t="CanEdit"),t="GroupMembers"+t;else if(e==s.Edit)t="CanEdit";else if(e==s.Submit)t="CanSubmit";else if(e==s.Owner)t="Owner";else if(e==s.CoOwner)return r("GF.Sharing.CoOwner");return n("Sharing."+t)}var E=this;b=b||{};var P,T,A,L,F=i.id,M=i.name,N=F.replace("!",""),U=b.dt;E.getIcId=function(){return P},E.icReady=function(e){A.html(e.render()),e.activate()},E.loadDefaultIc=function(){I(null,e.email,e.id,e.did,e.name,A)},E.loadIcFromEmail=function(e){var t=$pwc&&$pwc.getPersonsByEmail(e)[0];if(t){var i=window.$icm.createICForPerson(c,t.getId(),{namespace:p,toolTipType:"none"});A.html(i.render()),i.activate()}else this.loadDefaultIc()},E.getEntityContainer=function(){return T},E.render=function(){L=e.type==d.GroupOwned,T=jQuery('<li class="ips_entity"><a href="#" onclick="return false;"><div class="ips_ic"></div><div class="ips_ic_details"><div class="ips_ic_name"></div><div class="ips_ic_role"></div></div><div class="c_clr"></div></a></li>'),sutra(T,"$Sutra.SkyDrive.InfoPaneSharingEntity"),v.append(T),A=jQuery(".ips_ic",T),_(e),L||S(),k(),T.attr({entityId:e.id,scopeId:N}),C&&T.bind(g,{entity:e,scopeId:F,scopeName:M,scope:i,canChange:y,selectedTab:T,ignoreWarning:!0},C)}}var t=wLive.Core,i=wLive.Controls,n=t.AleHelpers.getPCString,r=t.AleHelpers.getSkyString,o=t.ImageStrip,a=t.PermissionsProvider,s=a.Role,l=a.GroupRole,d=a.EntityType,u=a.LinkType,c="SharingListTemplate",h="sharingListIc",p="Folders_SharingList",m=(FilesConfig.foldersImgBaseUrl+"/categoryIcon.png",o.getImage("openUp",null,null),o.getImage("darkPanelOpenUp",null,null),40),f=40,g="click";i.PermissionEntityControl=e}()}),define("permissionscopecontrol",["permissionentitycontrol"],function(){!function(){function e(e,i,a,s,l,d,u,c,h,p){function m(e,t,n,r,o){var a=new wLive.Controls.PermissionEntityControl(r,s,l,i,n,u,c,o,p);a.render();var d=a.getIcId();return d&&(b[d]=a,null!=r.did?e.push([r.did,d]):t.push([r.id,d])),a}function f(i){if(t.StringHelpers.caseInsensitiveStringEquals(s.id,l.id)||d)p.showPropertiesTitle&&i.append('<div class="ips_scope_header">'+w+"</div>");else if(l.canChange===!1)i.append('<div class="ips_scope_header">'+y.format(l.name)+"</div>");else if(v())i.append('<div class="ips_scope_header">'+y.format(l.name)+"</div>");else{var n=function(){p&&p.ct&&p.ct.close&&p.ct.close()},o=r.buildScopeLinkHeader(e,l,s,y,"ips_scope_link","ips_scope_header",n);i.append(o),sutra(o,"$Sutra.SkyDrive.InfoPaneSharingScopeHeader")}}function g(e,t){var i=b[e];i&&(t?i.icReady(t):i.loadDefaultIc())}function v(){return null!=l.allowedActions&&Array.prototype.indexOf.call(l.allowedActions,wLive.Core.PermissionsProvider.AllowedActions.Remove)>=0}var y=n("Sharing.ScopeHeaderFormat"),w=n("Sharing.Permissions"),C=this,b={};p=p||{},C.render=function(){var e=jQuery('<li class="ips_scope"></li>');a.append(e),sutra(e,"$Sutra.SkyDrive.InfoPaneSharingScope"),f(e);var t=jQuery("<ul></ul>");e.append(t),sutra(t,"$Sutra.SkyDrive.InfoPaneSharingEntities");var i,n=[],r=[],s=[];if(v()){var d=function(e){e.data.controlsToSelect=s,h(e)};i=d,t.addClass("ips_scope_linked_entities")}else i=h;for(var u=0;u<l.entities.length;u++){var c=m(n,r,t,l.entities[u],i);s.push(c.getEntityContainer())}for(var p=0;p<r.length;p++){r[p][0];g(r[p][1],null)}window.$icm&&window.$icm.createICsFromCids(o,n,g,{namespace:"Folders_SharingList",showICCard:!0}),a.closest(".ModalDialog").length&&jQuery(".ips_ic_remove:first").focus()}}var t=wLive.Core,i=wLive.Controls,n=t.AleHelpers.getPCString,r=t.SharingHelper,o="SharingListExpandedTemplate";i.PermissionScopeControl=e}()}),define("sharinglist",["permissionscopecontrol"],function(){!function(){function e(e,f,g,v,y){function w(i){if(L=setTimeout(function(){k()},p),FilesConfig.allowReshareForEditors&&e.callerCid&&!e.tokenHasBeenRedeemed&&i.tokenNeedsRedeeming&&FilesConfig.authKey){var n=Object.toJSON({id:i.id,authKey:FilesConfig.authKey}),r=function(){e.tokenHasBeenRedeemed=!0,b()},o=new t.DataRequest(m,m,n,r,b);o.apiId="SkyDrive_Json_RedeemPermissionToken",o.propertyId="SkyDrive",o.start()}else b()}function C(){H&&window.$icm&&(window.$icm.removeAllICsByNamespace(o),H=!1)}function b(){g.fetchPermissions(M,S,P,O)}function k(){C(),A=null,f.empty();var e=new wLive.Controls.LoadingSpinner(f);e.render()}function S(t,i){if(t.id==M.id){if(clearTimeout(L),clearTimeout(F),x(i))return _(jQuery(".ips_commands",f)),void(A=i);A=i,T=jQuery("<div></div>"),T.insertAfter(f).hide();var o=jQuery('<div class="ips_commands"></div>');_(o),T.append(o);var a=FilesConfig.hcid,s=a==t.ownerCid||r.isOwnerOrCoOwner(t)||e.isSuper,l=i&&i.permissionScopes;if(C(),s&&l&&1==l.length&&l[0].entities&&0==l[0].entities.length)E(n("Sharing.PermissionNotShared"),!0),M.sharingLevelValue=u;else{H=!0,D(i);var d=i&&i.sharingLevel;d&&!y.hc&&E(d)}I(),R&&R()}}function _(i){if(i.empty(),!y.hc)for(var r=y.fs(M)&&M.folder?"Folder":"",o=[s,l],d=0;d<o.length;d++){var u=o[d],c=e.actionManager.getAction(u,M);if(c){var h=t.ActionManager.setATagAction(c,null,e.infoPaneBiciLoc),p=u==s&&M.form?a:u,m=n(p+r+"Command");h.text(m),sutra(h,"$Sutra.SkyDrive."+u+"Command");var f=jQuery('<div class="ipc_container"></div>').append(h);i.append(f)}}}function I(){T.show(),f.remove(),sutra(T,"$Sutra.SkyDrive.InfoPaneSharing"),f=T}function x(e){if(!e||!A||e.permissionScopes.length!=A.permissionScopes.length)return!1;if(e.permissionScopes.length&&e.permissionScopes[0].id==M.id&&e.permissionScopes[0].entities.length||1==e.permissionScopes.length&&e.permissionScopes[0].entities&&0==e.permissionScopes[0].entities.length)return!1;for(var t=0;t<e.permissionScopes.length;t++)if(Object.toJSON(e.permissionScopes[t].entities)!=Object.toJSON(A.permissionScopes[t].entities))return!1;return!0}function D(i){var n=jQuery('<ul class="ips_list"></ul>');sutra(n,"$Sutra.SkyDrive.InfoPaneSharingScopes"),n.addClass("ips_extended"),T.append(n);for(var r=i&&i.permissionScopes,o=r?r.length:0,a=0;o>a;a++){var s=r[a],l=i.canChange&&t.StringHelpers.caseInsensitiveStringEquals(s.id,M.id);if(s.entities.length){var d=y;d.showPropertiesTitle=y.hc;var u=new wLive.Controls.PermissionScopeControl(e,g,n,M,s,!i.canChange,l,B,v,d);u.render()}}o>1&&r[0].entities&&0==r[0].entities.length&&jQuery("li:first-child",n).addClass("ips_scope_first"),n.append(jQuery('<div class="c_clr"></div>'))}function E(e,t){y.hc&&T.append('<div class="ips_scope_header t_ctc">'+c+"</div>");var i=jQuery('<div class="t_ctc ips_level"></div>').text(e);if(sutra(i,"$Sutra.SkyDrive.InfoPaneSharingSimpleSharingLevel"),v&&!t){var n=M&&M.name;i.bind(d,{entity:null,scopeName:n},v)}T.append(i)}function P(e,t){if(e.id==M.id){C(),f.empty(),clearTimeout(L);var r=n("Sharing.GetPermissionsError"),o=jQuery('<div class="ips_error"></div>');f.append(o);var a=new i.InlineError(o,r);a.render()}}var T,A,L,F,M,N,U,R,O,B=this,H=!1;B.render=function(e,i,r,o){e=e||M,r=r||{},R=r.getPermissionsCallback,O=r.skipCache;var a=r.quickRender,s=t.SkyDriveItem.areItemsSame(e,M,!0);M=e,N=i,U=o,clearTimeout(F),clearTimeout(L);var l=e?e.isRecycled?n(e.folder?"Sharing.PrivateFolder":"Sharing.PrivateFile"):null:n("Sharing.MultipleFilesPrivate");return l?(T=jQuery("<div></div>"),T.insertAfter(f).hide(),E(l),void I()):void(s||a?w(e):F=setTimeout(function(){w(e)},h))},B.dispose=function(){clearTimeout(L),clearTimeout(F),C(),T&&T.empty()}}var t=wLive.Core,i=wLive.Controls,n=t.AleHelpers.getPCString,r=t.SkyDriveItemHelper,o="Folders_SharingList",a="ShareWorkbook",s="Share",l="SendSurvey",d="click",u=4,c=n("Sharing.Permissions"),h=100,p=1e3,m=FilesConfig.baseApiUrl+"RedeemPermissionToken";i.SharingList=e,defineSubClass("SkyDrive.UI.SharingList",SkyDrive.UI.LegacyControlAdapter,function(){var e=this,n={fs:function(t){return t===e.dataContext.item}};e.controlType=function(r,o,a){var s=new t.PermissionsProvider(o.callerCid),l=bind(e,e._onPermissionsEntityClick);return i.SharingList.apply(this,[o,r,s,l,n])}},{_onPermissionsEntityClick:function(e){raiseEvent(this,"permissionsEntityClick",e.data,!0)}}),$Do.register("SharingList")}()}),define("directnetworksprovider",["sharinglist"],function(){!function(){var e;window.require?require(["skydrive_sharing_strip_8_ltr"],function(){e=JBase.UI.ImageStripHelper,e.registerStrip(FilesConfig.sharingStripUrl,SharingIS)}):(e=JBase.UI.ImageStripHelper,e.registerStrip(FilesConfig.sharingStripUrl,SharingIS));var t={FB:{url:"https://www.facebook.com/sharer/sharer.php?u={{url}}",icon:"facebook",width:626,height:436,sutra:"NetworkIconFB"},TWITR:{url:"http://twitter.com/share?url={{url}}",icon:"twitter",height:300,width:550,sutra:"NetworkIconTWITR"},LI:{url:"http://www.linkedin.com/shareArticle?mini=true&url={{url}}",icon:"linkedin",height:300,width:550,sutra:"NetworkIconLI"},SINWE:{icon:"weibo",height:400,width:600,url:"http://service.weibo.com/share/share.php?url={{url}}",sutra:"NetworkIconSINWE"}};defineSubClass("wLive.Core.DirectNetworksProvider",JBase.UI.BaseControl,function(){},{getLinks:function(e,i,n){for(var r=jQuery(_ce("div")),o=0;o<i.length;o++){var a=i[o];t.hasOwnProperty(a)&&r.append(this._buildNetworkLink(a,e,n))}return r},_generateShareUrl:function(e,t){var i=t;return i=i.replace("{{url}}",encodeURIComponent(e))},_buildNetworkLink:function(e,i,n){var r=t[e],o=jQuery('<a target="_blank" />'),a=this._generateShareUrl(i,r.url);o.attr("href",a),o.click(function(t){t.preventDefault();var i=window.screenLeft||0,n=window.innerWidth||0,o=Math.max(n/2-r.width/2+i,0),s=window.screenTop||0,l=window.innerHeight||0,d=Math.max(l/2-r.height/2+s,0);window.open(a,"sharing_"+e,"resizable, width="+r.width+", height="+r.height+", screenX="+o+", screenY="+d)}),sutra(o,"$Sutra.SkyDrive."+r.sutra);var s=this._buildNetworkIcon(r.icon);return s&&(o.html(s.renderHtml()),n.push(s)),o},_buildNetworkIcon:function(t){var i=null;return t&&(i=new JBase.UI.ImageTile,require(["skydrive_sharing_strip_8_ltr"],function(){var n=e.getImageInfo(t);i.setDataContext(n)})),i}})}()}),define("facebookprovider",["directnetworksprovider"],function(){!function(){var e=wLive.Core,t="https://graph.facebook.com",i="Facebook",n=6e4,r=wLive.Core.ViewContext.getInstance(),o=null,a=0,s="GetDownloadUrl";defineClass("wLive.Core.FacebookProvider",function(){this.baseUrl=r.viewParams.alturl||FilesConfig.facebookGraphApiUrl||t},{_network:null,setNetwork:function(e){this._network=e},getAlbums:function(){if(!o||a+n<(new Date).getTime()){var e=this._callGraphApi("me/albums","Facebook_GetAlbums",{limit:200},!1),t=function(t,i){e.then(function(e){o=e&&e.data,a=(new Date).getTime(),t(o)},i)},i=function(){e.cancel()};return new Shared.Promise(t,i)}return new Shared.Promise(function(e){return e(o)},function(){})},createAlbum:function(e,t,i){function n(e,t){s.then(function(t){o=null,e(t&&t.id)},t)}function r(){s.cancel()}var a={name:e,message:t,privacy:i&&"{'value':'{0}'}".format(i)},s=this._callGraphApi("me/albums","Facebook_CreateAlbum",a,!0);return new Shared.Promise(n,r)},addEmbeddedAuthUrlsToItems:function(e){var t=this;return t._callGetDownloadUrl(e)},_callGetDownloadUrl:function(t){function i(i,n){d=new e.DataRequest(l,l,u,function(e){for(var n=0;n<t.length;n++){var r=t[n];r.urls.embeddedAuth=e.items[n].downloadUrl}i(t)},n),d.apiId="SkyDrive_Json_GetDownloadUrl",d.propertyId="SkyDrive",d.start()}function n(){d&&d.abort()}for(var o=[],a=0;a<t.length;a++)o.push(t[a].id);var l=({resid:o.join(","),cid:r.callerCid,open:!0},FilesConfig.baseApiUrl+s),d=null,u=Object.toJSON({ids:o,streamName:"jpeg"});return new Shared.Promise(i,n)},getUploadPhotosBatch:function(e,t){for(var i=[],n=t+"/photos?url={0}&name={1}",r=0;r<e.length;r++){var o=e[r];i.push({method:"POST",relative_url:n.format(encodeURIComponent(o.urls.embeddedAuth),encodeURIComponent(o.caption||""))})}var a={batch:JSON.stringify(i),access_token:this._network&&this._network.clientToken};return a},publishVideo:function(e,t){wLive.Core.OperationManager.Current.execute("PublishVideo",{items:[e],targetItem:e,accessToken:this._network&&this._network.clientToken,description:t})},_callGraphApi:function(t,n,r,o){function a(t,r){c=new e.DataRequest(u,u,o?d:null,t,r,null,null,1,!0),c.apiId=n,c.propertyId=i,c.parseError=function(e,t,i){var n={};try{var r=Object.fromJSON(e.responseText);n=r&&r.error||{}}catch(o){}var a={error:{code:n.code?(n.type||"")+n.code:"HTTP_"+e.status,message:n.message,status:t,debugMessage:"(xhr status "+e.status+") xhr.responseText: "+e.responseText,stackTrace:""}};return a},c.start()}function s(){c&&c.abort()}var l=r||{};l.access_token=l.access_token||this._network&&this._network.clientToken;var d=$Utility.serialize(l),u=this.baseUrl+"/"+encodeURIComponent(t)+(o?"":"?"+d),c=null;return new Shared.Promise(a,s)}})}()}),define("emailpane",["facebookprovider","contactpickerv2"],function(){!function(){function e(e,U,R,O,B,H,j){function W(){var t=Date.now();if(!Se){var i=jQuery(o);i.bind("selectedContacts",ne),i.bind("deselectedContacts",ne),i.bind("editedContact",ne);var n,r,s,h=FilesConfig.fbDirectMessageEnabled&&Ie,p=!0,m=!1,f=function(){p&&m&&te()};if(h&&(s=u("Sharing.MessageShareSubtitleFacebookManage").format('<a href="'+_e.addLink+'" target="_blank">',"</a>")),Le)n=u("Sharing.MessageShareHeaderFormatNoQuotations").format(Fe),r=h?u("Sharing.MessageShareSubtitleEmailOrFacebookPlural")+" "+s:u("Sharing.MessageShareSubtitleEmailPlural");else if(O&&O.groupFolderType==l.GroupFolderType.MountPoint){var g=function(e,t){n=t?c("GF.Sharing.EmailOnBehalfOf").format(t.ownerName):u("Sharing.MessageShareHeaderFormat").format(H.getName()),ue.text(n),p=!0,f()},v=function(){n=u("Sharing.MessageShareHeaderFormat").format(H.getName()),ue.text(n),p=!0,f()};p=!1,U.fetchPermissions(O,g,v,!1),r=u("Sharing.MessageShareSubtitleEmailSingular")}else{if(O&&O.photo)n=u("Sharing.MessageShareHeaderSingularPhoto");else{var y=O&&O.extension;n=u("Sharing.MessageShareHeaderFormat").format(H.getName()+(y?y:""))}r=h?u("Sharing.MessageShareSubtitleEmailOrFacebookSingular")+" "+s:u("Sharing.MessageShareSubtitleEmailSingular")}ue.text(n),sutra(ue,"$Sutra.SkyDrive.EmailPaneHeader"),ce.html(r),fe=jQuery(".sd_email_error",e);e.find(".sd_email_to_label").text(u("Sharing.ToLabel"));be=jQuery(".sd_email_message",e);var w=new d.PlaceholderInput(be,E);w.render(),sutra(be,"$Sutra.SkyDrive.EmailPaneMessageInput"),be.bind("keyup",function(){ie()}),ke&&be.val(ke);var C=jQuery(".sd_email_perms",e),b=jQuery(".sd_email_statement",e),k=jQuery("#sd_email_roles",C),S=jQuery(".sd_email_can_edit",C),_=jQuery(".sd_email_signin_req",e);if(ge=jQuery("#sd_email_can_edit",S),ve=jQuery("#sd_email_roles",C),ve.attr("title",u("Sharing.RecipientPermissionsTitle")),_$roleNotes=jQuery(".sd_email_notes",e),we=jQuery("#sd_email_signin_req",_),Ce=jQuery("#sd_email_statement",e),sutra(ge,"$Sutra.SkyDrive.EmailPaneRecipientsCanEdit"),sutra(ve,"$Sutra.SkyDrive.EmailPaneRoles"),sutra(_$roleNotes,"$Sutra.SkyDrive.EmailPaneNotes"),sutra(we,"$Sutra.SkyDrive.EmailPaneRecipientsMustSignIn"),sutra(pe,"$Sutra.SkyDrive.EmailPaneShare"),sutra(me,"$Sutra.SkyDrive.EmailPaneCancel"),sutra(Ce,"$Sutra.SkyDrive.EmailPaneStatement"),jQuery("option",ve).each(function(){var e=jQuery(this),t="c"===e.attr("value")?"$Sutra.SkyDrive.EmailPaneRoleCoOwner":"$Sutra.SkyDrive.EmailPaneRoleView";sutra(e,t)}),jQuery("option",we).each(function(){var e=jQuery(this),t="y"===e.attr("value")?"$Sutra.SkyDrive.EmailPaneRecipientsMustSignInYes":"$Sutra.SkyDrive.EmailPaneRecipientsMustSignInNo";sutra(e,t)}),jQuery("#sd_email_signin_req_n",_).text(u("Sharing.SignInNotRequired")),jQuery("#sd_email_signin_req_y",_).text(u("Sharing.SignInRequired")),Ee&&!Pe)S.hide(),jQuery("#sd_email_coowner",C).text(c("GF.Sharing.RecipientsAreCoOwner")),jQuery("#sd_email_view",C).text(u("Sharing.RecipientsCanView")),ve.change(Z),ye=ve;else if(O&&O.isAlbum)S.hide(),k.hide(),ye=ge;else{k.hide();var I=jQuery("#sd_email_can_edit_y",S),x=jQuery("#sd_email_can_edit_n",S);I.text(u("Sharing.RecipientsCanEdit")),x.text(u("Sharing.RecipientsCanView")),sutra(I,"$Sutra.SkyDrive.EmailPaneRecipientsCanEditYes"),sutra(I,"$Sutra.SkyDrive.EmailPaneRecipientsCanEditNo"),ye=ge}var D=function(e){Ae=!0,e.preventDefault(),b.hide(),C.show(),_.show()};C.hide(),_.hide(),Ce.click(D),ye.change(X),X(),Y(),pe.val(u("Sharing.Share")),pe.click(oe),sutra(jQuery(".cp_inputContainer",e),"$Sutra.SkyDrive.EmailPaneToLine"),m=!0,f(),a.setFocus(!1),_$characterCounter=jQuery(".sd_email_char_cntr",e),ie(),"function"==typeof H.updateLayout&&H.updateLayout(),FilesConfig.fbDirectMessageEnabled&&!Ie&&q(),Qos.logData(F,M,t,null,null,null,Date.now())}}function Q(e){$Do.when("WLXContactPickerV2",0,function(){Se||$(e)})}function $(e){if(!Se){V();var t={};e&&(t.personFactory=wLive.ContactList.ViewModels.DirectMessageFactory,t.personFilterFn=function(e){return!e.isFanPage()}),s=new wLive.ContactList.ViewModels.FlatContactsDataModel(t),o=new wLive.ContactPickerV2.ViewModels.ContactPickerModel(s,{autoExpandCategories:!0}),a=new wLive.ContactPickerV2.Controls.ContactPicker(jQuery("#sharingContactPicker"),o,{excludeSelectedFromFrequentList:!0,maxHeight:250,showContactListOnFocus:wLive.ContactPickerV2.Controls.ContactPicker.ListMode.none}),setTimeout(W,0)}}function V(){a&&(a.dispose(),a=null),o&&(o.dispose(),o=null),s&&(s.dispose(),s=null);var e=jQuery(".sd_contact_picker");e.empty(),e.append(D)}function q(){he.html(u("Sharing.FacebookContactSyncUpsellText").format('<a href="#" class="sd_facebook_upsell_link">',"<a/>"));var t=jQuery(".sd_facebook_upsell_link",e);t.bind("click",function(){var e=_e.addLink+"&view=popup&brand=onedrive&scenarios=status_publish,media_publish&biciid=onedrivefbmessage&closenoredirect=true";return window.open(e,"addNetwork","width=720px,height=520px,status=no,toolbar=no,resizeable=yes,menubar=no,scrollbars=yes",!0),K(),!1})}function G(){var t=jQuery(".sd_facebook_upsell_line",e);t.hide()}function z(){var t=jQuery(".sd_facebook_upsell_line",e);t.show()}function K(){function e(i){if(!Se){var o=R.findTargetNetwork(i,"FB"),a=R.areRequiredNetworkOffersPresent(o,p);if(!n)if(o&&(a||r!==R.getContactSyncLastSuccessTime(o)))if(a){var s=jQuery(".sd_contact_sync_success");s.text(u("Sharing.FacebookContactSyncCompletedText")),clearTimeout(xe),$pwc.client.deltaSync(function(){$(!0),G(),te(),H.enableMenuTabs(),Te=!1},t)}else t();else o?J(e,t):t()}}function t(){Se||(te(),z(),H.enableMenuTabs(),re(u("Sharing.FacebookContactSyncTimeoutText")),Te=!1)}re(),ee(u("Sharing.FacebookContactSyncText")),G(),H.disableMenuTabs();var i=jQuery(".sd_loading");i.bind("click",function(){te(),z(),H.enableMenuTabs(),i.unbind("click",this)});var n,r;Te||(Te=!0,_e&&(r=R.getContactSyncLastSuccessTime(_e)),J(e,t),xe=setTimeout(function(){n=!0,t()},f))}function J(e,t){De=setTimeout(function(){R.clearCache(),R.fetchNetworks(e,t)},m)}function X(){var e=jQuery("option:selected",ye).text();Ce.text(e)}function Y(){if(!Le){var e=O&&(O.photo||O.folder)?"n":"y",t=function(){Ae||(ge.val(e),ge.change())},i=function(i,n){e=n&&"edit"===n.defaultPermissionsLevel?"y":"n",t()};t(),U.fetchPermissions(O,i,void 0,!1)}}function Z(e){"c"===ve.attr("value")?(_$roleNotes.text(P),we.val("y"),we.attr("disabled","disabled")):(_$roleNotes.text(""),we.removeAttr("disabled"))}function ee(e){Qos.start(A),le.empty();var t=new wLive.Controls.LoadingSpinner(le,e);t.render(),le.show(),ue.hide(),ce.hide(),he.hide(),de.hide(),pe.hide(),Qos.end()}function te(){Qos.start(L),ue.show(),ce.show(),he.show(),de.show(),pe.show(),le.hide(),Qos.end()}function ie(){var e=be.val().length;e>y-v&&(_$characterCounter.show(),sutra(_$characterCounter,"$Sutra.SkyDrive.CharacterCounter")),e>y?(_$characterCounter.addClass("char_cnt_error"),pe.prop("disabled",!0),sutra(_$characterCounter,"$Sutra.SkyDrive.CharacterCounterError")):(_$characterCounter.removeClass("char_cnt_error"),pe.prop("disabled",!1),sutra(_$characterCounter,"$Sutra.SkyDrive.CharacterCounter")),_$characterCounter.text(u("Sharing.NetworkCharacterCounterFormat").format(e,y))}function ne(){var e=o.selectedContacts().length,t=e>I,i=t?u("Sharing.MaxContacts").format(I):"";t?pe.attr(h,h):pe.removeAttr(h),re(i)}function re(e){if(fe.empty(),e){var t=new d.InlineError(fe,e);t.render(),fe.show()}else fe.hide()}function oe(){t=Date.now(),re();var e=Le?"Sharing.SharingFormatNoQuotations":"Sharing.SharingFormat";a.completeUserEntry(),H.showLoading(u(e).format(H.getName())),H.disableMenuTabs(),i=Ee&&!Pe?"c"===ve.attr("value")?l.PermissionsProvider.Role.CoOwner:l.PermissionsProvider.Role.View:"y"===ge.attr("value")?l.PermissionsProvider.Role.Edit:l.PermissionsProvider.Role.View,
n="y"===we.attr("value");var s=be.val();s=s==E?null:s,fe.empty(),fe.hide();var d=o.selectedContacts();r=d.length,O?U.shareToContacts(O,null,d,i,n,s,null,se,ae):j?U.shareToContacts(null,j,d,i,n,s,{bundleName:H.getBundleName()},se,ae):N.selectionManager.getSelectedItems(function(e){U.shareToContacts(null,e,d,i,n,s,{bundleName:H.getBundleName()},se,ae)}),Shared.ElementEventing.raise(window,"shareButtonClicked")}function ae(e,t,i){if(!Se){var n=t.message,r=!1;if(i){for(var a,s=0,l=0,c=0;c<i.length;c++){var h=i[c],p=h.entity;if(h.status&&h.status!=w){if(s++,h.errorCode==S){var m=h.uniqueError;a=m.message,r=!0}}else{l++;for(var f=o.selectedContacts(),g=0;g<f.length;g++){var v=f[g],y=v.contact();if(p.email==v.email()||y&&(p.did==y.cid()||p.abId==y.id())){o.deselectContactBySelectedContactId(v.id());break}}}}n=a?a:0==l?u("Sharing.ShareErrorAllFailed"):u("Sharing.ShareErrorSomeFailed").format(s)}var I=function(e){var i=t.data,o=t.message;if(i&&o){var a=Object.fromJSON(i),s=a.displayAction,l=a[e];l&&s&&(n=o.encodeHtml()+' <a href="'+l.encodeHtmlAttribute()+'" target="_blank">'+s.encodeHtml()+"</a>",r=!0)}};if(t&&t.code==C&&I("hipUrl"),t&&t.code==k&&I("url"),t&&t.code==b){var x=t.message;x&&(n=x.format('<a target="_top" href="http://'+FilesConfig.gLinkDomain+'/8SESkyDrive/VerifyAccount">',"</a>"),r=!0)}t&&t.code==_&&(n=u("Sharing.SharingBlockedLinkGenerationError")),ne();var D=new d.InlineError(fe,n,r);D.render(),fe.show(),H.hideLoading(),H.enableMenuTabs()}}function se(e,o){if(!Se){var a={shareStartDate:t,itemCount:H.getItemCount(),role:i,signInRequired:n,numContacts:r};H.onShareSuccessCallback(e,o,a)}}var le,de,ue,ce,he,pe,me,fe,ge,ve,ye,we,Ce,be,ke,Se,_e,Ie,xe,De,Ee=FilesConfig.isUserInGfRamp&&O&&O.folder&&!O.isBundle,Pe=FilesConfig.isUserInGfRamp,Te=!1,Ae=!1,Le=B||j,Fe=B&&B.selectionCount||j&&j.length,Me=this;Me.render=function(t){Qos.start(T),ke=t,sutra(e,"$Sutra.SkyDrive.ShareDialogEmailPane"),e.html(x),de=jQuery(".sd_email_content",e),le=jQuery(".sd_loading",e),pe=jQuery(".sd_email_share",e),ue=jQuery(".sd_header",e),he=jQuery(".sd_facebook_upsell_line",e),ce=jQuery(".sd_subheader_text",e),me=jQuery(".sd_cancel",e),me.val(u("Sharing.Close")),ee(u("Loading")),FilesConfig.fbDirectMessageEnabled?R.fetchNetworks(function(e){_e=R.findTargetNetwork(e,"FB"),R.areRequiredNetworkOffersPresent(_e,p)&&(Ie=!0),Q(Ie)},function(){Q()},g):Q(),Qos.end()},Me.getUserMessage=function(){var e=be&&be.val();return e&&e!=E?e:""},Me.dispose=function(){Se=!0,clearTimeout(xe),clearTimeout(De),V()}}var t,i,n,r,o,a,s,l=wLive.Core,d=wLive.Controls,u=l.AleHelpers.getPCString,c=l.AleHelpers.getSkyString,h="disabled",p=["ContactAgg","StatusPublish"],m=2e3,f=6e4,g=3e3,v=100,y=FilesConfig.emailPaneMaxMessageLength,w=0,C=3006,b=3009,k=3020,S=3101,_=9006,I=20,x='<h2 class="sd_header"></h2><h3 class="sd_subheader"><span class="sd_subheader_text"></span> <span class="sd_facebook_upsell_line"></span></h3><form><div class="sd_email_content"><div><div class="sd_email_to_label"></div><div class="sd_contact_picker"></div><div class="sd_contact_sync_success"></div><div class="c_clr"></div></div><textarea class="sd_email_message"></textarea><div class="sd_email_char_cntr"></div><div class="sd_email_statement"><a href="#" id="sd_email_statement" /></div><div class="sd_email_perms"><select id="sd_email_roles" name="sd_email_roles"><option id="sd_email_view" value="v" selected="selected"></option><option id="sd_email_coowner" value="c"></option></select><div class="sd_email_can_edit"><select id="sd_email_can_edit" name="sd_email_can_edit"><option id="sd_email_can_edit_n" value="n" selected="selected"></option><option id="sd_email_can_edit_y" value="y"></option></select></div></div><div class="sd_email_signin_req"><select id="sd_email_signin_req" name="sd_email_signin_req"><option id="sd_email_signin_req_n" value="n" selected="selected"></option><option id="sd_email_signin_req_y" value="y"></option></select></div><div class="sd_email_notes t_cstc"></div><div class="sd_email_error"></div><div class="sd_buffer_bottom"></div></div><div class="sd_loading"></div><div class="sd_btns"><input class="sd_email_share default" type="button" /><input class="sd_cancel" type="button" /></div></form>',D='<div class="sd_email_to_line cpv2 t_cpv2" id="sharingContactPicker"><textarea rows="1" cols="60" class="cp_textarea"></textarea></div>',E=u("Sharing.PersonalMessagePlaceholder"),P=c("GF.Sharing.CoOwnerNotes"),T="SkyDriveWeb_Internal_Control_EmailPane_Render",A="SkyDriveWeb_Internal_Control_EmailPane_ShowLoading",L="SkyDriveWeb_Internal_Control_EmailPane_HideLoading",F="SkyDriveWeb_Internal_Control_EmailPane_RefreshPane",M="SkyDrive",N=l.ViewContext.getInstance();d.EmailPane=e}()}),define("facebookpane",["emailpane"],function(){!function(){function e(e){return wLive.Core.AleHelpers.getPCString("Sharing."+e)}var t,i=["ClientPublish"],n=2e3,r=36e4,o=e("FacebookPublishHeaderSingle"),a=e("FacebookPublishVideoHeaderSingle"),s=e("FacebookPublishHeaderMultiple"),l=e("FacebookPublishedHeader"),d=e("FacebookVideoPublishedHeader"),u="https://www.facebook.com",c=$B.ltr?"{0} ({1})":"{0} ({1})",h='<a target="_blank" href="{0}Connect?appid=FB">{1}</a>'.format(FilesConfig.findServicesUrl,e("FacebookManageLink").encodeHtml()),p='<a target="_blank" href="{0}">'+e("FacebookLink")+"</a>",m=e("FacebookVideoPublishedMessage"),f=e("FacebookPublishedMessage"),g="SkyDriveWeb_Internal_Control_FacebookPane_Publish",v=0;defineSubClass("SkyDrive.UI.FacebookPane",JBase.UI.BaseControl,function(e,i){this.loadingHtml=$f&&$f.createLoading({returnMarkup:!0,useTransparentFallback:!0}),this._facebookProvider=new wLive.Core.FacebookProvider,this._networksProvider=e,this._shareDialog=i,t=t||wLive.Core.ViewContext.getInstance()},{apiIdBase:"SkyDriveWeb_Internal_Control_FacebookPane",albumNameText:e("FacebookAlbumName"),albumNamePlaceholderText:e("FacebookAlbumNamePlaceholder"),shareWithText:e("FacebookShareWith"),publishingHtml:"",albumPlaceholderText:e("FacebookAlbumDescPlaceholder"),everyoneOptionText:e("FacebookEveryone"),allFriendsOptionText:e("FacebookFriends"),selfOptionText:e("FacebookSelf"),customOptionText:e("FacebookCustom"),goToFacebookText:e("FacebookLink"),chooseAlbumHtml:e("FacebookHelperText").format(h),createNewAlbumText:e("FacebookNewAlbum"),publishBtnText:e("FacebookPublish"),cancelBtnText:e("Close"),upsellText:e("FacebookPublishUpsell"),errorText:e("FacebookPublishTimeoutText"),errorLinkText:e("FacebookPublishTimeoutLinkText"),publishVideoHtml:e("FacebookVideoHelperText").format(h),showUpsell:!0,showNewAlbumOptions:!1,showAlbumSelector:!0,showChooseAlbum:!1,facebookUrl:u,showMessage:!1,publishBtnDisabled:!0,showPublishButton:!0,headerText:"",items:null,isPolling:!1,showError:!1,showErrorLink:!0,errorLinkUrl:"",isAlbumSelectorDisabled:!0,showLoading:!1,showPublishVideo:!1,isPublishVideoFlow:!1,_albums:null,_unfilteredAlbums:null,_network:null,onDataContextChanged:function(e){this.items=e.item,this.isPublishVideoFlow=1==this.items.length&&this.items[0].video,this.isPublishVideoFlow?(this.headerText=a.format(this.items[0]?this.items[0].name+(this.items[0].extension||""):""),this.publishingHtml=m.format(p.format(this.facebookUrl))):(this.publishingHtml=f.format(p.format(this.facebookUrl)),this.headerText=this.items.length>1?s.format(this.items.length):o.format(this.items[0]?this.items[0].name+(this.items[0].extension||""):""))},onActivate:function(e){this._networksProvider.fetchNetworks(bind(this,this._onNetworksFetched),bind(this,this._onGetNetworksFailure));var t=this.isPublishVideoFlow?this.subElements.videoNote:this.subElements.albumNote,i=new wLive.Controls.PlaceholderInput(jQuery(t),this.albumPlaceholderText);i.render()},_onSelectedAlbumChange:function(){1==this.subElements.albumSelector.selectedIndex?(this.publishBtnDisabled=!0,this.showNewAlbumOptions=!0,this.showAlbumSelector=!1):this.publishBtnDisabled=!1,this._updateBindings()},_onAlbumNameChange:function(){var e=!!this.subElements.albumNameField.value;e==this.publishBtnDisabled&&(this.publishBtnDisabled=!this.publishBtnDisabled,this._updateBindings())},_onPublishClick:function(){Qos.logData(g,"SkyDrive",Date.now(),null,null,null,Date.now());var e=this;if(this.showNewAlbumOptions){var t=e.subElements.privacySelector,i=e.subElements.albumNameField.value,n=e.subElements.albumNote.value,r=t[t.selectedIndex].value;e._facebookProvider.createAlbum(i,n,r).then(bind(e,e._publishToAlbum),bind(e,e._onFacebookFailure))}else if(e.isPublishVideoFlow){var o=e.subElements.videoNote.value;e._facebookProvider.publishVideo(e.items[0],o),e.showMessage=!0,e.showPublishVideo=!1,e.headerText=d,e.showPublishButton=!1,e.showError=!1,e.facebookUrl=u,e._updateBindings()}else if(e._albums){var a=e.subElements.albumSelector,s=e._albums[a.selectedIndex-2];e._publishToAlbum(s.id,s.link)}},_onUpsellLinkClick:function(){return this._openUpsellWindow(),v=(new Date).getTime()+r,this.isPolling=!0,this._updateBindings(),this._networksProvider.clearCache(),this._networksProvider.fetchNetworks(bind(this,this._onNetworksFetched),bind(this,this._onGetNetworksFailure)),!1},_onErrorLinkClick:function(){return this._openUpsellWindow(!0),!1},_openUpsellWindow:function(e){var t="&view=popup&brand=onedrive&scenarios=status_publish,media_publish&biciid={0}&closenoredirect=true".format(this.isPublishVideoFlow?"onedrivePubVideo":"onedrivePubPhotos")+(e?"&authz=true":""),i=this._network.addLink+t;window.open(i,"addNetwork","width=720px,height=520px,status=no,toolbar=no,resizeable=yes,menubar=no,scrollbars=yes",!0)},_onNetworksFetched:function(e){if(this._network=this._networksProvider.findTargetNetwork(e,"FB"),t.viewParams.alturl||this._networksProvider.areRequiredNetworkOffersPresent(this._network,i))this.isPublishVideoFlow?this._enablePublishVideo():this._enableChooseAlbum();else if(this.isPolling){var r=this;this.setTimeout(function(){(new Date).getTime()<v?(r._networksProvider.clearCache(),r._networksProvider.fetchNetworks(bind(r,r._onNetworksFetched),bind(r,r._onGetNetworksFailure))):(r.isPolling=!1,r._updateBindings())},n)}},_enableChooseAlbum:function(){var e=this;e.showUpsell=!1,e.showChooseAlbum=!0,e.isPolling=!1,e.showLoading=!0,e._updateBindings(),e._facebookProvider.setNetwork(e._network),e._fetchAlbums()},_enablePublishVideo:function(){var t=this,i=t.items[0],n=i.video,r="",o=(n.width||1)/(n.height||1);n.duration>12e5?r=e("FacebookVideoTooLongError"):.5624>o||o>1.78?r=e("FacebookVideoBadAspectError"):i.size>1024e6&&(r=e("FacebookVideoTooLargeError")),r?(t.showErrorLink=!1,t.errorText=r,t.showError=!0):(t.showPublishVideo=!0,t.publishBtnDisabled=!1),t.showUpsell=!1,t.isPolling=!1,t._updateBindings(),t._facebookProvider.setNetwork(t._network)},_fetchAlbums:function(){var e=this;this._facebookProvider.getAlbums().then(function(t){e._unfilteredAlbums=t,e._albums=[];for(var i=0;i<t.length;i++){var n=t[i];if(n.can_upload||"app"!=n.type){var r=document.createElement("option");r.text=c.format(n.name||"",n.count||0),r.value=n.id,e.subElements.albumSelector.options.add(r),e._albums.push(n)}}e.isAlbumSelectorDisabled=!1,e.showLoading=!1,e._updateBindings()},function(t){e.showChooseAlbum=!1,e.showLoading=!1,e._onFacebookFailure(t)})},_publishToAlbum:function(e,t){var i=Date.now(),n=this;n._facebookProvider.addEmbeddedAuthUrlsToItems(n.items).then(function(t){wLive.Core.OperationManager.Current.execute("PublishToFacebook",{items:n.items,albumId:e,facebookProvider:n._facebookProvider})},bind(n,n._onFacebookFailure)),n.showMessage=!0,n.showChooseAlbum=!1,n.headerText=l,n.showPublishButton=!1,n.showError=!1,t&&(n.facebookUrl=t,n.publishingHtml=f.format(p.format(t))),n._updateBindings(),Qos.logData(g,"SkyDrive",i,null,null,null,Date.now())},_onFacebookFailure:function(e){this.showError=!0,this._updateBindings()},_onGetNetworksFailure:function(e){this.showError=!0,this._updateBindings()}}),defineSubClass("wLive.Controls.FacebookPane",SkyDrive.UI.NewControlAdapter,function(e,t,i,n){},{controlType:SkyDrive.UI.FacebookPane})}()}),define("facebookpane.html",["facebookpane"],function(){SkyDrive.UI.FacebookPane.prototype.onRenderHtml=function(){return"<"+this.baseTag+' id="'+htmlAttributeEncode(this.id+"_0")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="c-'+this.controlName+" "+this.baseClass+'"><h2 id="'+htmlAttributeEncode(this.id+"_1")+'" class="sd_header">'+htmlEncode(this.headerText)+'</h2><div id="'+htmlAttributeEncode(this.id+"_2")+'" style="'+generateStyleAttribute("display",this.showChooseAlbum)+'" class="sd_content"><h3 id="'+htmlAttributeEncode(this.id+"_3")+'" class="sd_subheader">'+this.chooseAlbumHtml+'</h3><div id="'+htmlAttributeEncode(this.id+"_4")+'" class="albumName sd_link_desc">'+htmlEncode(this.albumNameText)+'</div><select id="'+htmlAttributeEncode(this.id+"_5")+'" style="'+generateStyleAttribute("display.inlineblock",this.showAlbumSelector)+'" class="albumSelector"'+generateAttributesString("disabled",this.isAlbumSelectorDisabled)+'><option selected="true" disabled="true" id="'+htmlAttributeEncode(this.id+"_6")+'">'+htmlEncode(this.albumNamePlaceholderText)+'</option><option value="create" id="'+htmlAttributeEncode(this.id+"_7")+'">'+htmlEncode(this.createNewAlbumText)+'</option></select><div id="'+htmlAttributeEncode(this.id+"_8")+'" style="'+generateStyleAttribute("display",this.showNewAlbumOptions)+'"><input type="text" id="'+htmlAttributeEncode(this.id+"_9")+'" class="albumNameField"></input><textarea id="'+htmlAttributeEncode(this.id+"_10")+'" class="albumNote"></textarea><div id="'+htmlAttributeEncode(this.id+"_11")+'" class="sd_link_desc">'+htmlEncode(this.shareWithText)+'</div><select id="'+htmlAttributeEncode(this.id+"_12")+'" class="privacySelector"><option value="" id="'+htmlAttributeEncode(this.id+"_13")+'">'+htmlEncode(this.customOptionText)+'</option><option value="EVERYONE" id="'+htmlAttributeEncode(this.id+"_14")+'">'+htmlEncode(this.everyoneOptionText)+'</option><option value="ALL_FRIENDS" id="'+htmlAttributeEncode(this.id+"_15")+'">'+htmlEncode(this.allFriendsOptionText)+'</option><option value="SELF" id="'+htmlAttributeEncode(this.id+"_16")+'">'+htmlEncode(this.selfOptionText)+'</option></select></div></div><div id="'+htmlAttributeEncode(this.id+"_17")+'" style="'+generateStyleAttribute("display",this.showPublishVideo)+'" class="sd_content"><h3 id="'+htmlAttributeEncode(this.id+"_18")+'" class="sd_subheader">'+this.publishVideoHtml+'</h3><textarea id="'+htmlAttributeEncode(this.id+"_19")+'" class="videoNote"></textarea></div><div id="'+htmlAttributeEncode(this.id+"_20")+'" style="'+generateStyleAttribute("display",this.showMessage)+'"><h3 id="'+htmlAttributeEncode(this.id+"_21")+'" class="sd_subheader">'+this.publishingHtml+'</h3></div><div id="'+htmlAttributeEncode(this.id+"_22")+'" style="'+generateStyleAttribute("display",this.showUpsell)+'"><a href="#" id="'+htmlAttributeEncode(this.id+"_23")+'">'+htmlEncode(this.upsellText)+'</a></div><div id="'+htmlAttributeEncode(this.id+"_24")+'" style="'+generateStyleAttribute("display.inlineblock",this.showLoading)+'" class="sd_loading">'+this.loadingHtml+'</div><div id="'+htmlAttributeEncode(this.id+"_25")+'" style="'+generateStyleAttribute("display.inlineblock",this.showError)+'" class="sd_error'+generateClassAttribute("topError",this.isPublishVideoFlow)+'"><span id="'+htmlAttributeEncode(this.id+"_26")+'">'+htmlEncode(this.errorText)+'</span><a href="#" id="'+htmlAttributeEncode(this.id+"_27")+'" style="'+generateStyleAttribute("display.inlineblock",this.showErrorLink)+'">'+htmlEncode(this.errorLinkText)+'</a></div><div class="sd_btns"><input type="button" id="'+htmlAttributeEncode(this.id+"_28")+'" style="'+generateStyleAttribute("display.inlineblock",this.showPublishButton)+'" class="default"'+generateAttributesString("value",this.publishBtnText,"disabled",this.publishBtnDisabled)+'></input><input type="button" id="'+htmlAttributeEncode(this.id+"_29")+'" class="sd_cancel"'+generateAttributesString("value",this.cancelBtnText)+"></input></div></"+this.baseTag+">"},processAnnotations(SkyDrive.UI.FacebookPane,[{id:0},{id:1,attr:["text","headerText"]},{id:2,css:["display","showChooseAlbum"]},{id:3,attr:["html","chooseAlbumHtml"]},{id:4,attr:["text","albumNameText"]},{id:5,css:["display.inlineBlock","showAlbumSelector"],attr:["disabled","isAlbumSelectorDisabled"],childId:"albumSelector",userActions:{change:"_onSelectedAlbumChange"}},{id:6,attr:["text","albumNamePlaceholderText"]},{id:7,attr:["text","createNewAlbumText"]},{id:8,css:["display","showNewAlbumOptions"]},{id:9,childId:"albumNameField",userActions:{change:"_onAlbumNameChange",keydown:"_onAlbumNameChange"}},{id:10,childId:"albumNote"},{id:11,attr:["text","shareWithText"]},{id:12,childId:"privacySelector"},{id:13,attr:["text","customOptionText"]},{id:14,attr:["text","everyoneOptionText"]},{id:15,attr:["text","allFriendsOptionText"]},{id:16,attr:["text","selfOptionText"]},{id:17,css:["display","showPublishVideo"]},{id:18,attr:["html","publishVideoHtml"]},{id:19,childId:"videoNote"},{id:20,css:["display","showMessage"]},{id:21,attr:["html","publishingHtml"]},{id:22,css:["display","showUpsell"]},{id:23,attr:["text","upsellText"],childId:"upsellLink",userActions:{click:"_onUpsellLinkClick"}},{id:24,css:["display.inlineBlock","showLoading"],attr:["html","loadingHtml"],childId:"loading"},{id:25,css:["display.inlineBlock","showError"],className:["topError","isPublishVideoFlow"]},{id:26,attr:["text","errorText"]},{id:27,css:["display.inlineBlock","showErrorLink"],attr:["text","errorLinkText"],childId:"errUpsellLink",userActions:{click:"_onErrorLinkClick"}},{id:28,css:["display.inlineBlock","showPublishButton"],attr:["value","publishBtnText","disabled","publishBtnDisabled"],childId:"publishBtn",userActions:{click:"_onPublishClick"}},{id:29,attr:["value","cancelBtnText"]}],[],{})}),define("linkpane",["facebookpane.html"],function(){!function(){function e(e,C,b,k,S,_,I,x,D){function E(e){if(!ee){for(var t=0;t<e.length;t++){var i=e[t];i&&i.id&&le.push(i.id)}for(de=!0,t=0;t<ie.length;t++)ie[t]()}}function P(e){de?e():ie.push(e)}function T(e){void 0!==e&&null!==e&&q.val(e),I.hideLoading(),X&&U(a.View,X),Y&&U(a.Edit,Y),Z&&U(s,Z),B(),"function"==typeof I.updateLayout&&I.updateLayout()}function A(){oe[a.View]=L(n("Sharing.ViewLinkTitle"),"$Sutra.SkyDrive.ViewLink"),se[a.View]=N(a.View,n("Sharing.ViewLinkTitle"),"$Sutra.SkyDrive.LinkSectionNewLinkOptionView"),ae[a.View]=M(a.View,n("Sharing.ViewLinkDescription"),"$Sutra.SkyDrive.LinkSectionNewLinkDescriptionView"),oe[a.Edit]=L(n("Sharing.EditLinkTitle"),"$Sutra.SkyDrive.EditLink"),k&&k.isAlbum||(se[a.Edit]=N(a.Edit,n("Sharing.EditLinkTitle"),"$Sutra.SkyDrive.LinkSectionNewLinkOptionEdit"),ae[a.Edit]=M(a.Edit,n("Sharing.EditLinkDescription"),"$Sutra.SkyDrive.LinkSectionNewLinkDescriptionEdit")),oe[s]=L(n("Sharing.PublicViewLinkTitle"),"$Sutra.SkyDrive.PublicLink")}function L(e,t){var i=jQuery('<div class="sd_link_container"></div>'),n=jQuery('<div class="sd_link_title"></div>').text(e);return i.append(n),i.hide(),sutra(i,t),sutra(n,"$Sutra.SkyDrive.LinkSectionTitle"),Q.append(i),i}function F(){$=jQuery(w),V=jQuery("#sd_new_link_toggle",$),G=jQuery("#sd_new_link_select",$),q=jQuery("select",$),z=jQuery(".sd_link_type_descriptions",$),K=jQuery(".sd_new_link_loading",$),J=jQuery("input.sd_link_choose",$);var t=jQuery("a",V),i=new JBase.UI.ImageTile,r=jQuery("#sd_new_link_toggle_text",t),o=jQuery("#sd_new_link_toggle_icon",t);jQuery("label",G).text(n("Sharing.CreateLinkSelectLabel")),i.setDataContext(u),o.html(i.renderHtml()),r.text(n("Sharing.CreateAdditionalLink")),t.click(function(e){e.preventDefault(),V.hide(),G.show(),q.focus()}),J.val(n("Sharing.CreateLink")),J.click(function(e){e.preventDefault(),J.attr("disabled","disabled"),W(parseInt(q.val(),10))}),q.change(function(e){jQuery(".sd_option_description",z).hide(),jQuery("#sd_option_description"+q.val()).show()}),$.hide(),e.append($),i.activate(),sutra(z,"$Sutra.SkyDrive.LinkSectionDescriptions"),sutra(J,"$Sutra.SkyDrive.LinkCreateLinkButton"),sutra(q,"$Sutra.SkyDrive.LinkSectionNewLinkSelect"),sutra(t,"$Sutra.SkyDrive.LinkSectionNewLinkToggle")}function M(e,t,i){var n=jQuery("<div />");return n.attr("id","sd_option_description"+e),n.addClass("sd_option_description"),n.text(t),sutra(n,i),z.append(n),n}function N(e,t,i){var n=jQuery("<option />");return n.text(t),n.val(e),sutra(n,i),q.append(n),n}function U(e,t){if(t){ae[e]&&ae[e].remove(),se[e]&&se[e].remove();var i;if(t.link)i=t.link;else{var n="";!k||_&&_!=k.id||!k.photo&&!k.video||(n="&v="+r.ViewType.Self),i=FilesConfig.sharingBaseUrl+"?resid="+(_||k.id)+n}var o=new SkyDrive.UI.SharingLink;o.setDataContext({shortenEnabled:FilesConfig.urlShorteningEnabled,url:i,isReadOnly:!p,shortenAction:H,entity:t}),ue.push(o);var a=function(){o.setDataContext({networks:le})};P(a);var s=oe[e],l=ce("div");if(s[0].appendChild(l),setHtml(l,o.renderHtml()),s.append(l),s.show(),o.activate(),he){var d={itemCount:I.getItemCount(),type:e};Qos.logData(g,y,ne,null,null,d,Date.now()),he=!1}}}function R(e,i){if(!ee){for(var n=i.permissionScopes,r=0;r<n.length;r++){var a=n[r],s=t.StringHelpers.caseInsensitiveStringEquals(a.id,e.id);if(s)for(var l=a.entities,d=0;d<l.length;d++){var u=l[d];u.type==o.EntityType.Link?u.linkType==o.LinkType.View?X=u:u.linkType==o.LinkType.Edit&&(Y=u):u.type==o.EntityType.Public&&(Z=u)}}T(h[i.defaultPermissionsLevel])}}function O(t,i){if(!ee){I.hideLoading();var r=jQuery("<div></div>");e.append(r);var o=new wLive.Controls.InlineError(r,n("Sharing.GetPermissionsError"));o.render()}}function B(){var e=0;X&&e++,Y&&e++,0===e?(V.hide(),G.show(),q.focus()):2>e&&!k.isAlbum?(V.show(),G.hide()):(V.hide(),G.hide()),$.show(),q.change()}function H(e,i,n,r){var a=Date.now(),s={id:_||k.id};e.type==d.Public?s.type=o.EntityType.Public:e.role==l.View?(s.type=o.EntityType.Link,s.linkType=o.LinkType.View):e.role==l.Edit?(s.type=o.EntityType.Link,s.linkType=o.LinkType.Edit):(s.type=o.EntityType.Link,s.linkType=e.linkType),s.cid=k.ownerCid,t.SkyDriveItemHelper.isGroupItem(k)&&(s.group=k.group);var u=FilesConfig.baseApiUrl+"Shorten?"+$Utility.serialize(s),c=new t.DataRequest(u,u,null,function(e){var t=e.url;n(t),i.select();var r={type:s.type,linkType:s.linkType};Qos.logData(v,y,a,null,null,r,Date.now())},function(e){e.error.code==m&&I.renderPermissionsList(k,S,{skipCache:!0},D),j(e.error.message)});c.apiId="SkyDrive_Json_ShortenUrl",c.propertyId="SkyDrive",c.start()}function j(e){if(te.empty(),e){var t=new i.InlineError(te,e);t.render(),te.show()}else te.hide()}function W(e){function r(e,t,i,n){i==s?C.makePublic(e,t,n,o,l):C.createLink(e,t,i,n,o,l)}function o(t,i){ee||(k=k||t,K.empty(),J.removeAttr("disabled"),e===a.View?X=i:e===a.Edit?Y=i:e===s&&(void 0!==_&&null!==_||void 0!==k&&null!==k||(_=t.id),Z=i),U(e,i),B(),I.updateUIWithNewPermission(t,i))}function l(e,t){if(!ee){K.empty(),J.removeAttr("disabled");var i;switch(t.code){case f:i=n("Sharing.SharingBlockedLinkGenerationError");break;default:i=t.message?t.message:n("Sharing.LinkGenerationError")}j(i)}}ne=Date.now(),he=!0;var d=new i.LoadingSpinner(K,"");if(d.render(),sutra(d,"$Sutra.SkyDrive.LoadingSpinner"),j(null),k)r(k,null,e,null);else{var u={bundleName:I.getBundleName()};D?r(null,D,e,u):t.ViewContext.getInstance().selectionManager.getSelectedItems(function(t){r(null,t,e,u)})}}var Q,$,V,q,G,z,K,J,X,Y,Z,ee,te,ie,ne,re=this,oe={},ae={},se={},le=[],de=!1,ue=[],he=!1,pe=S||D,me=S&&S.selectionCount||D&&D.length;re.render=function(t){var i;if(pe)i=n("Sharing.GetLinkHeaderFormatNoQuotations").format(me);else if(k&&k.photo)i=n("Sharing.GetLinkHeaderSingularPhoto");else{var r=k&&k.extension;i=n("Sharing.GetLinkHeaderFormat").format(I.getName()+(r?r:""))}sutra(e,"$Sutra.SkyDrive.ShareDialogLinkPane");var o=jQuery('<h2 class="sd_header"></h2>').text(i);e.append(o);var a=jQuery('<h3 class="sd_subheader"></h3>').text(n("Sharing.GetLinkSubtitle"));e.append(a),Q=jQuery('<div class="sd_link_sections"></div>'),sutra(Q,"$Sutra.SkyDrive.LinkSections"),e.append(Q),k&&!C.hasCachedData(k)&&I.showLoading(),F(),A(),$buffer=jQuery('<div class="sd_buffer_bottom"></div>'),e.append($buffer),te=jQuery('<div class="sd_error"></div>'),e.append(te);var s=jQuery('<div class="sd_btns"></div>');e.append(s);var l=jQuery('<input class="sd_cancel" type="button" />');l.val(n("Sharing.Close")),s.append(l),sutra(l,"$Sutra.SkyDrive.LinkPaneCancel"),ie=[],pe?T(h[c]):k&&C.fetchPermissions(k,R,O),b.fetchNetworks(E)},re.dispose=function(){ee=!0;for(var e=0;e<ue.length;e++)ue[e].dispose()}}var t=wLive.Core,i=wLive.Controls,n=t.AleHelpers.getPCString,r=t.JSONConstants,o=t.PermissionsProvider,a=o.Role,s=(t.ImageStrip,0),l=o.Role,d=(o.GroupRole,o.EntityType),u=(o.LinkType,JBase.UI.ImageStripHelper.getImageInfo("add")),c="view",h={"public":s,view:a.View,edit:a.Edit},p=(n("Sharing.EmbedInstructions"),n("Sharing.Saving"),$B.SF_iPhone&&!$B.Mobile),m=3e3,f=9006,g="SkyDriveWeb_Internal_Control_LinkPane_CreateLink",v="SkyDriveWeb_Internal_Control_LinkPane_ShortenLink",y="SkyDrive",w='<div class="sd_new_link"><div id="sd_new_link_toggle"><a href="#" role="button"><div id="sd_new_link_toggle_icon"></div><div id="sd_new_link_toggle_text"></div></a></div><form id="sd_new_link_select"><label for="sd_link_type"></label><select class="sd_link_type" id="sd_link_type" aria-controls="sd_link_type_descriptions"></select><div class="sd_link_type_descriptions" id="sd_link_type_descriptions" aria-live="polite"></div><div class="sd_link_choose_wrapper"><div class="sd_link_choose_button"><input class="sd_link_choose sd_focusable default" type="button" /></div><div class="sd_new_link_loading"></div><div class="c_clr"></div></div></form></div>';i.LinkPane=e,window.wLive.Core.ShortenResponse=function(){},window.wLive.Core.ShortenResponse.prototype={url:""}}()}),define("networkpane",["linkpane"],function(){!function(){function e(e,h,p,m,f,g){function v(){var e=[];for(var i in $)e.push($[i]);g.showLoading(n("Sharing.PostingFormat").format(g.getName())),g.disableMenuTabs();var r=N.prop("checked")?t.PermissionsProvider.Role.Edit:t.PermissionsProvider.Role.View,o=B.val();if(o=o==d?null:o,U.empty(),U.hide(),m)h.shareToNetworks(m,null,e,r,o,null,w,y);else{var a=t.PageController.getInstance().getViewContext();a.selectionManager.getSelectedItems(function(t){h.shareToNetworks(null,t,e,r,o,{bundleName:g.getBundleName()},w,y)})}}function y(e,t,a){if(!j){var s=t.message,l=!1;if(a){for(var d,u=0,h=0,p=0;p<a.length;p++){var m=a[p],f=m.entity;if(m.status&&m.status!=r){if(u++,m.errorCode&&m.errorCode==o)for(var v=0;v<L.length;v++){var y=L[v];if(y.id==f.linkName){var w=m.uniqueError;if(d=w.message,l=!0,y.status=c.Error,w&&w.data){var C=Object.fromJSON(w.data);y.connectLink=C.url}delete $[f.linkName],Q--;break}}}else h++,delete $[f.linkName],Q--}s=d?d:0==h?n("Sharing.PostErrorAllFailed"):n("Sharing.PostErrorSomeFailed").format(u)}D(),k();var b=new i.InlineError(U,s,l);b.render(),U.show(),g.hideLoading(),g.enableMenuTabs()}}function w(e,t){j||g.onShareSuccessCallback(e,t)}function C(e){if(!j){g.hideLoading(),L=p.getConnectedNetworks(e);var t,i=p.getUpsellNetworks(e);if(0==L.length){var r=n("Sharing.NoneConnectedUpsellFormat").format('<a class="c_ml" href="#" onclick="return false;">',"</a>"),o=jQuery('<span class="sd_net_upsell"></span>').html(r);sutra(o,"$Sutra.SkyDrive.NetworkPaneNoNetworksUpsell"),t=jQuery("a",o),F.append(o)}else{M=jQuery('<ul class="sd_post_netlist"></ul>'),sutra(M,"$Sutra.SkyDrive.NetworkIcons"),k(),F.append(M);var a=jQuery('<div class="sd_post_uplink"></div>');i.length>0?(t=jQuery('<a class="c_ml" href="#" onclick="return false;"></a>').text(n("Sharing.ConnectMenu")),t.append(jQuery('<span class="c_chev">&nbsp;&#9660;</span>'))):(t=jQuery('<a class="c_ml" target="_blank"></a>').text(n("Sharing.ManageMyServices")),t.attr("href",FilesConfig.manageServicesUrl),t.bind(u,b)),a.append(t),F.append(a),F.append('<div class="c_clr"></div>')}if(i.length>0){var s=E(i);F.append(s),sutra(t,"$Sutra.SkyDrive.NetworkPaneConnectMenuLink"),sutra(s,"$Sutra.SkyDrive.NetworkPaneConnectMenu");var l=0;t.click(function(e){l||$menu.create(e,1,{menuEl:s[0]}),l=1})}D(),B.focus(),"function"==typeof g.updateLayout&&g.updateLayout()}}function b(){p.clearCache(),g.close()}function k(){M.empty();for(var e=L.length,t=Math.min(a,e),i=0;t>i;i++){var n=L[i],r=S(n);M.append(r)}M.append('<div class="c_clr"></div>')}function S(e){var t=jQuery('<li class="sd_post_netop"></li>'),i=jQuery('<input type="checkbox" />'),r=jQuery("<label></label>"),o=jQuery("<img />");o.attr("alt",e.name),o.attr("src",e.iconSmall);var a="sd_net_box_"+e.id;if(e.status==c.Error){i.prop("disabled",!0);var s=n("Sharing.NetworkErrorTooltipFormat").format(e.name);o=jQuery('<a target="_blank" href="#" title="'+s.encodeHtmlAttribute()+'"></a>').append(o),o.bind(u,{msg:e.connectLink?e.connectLink:FilesConfig.manageServicesUrl},T)}else $[e.id]&&i.prop("checked",!0);return i.attr("id",a),r.attr("for",a),r.append(o),t.append(i),t.append(r),sutra(i,"$Sutra.SkyDrive.NetworkIcon"+e.id),i.click(function(){i.prop("checked")?$[e.id]||($[e.id]=e,Q++):$[e.id]&&(delete $[e.id],Q--),D(),_(),I(),x()}),t}function _(){var e=-1;for(var t in $){var i=$[t].postMax;(-1==e||e>i)&&(e=i)}V=e}function I(){q=0;for(var e in $){var t=$[e].shortLinkLimit;t&&t>q&&(q=t)}}function x(){var e=B.val().length+q;V>0?(e>V-l&&(H.show(),sutra(H,"$Sutra.SkyDrive.CharacterCounter")),e>V?(H.addClass("char_cnt_error"),R.prop("disabled",!0),sutra(H,"$Sutra.SkyDrive.CharacterCounterError")):(H.removeClass("char_cnt_error"),R.prop("disabled",!1),sutra(H,"$Sutra.SkyDrive.CharacterCounter")),H.text(n("Sharing.NetworkCharacterCounterFormat").format(e,V))):(unsutra(H),H.hide())}function D(){var e=0==Q;R.prop("disabled",e)}function E(e){for(var t=Math.min(s,e.length),i=jQuery('<ul class="c_m t_hovl"></ul>'),r=0;t>r;r++){var o=e[r],a=jQuery('<li class="sd_post_upsell"></li>'),l=jQuery('<a href="#" target="_blank"></a>'),d=jQuery('<img class="sd_post_upicon" />');d.attr("alt",o.name),d.attr("src",o.iconSmall),l.bind(u,{msg:o.addLink},P),l.append(d),l.append(jQuery("<span></span>").text(o.name)),a.append(l),i.append(a)}var c=jQuery('<a target="_blank"></a>').text(n("Sharing.FindMoreServices")),h=jQuery('<a target="_blank"></a>').text(n("Sharing.ManageMyServices"));return c.attr("href",FilesConfig.findServicesUrl),c.bind(u,b),h.attr("href",FilesConfig.manageServicesUrl),h.bind(u,b),e.length>0&&i.append('<li class="c_ms"></li>'),i.append(jQuery("<li></li>").append(c)),i.append(jQuery("<li></li>").append(h)),i}function P(e){var t=e.data.msg+"&view=popup&brand=skydrive&scenarios=status_publish&biciid=skydrivepub&closenoredirect=true";return window.open(t,"addNetwork","width=720px,height=520px,status=no,toolbar=no,resizeable=yes,menubar=no,scrollbars=yes",!0),b(),!1}function T(e){var t=e.data.msg;return window.open(t,"fixNetwork","width=450px,height=525px,status=no,toolbar=no,resizeable=yes,menubar=no,scrollbars=yes",!0),b(),!1}function A(t){if(!j){g.hideLoading(),e.empty();var n=new i.InlineError(e,t.message);n.render()}}var L,F,M,N,U,R,O,B,H,j,W=this,Q=0,$={},V=-1,q=23;W.render=function(t){var r;if(f)r=n("Sharing.NetworkPostHeaderFormatNoQuotations").format(f.selectionCount);else{var o=m&&m.extension;r=n("Sharing.NetworkPostHeaderFormat").format(g.getName()+(o?o:""))}sutra(e,"$Sutra.SkyDrive.ShareDialogNetworkPane");var a=jQuery('<h2 class="sd_header"></h2>').text(r);sutra(a,"$Sutra.SkyDrive.NetworkPaneHeader"),U=jQuery('<div class="sd_post_error"></div>'),U.hide(),F=jQuery('<div class="sd_net_line"></div>');var s=jQuery('<div class="sd_message_cntr"><textarea class="sd_post_message"></textarea><div class="sd_char_cntr"></div></div>');B=s.find(".sd_post_message"),H=s.find(".sd_char_cntr");var l=new i.PlaceholderInput(B,d);l.render(),sutra(B,"$Sutra.SkyDrive.NetworkPaneMessageInput"),B.bind("keyup",function(){x()}),t&&B.val(t);var u=jQuery('<div class="sd_post_can_edit"><input id="sd_post_can_edit" type="checkbox" /><label for="sd_post_can_edit"></label></div>');N=jQuery("input",u),jQuery("label",u).text(n("Sharing.RecipientsCanEdit")),sutra(N,"$Sutra.SkyDrive.NetworkPaneRecipientsCanEdit"),
R=jQuery('<input class="sd_post_share default" type="button" />'),R.val(n("Sharing.Post")),R.click(v),sutra(R,"$Sutra.SkyDrive.NetworkPanePost"),O=jQuery('<input class="sd_cancel" type="button" />'),O.val(n("Sharing.Close"));var c=jQuery("<form></form>");c.append(F),c.append(s),c.append(u),c.append(U);var h=jQuery('<div class="sd_btns"></div>');c.append(h),h.append(R),h.append(O),sutra(O,"$Sutra.SkyDrive.NetworkPaneCancel"),e.append(a),e.append(c),g.showLoading(),p.fetchNetworks(C,A)},W.getUserMessage=function(){var e=B&&B.val();return e&&e!=d?e:""},W.dispose=function(){B.unbind("keyup"),j=!0}}var t=wLive.Core,i=wLive.Controls,n=t.AleHelpers.getPCString,r=0,o=3101,a=5,s=5,l=30,d=n("Sharing.PersonalMessagePlaceholder"),u="click",c=t.NetworksProvider.Status;i.NetworkPane=e}()}),define("permissionpane",["networkpane"],function(){!function(){function e(e,w,C,b,k,S,_,I,x,D,E,P,T){function A(e){var t=_.type==c.GroupOwned?u:d;ie=new Shared.UI.Menu;var i=[],o="";_.role==t.Edit?(o=n("Sharing.CanEdit"),i.push(new Shared.UI.NavItemDataContext({text:n("Sharing.ChangeToView"),isSelected:!1,click:function(){return ie.hide(),R(t.View),!1}}))):re&&_.role==d.CoOwner?o=r("GF.Sharing.CoOwner"):(o=n("Sharing.CanView"),b&&b.isAlbum||i.push(new Shared.UI.NavItemDataContext({text:n("Sharing.ChangeToEdit"),isSelected:!1,click:function(){return ie.hide(),R(t.Edit),!1}}))),i.push(new Shared.UI.NavItemDataContext({text:n("Sharing.StopSharing"),isSelected:!1,click:function(){return ie.hide(),H(),!1}}));var a=new Shared.UI.NavItemDataContext({text:o,childItems:i});ie.setDataContext(a),e.html(ie.renderHtml()),ie.activate()}function L(){if(!Z){var i=D||P.getName(),a=jQuery(".sd_header",e);a.text(i);var s=jQuery(".sd_header_sec",e),p=jQuery(".sd_subheader",e),m=jQuery(".sd_entity_name",e),f=jQuery(".sd_email",e),g=jQuery(".sd_perm_perms",e),w=jQuery(".sd_perm_menu",e);z=jQuery(".sd_perm_remove",e),ee=jQuery(".sd_ic",e);var C=jQuery(".sd_link_title",e),k="";if(C.hide(),p.hide(),f.hide(),m.hide(),s.hide(),_){var x=_.type==c.Public||_.type==c.Link&&!(_.linkType==h.Network),T=x?s:m,L=_.name;L?T.text(L):b.group&&T.text(n("Sharing.GroupMembersHeader"));var U=_.email;if(U&&L!=U&&(f.text(U.toLowerCase()),f.show()),T.show(),_.type==c.Facebook&&(p.text(n("Sharing.FacebookFriendSubheader")),p.show()),J=jQuery(".sd_perm_error",e),te=jQuery(".sd_perm_edit_spinner",e),te.hide(),o.renderTileForEntity(_,ee,80,M,o.icSize.XLarge,!1),X=jQuery("#sd_perm_perms",g),re&&_.role==d.CoOwner?(jQuery("label",g).text(r("GF.Sharing.CoOwner")),X.attr("checked",!0),X.attr("disabled",!0)):jQuery("label",g).text(n("Sharing.CanEdit")),_.type==c.GroupOwned&&_.role==u.Edit||_.type!=c.GroupOwned&&_.role==d.Edit?(X.attr("checked",!0),k=n("Sharing.CanEdit")):k=_.role==d.CoOwner?r("GF.Sharing.CoOwner"):n(_.role==d.Owner?"Sharing.Owner":"Sharing.CanView"),I&&_.role!=d.Owner&&!x){A(w),z.hide(),g.hide();var O=new wLive.Controls.LoadingSpinner(te,y);O.render()}else if(I&&_.role!=d.Owner&&x){z.val(n("Sharing.RemoveLink")),z.click(H),X.change(R);var B=new wLive.Controls.LoadingSpinner(te,y);B.render()}else z.hide(),g.hide(),w.text(k);if(b.group&&z.hide(),(x||_.role==d.Owner)&&g.hide(),F()&&(E.canChange===!1?p.text(n("Sharing.NoAccess")):Q(p,n(x?"Sharing.PermissionsPaneRedirect":"Sharing.PermissionsPaneRedirectForPerson")),p.show()),x){ee.hide(),Y=jQuery(".sd_perm_link",e),C.show().text(N());var j=S.actionManager.getAction("Share",b);if(_.linkType==h.Embed){var W=S.actionManager.getAction("Embed",b);if(W){var V=t.ActionManager.setATagAction(W,null,"ShareDialog",function(e,t){return P.close(),t()});V.text(v),sutra(V,"$Sutra.SkyDrive.EmbedCommand"),Y.append(V)}else Y.text(n("Sharing.EmbedVisitor"))}else F()?(T.hide(),w.text(""),$(_,Y,!1,null)):j&&$(_,Y,!0,null)}}else{var q=FilesConfig.hcid,G=!b||q==b.ownerCid||l.isOwnerOrCoOwner(b)||S.isSuper;if(G){var ie=n(de||b&&b.isBundle?"Sharing.MultipleFilesPrivate":b.folder?"Sharing.PrivateFolder":"Sharing.PrivateFile");s.text(ie)}ee.hide(),g.hide(),z.hide()}K=jQuery(".sd_done",e),K.val(n("Sharing.Close")),K.click(P.close),sutra(a,"$Sutra.SkyDrive.PermissionPaneHeader"),sutra(z,"$Sutra.SkyDrive.PermissionPaneRemove"),sutra(g,"$Sutra.SkyDrive.PermissionPaneRecipientsCanEdit"),sutra(K,"$Sutra.SkyDrive.PermissionPaneDone"),P.hideLoading(),"function"==typeof P.updateLayout&&P.updateLayout()}}function F(){return!t.StringHelpers.caseInsensitiveStringEquals(b.id,x)}function M(e,t){t?(ee.html(t.render()),t.activate()):o.loadDefaultIc(_,p,ee)}function N(){var e="";switch(_.type){case c.Email:case c.User:e=n(_.role==d.Owner?"Sharing.Owner":"Sharing.SharedByEmail");break;case c.Link:if(_.linkType==h.View)e=n("Sharing.ViewLinkTitle");else if(_.linkType==h.Edit)e=n("Sharing.EditLinkTitle");else if(_.linkType==h.Network&&_.linkName){var t=P.getNetworkName(_.linkName);t&&(e=n("Sharing.SharedToNetwork").format(t))}break;case c.Public:e=n("Sharing.PublicViewLinkTitle");break;case c.Group:e=n("Sharing.SharedToGroup");break;case c.Friends:e=n("Sharing.SharedToFriends");break;case c.GroupOwned:default:e=""}return e}function U(e){if(J.empty(),e){var t=new i.InlineError(J,e);t.render(),J.show()}else J.hide()}function R(e){return U(),P.disableMenuTabs(),te.show(),_.role=e,J.empty(),J.hide(),w.updatePermissions(b,null,_,{suppressNotification:!0},t.PermissionsProvider.UserAction.Manage,O,B),!1}function O(){P.enableMenuTabs(),P.renderPermissionsList(b,k,null,T),P.selectPermission(_&&_.id)}function B(){te.hide(),_.role==d.Edit?(_.role=d.View,X.attr("checked",!1)):(_.role=d.Edit,X.attr("checked",!0)),P.enableMenuTabs(),U(n("Sharing.EditPermissionsFailure"))}function H(){U(),P.disableMenuTabs(),J.empty(),J.hide(),w.deletePermission(b,_,j,W)}function j(){P.enableMenuTabs(),P.renderPermissionsList(b,k,null,T),P.selectPermission(_.id)}function W(){P.enableMenuTabs(),U(n("Sharing.EditPermissionsFailure"))}function Q(e,t){var i=function(){P&&P.close()},n=o.buildScopeLinkHeader(S,E,b,t,"","",i);e.html(n)}function $(e,t,n,r){if(r){var o=new i.InlineError(t,r);o.render()}var s;if(e.link)s=e.link;else{var l="";x&&x!=b.id||!b.photo&&!b.video||(l="&v="+a.ViewType.Self),s=FilesConfig.sharingBaseUrl+"?resid="+(x||b.id)+l}var d=jQuery(".sd_perm_link_url",t),u={url:s,disabled:!n,shortenEnabled:FilesConfig.urlShorteningEnabled&&n,shortenAction:V,entity:e,isReadOnly:!m};ne=new SkyDrive.UI.SharingLink,ne.setDataContext(u);var c=function(){ne.setDataContext({networks:oe})};G(c),setHtml(d.get(0),ne.renderHtml()),ne.activate()}function V(e,i,n,r){var o={id:x||b.id};e.type==c.Public?o.type=s.EntityType.Public:e.role==d.View?(o.type=s.EntityType.Link,o.linkType=s.LinkType.View):e.role==d.Edit?(o.type=s.EntityType.Link,o.linkType=s.LinkType.Edit):(o.type=s.EntityType.Link,o.linkType=e.linkType),o.cid=b.ownerCid,t.SkyDriveItemHelper.isGroupItem(b)&&(o.group=b.group);var a=FilesConfig.baseApiUrl+"Shorten?"+$Utility.serialize(o),l=new t.DataRequest(a,a,null,function(e){var t=e.url;n(t),i.select()},function(e){e.error.code==f&&P.renderPermissionsList(b,k,{skipCache:!0},T),U(e.error.message)});l.apiId="SkyDrive_Json_ShortenUrl",l.propertyId="SkyDrive",l.start()}function q(e){if(!Z){for(var t=0;t<e.length;t++){var i=e[t];i&&i.id&&oe.push(i.id)}for(ae=!0,t=0;t<se.length;t++)se[t]()}}function G(e){ae?e():se.push(e)}var z,K,J,X,Y,Z,ee,te,ie,ne,re=FilesConfig.isUserInGfRamp&&b&&b.folder,oe=[],ae=!1,se=[],le=this,de=k||T;k&&k.selectionCount||T&&T.length;le.render=function(){sutra(e,"$Sutra.SkyDrive.ShareDialogPermissionPane"),e.html(g),L(),C.fetchNetworks(q)},le.dispose=function(){Z=!0,ne&&ne.dispose()}}var t=wLive.Core,i=wLive.Controls,n=t.AleHelpers.getPCString,r=t.AleHelpers.getSkyString,o=t.SharingHelper,a=t.JSONConstants,s=t.PermissionsProvider,l=t.SkyDriveItemHelper,d=s.Role,u=s.GroupRole,c=s.EntityType,h=s.LinkType,p="SharingDialogPermissionTemplate",m=$B.SF_iPhone&&!$B.Mobile,f=3e3,g='<h2 class="sd_header perm_header"></h2><div class="sd_header_sec"></div><div class="sd_subheader"></div><div class="sd_permission_redirect"></div><div class="sd_ic"></div><div class="sd_display_info"><div class="sd_entity_name"></div><div class="sd_email"></div><div class="sd_perm_menu"></div></div><form class="sd_permission_pane"><div class="sd_perm_perms"><input id="sd_perm_perms" type="checkbox" /><label for="sd_perm_perms"></label></div><div class="sd_perm_edit_spinner"></div><div class="sd_link_title"></div><div class="sd_perm_link"><span class="sd_perm_link_url"></span><span class="sd_perm_link_shorten"></span></div><div class="sd_perm_error"></div><div class="sd_btns"><input class="sd_perm_remove" type="button" /><input class="sd_done default" type="button" /></div></form>',v=n("Sharing.EmbedInstructions"),y=n("Sharing.Saving");i.PermissionPane=e}()}),define("bundleremovalpane",["permissionpane"],function(){!function(){var e=wLive.Core.AleHelpers.getPCString("Sharing.RemoveItemFromBundle"),t=wLive.Core.AleHelpers.getPCString("Sharing.RemoveItemFromBundleAction"),i=wLive.Core.AleHelpers.getPCString("Sharing.RemoveItemFromBundleNavigateToFolder"),n=wLive.Core.AleHelpers.getPCString("Sharing.RemoveItemFromBundleNavigateToFolderAction"),r=wLive.Core.AleHelpers.getString("LoadGenericError"),o=wLive.Core.AleHelpers.getPCString("Sharing.Close");defineSubClass("SkyDrive.UI.BundleRemovalPane",JBase.UI.BaseControl,function(){},{removeCopy:"",removeLinkText:t,showRemoveLink:!1,navigateCopy:"",navigateLinkText:n,navigateAction:null,navigateHref:"",showNavigateLink:!1,errorText:r,showError:!1,closeButtonText:o,title:"",scopeName:null,permissionsProvider:null,scope:null,sharingDialog:null,viewContext:null,onDataContextChanged:function(t){t.container&&(this.myContainer=t.container),t.item&&(this.item=t.item),t.scopeName&&(this.scopeName=t.scopeName),t.permissionsProvider&&(this.permissionsProvider=t.permissionsProvider),t.scope&&(this.scope=t.scope,this.removeCopy=e.format(this.scope.name),this.navigateCopy=i.format(this.scope.name)),t.sharingDialog&&(this.sharingDialog=t.sharingDialog),t.viewContext&&(this.viewContext=t.viewContext),this.title=this.calculateTitle(),this.calculateRemoveVsNavigate()},onClick:function(){return this.removeItem(),!1},onNavigateClick:function(){var e=function(){this.sharingDialog&&this.sharingDialog.close()};wLive.Core.SharingHelper.buildScopeLinkHeaderCallback(this.viewContext,this.scope,this.item,bind(this,e),!0)()},close:function(){},onActivate:function(e,t){},calculateTitle:function(){var e="";return e=this.item&&this.item.name?this.item.extension?this.item.name+this.item.extension:this.item.name:this.scopeName},calculateRemoveVsNavigate:function(){this.item&&this.scope&&(this.showRemoveLink=this.item.id==this.scope.refId,this.showNavigateLink=!this.showRemoveLink,this.showNavigateLink&&(this.navigateHref=wLive.Core.SharingHelper.buildScopeLinkHeaderHref(this.viewContext,this.scope,this.item,!0)))},removeItem:function(){this.sharingDialog&&this.sharingDialog.disableMenuTabs(),this.showError=!1,this._updateBindings(),this.permissionsProvider.updateBundle(this.scope,[this.item],wLive.Core.PermissionsProvider.BundleAction.Remove,bind(this,this.removeItemSuccess),bind(this,this.removeItemFailure))},removeItemSuccess:function(){this.sharingDialog&&this.sharingDialog.enableMenuTabs(),this.sharingDialog.renderPermissionsList(this.item,null,{skipCache:!0}),this.sharingDialog.selectPermission("0")},removeItemFailure:function(){this.sharingDialog&&this.sharingDialog.enableMenuTabs(),this.showError=!0,this._updateBindings()}})}()}),define("bundleremovalpane.html",["bundleremovalpane"],function(){SkyDrive.UI.BundleRemovalPane.prototype.onRenderHtml=function(){return"<"+this.baseTag+sutraAttribute("SkyDrive.ShareDialogBundleRemovalPane")+' id="'+htmlAttributeEncode(this.id+"_0")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="c-'+this.controlName+" "+this.baseClass+'"><h2 id="'+htmlAttributeEncode(this.id+"_1")+'" class="sd_header">'+htmlEncode(this.title)+'</h2><p><span id="'+htmlAttributeEncode(this.id+"_2")+'" style="'+generateStyleAttribute("display",this.showRemoveLink)+'"><span id="'+htmlAttributeEncode(this.id+"_3")+'">'+htmlEncode(this.removeCopy)+'</span>&nbsp;<a href="#"'+sutraAttribute("SkyDrive.BundleRemovalRemoveLink")+' id="'+htmlAttributeEncode(this.id+"_4")+'">'+htmlEncode(this.removeLinkText)+'</a>.</span><span id="'+htmlAttributeEncode(this.id+"_5")+'" style="'+generateStyleAttribute("display",this.showNavigateLink)+'"><span id="'+htmlAttributeEncode(this.id+"_6")+'">'+htmlEncode(this.navigateCopy)+"</span>&nbsp;<a"+sutraAttribute("SkyDrive.BundleRemovalNavigateLink")+' id="'+htmlAttributeEncode(this.id+"_7")+'"'+generateAttributesString("href",this.navigateHref)+">"+htmlEncode(this.navigateLinkText)+'</a>.</span></p><div id="'+htmlAttributeEncode(this.id+"_8")+'" style="'+generateStyleAttribute("display",this.showError)+'" class="sd_error">'+htmlEncode(this.errorText)+'</div><div class="sd_btns"><input type="button"'+sutraAttribute("SkyDrive.ShareDialogCloseButton")+' id="'+htmlAttributeEncode(this.id+"_9")+'" class="sd_cancel"'+generateAttributesString("value",this.closeButtonText)+"></input></div></"+this.baseTag+">"},processAnnotations(SkyDrive.UI.BundleRemovalPane,[{id:0},{id:1,attr:["text","title"]},{id:2,css:["display","showRemoveLink"],childId:"showRemoveLink"},{id:3,attr:["text","removeCopy"],childId:"removeCopy"},{id:4,attr:["text","removeLinkText"],childId:"bundleRemovalLink",userActions:{click:"onClick"}},{id:5,css:["display","showNavigateLink"],childId:"showNavigateLink"},{id:6,attr:["text","navigateCopy"],childId:"navigateCopy"},{id:7,attr:["text","navigateLinkText","href","navigateHref"],childId:"bundleNavigateLink",userActions:{click:"onNavigateClick"}},{id:8,css:["display","showError"],attr:["text","errorText"],childId:"removeError"},{id:9,attr:["value","closeButtonText"],childId:"closeButton",userActions:{click:"close"}}],[],{})}),define("sharedialog",["bundleremovalpane.html"],function(){!function(){function e(y,w,C,b,k,S,_,I,x){function D(e){C&&C.key===e.key&&(te.renderPermissionsList(C,b,W,x),te.selectPermission(U&&U.id))}function E(e){V.hasClass(le)||(T(e.data.controlsToSelect||e.data.selectedTab),U=e.data.entity,R=e.data.canChange,O=e.data.scope,B=e.data.scopeId,H=e.data.scopeName,te.setVisiblePane(u.Permission))}function P(e,t){V.hasClass(le)||(T(e),te.setVisiblePane(t))}function T(e){if(jQuery(".ips_entity",V).removeClass(de),J.removeClass(de),e){var t;if(e instanceof Array){if(0==e.length)return;for(var i=0;i<e.length;i++){var n=jQuery(e[i]).addClass(de);0==i&&(t=n)}}else t=jQuery(e).addClass(de);var r=t.position();if(r){var o=r.top,a=V.height(),s=V.scrollTop();o>a-d&&V.scrollTop(s+o-a+d)}}}function A(e){var i=e.which;return 27==i?(te.close(),!1):t.DomHelpers.isInputElement(jQuery(e.target))||37!=i&&38!=i&&39!=i&&40!=i?void 0:!1}function L(e){return e.replace("!","")}function F(){if(!Y){var e=jQuery("<span></span>");sutra(e,"$Sutra.SkyDrive.NetworkIcons");var t=ae._buildNetworkIcon("facebook");e.append(t.renderHtml()),K.append(e),t.activate()}}var M,N,U,R,O,B,H,j,W,Q,$,V,q,G,z,K,J,X,Y,Z,ee,te=this,ie=jQuery(k.dataModel),ne=_,re=u.Email,oe=new t.NetworksProvider,ae=new t.DirectNetworksProvider,se=!1,le="sd_menu_disabled",de="sd_menu_selected",ue=b||x,ce=b&&b.selectionCount||x&&x.length;I=I||{},I.selectedEntity&&(re=u.Permission,U=I.selectedEntity,R=I.selectedEntityCanChange,O=I.selectedEntityScope,B=I.selectedEntityScopeId,H=I.selectedEntityScopeName),te.render=function(){if(!se){var e=Date.now();se=!0;var r=jQuery(c);sutra(r,"$Sutra.SkyDrive.ShareDialog"),V=jQuery(".sd_menu",r),sutra(V,"$Sutra.SkyDrive.ShareDialogMenu"),_$shareSubheader=jQuery(".sd_menu_subheader",V).text(n("Sharing.Share")),q=jQuery(".sd_menu_sendemail",V).text(n("Sharing.SendMessage")).parent().click(function(){P(this,u.Email)}),G=jQuery(".sd_menu_getlink",V).text(n("Sharing.GetALink")).parent().click(function(){P(this,u.Link)}),z=jQuery(".sd_menu_postto",V).text(n("Sharing.PublishToLink")+" ").parent().parent().click(function(){P(this,u.Network)}),K=jQuery(".sd_menu_oh",z),J=jQuery(".sd_menu_tab",V),_$permissionsContainer=jQuery(".sd_menu_perms div",V),sutra(q,"$Sutra.SkyDrive.ShareDialogMenuEmailPaneTab"),sutra(G,"$Sutra.SkyDrive.ShareDialogMenuLinkPaneTab"),sutra(z,"$Sutra.SkyDrive.ShareDialogMenuNetworkPaneTab"),$=jQuery(".sd_loading",r),Q=jQuery(".sd_content",r),$.hide();var a=x||b;x?ee=x:b&&k.selectionManager.getSelectedItems(function(e){ee=e});var s=!1,d=ee||[C];te._itemCount=d.length,s?z.show():z.hide();var p=null,m=C&&k.actionManager.getAction("Share",C)||a;m||(J.hide(),_$shareSubheader.hide(),re=u.Permission,p=function(){te.selectPermission("0")}),r.bind(o,A),y.append(r),Qos.logData(h,v,e,null,null,{itemCount:te.getItemCount()},Date.now()),s&&F(),FilesConfig.managedAccount?(G.hide(),z.hide()):oe.fetchNetworks(function(e){j=e},null,l),U&&B&&(p=function(){var e=jQuery('.ips_entity[entityId="'+U.id+'"][scopeId="'+L(B)+'"]',V);T(e)}),W={hc:!0,dt:!1,ct:te},p&&(W.getPermissionsCallback=p),N=new wLive.Controls.SharingList(k,_$permissionsContainer,w,E,W),te.renderPermissionsList(C,b,W,x),ie.bind(t.DataModel.dataChangedEvent,D)}var f=function(e){M=e,"function"==typeof e.renderHtml&&"function"==typeof e.activate?(setHtml(Q[0],e.renderHtml()),Q.show(),e.activate()):e.render(re==u.Network?ee||[C]:X)};if(M&&M.dispose(),Q.empty(),re==u.Link)f(new i.LinkPane(Q,w,oe,C,b,B,te,ae,x));else if(re==u.Network)f(new i.FacebookPane(Q,k,oe,te));else if(re==u.Email)f(new i.EmailPane(Q,w,oe,C,b,te,x));else{var g=ue?te.getName():H;if(null!=O&&null!=O.allowedActions&&Array.prototype.indexOf.call(O.allowedActions,wLive.Core.PermissionsProvider.AllowedActions.Remove)>=0){var S=new SkyDrive.UI.BundleRemovalPane;S.setDataContext({permissionScope:O,item:C,scopeName:g,scope:O,sharingDialog:te,permissionsProvider:w,viewContext:k}),f(S)}else f(new i.PermissionPane(Q,w,oe,C,b,k,U,R,B,g,O,te,x))}},te.renderPermissionsList=function(e,t,i,n){i=i||{},i.quickRender=!0,N.render(e,t,i,n)},te.selectPermission=function(e,t){var i;if(e&&(t=t||C.id,i=jQuery('.ips_entity[entityId="'+e+'"][scopeId="'+L(t)+'"]',V)),i&&i.length>0)i.trigger(a);else{var n=jQuery(".ips_entity",V);n.length>0?jQuery(n[0]).trigger(a):(U=null,P(null,u.Permission))}},te.getNetworkName=function(e){var t;if(j)for(var i=0;i<j.length;i++){var n=j[i];if(n.id==e){t=n.name;break}}return t},te.setVisiblePane=function(t){if(t!=re||t==u.Permission){var i=M&&M.getUserMessage&&M.getUserMessage();X=void 0!==i?i:X,re=t,te.render(),t===e.Panes.Link&&T(G)}},te.updateLayout=function(){ne&&ne()},te.close=function(){if(Qos.start(p),M.dispose(),ie.unbind(t.DataModel.dataChangedEvent,D),S(),y.empty(),C&&C.isBundle&&!ue&&C.sharingLevelValue==s){var e=k.itemProvider.peekParent(C),i=new Object;if(i.deletionType=2,i.rootPathName=3,i.skipDialog=!0,t.OperationManager.Current.execute("Delete",{items:[C],targetItem:e,options:i,hideFromProcessWindow:C.isBundle}),e&&!e.isPlaceholder){e.invalidate(),e.expire();var n=k.actionManager;n.doAction(n.getAction("ViewItem",e))}}Y=!0,Qos.end()},te.showLoading=function(e){Qos.start(m),$.empty();var t=new wLive.Controls.LoadingSpinner($,e);t.render(),$.show(),Q.hide(),Qos.end()},te.hideLoading=function(){Qos.start(f),$.hide(),Q.show(),Qos.end()},te.enableMenuTabs=function(){V.removeClass(le)},te.disableMenuTabs=function(){V.addClass(le)},te.setItem=function(e){C=e},te.getName=function(){return Z||(Z=C&&C.name||ue&&n("Sharing.MessageShareHeaderItemCountFormat").format(ce)),Z},te.setNewPermissionName=function(){ue&&(Z=n("Sharing.MessageShareHeaderItemCountFormat").format(ce))},te.getBundleName=function(){var e="";if(ue){var t=b&&b.parent||k.currentItem,i="Items",o=n("Sharing.BundleNameShared"),a=new Date,s=a.getMonth()+1,l=n("Sharing.BundleNameDate").format(s,a.getDate(),a.getFullYear());if(ee){for(var d=!0,u=!0,c=0;c<ee.length;c++){var h=ee[c];if(h.photo&&!h.video)u=!1;else{if(!SkyDrive.FileTypeHelper.isOfficeDocument(h)){u=!1,d=!1;break}d=!1}}d?i="Photos":u&&(i="Documents")}!t||r.isRootItem(t)||t.isSpecialFolder||(o=n("Sharing.BundleNameFolderName").format(t.name,"{0}","{1}")),e=o.format(n("Sharing.BundleNameType"+i),l)}return e},te.updateUIWithNewPermission=function(e,t,i){if(te.hideLoading(),i){var n=i.shareStartDate;delete i.shareStartDate,Qos.logData(g,v,n,null,null,i,Date.now())}te.enableMenuTabs(),C&&C.sharingLevelValue==s&&(C.sharingLevelValue=0),C&&!e||te.setItem(e),te.renderPermissionsList(e,b,null,x)},te.onShareSuccessCallback=function(e,t,i){te.setNewPermissionName(),te.updateUIWithNewPermission(e,t,i),te.selectPermission(t&&t.id)},te.getItemCount=function(){return te._itemCount}}var t=wLive.Core,i=wLive.Controls,n=t.AleHelpers.getPCString,r=t.SkyDriveItemHelper,o="keydown",a="click",s=4,l=3e3,d=50,u={Email:1,Network:2,Link:3,Permission:4,BundleRemoval:5};e.Panes=u;var c='<div class="sd_pop_body"><ul class="sd_menu" role="menu"><div class="sd_menu_subheader"></div><li class="sd_menu_tab sd_menu_selected"><a href="#" role="menuitem" class="sd_menu_sendemail" onclick="return false"></a></li><li class="sd_menu_tab"><a href="#" role="menuitem" class="sd_menu_getlink" onclick="return false"></a></li><li class="sd_menu_tab"><span class="sd_menu_oh"><a href="#" role="menuitem" class="sd_menu_postto" onclick="return false"></a></span></li><div class="sd_menu_perms"><div></div></div></ul><div class="sd_scroll_wrapper"><div class="sd_contents"><div class="sd_loading"></div><div class="sd_content"></div></div></div><div class="c_clr"></div></div>',h="SkyDriveWeb_Internal_Control_ShareDialog_Render",p="SkyDriveWeb_Internal_Control_ShareDialog_Dispose",m="SkyDriveWeb_Internal_Control_ShareDialog_ShowLoading",f="SkyDriveWeb_Internal_Control_ShareDialog_HideLoading",g="SkyDriveWeb_Internal_Control_EmailPane_Share",v="SkyDrive";i.ShareDialog=e,$Do.register("wLive.Controls.ShareDialog")}()}),define("msanotificationcontroller",["jquery-1.7.2","alehelpers","browserstorage","do","modaldialog","postmessagehandler","setup"],function(){!function(){function e(e,t){var i=d[e.toLowerCase()];return i||(i=d["en-us"]),i}function t(t){function i(){if(m){var i=Date.now();if(!(i>=o)){var n,p=e($Config.mkt),f=d();if(r>=i){if(f){if(f.isConfirmed)return;if(f.lastShownAt+s*a>i)return}n=p.updatingContent}else{if(f)if(f.lastShownAt<r)c(),f=null;else{if(f.isConfirmed)return;if(f.lastShownAt+l*a>i)return}n=p.updatedContent}var g=m.createTopBar({buttons:{action:p.learnMore,close:p.dismiss},content:n,dismissalMode:"Timeout"});if(g){h&&(h.isCurrentlyShown(),h.dismiss());var v=!1;h=g,jQuery(h).bind({"buttonclick.msanotificationdialog":function(e,t,i){v=!0,"action"===i&&window.open("https://go.microsoft.com/fwlink/?LinkID=2092201","_blank")},"aftershow.msanotificationdialog":function(e,i){t&&t.sendBlurFocus()},"afterdismiss.msanotificationdialog":function(e,n){u(i,v),t&&t.sendGrabFocus(),h&&(jQuery(h).unbind(".msanotificationdialog"),h=null)}}),h.show()}}}}function d(){try{var e=window.localStorage.getItem(n);if(e)return JSON.parse(e)}catch(t){console.log("OneDrive.WAC: can not read msa notification record")}}function u(e,t){try{window.localStorage.setItem(n,JSON.stringify({lastShownAt:e,isConfirmed:t}))}catch(i){console.log("OneDrive.WAC: can not update msa notification record")}}function c(){try{window.localStorage.removeItem(n)}catch(e){console.log("OneDrive.WAC: can not update msa notification record")}}var h,p=this,m=wLive.Controls.Notifications;p.dispose=function(){h&&h.dismiss()};try{i()}catch(f){console.log("OneDrive.WAC: can not check msa notification status: ",f)}}var i=wLive.Core,n="OneDrive.MsaUpdateNotification",r=new Date(2022,7,15).getTime(),o=new Date(2022,7,20).getTime(),a=864e5,s=7,l=1,d={"af-za":{updatingContent:"Ons werk tans ons Gebruiksbepalings by.",updatedContent:"Ons het ons Gebruiksbepalings bygewerk.",learnMore:"Kom meer te wete",dismiss:"Weier"},"am-et":{updatingContent:"    ",updatedContent:"  ",learnMore:" ",dismiss:""},"ar-sa":{updatingContent:"    .",updatedContent:"    .",learnMore:" ",dismiss:""},"ar-xm":{updatingContent:"    .",updatedContent:"    .",learnMore:" ",dismiss:""},"as-in":{updatingContent:"      ",updatedContent:"     ",learnMore:" ",dismiss:""},"az-latn-az":{updatingContent:"stifad rtlrimizi yenilyirik.",updatedContent:"stifad rtlrimizi yenildik.",learnMore:"trafl mlumat",dismiss:"Rdd et"},"be-by":{updatingContent:"   .",updatedContent:"   .",learnMore:"",dismiss:""},"bg-bg":{updatingContent:"    .",updatedContent:"    .",learnMore:" ",dismiss:""},"bn-bd":{updatingContent:"     ",updatedContent:"     ",learnMore:" ",dismiss:" "},"bn-in":{updatingContent:"    ",updatedContent:"    ",learnMore:" ",dismiss:" "},"bs-cyrl-ba":{updatingContent:"   .",updatedContent:"    .",learnMore:" ",dismiss:""},"bs-latn-ba":{updatingContent:"Auriramo Uslove koritenja usluge.",updatedContent:"Aurirali smo Uslove koritenja usluge.",learnMore:"Saznajte vie",dismiss:"Ignoriite"},"ca-es":{updatingContent:"Estem actualitzant les Condicions d's.",updatedContent:"Hem actualitzat les Condicions d's.",learnMore:"Ms informaci",dismiss:"Descarta"},"ca-es-valencia":{updatingContent:"Estem actualitzant les Condicions d's.",updatedContent:"Hem actualitzat les Condicions d's.",learnMore:"Ms informaci",dismiss:"Descarta"},"cs-cz":{updatingContent:"Provdme aktualizaci podmnek pouvn.",updatedContent:"Provedli jsme aktualizaci podmnek pouvn.",learnMore:"Dal informace",dismiss:"Zavt"},"cy-gb":{updatingContent:"Rydym yn diweddaru ein Telerau Defnyddio.",updatedContent:"Rydym wedi diweddaru ein Telerau Defnyddio.",learnMore:"Dysgu rhagor",dismiss:"Diystyru"},"da-dk":{updatingContent:"Vi opdaterer vores Vilkr for anvendelse.",updatedContent:"Vi har opdateret vores Vilkr for anvendelse",learnMore:"Ls mere",dismiss:"Afvis"},"de-at":{updatingContent:"Wir aktualisieren unsere Nutzungsbestimmungen.",updatedContent:"Wir haben unsere Nutzungsbestimmungen aktualisiert.",learnMore:"Mehr erfahren",dismiss:"Schlieen"},"de-ch":{updatingContent:"Wir aktualisieren unsere Nutzungsbestimmungen.",updatedContent:"Wir haben unsere Nutzungsbestimmungen aktualisiert.",learnMore:"Mehr erfahren",dismiss:"Schliessen"},"de-de":{updatingContent:"Wir aktualisieren unsere Nutzungsbestimmungen.",updatedContent:"Wir haben unsere Nutzungsbestimmungen aktualisiert.",learnMore:"Mehr erfahren",dismiss:"Schlieen"},"el-gr":{updatingContent:"    .",updatedContent:"     .",learnMore:" ",dismiss:""},"en-ca":{updatingContent:"We are updating our Terms of Use.",updatedContent:"We have updated our Terms of Use.",learnMore:"Learn more",dismiss:"Dismiss"},"en-gb":{updatingContent:"We are updating our Terms of Use.",updatedContent:"We have updated our Terms of Use.",learnMore:"Learn more",dismiss:"Dismiss"},"en-us":{updatingContent:"We're updating our Terms of Use.",updatedContent:"We've updated our Terms of Use.",learnMore:"Learn more",dismiss:"Dismiss"},"es-ar":{updatingContent:"Estamos actualizando nuestras condiciones de uso.",updatedContent:"Hemos actualizado nuestras condiciones de uso.",learnMore:"Ms informacin",dismiss:"Descartar"},"es-cl":{updatingContent:"Estamos actualizando nuestras condiciones de uso.",updatedContent:"Hemos actualizado nuestras condiciones de uso.",learnMore:"Ms informacin",dismiss:"Descartar"},"es-es":{updatingContent:"Estamos actualizando nuestras condiciones de uso.",updatedContent:"Hemos actualizado nuestras condiciones de uso.",learnMore:"Ms informacin",dismiss:"Descartar"},"es-mx":{updatingContent:"Estamos actualizando nuestras condiciones de uso.",updatedContent:"Hemos actualizado nuestras condiciones de uso.",learnMore:"Ms informacin",dismiss:"Descartar"},"es-xl":{updatingContent:"Estamos actualizando nuestras condiciones de uso.",updatedContent:"Hemos actualizado nuestras condiciones de uso.",learnMore:"Ms informacin",dismiss:"Descartar"},"et-ee":{updatingContent:"Vrskendame kasutustingimusi.",updatedContent:"Oleme vrskendanud kasutustingimusi.",learnMore:"Lisateave",dismiss:"Sule"},"eu-es":{updatingContent:"Erabiltzeko baldintzak eguneratzen ari gara.",updatedContent:"Erabiltzeko baldintzak eguneratu ditugu.",learnMore:"Informazio gehiago",dismiss:"Baztertu"},"fa-ir":{updatingContent:"       .",updatedContent:"      .",learnMore:"  ",dismiss:""},"fi-fi":{updatingContent:"Pivitmme kyttehtoja.",updatedContent:"Olemme pivittneet kyttehdot.",learnMore:"Lue listietoja",dismiss:"Ohita"},"fil-ph":{updatingContent:"Ia-update namin ang aming Mga Tuntunin sa Paggamit.",updatedContent:"Na-update namin ang aming Mga Tuntunin sa Paggamit.",learnMore:"Alamin pa",dismiss:"Alisin"},"fr-be":{updatingContent:"Nous mettons  jour nos Conditions dUtilisation.",updatedContent:"Nous avons mis  jour nos Conditions dUtilisation.",learnMore:"En savoir plus",dismiss:"Ignorer"},"fr-ch":{updatingContent:"Nous mettons  jour nos Conditions dUtilisation.",updatedContent:"Nous avons mis  jour nos Conditions dUtilisation.",learnMore:"En savoir plus",dismiss:"Ignorer"},"fr-ca":{updatingContent:"Nous mettons  jour nos conditions dutilisation.",updatedContent:"Nous avons mis  jour nos conditions dutilisation.",learnMore:"En savoir plus",dismiss:"Ignorer"},"fr-fr":{updatingContent:"Nous mettons  jour nos Conditions dUtilisation.",updatedContent:"Nous avons mis  jour nos Conditions dUtilisation.",learnMore:"En savoir plus",dismiss:"Ignorer"},"fr-xf":{updatingContent:"Nous mettons  jour nos Conditions dUtilisation.",updatedContent:"Nous avons mis  jour nos Conditions dUtilisation.",learnMore:"En savoir plus",dismiss:"Ignorer"},"ga-ie":{updatingContent:"T r dTarma side  nuashonr againn.",updatedContent:"T r dTarma side nuashonraithe againn.",learnMore:"Tuilleadh eolais",dismiss:"Dn"},"gd-gb":{updatingContent:"Tha sinn ag rachadh teirmichean a chleachdaidh againn.",updatedContent:"Tha sinn air teirmichean a chleachdaidh againn rachadh.",learnMore:"Barrachd fiosrachaidh",dismiss:"Leig seachad"},"gl-es":{updatingContent:"Estamos a actualizar as Condicins de uso.",updatedContent:"Actualizamos as Condicins de uso.",learnMore:"Mis informacin",dismiss:"Rexeitar"},"gu-in":{updatingContent:"       .",updatedContent:"      .",learnMore:" ",dismiss:" "},"ha-latn-ng":{updatingContent:"Muna sabunta namu Sharuan Amfani.",updatedContent:"Mun sabunta namu Sharuan Amfani.",learnMore:"ara koyo",dismiss:"Watsar"},"he-il":{updatingContent:"     .",updatedContent:"    .",learnMore:" ",dismiss:""},"hi-in":{updatingContent:"        .",updatedContent:"        .",learnMore:"  ",dismiss:" "},"hr-hr":{updatingContent:"Auriramo Uvjete koritenja.",updatedContent:"Aurirali smo Uvjete koritenja.",learnMore:"Saznajte vie",dismiss:"Odbaci"},"hu-hu":{updatingContent:"Frisstjk a Hasznlati Feltteleket.",updatedContent:"Frisstettk a Hasznlati Feltteleket.",learnMore:"Tovbbi informcik",dismiss:"Elvets"},"hy-am":{updatingContent:"     :",updatedContent:"     :",
learnMore:" ",dismiss:""},"id-id":{updatingContent:"Kami memperbarui Persyaratan Penggunaan.",updatedContent:"Kami telah memperbarui Persyaratan Penggunaan.",learnMore:"Pelajari lebih lanjut",dismiss:"Tutup"},"ig-ng":{updatingContent:"Any na-emelite Usoro Ojiji any.",updatedContent:"Any emelitela Usoro Ojiji any.",learnMore:"Mtakwuo",dismiss:"Wep"},"is-is":{updatingContent:"Vi erum a uppfra notkunarskilmla okkar.",updatedContent:"Vi hfum uppfrt notkunarskilmla okkar.",learnMore:"Nnari upplsingar",dismiss:"Hunsa"},"it-it":{updatingContent:"Le Condizioni per l'Utilizzo sono in fase di aggiornamento.",updatedContent:"Le Condizioni per l'Utilizzo sono state aggiornate.",learnMore:"Ulteriori informazioni",dismiss:"Ignora"},"iu-latn-ca":{updatingContent:"Atuqtauninginnut maligait nutaanguqtiqtauyuit",updatedContent:"Atuqtauninginnut maligait nutaanguqtiqtauyuit",learnMore:"Ilisakkanirit",dismiss:"Aturunnaiqtuq"},"ja-jp":{updatingContent:"",updatedContent:"",learnMore:"",dismiss:""},"ka-ge":{updatingContent:"   .",updatedContent:"   .",learnMore:" ",dismiss:""},"kk-kz":{updatingContent:"    .",updatedContent:"   .",learnMore:" ",dismiss:" "},"km-kh":{updatingContent:"",updatedContent:"",learnMore:"",dismiss:""},"kn-in":{updatingContent:"    .",updatedContent:"    .",learnMore:" ",dismiss:""},"kok-in":{updatingContent:"     .",updatedContent:"     .",learnMore:"  ",dismiss:" "},"ko-kr":{updatingContent:"   .",updatedContent:"  . ",learnMore:" ",dismiss:""},"ku-arab-iq":{updatingContent:"    .",updatedContent:"    .",learnMore:" ",dismiss:""},"ky-kg":{updatingContent:"   .",updatedContent:"  .",learnMore:" ",dismiss:" "},"lb-lu":{updatingContent:"Mir aktualisieren eis Benotzerbedngungen.",updatedContent:"Mir hunn eis Benotzerbedngungen aktualisiert.",learnMore:"Mi gewuer ginn",dismiss:"Verwerfen"},"lo-la":{updatingContent:".",updatedContent:".",learnMore:"",dismiss:""},"lt-lt":{updatingContent:"Atnaujiname savo naudojimo slygas.",updatedContent:"Atnaujinome savo naudojimo slygas.",learnMore:"Suinoti daugiau",dismiss:"Atsisakyti"},"lv-lv":{updatingContent:"Ms atjauninm msu lietoanas nosacjumus.",updatedContent:"Esam atjauninjui msu lietoanas nosacjumus.",learnMore:"Papildinformcija",dismiss:"Nerdt"},"mi-nz":{updatingContent:"Kei te whakahou mtou i  mtou Ture Whakamahi.",updatedContent:"Kua whakahoutia e mtou  mtou Ture Whakamahi.",learnMore:"Ako an",dismiss:"kiri"},"mk-mk":{updatingContent:"     .",updatedContent:"     .",learnMore:" ",dismiss:""},"ml-in":{updatingContent:"    .",updatedContent:"    .",learnMore:" ",dismiss:""},"mn-mn":{updatingContent:"    .",updatedContent:"   .",learnMore:"  ",dismiss:" "},"mr-in":{updatingContent:"      .",updatedContent:"      .",learnMore:"  ",dismiss:" "},"ms-my":{updatingContent:"Kami sedang mengemas kini Terma Penggunaan kami.",updatedContent:"Kami telah mengemas kini Terma Penggunaan kami.",learnMore:"Ketahui lebih lanjut",dismiss:"Abaikan"},"mt-mt":{updatingContent:"Qegdin naornaw it-Termini tal-Uu tagna.",updatedContent:"Aornajna t-Termini tal-Uu tagna.",learnMore:"Sir af aktar",dismiss:"Warrab"},"nb-no":{updatingContent:"Vi oppdaterer vilkrene vre for bruk.",updatedContent:"Vi har oppdatert vilkrene vre for bruk.",learnMore:"Les mer",dismiss:"Lukk"},"ne-np":{updatingContent:"     ",updatedContent:"      ",learnMore:" ",dismiss:" "},"nl-be":{updatingContent:"Wij werken onze Gebruiksvoorwaarden bij.",updatedContent:"We hebben onze Gebruiksvoorwaarden bijgewerkt.",learnMore:"Meer informatie",dismiss:"Sluiten"},"nl-nl":{updatingContent:"Wij werken onze Gebruiksvoorwaarden bij.",updatedContent:"We hebben onze Gebruiksvoorwaarden bijgewerkt.",learnMore:"Meer informatie",dismiss:"Sluiten"},"nn-no":{updatingContent:"Vi oppdaterer vilkra vre for bruk.",updatedContent:"Vi har oppdatert vilkra vre for bruk.",learnMore:"Les meir",dismiss:"Lukk"},"nso-za":{updatingContent:"Re gare re fetola Mabaka a rena a Tirio.",updatedContent:"Re fetote Mabaka a rena a Tirio.",learnMore:"Ithute te dingwe",dismiss:"Beela ka thoko"},"or-in":{updatingContent:"     ",updatedContent:"     ",learnMore:" ",dismiss:" "},"pa-arab-pk":{updatingContent:"          ",updatedContent:"          ",learnMore:" ",dismiss:"  "},"pa-in":{updatingContent:"         ",updatedContent:"        ",learnMore:" ",dismiss:" "},"pl-pl":{updatingContent:"Aktualizujemy nasze Warunki uytkowania.",updatedContent:"Zaktualizowalimy nasze Warunki uytkowania.",learnMore:"Dowiedz si wicej",dismiss:"Zamknij"},"prs-af":{updatingContent:"       .",updatedContent:"        .",learnMore:" ",dismiss:""},"pt-br":{updatingContent:"Estamos atualizando nossos Termos de Uso.",updatedContent:"Atualizamos nossos Termos de Uso.",learnMore:"Mais informaes",dismiss:"Ignorar"},"pt-pt":{updatingContent:"Estamos a atualizar os nossos Termos de Utilizao.",updatedContent:"Atualizmos os nossos Termos de Utilizao.",learnMore:"Saiba mais",dismiss:"Ignorar"},"qut-gt":{updatingContent:"Katajin kaqak'ak'arisaj le Taqanem chech ukojik.",updatedContent:"Xqak'ak'arisaj le Taqanem chech ukojik.",learnMore:"Nik'aj chik",dismiss:"Relesaxik"},"quz-pe":{updatingContent:"Hapiymanta Kamachiykuna kunanchachkayku.",updatedContent:"Hapiymanta Kamachiykuna kunanchasqayku.",learnMore:"Aswan yacharinapaq",dismiss:"Nana munarisqay"},"ro-ro":{updatingContent:"Actualizm Condiiile de utilizare.",updatedContent:"Am actualizat Condiiile de utilizare.",learnMore:"Aflai mai multe",dismiss:"Ignorare"},"ru-ru":{updatingContent:"   .",updatedContent:"   .",learnMore:" ",dismiss:""},"rw-rw":{updatingContent:"Turimo kuvugurura amategeko y'imikoreshereze.",updatedContent:"Twavuguruye amategeko y'imikoreshereze.",learnMore:"Menya ibindi",dismiss:"Kureka"},"sd-arab-pk":{updatingContent:"         .",updatedContent:"         .",learnMore:" ",dismiss:" "},"si-lk":{updatingContent:"      .",updatedContent:"      .",learnMore:" ",dismiss:""},"sk-sk":{updatingContent:"Aktualizujeme nae podmienky pouvania.",updatedContent:"Aktualizovali sme nae podmienky pouvania.",learnMore:"alie informcie",dismiss:"Zrui"},"sl-si":{updatingContent:"Posodobili bomo pogoje uporabe.",updatedContent:"Posodobili smo pogoje uporabe.",learnMore:"Ve informacij",dismiss:"Opusti"},"sq-al":{updatingContent:"Jemi duke prditsuar Kushtet tona t prdorimit.",updatedContent:"Kemi prditsuar Kushtet tona t prdorimit.",learnMore:"Mso m shum",dismiss:"Hiq"},"sr-cyrl-cs":{updatingContent:"  .",updatedContent:"   .",learnMore:" ",dismiss:""},"sr-latn-cs":{updatingContent:"Auriramo Uslove korienja.",updatedContent:"Aurirali smo Uslove korienja.",learnMore:"Saznajte vie",dismiss:"Ignoriite"},"sr-cyrl-sp":{updatingContent:"  .",updatedContent:"   .",learnMore:" ",dismiss:""},"sr-latn-sp":{updatingContent:"Auriramo Uslove korienja.",updatedContent:"Aurirali smo Uslove korienja.",learnMore:"Saznajte vie",dismiss:"Ignoriite"},"sv-se":{updatingContent:"Vi uppdaterar vra anvndningsvillkor.",updatedContent:"Vi har uppdaterat vra anvndningsvillkor.",learnMore:"Mer information",dismiss:"Avfrda"},"sw-ke":{updatingContent:"Tunasasisha Masharti yetu ya Matumizi.",updatedContent:"Tumesasisha Masharti yetu ya Matumizi.",learnMore:"Jifunze zaidi",dismiss:"Puuza"},"ta-in":{updatingContent:"     .",updatedContent:"     .",learnMore:" ",dismiss:""},"te-in":{updatingContent:"     .",updatedContent:"     .",learnMore:" ",dismiss:""},"tg-cyrl-tj":{updatingContent:"    .",updatedContent:"    .",learnMore:" ",dismiss:""},"th-th":{updatingContent:"",updatedContent:"",learnMore:"",dismiss:""},"ti-et":{updatingContent:"     ",updatedContent:"     ",learnMore:" ",dismiss:""},"tk-tm":{updatingContent:"Ulany ertlerimizi tzeleris.",updatedContent:"Ulany ertlerimizi tzeledik.",learnMore:"Gomaa maglumat",dismiss:"Gobolsun"},"tn-za":{updatingContent:"Re tlhabolola Melawana ya rona ya Tiriso.",updatedContent:"Re tlhabolotse Melawana ya rona ya Tiriso.",learnMore:"Ithute mo gontsi",dismiss:"Tlogela"},"tr-tr":{updatingContent:"Kullanm Koullarmz gncelletiriyoruz.",updatedContent:"Kullanm Koullarmz gncelletirdik.",learnMore:"Daha fazla bilgi",dismiss:"Kapat"},"tt-ru":{updatingContent:"   .",updatedContent:"   .",learnMore:" ",dismiss:" "},"ug-cn":{updatingContent:"   .",updatedContent:"   .",learnMore:"  ",dismiss:""},"uk-ua":{updatingContent:"   .",updatedContent:"   .",learnMore:" ",dismiss:""},"ur-pk":{updatingContent:"         ",updatedContent:"         ",learnMore:" ",dismiss:" "},"uz-latn-uz":{updatingContent:"Foydalanish shartlarimizni yangilayapmiz.",updatedContent:"Foydalanish shartlarimizni yangiladik.",learnMore:"Batafsil",dismiss:"Yopish"},"vi-vn":{updatingContent:"Chng ti ang cp nht iu khon S dng.",updatedContent:"Chng ti  cp nht iu khon S dng.",learnMore:"Tm hiu thm",dismiss:"ng"},"wo-sn":{updatingContent:"Noo ngi yeesal sunu Srti Jfandikoo.",updatedContent:"Yeesal nanu sunu Srti Jfandikoo.",learnMore:"Yeneeni leeral",dismiss:"Byyi"},"xh-za":{updatingContent:"Sihlaziya iMimiselo yoSetyenziso yethu.",updatedContent:"Siyihlaziyile iMimiselo yoSetyenziso yethu.",learnMore:"Funda lukhulu",dismiss:"Susa"},"yo-ng":{updatingContent:"w  fikn wn fnuk l wa.",updatedContent:"A ti fikn wn fnuk l wa.",learnMore:"K k npa r si",dismiss:"Mkn kr"},"zh-cn":{updatingContent:"",updatedContent:"",learnMore:"",dismiss:""},"zh-hk":{updatingContent:"",updatedContent:"",learnMore:"",dismiss:""},"zh-tw":{updatingContent:"",updatedContent:"",learnMore:"",dismiss:""},"zu-za":{updatingContent:"Sibuyekeza Imigomo yethu Yokusebenzisa.",updatedContent:"Sibuyekeze Imigomo yethu Yokusebenzisa.",learnMore:"Funda kabanzi",dismiss:"Yekela"}};i.MSANotificationController=t}()}),define("officepagecontroller",["wliveloaded","doregister","jquery-1.7.2","alehelpers","jbase","basecontrol","actionmanager","datarequest","imagestrip","validateconfig","viewcontext","ticketredeemer","bicihelpers","errormanager","embed","skydrive_pc_strip_32_ltr","skydrive_pc_strip_8_ltr","skydrive_sharing_strip_8_ltr","header_strip_ltr","inlineerror","itemactionhelper","loadingcue","permissionsprovider","sendform","sharedialog","postmessagehandler","vaultcontroller","msanotificationcontroller","lightobject","navigation"],function(){!function(){function e(e,i,l,d,u,c,h){function p(){w.addObjectListener(k,r.DataModel.dataChangedEvent,m);var e=k.getItem(S);if(e&&m(e),FilesConfig.enableWacHtmlHistory&&a.bind("popstate",f),e.vault&&(v=new r.VaultController(C)),$Config&&"UnAuth"===$Config.unid&&(y=new r.MSANotificationController(C)),WacConfig.IsOverQuota){var t=wLive.Controls.Notifications.createModalDialog({title:r.AleHelpers.getPCString("WacEditQuota.WarnHeader"),content:r.AleHelpers.getPCString("WacEditQuota.WarnBody"),buttons:{action:r.AleHelpers.getPCString("WacEditQuota.WarnButton")}});t.show(),wLive.Controls.Notifications.getQueue().start()}try{var i="dev"!==Flight.version&&!!Flight.UserGroup&&("df"===Flight.UserGroup.toLowerCase()||"prod"===Flight.UserGroup.toLowerCase());microsoft.applications.telemetry.LogManager.initialize(i?$Config.AriaProdToken:$Config.AriaPreProdToken),g=new microsoft.applications.telemetry.Logger;var n=g.getSemanticContext(),o=n.contextMap,s="UnAuth"===$Config.unid;o.Add("AppInfo.Session",Flight.session),n.setAppVersion(Flight.version),o.Add("AppInfo.Manifest",Flight.manifest),n.setUserLanguage($Config.mkt||""),n.setUserId(s?"":Flight.cid),g.setContext("AccountType",s?"ConsumerAnonymous":"Consumer"),g.setContext("Environment","ODC_"+Flight.UserGroup),g.setContext("Workload","ODC"),g.setContext("IsAuthenticated",s?0:1),g.setContext("BrowserIsMobile",!(!$B.SF_iPhone&&!$B.CR_Android)),g.setContext("BrowserUserAgent",window.navigator&&navigator.userAgent||"")}catch(l){}}function m(e){if(!_&&S===e.key){for(var t=0;t<s.length;t++)I.push(new o[s[t]](b,C,e));$Do.register("WacPostMessageHandlersAttached"),w.removeObjectListener(k,r.DataModel.dataChangedEvent)}}function f(e){e.originalEvent.state?C.sendPopState({Url:window.location.href,State:e.originalEvent.state}):window.history&&window.history.back&&window.history.back()}var g,v,y,w=this,C=new r.PostMessageHandler,b=t(),k=new r.DataModel(e,l,d,u,c),S=r.SkyDriveItem.getItemKey(WacConfig.viewParams.id,WacConfig.viewParams.cid,WacConfig.viewParams.group,WacConfig.viewParams.qt,WacConfig.viewParams.did),_=!1;h&&k.processResponse(h,S),$Do.when("NotificationControls",0,function(){n=o.Notifications,n&&n.getQueue().start()});var I=[];w.dispose=function(){n&&n.getQueue().reset(),C.dispose(),v&&v.dispose(),y&&y.dispose();try{microsoft.applications.telemetry.LogManager.flush(null)}catch(e){}for(var t=0;t<I.length;t++)I[t].dispose();a.unbind("popstate"),k.dispose(),_=!0},w.getPostMessageHandler=function(){return C},w.getAriaLogger=function(){return g},mix(w,Shared.ObjectEventing),p()}function t(){var e={viewParams:null,callerCid:$Config.hcid,tokenHasBeenRedeemed:!1,notifications:n,actionManager:{getAction:function(e,t){if("Share"==e&&t.commands&&!t.group){var i=t.commands.split(","),n=jQuery.inArray("sh",i);if(-1!=n)return 1}else if("Embed"==e&&t.commands&&(i=t.commands.split(","),n=jQuery.inArray("em",i),-1!=n))return 1;return null}}},t=new Shared.Navigation;return e.viewParams=t.getViewParams(),e}function i(){var e=Object.fromJSON(WacConfig.GetItemsResponse),t=new wLive.Core.OfficePageController(FilesConfig.baseApiUrl,FilesConfig.canary,FilesConfig.appId,FilesConfig.hcid,$Config.mkt,FilesConfig.dataPageSize,e);return a.bind("unload",function(){t.dispose()}),t}var n,r=wLive.Core,o=wLive.Controls,a=jQuery(window),s=["CopyEditHandler","ShareHandler","EmbedHandler","OpenInClientHandler","VersionHistoryHandler","ShareFormHandler","SignInHandler","RenameFileHandler","EditNotificationHandler","GetAccessTokenHandler","RefreshSessionInfoHandler","UserActivityHandler","WopiInfoFromUrlHandler","DavUrlFromIdsHandler","CheckAccessGrantPermissionsHandler","GetCustomAuthConfigHandler"];r.OfficePageController=e;var l;r.OfficePageController.getInstance=function(){return l},require(["postmessagehandler","vaultcontroller","msanotificationcontroller","copyedithandler","sharehandler","embedhandler","openinclienthandler","versionhistoryhandler","shareformhandler","signinhandler","renamefilehandler","editnotificationhandler","getaccesstokenhandler","refreshsessioninfohandler","useractivityhandler","wopiinfofromurlhandler","davurlfromidshandler","checkaccessgrantpermissionshandler","getcustomauthconfighandler"],function(){l=i()})}()}),define("getcustomauthconfighandler",["jquery-1.7.2","officepagecontroller"],function(){!function(){function e(e,i,l){function d(e,t){if(Flight.Ramps&&Flight.Ramps.WacSupportCustomAuthConfig){var n=$Wac.getWacIframeDomain(),r={type:"webMsaWithAadProxy",login_Hint:$Config.email,appSignOutUrl:FilesConfig.autoRedeemSignOut,aad:{appId:o,wreply:n},msa:{siteId:a,wreply:n}};i.sendWacCustomAuthConfig({AuthConfig:JSON.stringify(r)})}}var u=this,c=jQuery(i),h=s+r++;n?(u.jsApiEventListener=function(e){e.type===Microsoft.Office[WacConfig.Unified.WacApplication].EventIds.GetCustomAuthConfig&&d(null,e.data)},$Wac.addJsApiEventListener(u.jsApiEventListener)):c.bind(t.PostMessageHandler.WacGetCusotomAuthConfigEvent+h,d),u.dispose=function(){n?$Wac.removeJsApiEventListener(u.jsApiEventListener):c.unbind(h)}}var t=wLive.Core,i=wLive.Controls,n=WacConfig&&WacConfig.BootWithJsApiV2,r=0,o="00000003-0000-0ff1-ce00-000000000000",a=250206,s=".getCustomAuthConfigHandler";i.GetCustomAuthConfigHandler=e}()}),define("checkaccessgrantpermissionshandler",["getcustomauthconfighandler","sharedialogv3"],function(){!function(){function e(e,a,s){function l(t,n){if(Flight.Ramps&&Flight.Ramps.WacAtMentionDialog&&!h){h=!0;var r=new i.ShareDialogV3(s,a,e);r.showAtMentionDialog(n,function(){h=!1})}}var d=this,u=jQuery(a),c=o+r++,h=!1;n?(d.jsApiEventListener=function(e){e.type===Microsoft.Office[WacConfig.Unified.WacApplication].EventIds.UserAccessAndPermissions&&l(null,e.data)},$Wac.addJsApiEventListener(d.jsApiEventListener)):u.bind(t.PostMessageHandler.WacCheckAccessGrantPermissionsEvent+c,l),d.dispose=function(){n?$Wac.removeJsApiEventListener(d.jsApiEventListener):u.unbind(c)}}var t=wLive.Core,i=wLive.Controls,n=WacConfig&&WacConfig.BootWithJsApiV2,r=0,o=".checkAccessGrantPermissionsHandler";i.CheckAccessGrantPermissionsHandler=e}()}),define("davurlfromidshandler",["checkaccessgrantpermissionshandler","vroomrequestor"],function(){!function(){function e(e,i,p){function m(e,n){if(Flight.Ramps&&Flight.Ramps.WacConvertIdToPathUrl){y||(y=t.OfficePageController.getInstance().getAriaLogger());var r,o,a=Date.now();if(n&&(r=n.DriveId,o=n.ItemId),!r||!o)return v(a,c,h),void i.sendHostDavUrlFromIds(r,o,void 0,void 0,void 0,void 0,{Id:c,Details:h});if(S.length>=100)return v(a,d,u),void i.sendHostDavUrlFromIds(r,o,void 0,void 0,void 0,void 0,{Id:d,Details:u});var s={driveId:r,itemId:o,timeReceived:a};S.push(s),_||f()}}function f(){if(!(S.length<=0)){var e=S.shift(),t=e.driveId,n=e.itemId,r=e.timeReceived;try{_=!0,k.send("/drives/"+t+"/items/"+n+"?$select=openWith,webDavUrl").then(function(e){var o=e.openWith,a=e.webDavUrl;if(o&&o.wac){var d=o.wac;g(r),i.sendHostDavUrlFromIds(t,n,a,d.wopiSrc,d.accessToken,d.accessTokenExpiry)}else v(r,s,l),i.sendHostDavUrlFromIds(t,n,void 0,void 0,void 0,void 0,{Id:s,Details:l});_=!1,f()},function(e){var o=e&&e.error,a=o&&(o.xhrStatus||o.code)||"Unknown";a=String(a);var s=o&&o.message||"Unknown",l=o&&(o.xhrResponseText||o.debugMessage)||"response object / error was null";v(r,a,s),i.sendHostDavUrlFromIds(t,n,void 0,void 0,void 0,void 0,{Id:a,Details:l}),_=!1,f()})}catch(o){v(r,o.name,o.message),i.sendHostDavUrlFromIds(t,n,void 0,void 0,void 0,void 0,{Id:o.name,Details:o.message}),_=!1,f()}}}function g(e){if(y){var t=new microsoft.applications.telemetry.EventProperties;t.name="ev_Engagement",t.setProperty("WebLog_FullName","Engagement,"),t.setProperty("WebLog_EventType","Single"),t.setProperty("WebLog_Type_Engagement","1"),t.setProperty("UsageType","Click"),t.setProperty("Name",a+"_Success"),t.setProperty("Latency",e?Date.now()-e:0),y.logEvent(t)}}function v(e,t,i){if(y){var n=new microsoft.applications.telemetry.EventProperties;n.name="ev_UnhandledError",n.setProperty("Name",a+"_Error"),n.setProperty("error",t||"UnknownError"),n.setProperty("errorMessage",i||"UnknownError"),n.setProperty("Latency",e?Date.now()-e:0),y.logEvent(n)}}var y,w=this,C=jQuery(i),b=o+r++,k=new t.VroomRequestor,S=[],_=!1;n?(w.jsApiEventListener=function(e){e.type===Microsoft.Office[WacConfig.Unified.WacApplication].EventIds.GetDavUrlFromIds&&m(null,e.data)},$Wac.addJsApiEventListener(w.jsApiEventListener)):C.bind(t.PostMessageHandler.WacDavUrlFromIdsEvent+b,m),w.dispose=function(){n?$Wac.removeJsApiEventListener(w.jsApiEventListener):C.unbind(b)}}var t=wLive.Core,i=wLive.Controls,n=WacConfig&&WacConfig.BootWithJsApiV2,r=0,o=".davUrlFromIdsHandler",a="DavUrlFromIds",s="MissingProperty",l="No wac property was found in the response",d="429",u="Too many requests",c="MissingParameter",h="No parameter was found in the request";i.DavUrlFromIdsHandler=e}()}),define("wopiinfofromurlhandler",["davurlfromidshandler","vroomrequestor"],function(){!function(){function e(e,i,p){function m(e,n){C||(C=t.OfficePageController.getInstance().getAriaLogger());var r,o=Date.now();if(n&&(r=n.Url),!r)return w(o,c,h),void i.sendHostWopiInfoFromUrl(r,void 0,void 0,void 0,void 0,void 0,{Id:c,Details:h});if(x.length>=100)return w(o,d,u),void i.sendHostWopiInfoFromUrl(r,void 0,void 0,void 0,void 0,void 0,{Id:d,Details:u});var a={url:r,timeReceived:o};x.push(a),D||f()}function f(){if(x.length>0){var e=x.shift(),t=e.url,n=e.timeReceived;try{D=!0;var r="u!"+v(g(t));_.send("/shares/"+r+"/driveItem?$select=openWith,parentReference,id").then(function(e){var r=e.openWith;if(r&&r.wac){var o=r.wac;y(n);var a=e.parentReference&&e.parentReference.driveId,d=e.id;i.sendHostWopiInfoFromUrl(t,o.wopiSrc,o.accessToken,o.accessTokenExpiry,a,d)}else w(n,s,l),i.sendHostWopiInfoFromUrl(t,void 0,void 0,void 0,void 0,void 0,{Id:s,Details:l});D=!1,f()},function(e){var r=e&&e.error,o=r&&(r.xhrStatus||r.code)||"Unknown";o=String(o);var a=r&&r.message||"Unknown",s=r&&(r.xhrResponseText||r.debugMessage)||"response object / error was null";w(n,o,a),i.sendHostWopiInfoFromUrl(t,void 0,void 0,void 0,void 0,void 0,{Id:o,Details:s}),D=!1,f()})}catch(o){w(n,o.name,o.message),i.sendHostWopiInfoFromUrl(t,void 0,void 0,void 0,void 0,void 0,{Id:o.name,Details:o.message}),D=!1,f()}}}function g(e){if("https://"!==e.substring(0,8))if("/"===e[0]){var t=I.split("/"),i=t[2];e="https://"+i+e}else e=I.substring(0,I.lastIndexOf("/"))+"/"+e;return e}function v(e){var t=btoa(unescape(encodeURIComponent(e))).replace(/=/g,"").replace(/[+]/g,"-").replace(/\//g,"_");return t}function y(e){if(C){var t=new microsoft.applications.telemetry.EventProperties;t.name="ev_Engagement",t.setProperty("WebLog_FullName","Engagement,"),t.setProperty("WebLog_EventType","Single"),t.setProperty("WebLog_Type_Engagement","1"),t.setProperty("UsageType","Click"),t.setProperty("Name",a+"_Success"),t.setProperty("Latency",e?Date.now()-e:0),C.logEvent(t)}}function w(e,t,i){if(C){var n=new microsoft.applications.telemetry.EventProperties;n.name="ev_UnhandledError",n.setProperty("Name",a+"_Error"),n.setProperty("error",t||"UnknownError"),n.setProperty("errorMessage",i||"UnknownError"),n.setProperty("Latency",e?Date.now()-e:0),C.logEvent(n)}}var C,b=this,k=jQuery(i),S=o+r++,_=new t.VroomRequestor,I=p.davUrl,x=[],D=!1;n?(b.jsApiEventListener=function(e){e.type===Microsoft.Office[WacConfig.Unified.WacApplication].EventIds.GetWopiInfoFromUrl&&m(null,e.data)},$Wac.addJsApiEventListener(b.jsApiEventListener)):k.bind(t.PostMessageHandler.WacWopiInfoFromUrlEvent+S,m),b.dispose=function(){n?$Wac.removeJsApiEventListener(b.jsApiEventListener):k.unbind(S)}}var t=wLive.Core,i=wLive.Controls,n=WacConfig&&WacConfig.BootWithJsApiV2,r=0,o=".wopiInfoFromUrlHandler",a="WopiInfoFromUrl",s="MissingProperty",l="No wac property was found in the response",d="429",u="Too many requests",c="MissingParameter",h="No parameter was found in the request";i.WopiInfoFromUrlHandler=e}()}),define("useractivityhandler",["vaultcontroller","wopiinfofromurlhandler"],function(){!function(){function e(e,i,a){function s(e,t){WacConfig.enableActivityTimeout&&a.vault&&i.vaultController.onUserActivity()}var l=this,d=jQuery(i),u=window,c=jQuery(u),h=o+n++;r?(l.jsApiEventListener=function(e){e.type===Microsoft.Office[WacConfig.Unified.WacApplication].EventIds.UserActivity&&s()},$Wac.addJsApiEventListener(l.jsApiEventListener)):d.bind(t.PostMessageHandler.WacUserActivityEvent+h,s),l.dispose=function(){r?$Wac.removeJsApiEventListener(l.jsApiEventListener):(d.unbind(h),c.unbind(h))}}var t=wLive.Core,i=wLive.Controls,n=0,r=WacConfig&&WacConfig.BootWithJsApiV2,o=".userActivityHandler";i.UserActivityHandler=e}()}),define("refreshsessioninfohandler",["useractivityhandler"],function(){!function(){function e(e,i,I){function x(e,n){O||(O=t.OfficePageController.getInstance().getAriaLogger());var r=void 0;V?r=[{Id:w,Details:C}]:(V=!0,R=Date.now());var a,s=[],l=!1;if(n&&(a=n[o],a&&a.length)){for(var d=0;d<a.length;d++)switch(a[d]){case c:s.push({Name:c,Errors:r}),l=!0;break;case h:s.push({Name:h,Errors:r}),l=!0;break;default:s.push({Name:a[d],Errors:[{Id:f,Details:g}]})}r&&(l=!1)}l?T(s):i.sendHostRefreshSessionInfo({Tokens:s})}function D(e,t){for(var n,r,o=Date.now()+36e5,a=0;a<t.length;a++)if(e&&e.urls)switch(t[a].Name){case c:n=N(e.urls.wacIframeViewPostParameters,p),r=N(e.urls.wacIframeViewPostParameters,m),n?(t[a].Value=n,t[a].Expiry=r,F(c,R)):(t[a].Errors=[{Id:v,Details:y}],M(c,v,R));break;case h:e.urls.download?(t[a].Value=e.urls.download,t[a].Expiry=o,F(h,R)):(t[a].Errors=[{Id:v,Details:y}],M(h,v,R))}else t[a].Errors=[{Id:v,Details:y}];i.sendHostRefreshSessionInfo({Tokens:t}),$=0,V=!1,k=0}function E(e,t){k++,e&&e.code===d?U(P,e,t):P(e,t)}function P(e,t){if(s>$)$++,A(function(e){setTimeout(function(){var i=document.getElementById(a);i&&document.body.removeChild(i),e?E(e,t):T(t)},S)});else{for(var n=0;n<t.length;n++)switch(t[n].Name){case c:t[n].Errors=[{Id:e.code,Details:e.debugMessage}],M(c,e.code,R);break;case h:t[n].Errors=[{Id:e.code,Details:e.debugMessage}],M(h,e.code,R)}i.sendHostRefreshSessionInfo({Tokens:t}),$=0,V=!1}}function T(e){var i=0;Flight.Ramps&&Flight.Ramps.RefreshSessionTokenWithBackoff&&(i=wLive.getExpDelayBackoff(S,k,_)),wLive.throttle(Q,i,function(){return I.getExtendedInfo(function(t){D(t,e)},function(t){E(t,e)},t.SkyDriveItem.ExtendedProperty.WacIFrameViewUrl)},!0)}function A(e){var t=FilesConfig.signInUrl+L();W.bind("message"+Q,function(t){if(t=t.originalEvent,t.origin===j.location.origin&&t.data)if("MSA_AuthenticationSuccess"===t.data)e();else if("MSA_AuthenticationError"===t.data){var i={code:"ReauthenticationError",debugMessage:"Error received from MSA during reauthentication."};e(i)}});var i=document.createElement("iframe");i.id=a,i.src=t,i.style.display="none",document.body.appendChild(i)}function L(){var e="https://onedrive.live.com/sa?msaCallback=1";return"soak2"===FilesConfig.env?e="https://soak2.test.onedrive.live.com/sa?msaCallback=1":"soak3"===FilesConfig.env?e="https://soak3.test.onedrive.live.com/sa?msaCallback=1":"dev"===FilesConfig.env&&(e="https://dev.onedrive-dev.live.com/sa?msaCallback=1"),"&checkda=1&ru="+encodeURIComponent(e)}function F(e,t){if(O){var i=new microsoft.applications.telemetry.EventProperties;i.name="ev_Engagement",i.setProperty("WebLog_FullName","Engagement,"),i.setProperty("WebLog_EventType","Single"),i.setProperty("WebLog_Type_Engagement","1"),i.setProperty("UsageType","Click"),i.setProperty("Name","RefreshSessionInfo_Success"),i.setProperty("TokenType",e||"TokenNotProvided"),t?i.setProperty("Latency",Date.now()-t):i.setProperty("Latency",0),O.logEvent(i)}}function M(e,t,i){if(O){var n=new microsoft.applications.telemetry.EventProperties;n.name="ev_UnhandledError",n.setProperty("Name","RefreshSessionInfo_Error"),n.setProperty("TokenType",e||"TokenNotProvided"),n.setProperty("error",t||"UnknownError"),i?n.setProperty("Latency",Date.now()-i):n.setProperty("Latency",0),O.logEvent(n)}}function N(e,t){if(e)for(var i=e.split("&"),n=0;n<i.length;n++){var r=i[n].split("=");if(r&&2==r.length&&r[0].toUpperCase()===t.toUpperCase())return r[1]}return null}function U(e,i,n){if(Flight.Ramps&&Flight.Ramps.RefreshSessionTokenCanary){var r=l,o=new t.DataRequest(r,r,null,function(t){t&&t.canary&&FilesConfig.canary!==t.canary&&(FilesConfig.canary=t.canary,e(i,n))},function(t){M("canary",u),e(i,n)});o.apiId="SkyDrive_Web_GetPageContext",o.propertyId="SkyDrive",o.start()}}var R,O,B=this,H=jQuery(i),j=window,W=jQuery(j),Q=b+r++,$=0,V=!1;n?(B.jsApiEventListener=function(e){e.type===Microsoft.Office[WacConfig.Unified.WacApplication].EventIds.RefreshSessionInfo&&x(null,e.data)},$Wac.addJsApiEventListener(B.jsApiEventListener)):H.bind(t.PostMessageHandler.WacAppRefreshSessionInfoEvent+Q,x),B.dispose=function(){n?$Wac.removeJsApiEventListener(B.jsApiEventListener):(H.unbind(Q),W.unbind(Q))}}var t=wLive.Core,i=wLive.Controls,n=WacConfig&&WacConfig.BootWithJsApiV2,r=0,o="Tokens",a="msa_reauth_frame",s=1,l="/GetPageContext",d=103,u="CanaryRefreshFailure",c="AccessToken",h="FileGetUrl",p="access_token",m="access_token_ttl",f="UnknownToken",g="The requested token is not supported.",v="TokenNotAvailable",y="The requested token is not available.",w="202",C="Call in progress",b=".refreshSessionInfoHandler",k=0,S=2e3,_=18e4;i.RefreshSessionInfoHandler=e}()}),define("getaccesstokenhandler",["jquery-1.7.2","refreshsessioninfohandler"],function(){!function(){function e(e,i,s){function l(e,t){if(t){var o=t[r];o&&i.sendPostAccessToken(o,null,n,0,0)}}var d=this,u=jQuery(i),c=a+o++;u.bind(t.PostMessageHandler.WacGetAccessTokenEvent+c,l),d.dispose=function(){u.unbind(c)}}var t=wLive.Core,i=wLive.Controls,n="access_denied",r="AddinControlId",o=0,a=".getAccessTokenHandler";i.GetAccessTokenHandler=e}()}),define("versionhistoryhandler",["getaccesstokenhandler"],function(){!function(){function e(e,a,s){function l(){if(FilesConfig.authKey){var t=new i.TicketRedeemer(e);t.show(d())}else $BSI.navigateTo(WacConfig.FileVersionUrl)}function d(){var e={item:s,action:{url:WacConfig.FileVersionUrl},authkey:FilesConfig.authKey,callback:function(){$BSI.navigateTo(WacConfig.FileVersionUrl)},onHide:function(){a.sendGrabFocus()},onShow:function(){a.sendBlurFocus()}};return e}var u=this,c=jQuery(a),h=o+r++;n?(u.jsApiEventListener=function(e){e.type===Microsoft.Office[WacConfig.Unified.WacApplication].EventIds.FileVersions&&l()},$Wac.addJsApiEventListener(u.jsApiEventListener)):c.bind(t.PostMessageHandler.WacFileVersionsEvent+h,l),u.dispose=function(){n?$Wac.removeJsApiEventListener(u.jsApiEventListener):c.unbind(h)}}var t=wLive.Core,i=wLive.Controls,n=WacConfig&&WacConfig.BootWithJsApiV2,r=0,o=".versionHistoryHandler";
i.VersionHistoryHandler=e}()}),define("copyedithandler",["versionhistoryhandler"],function(){!function(){function e(e,d,u){function c(i,n){n&&(p=n[o],m=n[a]);var r=new t.TicketRedeemer(e);r.show(h())}function h(){var e=p===s?WacConfig.ViewUrl:WacConfig.EditUrl;m&&(e+=m);var t={item:u,action:{url:e},authkey:FilesConfig.authKey,callback:function(){$BSI.navigateTo(e)},onHide:function(){d.sendGrabFocus()},onShow:function(){d.sendBlurFocus()}};return t}var p,m,f=this,g=jQuery(d),v=l+r++;n?(f.jsApiEventListener=function(e){e.type!==Microsoft.Office[WacConfig.Unified.WacApplication].EventIds.CopyAndEdit&&e.type!==Microsoft.Office[WacConfig.Unified.WacApplication].EventIds.Edit||c(null,e.data)},$Wac.addJsApiEventListener(f.jsApiEventListener)):g.bind(i.PostMessageHandler.WacCopyEditEvent+v,c),f.dispose=function(){n?$Wac.removeJsApiEventListener(f.jsApiEventListener):g.unbind(v)}}var t=wLive.Controls,i=wLive.Core,n=WacConfig&&WacConfig.BootWithJsApiV2,r=0,o="targetWacAction",a="wdparams",s="View",l=".copyEditHandler";t.CopyEditHandler=e}()}),define("signinhandler",["copyedithandler"],function(){!function(){function e(e,d,u){function c(i,n){n&&(p=n[o],m=n[a]);var r;if(r=p===s?WacConfig.ViewUrl:WacConfig.EditUrl,m&&(r+=m),FilesConfig.authKey){var l=new t.TicketRedeemer(e);l.show(h(r))}else{var d=FilesConfig.signInUrl+"&ru="+r.encodeUrl()+"&wreply="+r.encodeUrl();$BSI.navigateTo(d,"_top")}}function h(e){var t={item:u,action:{url:e},authkey:FilesConfig.authKey,callback:function(){$BSI.navigateTo(e)},onHide:function(){d.sendGrabFocus()},onShow:function(){d.sendBlurFocus()}};return t}var p,m,f=this,g=jQuery(d),v=l+r++;n?(f.jsApiEventListener=function(e){e.type===Microsoft.Office[WacConfig.Unified.WacApplication].EventIds.SignIn&&c(null,e.data)},$Wac.addJsApiEventListener(f.jsApiEventListener)):g.bind(i.PostMessageHandler.WacSignInEvent+v,c),f.dispose=function(){n?$Wac.removeJsApiEventListener(f.jsApiEventListener):g.unbind(v)}}var t=wLive.Controls,i=wLive.Core,n=WacConfig&&WacConfig.BootWithJsApiV2,r=0,o="targetWacAction",a="wdparams",s="View",l=".signInHandler";t.SignInHandler=e}()}),define("renamefilehandler",["signinhandler"],function(){!function(){function e(e,t,s){function l(e,t){var i;t&&(i=t[o]),i&&($f.updateTitle(WacConfig.PageTitleType.format(i)),s.expire(),s.invalidate(),s._dataModel.getItem(s.key))}var d=this,u=jQuery(t),c=a+r++;n?(d.jsApiEventListener=function(e){e.type===Microsoft.Office[WacConfig.Unified.WacApplication].EventIds.FileRenamed&&l(null,e.data)},$Wac.addJsApiEventListener(d.jsApiEventListener)):u.bind(i.PostMessageHandler.WacRenameFileEvent+c,l),d.dispose=function(){n?$Wac.removeJsApiEventListener(d.jsApiEventListener):u.unbind(c)}}var t=wLive.Controls,i=wLive.Core,n=WacConfig&&WacConfig.BootWithJsApiV2,r=0,o="NewName",a=".renameFileHandler";t.RenameFileHandler=e}()}),define("openinclienthandler",["renamefilehandler"],function(){!function(){function e(e,a,s){function l(){var t=new i.TicketRedeemer(e);t.show(d())}function d(){var e={item:s,action:{url:u()},authkey:FilesConfig.authKey,callback:function(){$BSI.navigateTo(u())},onHide:function(){a.sendGrabFocus()},onShow:function(){a.sendBlurFocus()}};return e}function u(){return WacConfig.FilePropertiesUrl+"&action="+WacConfig.OpenInClientAction}var c=this,h=jQuery(a),p=o+r++;n?(c.jsApiEventListener=function(e){e.type===Microsoft.Office[WacConfig.Unified.WacApplication].EventIds.OpenInClient&&l()},$Wac.addJsApiEventListener(c.jsApiEventListener)):h.bind(t.PostMessageHandler.WacOpenInClientEvent+p,l),c.dispose=function(){n?$Wac.removeJsApiEventListener(c.jsApiEventListener):h.unbind(p)}}var t=wLive.Core,i=wLive.Controls,n=WacConfig&&WacConfig.BootWithJsApiV2,r=0,o=".openInClientHandler";i.OpenInClientHandler=e}()}),define("shareformhandler",["openinclienthandler"],function(){!function(){function e(e,a,s){function l(n,r){t.BiciHelpers.reportClickAction("SF","WAC","WAC");var o=r&&r.SurveyTitle;if(!u){var a=new t.PermissionsProvider(e.callerCid),l=new i.SendForm(a);l.show(s,o)}}var d=this,u=!1,c=jQuery(a),h=o+r++;n?(d.jsApiEventListener=function(e){e.type===Microsoft.Office[WacConfig.Unified.WacApplication].EventIds.ShareForm&&l(null,e.data)},$Wac.addJsApiEventListener(d.jsApiEventListener)):c.bind(t.PostMessageHandler.WacShareFormEvent+h,l),d.dispose=function(){n?$Wac.removeJsApiEventListener(d.jsApiEventListener):(c.unbind(h),u=!0)}}var t=wLive.Core,i=wLive.Controls,n=(t.AleHelpers.getPCString,WacConfig&&WacConfig.BootWithJsApiV2),r=0,o=".shareFormHandler";i.ShareFormHandler=e}()}),define("sharehandler",["sharedialogv3","shareformhandler","vaultcontroller"],function(){!function(){function e(e,u,c){function h(n,r){if(t.BiciHelpers.reportClickAction("SH","WAC","WAC"),c.vault)u.vaultController.showSharingDisabledDialog();else if("UnAuth"!==$Config.cid&&"0"!==e.viewParams.sharev3){if(!A){A=!0;var o=new i.ShareDialogV3(c,u,e);o.showShareDialog(r,function(){A=!1})}}else g()}function p(){var r=new t.PermissionsProvider(e.callerCid);r.fetchPermissions(c,function(e,t){!A&&b&&f(r)},function(){var e=n("Sharing.GetPermissionsError"),t=jQuery('<div class="ips_error"></div>'),r=new i.InlineError(t,e);r.render(),T=jQuery(a),T.find(".sd_header").text(x),T.find(".ips_list").hide(),T.find(".sd_shareMore").hide(),T.find(".sd_done").val(I).click(w),t.insertBefore(T.find(".ips_list")),C(T),v()},!0)}function m(){d||(d=!0,$Do.isRegistered("Bucket3.css")||window.$Network.fetchCSS(FilesConfig.bucket3CssLocation,function(){$Do.register("Bucket3.css")},void 0,"Gfx_Css_FilesBucket3_Download","Gfx"))}function f(t){m(),$Do.wE("Bucket3.css",0,function(){var n=jQuery('<div class="sd_pop_wrapper"></div>');C(n);var r=new i.ShareDialog(n,t,c,null,e,w);r.render(),v(),A=!0,sutra(n.closest(".ModalDialog"),"$Sutra.SkyDrive.WacSharing")})}function g(){if(b&&(b.dismiss(),b=null),P=jQuery('<div style="min-height:270px;"></div>'),b=k&&k.createModalDialog({content:P[0]})){var e=jQuery(b);e.bind({"beforeshow._dlg":function(e,t){S=jQuery(".ModalDialog"),S.hide()},"aftershow._dlg":function(e,t){u.sendBlurFocus(),p(),jQuery(".UserArea").on("click",".sd_cancel",function(e){w()}),b&&b.reposition()},"afterdismiss._dlg":function(t,i){jQuery(".UserArea").off("click",".sd_cancel"),L=!1,S.unbind("onclose._dlg"),e&&e.unbind("._dlg"),e=null,b=null},"buttonclick._dlg":y}),b.show(),k.getQueue().start()}}function v(){b&&!L&&(L=!0,S.show())}function y(e,t,i){return w(),!0}function w(){b&&(b.dismiss(),b=null),A=!1,L=!1,u.sendGrabFocus()}function C(e){b&&(jQuery(".UserContent").html(e),setTimeout(function(){b.reposition()},0))}var b,k,S,_=this,I=n(l+"Done"),x=(n("Cancel"),n(l+"ShareMore"),n(l+"CurrentPermissions")),D=(jQuery(window),jQuery(u)),E=s+o++;$Do.when("NotificationControls",0,function(){k=i.Notifications});var P,T,A=!1,L=!1;r?(_.jsApiEventListener=function(e){e.type===Microsoft.Office[WacConfig.Unified.WacApplication].EventIds.Share&&h(null,e.data)},$Wac.addJsApiEventListener(_.jsApiEventListener)):D.bind(t.PostMessageHandler.WacShareEvent+E,h),_.dispose=function(){r?$Wac.removeJsApiEventListener(_.jsApiEventListener):D.unbind(E)}}var t=wLive.Core,i=wLive.Controls,n=t.AleHelpers.getPCString,r=WacConfig&&WacConfig.BootWithJsApiV2,o=($B.rtl?"right":"left",$B.rtl?"left":"right",0),a='<div class="sd_pop_wrapper wac_permissions"><div class="sd_content"><div class="sd_datacontainer"><h2 class="sd_header"></h2><ul class="ips_list"></ul></div><br /><br /><div class="sd_btns"><input class="sd_shareMore default" type="button" /><input class="sd_done" type="button" /></div></div></div>',s=".shareHandler",l="Office.Sharing.",d=!1;i.ShareHandler=e}()}),define("embedhandler",["sharehandler"],function(){!function(){function e(e,s,l){function d(){t.BiciHelpers.reportClickAction("EM","WAC","WAC"),l.expire=function(){},l.invalidate=function(){},f||(p=new n(e.callerCid),FilesConfig.shouldSendCanEmbed?p.fetchPermissions(l,u,h,!0):h())}function u(e,i){for(var r,o=i.permissionScopes,a=0;a<o.length;a++){var l=o[a];if(t.StringHelpers.caseInsensitiveStringEquals(l.id,e.id)){for(var d=l.entities,u=0;u<d.length;u++){var p=d[u];if(p.type==n.EntityType.Link&&p.linkType==n.LinkType.Embed){r=c(p);break}}break}}r?s.sendCanEmbed(r):h()}function c(e){return e.link+"&em=2"}function h(){var e=function(){s.sendGrabFocus()},t=FilesConfig.shouldSendCanEmbed&&function(e){i.dispose(),s.sendCanEmbed(c(e))},i=new y(p);s.sendBlurFocus();var n=-1!=l.commands.indexOf("em,2");i.show(l,!1,n,e,t)}var p,m=this,f=!1,g=jQuery(s),v=a+o++,y=i.Embed;r?(m.jsApiEventListener=function(e){e.type===Microsoft.Office[WacConfig.Unified.WacApplication].EventIds.FileEmbed&&d()},$Wac.addJsApiEventListener(m.jsApiEventListener)):g.bind(t.PostMessageHandler.WacFileEmbedEvent+v,d),m.dispose=function(){r?$Wac.removeJsApiEventListener(m.jsApiEventListener):g.unbind(v),f=!0}}var t=wLive.Core,i=wLive.Controls,n=t.PermissionsProvider,r=WacConfig&&WacConfig.BootWithJsApiV2,o=0;i.EmbedHandler=e;var a=".embedHandler"}()}),define("qoshelpers",["dependancies","do","basecontrol","validateconfig","pagestats"],function(){!function(){function e(e){try{var t=$WebWatson.CB.IsIgnored;$WebWatson.CB.IsIgnored=function(){return!0},m(e)}catch(e){}finally{$WebWatson.CB.IsIgnored=t}}function t(){$Static.setQosCB(l)}function i(){c=!0,f.unbind("unload",i),f.unbind("load",t),clearInterval(u),d()}function n(){var e=Qos.getContext(),t=arguments[1]||arguments[0];return t.success=Qos.instrument(e,t.success),t.error=Qos.instrument(e,t.error),t.complete=Qos.instrument(e,t.complete),c&&-1!==t.url.indexOf("ScenarioQos")&&window.top===window.self&&(t.async=!1),p.apply(this,arguments)}function r(){return Qos.getContext()}function o(e,t,i,n,r,o,a,s,l,d){return!e||!t||!a}function a(e,t,i,n,r,o,a,s,l,d){Qos.onUnhandledError(e,t,a),$WebWatson.resetException()}function s(e,t){return Qos.instrument(t,e)}function l(e){for(var t=0;t<e.length;t++){var i=e[t];Qos.log(i.apiId,i.propertyId,i.startTime,i.errorCode,i.errorType,void 0,i.endTime)}}function d(){Qos.start("SkyDriveWeb_Internal_QosOnQos_FlushToServer");var e=null,t=Qos.clearLogs();for(var i in t)if(t.hasOwnProperty(i)){var n=t[i],r={api:n.id,dependent:n.partnerId,error:n.errorCode,errorType:n.errorType,stackTrace:n.stack,actionId:n.actionId,parentActionId:n.parentActionId};e||(e=$ScenarioQoS.startScenario("SkyDriveWeb_None","SkyDriveWeb")),wLive.ScenarioQoSStats.add(r,n.startTime,e,n.endTime-n.startTime)}e&&$ScenarioQoS.stopScenario(e,!0),Qos.end()}var u,c,h="SkyDriveWeb_Internal_Unknown",p=jQuery.ajax,m=$WebWatson.submitFromException,f=jQuery(window);jQuery.ajax=n,$Do.x=r,$WebWatson.submitFromException=Qos.instrumentException,$WebWatson.CB.ErrorOccurred=a,$WebWatson.CB.InstrumentDelegate=s,$WebWatson.CB.IsHidden=o,$WebWatson.CB.IsIgnored=o,FilesConfig.qosFlushInterval&&(u=setInterval(d,FilesConfig.qosFlushInterval)),f.bind("load",t),f.bind("unload",Qos.instrument(null,i)),Qos.registerDefaultErrorId(h),Qos.registerQosOnLogErrorId("SkyDriveWeb_Internal_QosOnQos_LogError"),Qos.displayErrorCallback=e}()}),define("editnotificationhandler",["embedhandler","qos","qoshelpers"],function(){!function(){function e(e,i,d){function u(){if(o){var t={editActivityOn:c(),callercid:e.callerCid,resId:e.viewParams.resid,wacqt:e.viewParams.wacqt};Qos.logData(a,s,Date.now(),null,null,t),o=!1}}function c(){var i="unknown";if(!e.viewParams.resid||!e.callerCid)return i;var n=t.SkyDriveItemHelper.parseCidFromItemId(e.viewParams.resid.toLowerCase()),r=e.callerCid.toLowerCase();return n==r?i="owned":void 0==e.viewParams.wacqt?i="mounted":"sharedby"==e.viewParams.wacqt&&(i="shared"),i}var h=this,p=!1,m=jQuery(i),f=l+r++;n?(h.jsApiEventListener=function(e){e.type===Microsoft.Office[WacConfig.Unified.WacApplication].EventIds.UserEditActivity&&u()},$Wac.addJsApiEventListener(h.jsApiEventListener)):m.bind(t.PostMessageHandler.WacEditNotificationEvent+f,u),h.dispose=function(){n?$Wac.removeJsApiEventListener(h.jsApiEventListener):m.unbind(f),p=!0}}var t=wLive.Core,i=wLive.Controls,n=WacConfig&&WacConfig.BootWithJsApiV2,r=0,o=!0,a="SkyDrive_Internal_Wac_DocumentEdit",s="SkyDrive",l=".editNotificationHandler";i.EditNotificationHandler=e}()}),define("ipadzoom",[],function(){!function(){function e(e){for(var t=e.getElementsByTagName("meta"),i=0;i<t.length;i++)if("viewport"==t[i].name){t[i].content=FilesConfig.isWac?"width=device-width, initial-scale=1.0, maximum-scale=4.0, minimum-scale=1.0, user-scalable=yes":"width=device-width, initial-scale=1.0, maximum-scale=1.01, minimum-scale=0.99, user-scalable=yes";break}}function t(){if("undefined"==typeof t.iframe&&(t.iframe=document.getElementById("sdx_ow_iframe"),t.windowWidth=t.windowHeight=0),t.windowWidth!=window.innerWidth||t.windowHeight!=window.innerHeight){var e=t.iframe.style;e.width=screen.width+"px",e.height=screen.height+"px",window.scrollTo(0,1),t.windowWidth=window.innerWidth,t.windowHeight=window.innerHeight,e.width=t.windowWidth+"px",e.height=t.windowHeight+"px"}}if($B.SF_iPhone&&!$B.Mobile?setTimeout(function(){e(document),e(window.parent.document)},100):$B.SF_iPhone&&FilesConfig.isWac&&window.addEventListener("load",function(){setTimeout(function(){t()},1e3)}),$B.Mobile&&FilesConfig.isWac&&$B.IE&&$B.V>=10){document.body.style.msContentZooming="none";var i=document.getElementById("sdx_ow_iframe");i&&(i.style.msTouchAction="none")}$B.Mobile&&FilesConfig.isWac&&"onpageshow"in window&&(window.onpageshow=function(e){e.persisted&&(document.body.style.display="none",location.reload())})}()}),define("Wac_s_Office",function(){});